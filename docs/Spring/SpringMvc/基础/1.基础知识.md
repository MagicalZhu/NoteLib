---
id: 基础知识
title: 基础知识
cssclasses:
  - wide-page
---

## 基本概念

> 三层架构分为表述层/表示层、业务逻辑层、数据访问层,表述层表示**前台页面和后台 Servlet**

SpringMVC 是**基于 Servlet API 构建的 Web 框架**, 并且作为的子项目包含在 Spring 框架中

### MVC

首先 MVC 是一种软件架构的思想, 将软件按照模型层(Model)、视图层(View)、控制器层(Controller)的三层架构来划分:

- Model(模型层): 项目中的JavaBean,作用是处理数据
- View(视图层): 项目中的html或jsp等页面, 作用是与用户进行交互,展示数据
- Controller(控制层):项目中的servlet, 作用是接收请求和响应浏览器

MVC 的大致工作流程:

- 用户通过视图层发送请求到服务器,在服务器中请求被 Controller 接收
- Controller调用相应的Model层处理请求,处理完毕将结果返回到 Controller
- Controller再根据请求处理的结果找到相应的 View 视图,渲染数据后最终响应给浏览器

### 相关组件

1. `DispatcherServlet`
    - 前端控制器,对浏览器发送的请求进行统一的处理
2. `Controller`
    - 处理器/页面控制器,也就是 MVC 中的 C
3. `HandlerMapping`
    - 请求映射处理器
    - 如果映射成功返回一个 HandlerExecutionChain 对象(包含一个 Handler 处理器(页面控制器)对象、多个 HandlerInterceptor 拦截器对象)
4. `ViewResolver`
    - 视图解析器, 用于将把逻辑视图解析为具体的 视图对象(View)
    - 它采用了策略模式,一边方便的更换其他视图技术
      -比如 *InternalResourceViewResolver* 将逻辑视图名映射为 jsp 视图
5. `LocaleResolver`
    - 本地化、国际化
6. `MultipartResolver`
    - 文件上传解析器
7. `HandlerExceptionResolver`
    - 异常处理器

## 基本示例

> 创建一个 SpringMvc 的 "HelloWorld" 项目的基本步骤

常见一个基本的 SpringMvc 项目的基本步骤:

1. 创建一个 Maven 工程
   - 添加 Web 模块的依赖
   - 项目的打包方式设置为 `war`
2. 配置 web.xml
3. 创建请求控制器
4. 创建应用上下文配置文件(SpringMvc 配置文件),与 Spring 配置元信息文件基本一致

### 创建 Maven 工程

> 需要引入Spring 的 web 模块,并且将项目打包为war

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.example</groupId>
        <artifactId>mvc-action</artifactId>
        <version>1.0-SNAPSHOT</version>
    </parent>
    <groupId>com.pacos</groupId>
    <artifactId>MvcIntro</artifactId>
    <packaging>war</packaging>
    <name>MvcIntro</name>
    <dependencies>
        <!-- SpringMVC -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
        </dependency>

        <!-- 日志 -->
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
            <version>1.2.3</version>
        </dependency>

        <!-- ServletAPI -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>3.1.0</version>
            <scope>provided</scope>
        </dependency>

        <!-- Spring5和 Thymeleaf 整合包 -->
        <dependency>
            <groupId>org.thymeleaf</groupId>
            <artifactId>thymeleaf-spring5</artifactId>
            <version>3.0.12.RELEASE</version>
        </dependency>
    </dependencies>
</project>
```

### 配置 web.xml

- 配置前端控制器 Servlet: `DispatcherServlet`
- 配置 Servlet 应用上下文 配置文件的路径, 参数名是固定的: `contextConfigLocation`
  - 通过 `classpath:` 前缀来表示 resource 资源目录,否则 `/` 表示 web 目录

- 配置 DispatcherServlet 对应的 servlet-mapping, 且url-pattern 是相对于应用上下文路径的
  - 如果配置为 **/app/***, 那么请求路径需要在 应用上下文路径 后面拼接上 **/app**

```xml
<servlet>
    <servlet-name>dispatcher</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <!-- 通过初始化参数指定SpringMVC配置文件的位置和名称 -->
    <init-param>
        <!-- contextConfigLocation 为固定值 -->
        <param-name>contextConfigLocation</param-name>
	      <!--使用 classpath 表示 resource 资源目录-->
	      <param-value>classpath:/META-INF/app.xml</param-value>
      	<!-- 使用 / 表示 web app 目录 -->
	      <!--
			 <param-value>/WEB-INF/app.xml</param-value>
				-->
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name>dispatcher</servlet-name>
    <!--
        设置 DispatcherServlet 所能处理的请求的请求路径
        / 所匹配的请求可以是:  /login、.html、.js、.css方式的请求路径
        但是 / 不能匹配 .jsp请求路径的请求
    -->
    <url-pattern>/app/*</url-pattern>
</servlet-mapping>
```

### 创建请求控制器

> 也就是创建一个 Controller

通过 @GetMapping 来映射请求,**并且它是 @RequestMapping 的派生注解**

```java
@Controller
public class HelloController {
    @GetMapping("/hello")
    @ResponseBody
    public String hello() {
        return "hello,world";
    }
  	
  	// 跳转到 /WEB-INF/templates 下的指定视图
    @GetMapping("/index")
    public String index() {
        return "index";
    }
}
```

### 创建应用上下文配置文件

> SpringMvc 作为 Spring 的子项目,配置文件也和 Spring 是一致的!

1. 指定包扫描的 base-package,保证将 Controller 注册到 IOC 容器中
2. 配置视图解析器
   - 比如 `ThymeleafViewResolver`
     - 配置视图前缀、视图后缀…
   - 比如处理 jsp 的 `InternalResourceViewResolver`
3. 处理静态资源, 比如 html、js、css、jpg
4. 开启mvc注解驱动(**在配置 component-scan 的时候也会添加对注解的支持**)
   - 设置数据转换功能(中文乱码、支持的 mediaType ...)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
                http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context
                http://www.springframework.org/schema/context/spring-context-4.2.xsd">
   <!--指定包扫描路径-->
    <context:component-scan base-package="com.pacos"/>
		
  	<!--配置视图解析器-->
    <bean id="viewResolver" class="org.thymeleaf.spring5.view.ThymeleafViewResolver">
        <property name="order" value="1"/>
        <property name="characterEncoding" value="UTF-8"/>
        <property name="templateEngine">
            <bean class="org.thymeleaf.spring5.SpringTemplateEngine">
                <property name="templateResolver">
                    <bean class="org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver">

                        <!-- 视图前缀 -->
                        <property name="prefix" value="/WEB-INF/templates/"/>

                        <!-- 视图后缀 -->
                        <property name="suffix" value=".html"/>
                        <property name="templateMode" value="HTML5"/>
                        <property name="characterEncoding" value="UTF-8" />
                    </bean>
                </property>
            </bean>
        </property>
    </bean>
  
     <!-- 
       处理静态资源, 例如html、js、css、jpg
     -->
    <mvc:default-servlet-handler/>

    <!-- 开启mvc注解驱动 -->
    <mvc:annotation-driven>
        <mvc:message-converters>
            <!-- 处理响应中文内容乱码 -->
            <bean class="org.springframework.http.converter.StringHttpMessageConverter">
                <property name="defaultCharset" value="UTF-8" />
                <property name="supportedMediaTypes">
                    <list>
                        <value>text/html</value>
                        <value>application/json</value>
                    </list>
                </property>
            </bean>
        </mvc:message-converters>
    </mvc:annotation-driven>
</beans>
```

:::tip 基本流程

- 浏览器发送请求, 如果请求地址符合前端控制器的 url-pattern, 那么该请求就会被 前端控制器 DispatcherServlet 处理
- DispatcherServlet 会读取SpringMVC的核心配置文件, 通过扫描组件找到请求控制器Controller, 并且将请求地址和控制器中 @RequestMapping 的 value 属性值进行匹配
- 若匹配成功, 该注解所标识的控制器方法就是处理请求的方法。处理请求的方法需要返回一个字符串类型的视图名称, 该视图名称会被视图解析器解析, 加上前缀和后缀组成视图的路径
- 最后通过模板引擎(比如 Thymeleaf) 对视图进行渲染, 最终**转发**到视图所对应页面

:::

## 相关注解

### @RequestMapping
