---
id: tcp-ip-basic
title: TCP-IP基础
---


TCP(Transmission Control Protocol) 和 IP(Internet Protocol) 是最著名的通信协议

![TCP-IP与OSI](./image/TCP-IP基础/TCP-IP与OSI.png)

## TCP/IP协议分层

### 对比OIS模型

![OSI与TCP-IP模型](./image/TCP-IP基础/OSI与TCP-IP模型.png)

可以看出来,OSI参考模型专注于**通信协议需要有哪些功能**,而TCP/IP分层模型专注于**实现协议应该开发那种应用程序**。换句话说,OSI专注于协议的功能,而TCP/IP分层模型专注于应用程序的实现

### 硬件层(物理层)

TCP/IP 分层模型中最底层是负责数据传输的硬件,相当于是以太网、电话线等物理设备。它无法被节界定,因为人们使用的传输介质不同,导致网络的带宽、可靠性、安全性、延迟等都有区别,然而这些区别并没有一个标准

### 网络接口层(数据链路层)

> 有时候,也会将硬件层和网络接口层加起来称为**网络通信层**

网络接口层利用数据链路层进行通信,也就是说把它作为网络接口卡(NIC,网卡)的"驱动程序"也可以。

### 互联网层(网络层)

>  互联网层中使用`IP协议`,相当于是OSI参考模型的第三层(网络层)

IP协议是`基于IP地址转发数据包`,所以IP协议的作用就是将数据包发送到指定的目的地。

我们知道互联网通过各种网络设备连接起来的(路由器、交换机...),如果忽略互联网中设备构成,仅仅考虑两台计算机的通信,那么互联网就是具有互联网层功能的网络

![互联网层](./image/TCP-IP基础/互联网层.png)

TCP/IP 分层中的互联网层和传输层的功能一般由`操作系统提供`,尤其对于三层交换机(路由器)来说,需要实现互联网层**转发分组数据包的功能**,并且还需要实现**IP功能**,而其他网络设备(中继器、网桥)则不需要


:::tip 关于互联网层的协议

1. `IP`
    - 跨网络传输数据包,并让数据能触达到整个互联网的任意位置的协议,它实现的基础在于使用 IP 地址作为唯一的识别号
    - 虽然 IP 协议也是分组交换的一种协议,但是它**不具有重发机制**,所以即使数据包没有到达对端主机也不会重发,所以**IP协议属于`非可靠性传输协议`**

2. `ICMP`
    - IP数据包在发送途中一旦发生异常没有正确的送到对端的主机,需要**给发送端发送一个异常通知**,ICMP协议就是用来做这个的

3. `ARP`
    - 从分组数据的 IP 地址中解析出物理地址(MAC地址)的一种协议

:::


### 传输层

> 传输层最主要的功能就是让应用程序之间可以实现通信,并且在计算机内部同时运行这个多个程序,通过`端口`来区分哪些程序和哪些程序在通信

在传输层有两个最具代表性的协议:

1. `TCP`
2. `UDP`

#### TCP

> 它是`面向有连接`的传输层协议

1. TCP 协议的优点
    - 可以保证两端通信主机之间的通信可达,可以正确的处理数据包在传输过程中可能出现的**丢包、传输顺序乱掉等异常情况**
    - 可以有效利用带宽(拥堵算法...),缓解网络拥堵

2. TCP 协议的缺点
    - 为了建立连接,所以正常来说至少需要 7 次发包与收包(**3次握手 + 4 次挥手**),这个一定程度上导致了网络流量的浪费
    - 为了提高网络的利用率,TCP 协议定义许多的复杂的规范,这些规范并不利于对实时性要求较高的场景(视频会议等)

#### UDP

和TCP协议不同的是,UDP是`面向无连接`的传输层协议,这个意味着它**不需要知道对端是否接收到了数据**。当然如果需要知道对端是否接收到了数据,则需要在应用程序中实现

<mark>UDP常用语分组数据较少活着的多播、广播通信、视频会议等领域</mark>

### 应用层(会话层及以上)

在TCP/IP的分层中,将OSI中的会话层、表示层、应用层统一划分为**应用层**,也就是说在应用程序中会实现OSI会话层及以上的所有功能。

现在基于TCP/IP 的应用程序的架构一般都是**C/S模型**,也就是客户端/服务端模型,提供服务资源的是服务端,而接受服务资源的则是客户端。我们将服务资源提前"部署"到服务器上,然后客户端可以随时向服务端发送访问请求

下面是常见的应用:

1. `WWW`
    - 通过浏览器访问服务端上的资源
    - 浏览器与服务器之间通信使用协议的是`HTTP(Hyper Text Transfer Protocol)`,所传输数据的主要格式是`HTML(Hyper Text Markup Protocol)`。与之对应的 HTTP 就是OSI 应用层的协议,而 HTML 就属于表示层的协议

2. `Email`
    - 发送电子邮件时使用的协议是`SMTP(Simple Mail Transfer Protocol)`, 邮件中可以包含图片、文件、视频等,这些都称为`MIME` ,这个 MIME 就属于表示层的协议

3. `FTP(File Transfer Protocol)`
    - 文件传输协议,就是将存储在其他计算机磁盘上的文件保存到本地磁盘上,或者将本地磁盘上的文件传送到其他计算机的磁盘上
    - 在不同操作系统传输文本文件的时候,会自动修改换行符,这一点就是表示层的体现
    - 使用 FTP 的时候,会建立两个 TCP 连接: `发出传输请求的控制连接` 和 `实际传输数据的数据连接`,这两个连接都属于会话层的功能

4. `SSH / TELNET`

## 分层模型

### 数据包首部

![数据包首部](./image/TCP-IP基础/数据包首部.webp)

每一层都会对发送的数据加上一个首部信息,这个首部信息描述了**该层的必要信息(如目标地址、协议相关的信息)**,通常来说<mark>为协议的是包首部,要发送的内容是数据</mark>。站在下一层的角度看,数据就是上一层的所有数据(包首部+内容)

:::tip 包首部

网络中传输的数据包由两部分组成:

1. `协议需要使用到的包首部`
2. `上一层传过来的所有数据(也包含上一层的包首部)`

首部信息由**协议的具体规范定义**,比如:

- 识别上一层协议的域应该从第几位开始,取多少个 bit 
- 如何计算校验和(checksum),并插入包的哪一位
- ...

不同的协议首部信息是不同的,所以也就无法通信

:::

### 发送数据包


