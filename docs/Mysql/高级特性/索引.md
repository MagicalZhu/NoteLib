---
id: 索引
title: 索引
---



## 为什么使用索引

> 索引是存储引擎用于快速找到数据记录的一种数据结构 , MySQL 在进行数据查询的时候,首先查看查询条件是否命中某条索引。如果命中则`通过索引查找数据`,如果不符合就`全表扫描`,直到找到为止!

![image-20220529153631832](./image/索引/image-20220529153631832.png)

1. 最左边数据库没有索引的情况下,`数据分散在磁盘的不同位置`,读取数据的时候，摆臂需要前后摆动查询数据，非常耗时
2. 按中间的方式,数据`顺序摆放`,那么也需要从第一行开始逐行读取,将数据从磁盘加载到内存, 那么也需要进行 N 次的磁盘 IO 操作，仍然十分耗时
3. 最后侧对 Col2 添加了索引,`相当于在磁盘上为 Col2 维护了一个索引的数据结构 -> 二叉搜索树`。二叉搜索树是的每个节点存储的是`K-V 结构`, key 是 Col2，value 是该 key 对应的`文件指针(地址)`

<mark>所以建立索引的目的就是: 减少磁盘 IO 的次数，加快查询效率</mark>

## 索引优缺点

> MySQL 官方对索引的定义为: `索引(index)是帮助 MySQL高效获取数据的数据结构`

- 索引的本质是`数据结构`, 可以简单的理解为**`排好序`**的快速查找数据结构,满足特定查找算法。这些数据结构以某种方式执行数据,这样就可以在这些数据结构的基础上实现`高级查找算法`

- `索引是在存储引擎中实现的`,所以每种存储引擎的索引不一定完全相同，并且每种存储引擎不一定支持所有的索引类型。同时存储引擎可以定义每个表的`最大索引数、最大索引长度`。

- **所有存储引擎支持每个表至少 `16` 个索引,总索引长度至少为 `256` 个字节**

- **索引的优点**
  1. **通过建立索引,可以提高检索效率,从而降低数据库IO 的成本**
  2. **通过创建索引来保证每一行数据的唯一性**
  3. 可以加速表与表之间的连接,即**对于有依赖关系的父子表联合查询时,可以提高查询速度**
  4. 在使用分组和排序子句进行数据查询时,可以显著**减少查询中分组和排序的时间**,降低了 CPU 的消耗
- **索引的缺点**
  1. **创建和维护索引需要耗费时间,耗费的时间会随着数据量的增加而增加**
  2. **索引需要占用磁盘空间, 如果有大量的索引,索引文件就可能比数据文件更快达到最大文件尺寸**
  3. **索引虽然可以提高查询速度,但是会降低表更新速度。因为对表数据进行增删改时,索引也需要动态的维护**

## InnoDb索引的推演

### 索引前的查找

> 一个精确匹配的 Sql 语句: 
>
> ```sql
> SELECT [列名列表] FROM 表名 WHERE 列名 = xxx;
> ```



**一个页中查询**

假设表的数据较少,所有的记录都可以放到一个页中,在查询记录的时候可以按照搜索条件的不同分为下面两种情况

1. **以主键为搜索条件**
   - 可以在页目录使用`二分法` 快速定位到对应的槽,然后再遍历该槽对应分组中的记录就可以快速找到指定的记录
2. **以其他列作为搜索条件**
   - 因为数据页中没有对非主键列建立页目录,所以无法通过二分法快速定位槽，这样只能从`最小记录`开始`依次遍历`但链表中的每条记录，然后对比每条记录是否符合搜索条件

**很多页中查询**

大部分情况下,表中存放的数据是很多的,需要很多的数据页来存储数据。在很多页中查询的话分为两个步骤

1. 定位到记录的页
2. 从所在的页中查找相应的记录

在没有索引的情况下，无论是否按照主键列还是其他列进行查询。由于无法快速定位到记录所在的数据页,所以`只能从第一页开始沿着双向链表一致往下找`,每一页都会按照上面的方式查询指定的记录。由于要遍历所有的数据页,那么所以效率极其低下。

### 设计索引

>建一个表
>
>```sql
>CREATE TABLE index_demo( 
>  c1 INT,
>	c2 INT,
>	c3 CHAR(1), 
>  PRIMARY KEY(c1)
>) ROW_FORMAT =Compact;
>```

新建的 index_demo 表有 2 个 INT 类型的列，1个 Char(1) 类型的列,并且c1为主键。这个表使用`Compact`行格式来实际存储数据

![image-20220529172547929](./image/索引/image-20220529172547929.png)

**Compact行格式展示记录的这几个部分**

1. `record_type`
   - 记录头信息的一项属性，**表示记录的类型**
     - `0` : 表示普通记录
     - `2` : 表示最小记录
     - `3` : 表示最大记录
     - `1`
2. `next_record`
   - 记录头信息的一项属性，**表示下一条地址相对于本条记录的地址偏移量**

3. `各个列的值`
   - 记录在表中列
4. `其他信息`
   - 除了上述3种信息以外的所有信息，包括其他隐藏列的值以及记录的额外信息

**把一些记录放在页里是如下的形式：**

![image-20220529163641319](./image/索引/image-20220529163641319.png)





























