---
id: 基本使用
title: 基本使用
---

## Elastic Search

Elastic Search 有以下的基本组成概念:

1. `Index`
    - 索引，由具有相同字段的文档列表组成
    - Document 存在于 Index 中,类比于数据表 ( Es6.x 以后删除 type 的概念 )
2. `Document`
    - 文档数据 
3. `Field`
    - 字段,文档的属性
4. `Node`
    - 节点, 一个Es的运行实例,是集群的构成单元
5. `Cluster`
    - 集群,由一个或者多个节点组成,对外提供服务

### Document

- Json Object,由 **字段(field)** 组成,常见的数据类型有
  - `字符串`
    - text,keyword
  - `数值型`
    - long,integer,short,byte,double,float,half_float,scaled_float
  - `布尔`
    - boolean
  - `日期`
    - date
  - `二进制`
    - binary
  - `范围类型`
    - integer_range,float_range,long_range,double_range,date_range

- **每个文档都会有唯一id 作为标识**,有两种生成方式：
  1. 手动指定
  2. ES 自动生成

- Document Metadata ,用于标注文档的相关信息
  - `_index ` :  文档所在的索引名
  - `_id`     :  文档唯一id
  - `_source` : 文档原始的Json数据 , 可以从这里获取每个字段的内容
  - `_all`    : 整合所有字段内容到该字段 (默认禁用)
  - `_type`   :  文档所在的类型名
  - `_uid`    :  组合id,由 _type 和 _id组成 ( Es 6.x版本后 _type 不起作用.和 _id 一样)

### Index

> 索引中存储具有相同结构的文档 (Document)

每一个索引都有自己的 `mapping` 映射设置,用于定义 `字段名` 和 `类型`。在集群环境下,一个集群是可以有多个索引的

## REST api

### Index api

> Es有专门的Index api,用于创建 / 更新 / 删除索引配置等

1. 创建索引: `PUT /索引名`
2. 查看现有的索引: `GET _cat/indices`
3. 删除索引: `DELETE /索引名`

### Document api

> Es有专门的 Document Api 来对文档Document 进行 CRUD

1. 创建文档
    - `PUT /指定索引名/[类型]/文档ID`
      - 创建文档,并且手动指定文档名 (类型以后会被移除)
    - `POST  /指定索引名/[类型]`
      - 创建文档,由ES自动生成文档ID (类型以后会被移除)
2. 查询文档
    - `GET /指定索引名/[类型]/文档ID`
      - 查询指定的文档(类型以后会被移除)
    - `GET /_mget {"docs":[ {....},{....} ] }`
      - 批量查询文档
3. 局部更新文档
    - `POST /指定索引名/[类型]/文档ID/_update {"doc":{更新内容}}`
    - 还支持 Groovy 脚本进行局部更新
4. 批量操作文档
    - `POST  _bulk  {"action_type":{.....}}`
    - action_type : 操作类型,有以下的可选值
      - `index` : 创建文档,若文档存在,会覆盖原文档
        - 添加的 json 数据需要单独一行
      - `create` : 创建文档,若文档存在则会报错
      - `update` : 更新文档
        - json格式: `{"doc":{文档内容}}`
        - 更新的json数据需要单独一行
      - `delete` : 删除文档

:::caution 关于更新

注意 : ES中倒排索引是不可以改变的,所以所谓的更新就是: **用新文档替换就文档**

  1. 从旧文档中检索Json
  2. 修改旧的Json数据
  3. 将旧文档标记为不可用,而且无法访问,只有在以后的访问中才会被删除
  4. 创建的新的索引以及文档数据

:::

#### 创建文档示例

```json
# 手动的指定文档的ID
PUT /test_index/doc/1
{
  
  "username":"yoey",
  "age":22
}

# 由ES指定文档的ID
POST /test_index/doc
{
  
  "username":"yoey2",
  "age":33
}
```

#### 查询文档示例

```json
# 通过文档ID查询
GET /test_index/doc/1
```

#### 批量操作文档示例

```json
# 批量的添加
POST _bulk
{"index":{"_index":"test_index","_type":"doc","_id":"2"}}
{"username":"yoey2","age":33}

# 批量的更新
POST _bulk
{"update":{"_index":"test_index","_type":"doc","_id":"1"}}
{"doc":{"username":"yoey2","age":22}}

# 批量的删除
POST _bulk
{"delete":{"_index":"test_index","_type":"doc","_id":"cn9fKnEBKvZxRnYkUwDq"}}
{"delete":{"_index":"test_index","_type":"doc","_id":"c39mKnEBKvZxRnYkQgCJ"}}
```

#### 批量查询文档示例

```json
# 获取索引中不同的Id的文档
POST /_mget
{
  "docs":[
    {
      "_index":"test_index",
      "_type":"doc",
      "_id":1
    },
    {
      "_index":"test_index",
      "_type":"doc",
      "_id":2
    }
  ]
}
```