<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Mysql/高级特性/InnoDB数据页结构">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">InnoDB数据页结构 | 花裤衩Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" name="twitter:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" property="og:url" content="https://huakucha.com/docs/Mysql/高级特性/InnoDB数据页结构"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="InnoDB数据页结构 | 花裤衩Wiki"><meta data-rh="true" name="description" content="InnoDB的存储结构"><meta data-rh="true" property="og:description" content="InnoDB的存储结构"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huakucha.com/docs/Mysql/高级特性/InnoDB数据页结构"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/Mysql/高级特性/InnoDB数据页结构" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/Mysql/高级特性/InnoDB数据页结构" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QZ9YPBGUYT-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="花裤衩Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="花裤衩Wiki Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="花裤衩Wiki JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="花裤衩Wiki" href="/opensearch.xml">

<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.font.im/css?family=Raleway:500,700&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.864d50a7.css">
<link rel="preload" href="/assets/js/runtime~main.bf86732a.js" as="script">
<link rel="preload" href="/assets/js/main.98457ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_D8pK">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="content_zf74 announcementBarContent_dpRF">🌟欢迎来到花裤衩的博客🌟</div><button type="button" aria-label="关闭" class="clean-btn close closeButton_ZdWa announcementBarClose_iXyO"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--light_PnYV"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--dark_eYgw"></div><b class="navbar__title text--truncate">花裤衩</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">基础知识🤖</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/currency">并发编程</a></li><li><a class="dropdown__link" href="/docs/networrk-basic">计算机网络</a></li><li><a class="dropdown__link" href="/docs/linuxCommand">Linux</a></li><li><a class="dropdown__link" href="/docs/dataStructure">数据结构与算法</a></li><li><a class="dropdown__link" href="/docs/leetCode">LeetCode</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/mysql">MySQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">后端框架👨‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/spring">Spring</a></li><li><a class="dropdown__link" href="/docs/springCloud">SpringCloud</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">方法论🚧</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/distribute/protol">分布式理论</a></li><li><a class="dropdown__link" href="/docs/distribute/basicTech">分布式技术点</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">中间件🚀</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/middleware/basicMiddleware">基础中间件</a></li><li><a class="dropdown__link" href="/docs/middleware/job">定时任务</a></li><li><a class="dropdown__link" href="/docs/middleware/cache">缓存</a></li><li><a class="dropdown__link" href="/docs/middleware/searchEngine">搜索引擎</a></li><li><a class="dropdown__link" href="/docs/middleware/messageQueue">消息队列</a></li><li><a class="dropdown__link" href="/docs/middleware/database">数据库</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">底层⛽️</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/JVM">JVM</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">前端技术👩‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/front/Vue">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其他工具👹</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Gradle">Gradle</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">物料中心👏</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/website/BE">后端产品</a></li><li><a class="dropdown__link" href="/website/COM">其他产品</a></li><li><a class="dropdown__link" href="/website/FE">前端产品</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.huakucha.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">关于<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/MagicalZhu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_MW0i colorModeToggle_x44X"><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SFTY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ekgs"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_H2mL"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_W2AM"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_ntye" type="button"></button><div class="docPage_qMb8"><aside class="theme-doc-sidebar-container docSidebarContainer_rpaz"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mysql">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/mysql基础与高级">MySQL基础与高级</a><button aria-label="打开/收起侧边栏菜单「MySQL基础与高级」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/基础知识">基础知识</a><button aria-label="打开/收起侧边栏菜单「基础知识」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/数据库管理">数据库管理</a><button aria-label="打开/收起侧边栏菜单「数据库管理」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/架构与引擎">架构与引擎</a><button aria-label="打开/收起侧边栏菜单「架构与引擎」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/存储结构与索引">存储结构与索引</a><button aria-label="打开/收起侧边栏菜单「存储结构与索引」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/索引">索引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/索引的应用">索引的应用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/设计索引">设计索引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Mysql/高级特性/InnoDB数据页结构">InnoDB数据页结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/InnoDB表空间">InnoDB表空间</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/性能优化">性能优化</a><button aria-label="打开/收起侧边栏菜单「性能优化」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/事务与锁">事务与锁</a><button aria-label="打开/收起侧边栏菜单「事务与锁」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/运维">运维</a><button aria-label="打开/收起侧边栏菜单「运维」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Mysql/MySQL参数与命令">MySQL参数与命令</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_JQG6"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Iseg"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SLhD"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/mysql基础与高级"><span itemprop="name">MySQL基础与高级</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/存储结构与索引"><span itemprop="name">存储结构与索引</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">InnoDB数据页结构</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_IbkY theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_p7nN">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>InnoDB数据页结构</h1></header><h2 class="anchor anchorWithStickyNavbar_loeA" id="innodb的存储结构">InnoDB的存储结构<a class="hash-link" href="#innodb的存储结构" title="标题的直接链接">​</a></h2><blockquote><p>索引结构提高了高效的索引方式,不过索引信息以及数据记录都是保存在磁盘文件上的。索引是在存储引擎中实现的,MySQL 服务器上的<code>存储引擎</code>负责对表中的数据进行读取和写入。<code>不同的存储引擎中存放的格式也是不同的</code>,甚至有的存储引擎使用Memory 来存储数据</p></blockquote><h3 class="anchor anchorWithStickyNavbar_loeA" id="存储的基本单位-页">存储的基本单位-页<a class="hash-link" href="#存储的基本单位-页" title="标题的直接链接">​</a></h3><ol><li><p>InnoDB 将数据划分为若干个页,InnoDB 中页的大小默认为<code>16KB</code>。它也是<code>InnoDB管理存储空间的基本单位</code></p></li><li><p>以<code>页</code>作为磁盘和内存之间交互的<code>基本单位</code>,也就是<strong>一次最少从磁盘读取 16KB 的内容到内存中, 一次最少把内存中 16KB 内容刷新到磁盘上</strong></p><ul><li><p>也就是说<code>在数据库中,无论读一行还是读多行数据,都是将这些行所在的页加载到内存中</code></p></li><li><p>也就是说<code>数据库管理存储空间的基本单位是页(Page),数据库 IO 操作的最小单位是页</code></p></li><li><mark>即记录时按照行来存储,但不是按照行来读取。如果按照行来读取,那么读取一次需要一次 IO,那么效率会变得非常低</mark></li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="页结构">页结构<a class="hash-link" href="#页结构" title="标题的直接链接">​</a></h3><ol><li>页 a、页 b…这些页<code>在物理上并不相连</code>,只要通过<code>双向链表</code>关联达到逻辑上的连接即可</li><li>每个数据页中的记录会按照索引列从小到大的顺序组成一个<code>单向链表</code></li><li>每个数据页都会为存储在它里面的记录生成一个<code>页目录(Page Directory)</code>,在通过索引列查找某个记录的时候,可以在页目录中使用<code>二分法</code>快速定位到对应的槽,然后便利这个槽中的记录即可</li></ol><p><img loading="lazy" alt="image-20220625163310614" src="/assets/images/image-20220625163310614-ec0a05f6ee86117b29ac696a8ad881e1.png" width="844" height="384" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="页的大小">页的大小<a class="hash-link" href="#页的大小" title="标题的直接链接">​</a></h3><p>不同的DBMS 的页大小不同,比如在 MySQL 的 InnoDB 存储引擎冲, 默认页的大小是<code>16KB</code>,可以通过命令<code>innodb_page_size</code> 查看</p><p><img loading="lazy" alt="image-20220625160523103" src="/assets/images/image-20220625160523103-473a36985bf2ef12813fb0318e40bed0.png" width="602" height="144" class="img_CujE"></p><p>SQL Server中页的大小为 <code>8KB</code>,而在 Oracle 中使用<code>块(Block)</code>来代表页,Oracle 支持的块大小为<code>2KB、4KB、8KB、16KB、32KB、64KB</code></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="页的上层结构">页的上层结构<a class="hash-link" href="#页的上层结构" title="标题的直接链接">​</a></h3><p>在数据库中除了<strong><em>页</em></strong> 之外,还存在着 <code>区(Extent)、段(Segment)、表空间(Tablespace)</code>的概念,行、页、区、段、表空间的关系如下:</p><p><img loading="lazy" alt="image-20220625164417203" src="/assets/images/image-20220625164417203-470595a89899e062e36ccb1351aa6b84.png" width="1057" height="637" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="区extent">区(Extent)<a class="hash-link" href="#区extent" title="标题的直接链接">​</a></h4><ul><li>比页大一级存储结构, <strong>在 InnoDB 存储引擎中,一个区会分配<code>64 个连续的页</code></strong></li><li>因为 InnoDB 的页大小默认为 16Kb,所以一个区的大小是 64 * 16KB = <code>1MB</code><ul><li><strong>注意: InnoDB 1.2.x版本可以控制页的默认大小,但是一个区的大小是固定的 1M</strong></li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="段segment">段(Segment)<a class="hash-link" href="#段segment" title="标题的直接链接">​</a></h4><ul><li><strong>概述</strong><ul><li>由一个或者多个区组成,<strong>区在文件系统中是一个连续分配的空间(InnoDB 中是 64 个连续的页)</strong>, <strong>段中不要求区与区之间是连续的</strong></li><li><strong><code>段是数据库中的分配单位, 不同类型的数据库对象以不同的段形式存在</code></strong><ul><li>当创建数据表、索引的时候,就会创建相应的段。比如创建一张表时会创建一个表段, 创建一个索引时会创建一个索引段</li></ul></li></ul></li><li><strong>说明</strong><ul><li>表空间是由各个段组成的,常见的段有<code>数据段、索引段、回滚段等</code></li><li>InnoDB 中索引即数据,数据即索引,所以<code>数据段就是 B+Tree 的叶子节点,索引段就是 B+Tree 的非叶子节点</code></li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="表空间">表空间<a class="hash-link" href="#表空间" title="标题的直接链接">​</a></h4><ul><li><strong>概述</strong><ul><li>一个逻辑容器,表空间存储的对象是段。在一个表空间中可以有一个或者多个段,但是一个段只能属于一个表空间</li><li>数据库由一个或者多个表空间组成</li><li>表空间从管理上可以划分为: <code>系统表空间、用户表空间、撤销表空间、临时表空间...</code></li></ul></li><li><strong>说明</strong><ul><li>表空间可以看作是 InnoDB 存储引擎结构的最高层, 所有的数据都存放在表空间中。InnoDB 默认有一个共享表空间 <code>/var/lib/mysql/ibdata1</code>,即所有的数据都存放在这个表空间中,但是如果开启了参数<code>innodb_file_per_table</code>的话,那么每张表都会单独放到一个表空间内。</li><li>需要注意的是,开启了<strong>innodb_file_per_table</strong>参数,只是将<code>数据、索引和插入缓冲Bitmap 页</code>放在单独的表空间,其他的诸如<code>回滚(undo)信息、插入缓冲索引页、系统事务信息、二次写缓冲等</code>还是存放在原来的共享表空间 ibdata1 中</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="数据页index的内部结构">数据页(INDEX)的内部结构<a class="hash-link" href="#数据页index的内部结构" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="说明">说明<a class="hash-link" href="#说明" title="标题的直接链接">​</a></h3><ul><li><p>页如果按照类型划分的话,常见的有: <code>数据页(保存 B+Tree 节点)、系统页、Undo 页、事务数据页等</code>,  <strong>数据页是使我们最长使用的页</strong></p></li><li><p><strong>数据页的 <a href="/docs/Mysql/高级特性/InnoDB数据页结构#%E6%96%87%E4%BB%B6%E5%A4%B4file-header">FILE_TYPE</a> 是<code>FIL_PAGE_INDEX</code>,一般称之为索引页,也可以叫做数据页(索引即数据嘛)</strong></p></li><li><p><strong>数据页的<code>16KB</code>大小的存储空间被划分为七大部分:</strong></p><ul><li><p><code>文件头(File Header)</code></p></li><li><p><code>页头(Page Header)</code></p></li><li><p><code>最大最小记录(Infimum + supremum)</code></p></li><li><p><code>用户记录(User Records)</code></p></li><li><p><code>空闲空间(Free Page)</code></p></li><li><p><code>页目录(Page Directory)</code></p></li><li><p><code>文件尾(File Trailer)</code></p></li></ul><p><img loading="lazy" alt="image-20220703230204648" src="/assets/images/image-20220703230204648-85ebd2f8b4eac7286fac627f30c1c1f9.png" width="631" height="517" class="img_CujE"></p></li></ul><p><strong>上面七个部分的作用简单来说:</strong></p><table><thead><tr><th align="center">名称</th><th align="center">大小(字节)</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center"><code>File Header</code></td><td align="center"><strong>38</strong></td><td align="center">文件头,描述页信息</td></tr><tr><td align="center"><code>Page Header</code></td><td align="center"><strong>56</strong></td><td align="center">页头,页的状态信息</td></tr><tr><td align="center"><code>Infimum + Supremum</code></td><td align="center"><strong>26(13+13)</strong></td><td align="center">最大和最小记录,是两个虚拟的记录</td></tr><tr><td align="center"><code>User Records</code></td><td align="center">不确定</td><td align="center">用户记录,存储行记录内容</td></tr><tr><td align="center"><code>Free Space</code></td><td align="center">不确定</td><td align="center">空闲空间,页中没有被使用的空间</td></tr><tr><td align="center"><code>Page Directory</code></td><td align="center">不确定</td><td align="center">页目录,存储用户记录中的相对位置</td></tr><tr><td align="center"><code>File Trailer</code></td><td align="center"><strong>8</strong></td><td align="center">文件尾,检查数据是否完整</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_loeA" id="文件头file-header">文件头(File Header)<a class="hash-link" href="#文件头file-header" title="标题的直接链接">​</a></h3><ol><li><p><strong>作用:<code>描述各种页的通用信息(比如页的编号、上一页、下一页等)</code></strong></p></li><li><p><strong>大小: <code>38 字节</code></strong></p></li><li><mark>通过<strong>上一页、下一页实现了多个页之间的双向连接</strong></mark></li><li><p><strong>构成</strong>:</p><table><thead><tr><th>名称</th><th>大小(字节)</th><th>描述</th></tr></thead><tbody><tr><td><code>FIL_PAGE_SPACE_OR_CHKSUM</code></td><td><strong>4</strong></td><td>页的校验和 (checksum值)</td></tr><tr><td><code>FIL_PAGE_OFFSET</code></td><td><strong>4</strong></td><td>页号(表空间的偏移值)<br>假设表空间 ID 为 10,那么搜索页(10,1) 就是查询表 a 中的第二个页</td></tr><tr><td><code>FIL_PAGE_PREV</code></td><td><strong>4</strong></td><td>当前页的上一页的页号</td></tr><tr><td><code>FIL_PAGE_NEXT</code></td><td><strong>4</strong></td><td>当前页的下一页的页号</td></tr><tr><td><code>FIL_PAGE_LSN</code></td><td><strong>8</strong></td><td>页面最后被修改时对应的日志序列位置(Log Sequence Number)</td></tr><tr><td><code>FIL_PAGE_TYPE</code></td><td><strong>2</strong></td><td>该页的类型.数据页的值值 <code>0x45BF</code></td></tr><tr><td><code>FIL_PAGE_FILE_FLUSH_LSN</code></td><td><strong>8</strong></td><td>仅在系统表空间的一个页中定义,代表文件至少被刷新到了对应的 LSN 值</td></tr><tr><td><code>FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</code></td><td><strong>4</strong></td><td>页属于哪个表空间</td></tr></tbody></table></li></ol><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle><strong>校验和- CheckSum</strong></mdxadmonitiontitle></div><div class="admonitionContent_vXIg"><ul><li>就是对于一个很长的字符串来说,通过算法得到一个比较短的值来表示这个很长的字符串,这个比较短的值就是<code>校验和(checksum)</code>。<ul><li>在比较两个很长的字符串之前首先比较这两个校验和,如果校验和都不一样,那么这两个字符串肯定也不同,就省去了两个长字符串的比较时间</li></ul></li><li><strong>文件头和文件尾都有属性: FIL_PAGE_SPACE_OR_CHKSUM</strong></li><li><strong>作用</strong><ul><li>InnoDB 存储引擎以<strong>页</strong>为单位将数据加载到内存中处理,如果该页中的数据在内存中被修改了,那么在修改后的某个时间点上讲数据同步到磁盘上,但是同步过程中突然出现异常(比如断电),造成该页传输的不完整。</li><li>为了检测一个页是否完整(即同步没有同步成功的情况),这时可以通过文件尾校验和与文件头的作比对,如果两个值不同,则说明页的传输有问题,需要重新传输同步。</li></ul></li><li><strong>具体</strong><ul><li>每当一个页在内存中修改了，在同步之前就要把它的校验和算出来。因为File Header在页面的前边，所以校验和会被首先同步到磁盘，当完全写完时，校验和也会被写到页的尾部<ul><li>如果完全同步成功，则页的首部和尾部的校验和应该是一致的。</li><li>如果写了一半儿断电了，那么在File Header中的校验和就代表着已经修改过的页，而在File Trailer中的校验和代表着原先的页，二者不同则意味着同步中间出了错</li></ul></li><li><strong>这里的校验方式就是采用 <code>Hash 算法</code>进行校验</strong></li></ul></li></ul></div></div><ol start="4"><li><strong>页类型(FIL_PAGE_TYPE 可选值)</strong></li></ol><table><thead><tr><th>名称</th><th>十六进制</th><th>说明</th></tr></thead><tbody><tr><td><strong>FIL_PAGE_INDEX</strong></td><td><code>0x45BF</code></td><td>索引页,也叫做数据页</td></tr><tr><td><strong>FIL_PAGE_TYPE_ALLOCATED</strong></td><td><code>0x0000</code></td><td>最新分配的页</td></tr><tr><td><strong>FIL_PAGE_UNDO_LOG</strong></td><td><code>0x0002</code></td><td>Undo日志页</td></tr><tr><td><strong>FIL_PAGE_INODE</strong></td><td><code>0x0003</code></td><td>存储段的信息</td></tr><tr><td><strong>FIL_PAGE_IBUF_FREE_LIST</strong></td><td><code>0x0004</code></td><td>Insert Buffer 空闲列表</td></tr><tr><td><strong>FIL_PAGE_TYPE_SYS</strong></td><td><code>0x0006</code></td><td>系统页</td></tr><tr><td><strong>FIL_PAGE_TRX_SYS</strong></td><td><code>0x0007</code></td><td>事务系统数据</td></tr><tr><td><strong>FIL_PAGE_TYPE_FSP_HDR</strong></td><td><code>0x0008</code></td><td>表空间头部信息</td></tr><tr><td><strong>FIL_PAGE_TYPE_XDES</strong></td><td><code>0x0009</code></td><td>拓展描述页</td></tr><tr><td><strong>FIL_PAGE_TYPE_BLOB</strong></td><td><code>0x000A</code></td><td>溢出页</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_loeA" id="文件尾file-trailer">文件尾(File Trailer)<a class="hash-link" href="#文件尾file-trailer" title="标题的直接链接">​</a></h3><blockquote><p>为了检测也是否已经完整地写入磁盘(比如可能发生的写入过程中磁盘损坏、机器关机等),InnoDB 存储引擎的页设置了 <code>File Trailer</code>部分</p></blockquote><ul><li><p>File Trailer 只有一个 <code>FIL_PAGE_END_LSN</code> 部分,占用<code>8 字节</code>。</p><ul><li><code>前4 字节</code>: 该页的 checksum 值</li><li><code>后 4 字节</code>: 与 File Header 的 <code>FIL_PAGE_LSN</code>相同</li></ul></li><li><p>判断的时候,将这两个值分别与 File Header 的 <code>FIL_PAFGE_OR_CHKSUM、FIL_PAGE_LSN</code>比较,判断是否一致,以此保证也得完整性</p><ul><li><font color="blue">注意:校验和 checksum 的比较需要通过 InnoDB 的 checksum 函数进行比较,不是简单的等值比较</font></li></ul></li><li><p>在默认配置下, InnoDB 每次从磁盘读取一个页到内存,都会检测页的完整性,就是通过这个 File Trailer 进行判断的</p><ul><li>当然这个检测有一定的开销,key 已通过<code>innodb_checksums</code> 来开启或者关闭这个页完整性检查 (<strong>MySQL8.0 中没有这参数了</strong>)</li></ul></li><li><p>MySQL 5.6.6 版本中,新增了参数 <code>innodb_checksum_algorithm</code>,用于控制检测 checksum 的算法,有如下的可选值</p><ul><li><code>innodb</code></li><li><code>crc32</code> : <strong>默认值</strong></li><li><code>none</code></li><li><code>strict_innodb</code></li><li><code>strict_crc_32</code></li><li><code>strict_none</code></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="最小最大记录">最小最大记录<a class="hash-link" href="#最小最大记录" title="标题的直接链接">​</a></h3><ul><li>在 InnoDB 存储引擎中,每个数据页中都有两个<code>虚拟的行记录</code>,用于限定记录的边界<ul><li><strong>Infimum 记录是比该页中任何主键值都小的值,Supremum 是任何可能大的值还要大的值</strong></li></ul></li><li><code>这两个值在页被创建的时候建立,并且在任何情况下都不会被删除</code><ul><li><strong>由于这两条记录不是自定义的记录,所以它不存储在User Record 中,而是单独存储在 Infimum与Supremum中</strong></li><li>InnoDB 规定的最小记录与最大记录的构造很简单,都是由 5 个字节大小的<a href="/docs/Mysql/高级特性/InnoDB数据页结构#%E8%AE%B0%E5%BD%95%E5%A4%B4%E4%BF%A1%E6%81%AF">记录头信息</a>和 8 字节大小的一个固定部分组成的</li></ul></li></ul><p><img loading="lazy" alt="image-20220703160138361" src="/assets/images/image-20220703160138361-aafd302f54ec7f0068e77a989bdadf1a.png" width="544" height="350" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="user-records--free-space">User Records + Free Space<a class="hash-link" href="#user-records--free-space" title="标题的直接链接">​</a></h3><ul><li><strong>User Record</strong> 就是<strong>用户记录</strong>,即<code>实际存储行记录的内容</code>。<ul><li>User Records 中的这些记录按照指定的行格式一条一条摆在User Records部分,相互之间形成单链表。 </li><li>用户记录里的一条条数据如何记录？可以查看<a href="/docs/Mysql/高级特性/InnoDB数据页结构#%E8%AE%B0%E5%BD%95%E5%A4%B4%E4%BF%A1%E6%81%AF">记录头信息</a></li></ul></li><li><strong>Free Space</strong> 就是<strong>空闲空间</strong><ul><li>与用户记录一样,也采用了链表的数据结构。在一条记录被删除之后,对应的节点会相互连接成链表(<strong>垃圾链表 </strong>)<ul><li>用户记录会以指定的<code>行格式</code>存储到 <strong>User Records 中</strong>,但是新分配的页中是没有 User Records 部分的。</li><li>在新插入一条 User Record 的时候,都会向 Free Space 申请一个记录大小的空间划分到 User Records 中,当 Free Space 的空间不足的时候,就会新分配一个页</li></ul></li></ul></li></ul><p><img loading="lazy" alt="image-20220703142505904" src="/assets/images/image-20220703142505904-55ea964d8cdb6e3aba138fa0b9933f8d.png" width="1182" height="505" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="page-directory">Page Directory<a class="hash-link" href="#page-directory" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_loeA" id="说明-1">说明<a class="hash-link" href="#说明-1" title="标题的直接链接">​</a></h4><ol><li><p>将当前数据页的所有记录<code>分为几个组</code>,这些记录<code>包括用户记录、最大最小记录,但不包含标记为已删除的记录</code></p><ul><li><p><strong>第一组</strong> : 最小记录所在的组,只有1 条记录 ( n_owned的值总是 <code>1</code> )</p></li><li><p><strong>最后一组</strong> : 最大记录所在的组,有 1~8 条记录,并且会尽量平分 ( n_owned的取值范围是<code>[1,8]</code> )</p></li><li><p><strong>其余组</strong> : 有 4~8 条记录,并且会尽量平分 (  n_owned的取值范围是<code>[4,8]</code> )</p></li></ul></li><li><p>在每个组中的最后一条记录的头信息中会存储这个组一共有多少条记录,也就是 <code>n_owned</code> 字段</p></li><li><p><code>页目录用来存储每组最后一条记录的地址偏移量</code>,这些地址偏移量会按照<code>先后顺序存储起来</code>,每组的地址偏移量也叫做<code>槽(Slot)</code></p><ul><li>每个槽相当于指针指向了不同组的最后一个记录</li></ul></li><li><p>查询的时候,由于一个槽指向一组记录的最后一个记录的地址,且记录之前采用单向链表的方式连接,所以可能需要拿到上一个槽,然后通过上一个槽最后一个记录的<strong>next_record</strong> 获取当前槽的第一个元素</p><ul><li><strong>如果第一组有多个,那么由于用户记录采用单链表的形式,所以只能通过槽拿到第一组里面的尾部记录,前面的记录则无法获取</strong><ul><li>所以第一组中有一个记录(最小记录)</li></ul></li></ul></li></ol><p><strong>页目录中槽、分组的示意图:</strong></p><p><img loading="lazy" alt="image-20220703170617454" src="/assets/images/image-20220703170617454-01bb6dbaaa322b7c8cf6149782dd18e1.png" width="919" height="838" class="img_CujE"></p><p><img loading="lazy" alt="image-20220705224211988" src="/assets/images/image-20220705224211988-aeed9444a6252e93ad67a9b18db6f323.png" width="1346" height="686" class="img_CujE"></p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>为什么需要页目录</div><div class="admonitionContent_vXIg"><ul><li>在页中,记录是以<code>单向链表</code>的形式存储的,单向链表的插入和删除速度很快,但是查询速度慢。最差的情况下,需要对整个链表进行线性遍历才能完成检索。</li><li>所以在页结构中专门设置了<code>页目录</code>这个模块,<code>专门给记录做一个目录</code>,通过二分法的方式进行检索<ul><li>对槽采用二分法,每次二分可以得到<strong>槽的最大记录</strong>,如果不匹配就再二分。</li><li>如果匹配的话,我们假设该槽是 slotA1,我们就可以通过它找到前面的槽 slotA0,也就找到了<strong>slotA0 槽的最大记录 slotA0_Max</strong></li><li>找到 <strong>slotA0_Max</strong> 后,就可以利用 slotA0_Max 的 <em>next_record</em> 找到 <strong>slotA1 槽的首部记录 slotA1_First</strong></li><li>然后可以利用 slotA1_First 的 <em>next_record</em> 进行链表的线性迭代</li></ul></li></ul></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="问题">问题<a class="hash-link" href="#问题" title="标题的直接链接">​</a></h4><ol><li><p><strong>页目录中分组的个数是如何确定的? 为什么最小记录的 n_owned =1, 最大记录的 n_owned=5?</strong></p><ul><li><p>InnoDB规定：</p><ul><li><strong>对于最小记录所在的分组只能有1条记录</strong></li><li><strong>最大记录所在的分组拥有的记录条数只能在1~8条之间</strong></li><li><strong>剩下的分组中记录的条数范围只能在是 4~8 条之间</strong></li></ul></li><li><p><strong>分组是按照下边的步骤进行的</strong></p><ul><li>初始情况下一个数据页里只有<code>最小记录</code>和<code>最大记录</code>两条记录，它们分属于两个分组</li><li>之后每插入一条记录，都会从页目录中找到主键值比本该记录的主键值大并且差值最小的槽,然后把该槽对应的记录的n_owned值加1,表示本组内又添加了一条记录,直到该组中的记录数等于8个</li><li>在一个组中的记录数等于8个后再插入一条记录时，会将组中的记录拆分成两个组，一个组中4条记录，另一个5条记录</li><li>这个过程会在页目录中新增一个槽来记录这个新增分组中最大的那条记录的偏移量</li></ul></li></ul></li><li><p>B+Tree是如何进行记录检索的?</p><ul><li>如果通过 B+Tree 的索引查询行记录,首先从 B+Tree 的根节点开始,逐层检索,直到找到叶子节点,也就是找到指定的数据页为止</li><li>然后将数据页加载到内存中</li><li>接着对数据页中页目录中的槽(Slots)采用<code>二分查找</code>的方式找到一个粗略的分组,然后利用分组进行链表遍历</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="page-header">Page Header<a class="hash-link" href="#page-header" title="标题的直接链接">​</a></h3><p>为了能得到数据页中存储的记录的状态信息,比如<strong>本页中已经存储了多少数据、第一条记录的地址是什么、页目录中存储了多少个槽等等</strong>,InnoDB 特意在页中定义了<code>Page Header</code>,它由 <code>14个部分</code>组成, 占用固定的<code>56 字节</code>,<strong>用于存储数据页的状态信息</strong></p><ol><li><strong><code>PAGE_N_DIR_SLOTS</code></strong><ul><li>在页目录 Page Directory 中的槽数量</li><li>占用<code>2 字节</code></li></ul></li><li><strong><code>PAGE_HEAP_TOP</code></strong><ul><li>还未使用的空间最小地址,也就是该地址之后就是 Free Space</li><li>占用<code>2 字节</code></li></ul></li><li><strong><code>PAGE_N_HEAP</code></strong><ul><li>堆中的记录数<ul><li>即本页中记录的数量(包括最小记录、最大记录、标记为删除的记录)</li></ul></li><li>占用<code>2 字节</code>,但是第 15 位表示行记录格式</li></ul></li><li><strong><code>PAGE_FREE</code></strong><ul><li>指向<code>可重用空间</code>的首地址<ul><li>即第一个被标记为删除(deleted_flag=1) 的记录的地址</li><li><strong>每个删除的记录通过 <code>next_record</code>也会组成一条单链表,这个单链表中的记录可以被重用(新插入排序后的记录替换该单链表中的记录),原链修改性能比删除后修改高</strong></li></ul></li><li>占用<code>2 字节</code></li></ul></li><li><strong><code>PAGE_GARBAGE</code></strong><ul><li>已删除记录所占用的字节数,<strong>不是删除的记录的数量!</strong><ul><li>即行记录结构中,deleted_flag=1 的记录的大小总数</li></ul></li><li>占用<code>2 字节</code></li></ul></li><li><code>PAGE_LAST_INSERT</code><ul><li>最后插入记录的位置</li><li>占用<code>2 字节</code></li></ul></li><li><strong><code>PAGE_DIRECTION</code></strong><ul><li>最后记录插入的方向,可选值如下<ul><li><strong>PAGE_LEFT: 0x01</strong></li><li><strong>PAGE_RIGHT: 0x02</strong></li><li><strong>PAGE_SAME_REC: 0x03</strong></li><li><strong>PAGE_SAME_PAGE: 0x04</strong></li><li><strong>PAGE_SAME_NO_DIRECTION: 0x05</strong></li></ul></li><li>比如新插入的一条记录的主键值比上一条记录的主键值大，我们说这条记录的插入方向是右边，反之则是左边</li><li>占用<code>2 字节</code></li></ul></li><li><strong><code>PAGE_N_DIRECTION</code></strong><ul><li>一个方向连续插入记录的数量,<strong>当然,如果某条记录插入的方向改变后,这个值会被清零重新统计</strong></li><li>占用<code>2 字节</code></li></ul></li><li><strong><code>PAGE_N_RECS</code></strong><ul><li>该页中用户记录的数量(不包括最小记录、最大记录、标记为删除的记录)</li><li>占用<code>2 字节</code></li></ul></li><li><strong><code>PAGE_MAX_TRX_ID</code></strong><ul><li>修改当前页的最大事务 ID,<code>仅在二级索引中定义</code></li><li>占用<code>8 字节</code></li></ul></li><li><strong><code>PAGE_LEVEL</code></strong><ul><li>当前页在 B+Tree 中的层级, <strong>0x00 表示叶子节点</strong></li><li>占用<code>2 字节</code></li></ul></li><li><strong><code>PAGE_INDEX_ID</code></strong><ul><li>索引 ID,表示当前页属于哪个索引</li><li>占用<code>2 字节</code></li></ul></li><li><code>PAGE_BTR_SEG_LEAF</code></li><li><code>PAGE_BTR_SEG_TOP</code></li></ol><h2 class="anchor anchorWithStickyNavbar_loeA" id="行记录格式">行记录格式<a class="hash-link" href="#行记录格式" title="标题的直接链接">​</a></h2><p>InnoDB 存储引擎和大多数数据库一样,记录是以行的形式存储的,这些记录在磁盘的存放方式也叫做<code>行格式</code>或者<code>记录格式</code></p><p>InnoDB 存储引擎设计了 4 种不同类型的<code>行格式</code>:</p><ol><li><code>Compact</code></li><li><code>Redundant</code></li><li><code>Dynamic</code> </li><li><code>Compressed</code></li></ol><p><strong>查看 MySQL5.7默认的行格式</strong></p><p><img loading="lazy" alt="image-20220707225324967" src="/assets/images/image-20220707225324967-e3797ece967b8d764959f5e504edae83.png" width="1450" height="320" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="指定行格式">指定行格式<a class="hash-link" href="#指定行格式" title="标题的直接链接">​</a></h3><ul><li><p><strong>语法</strong></p><ul><li><p><strong>查看具体表的行格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">show</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">table</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">status</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;表名&#x27;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>创建表时指定其他的行格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> 表名 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    列的信息</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">  ROW_FORMAT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">行格式名称</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>修改指定表的行格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> 表名 ROW_FORMAT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">行格式名称</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul><p><strong>创建表时指定行格式</strong></p><p><img loading="lazy" alt="image-20220707230054866" src="/assets/images/image-20220707230054866-dd65b2ecd10d51ab0f1b2f2f123eeb19.png" width="2254" height="872" class="img_CujE"></p><p><strong>修改表的行格式</strong><img loading="lazy" alt="image-20220707230146333" src="/assets/images/image-20220707230146333-8981b83e22092d7458d5f81e832f2a5e.png" width="1416" height="916" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="compact行格式">COMPACT行格式<a class="hash-link" href="#compact行格式" title="标题的直接链接">​</a></h3><p>Compact 行格式实在 MySQL5.0 中引入的,用于高效的存储数据,当一个页中存放的数据越多,它的性能越高。包含的内容如下</p><ol><li><p><code>变长字段长度列表</code></p></li><li><p><code>NULL 值标记位</code></p></li><li><p><code>记录头信息</code></p></li><li><p><code>列数据 1、列数据 2....列数据 n</code></p><p><img loading="lazy" alt="image-20220710124646181" src="/assets/images/image-20220710124646181-8fcba374c49265de5c535f9dac064d9d.png" width="827" height="148" class="img_CujE"></p></li></ol><h4 class="anchor anchorWithStickyNavbar_loeA" id="变长字段长度列表">变长字段长度列表<a class="hash-link" href="#变长字段长度列表" title="标题的直接链接">​</a></h4><ul><li><p>MySQL 支持一些变长的数据类型,比如 varchar(M)、varbinary(M)、text、blob ,这些数据类型的列被称为<code>变长字段</code>。变长字段中存储多少字节的数据不是固定,所以需要在存储真实数据的时候讲这些数据占用的字节数页存储起来。</p><ul><li><mark>因为需要通过<strong>变长字段长度</strong>来确定<strong>需要取数据页中多长的二进制数据与该字段进行关联</strong></mark></li><li>举个例子:表 A 中中两个变长字段 A、B,定义的长度分别是 <code>varchar(2)、varchar(3)</code>, 在数据页中存储的二进制数据是 <code>61(a) 62(b) 62(b)</code>。那么字段 A 的值是 61(a) 62(b) 呢?还是 61(a)呢?这个时候就需要使用变长字段长度了,此时的变长字段长度列如果是<code>02(B) 01(A)</code>的话,那么<strong>字段 A 的值就是 61(a), 字段 B 的值是 62(b) 62(b) 了</strong></li></ul></li><li><p><strong>在 Compact 行格式中, 把所有变长字段所占用的字段长度都存放在记录的头部,从而得到一个</strong><code>变长字段长度列表</code>, 同时<code>里面存储的变长长度与字段的顺序是相反的</code>。比如两个 varchar 字段在表中顺序是 a(10),b(20), 那么在变长字段长度列表中存储的顺序就是 20、10。</p></li><li><p><strong>哪些情况下字段没有对应的变长字段列表呢?</strong></p><ul><li><code>变长字段长度列表只会记录值不为 NULL 的,当然这个也很明显</code> </li><li><code>并不是所有记录都有这个变长字段长度列表部分</code>，比方说表中所有的列都不是变长的数据类型的话，这一部分就不需要有。</li></ul></li><li><p><strong>所以变长字段占用的存储空间分为两部分:(后面索引的 key_len计算就是这个原因)</strong> </p><ul><li><code>真正的数据内容</code></li><li><code>占用的字节数</code></li></ul></li></ul><p>需要注意的是:</p><ol><li><strong>若列的长度小于 255 个字节,就用<code>1</code>字节表示(1 字节范围 0~255)</strong></li><li><strong>若列的长度大于 255 个字节,就是<code>2</code>字节表示(2 字节范围 0~65535)</strong></li></ol><mark>0xFF就是16 进制的一个字节,一个字节最大值以十进制表示为 255,两个字节最大能表示 65535</mark><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>说明</div><div class="admonitionContent_vXIg"><ol><li><strong>假设某个字符集中表示一个字符最多需要使用的字节数为<code>W</code>(即<code>SHOW CHARSET</code>语句的结果中的<code>Maxlen</code>列)</strong><ul><li>比方说utf8中 W=3，gbk中 W=2，ascii中 W=1</li></ul></li><li><strong>对于变长类型VARCHAR(M)来说，这种类型表示能存储<code>最多M个字符(注意是字符不是字节)</code>，所以这个类型能表示的字符串最多占用的<code>字节数就是M×W</code>。</strong></li></ol><p><strong>假设它实际存储的字符串占用的字节数是L,确定使用1个还是2个字节的规则就是这样：</strong></p><ol><li>如果<code>M×W &lt;= 255</code>，那么使用1个字节来表示真正字符串占用的字节数。</li><li>如果<code>M×W &gt; 255</code>，则分为两种情况<ul><li>如果<code>L &lt;= 127</code>，则用1个字节来表示真正字符串占用的字节数</li><li>如果<code>L &gt; 127</code>，则用2个字节来表示真正字符串占用的字节数。</li></ul></li></ol></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="null-值标记位">NULL 值标记位<a class="hash-link" href="#null-值标记位" title="标题的直接链接">​</a></h4><p>Compact 行格式会将可以为 NULL 的列统一管理起来,存在一个标记为 NULL 值列表中,如果表中没有允许存储 NULL 的列,那么这个 NULL 值列表就不存在了。和和变长字段长度列表类似的是,<code>NULL 值标记位对应二进制中字段顺序与表中实际字段的顺序是相反的</code></p><p><strong>取值如下:</strong></p><ol><li><code>1</code> : 表示该列的值为 NULL</li><li><code>0</code> : 表示该列的值不为 NULL</li></ol><p>注意: <strong>如果某个字段定义的时候指明了是非 NULL 的,那么就不会在 NULL 值列表中记录(当然也包含主键)</strong></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>说明与示例</div><div class="admonitionContent_vXIg"><p><strong>1.为什么需要 NULL 值标记位</strong></p><p>我们在定义表的时候,某些字段是可以为 NULL 的,但是实际存储数据的时候,如何表示这个位置的列数据是 NULL 呢? 就是通过 NULL 值列表。这样存储列数据的时候,非 NULL 的组合起来,然后利用 NULL 列表确定哪些字段是 NULL,哪些不是 NULL,相当于定位了列的位置</p><p><strong>2.示例</strong></p><p>字段a、b、c, 其中a 是主键,在某一行中存储的记录为(1,null,2),那么此时 NULL 值列表中存储 01(第一个 0 表示 c 不为 NULL,第二个 1 表示 b=null),用 16 进制表示就是<strong>0x01</strong>。<strong>由于 a 是主键,肯定不为 NULL,所以会自动的行忽略跳过</strong></p></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="记录头信息">记录头信息<a class="hash-link" href="#记录头信息" title="标题的直接链接">​</a></h4><blockquote><p>一共占用 40bit,即 5 字节</p></blockquote><h5 class="anchor anchorWithStickyNavbar_loeA" id="delete_flag">delete_flag<a class="hash-link" href="#delete_flag" title="标题的直接链接">​</a></h5><ul><li>该行是否已被删除,占用<strong>1 字节</strong><ul><li><code>0</code> : 没有被删除</li><li><code>1</code> : 已经被删除</li></ul></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>被删除的记录为什么还要在页中存储呢?</div><div class="admonitionContent_vXIg"><p>因为删除数据后,其他的数据需要重新排序,导致性能消耗.所以只是打上一个删除标记而已。</p><p>所有被删除的记录会组成一个<code>垃圾链表</code>,在这个链表中的记录占用的空间称之为<code>可重用空间</code>,如果有新的记录插入到表中的话,可以把这些背删除的记录占用的存储空间覆盖掉</p></div></div><h5 class="anchor anchorWithStickyNavbar_loeA" id="min_rec_flag">min_rec_flag<a class="hash-link" href="#min_rec_flag" title="标题的直接链接">​</a></h5><ul><li>B+Tree 的每层非叶子节点中的最小记录都会添加该标记,并且值为<code>1</code>。占用 <strong>1 bit</strong></li><li>手动插入的用户记录的 <em>min_rec_flag</em> 的值是<code>0</code></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="record_type">record_type<a class="hash-link" href="#record_type" title="标题的直接链接">​</a></h5><ul><li>记录类型,占用<strong>3 bit</strong><ul><li><code>000(0)</code> : 普通记录</li><li><code>001(1)</code> : B+Tree 非叶子节点记录</li><li><code>010(2)</code> : 最小记录</li><li><code>011(3)</code> : 最大记录 </li><li><code>1xx</code>    : 保留</li></ul></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="heap_no">heap_no<a class="hash-link" href="#heap_no" title="标题的直接链接">​</a></h5><ul><li>当前记录在记录堆中的排序后的<code>相对位置</code>,占用 <strong>13 bit</strong></li><li>MySQL 会给每个页里面加两个<code>虚拟记录</code><a href="/docs/Mysql/高级特性/InnoDB数据页结构#%E6%9C%80%E5%B0%8F%E6%9C%80%E5%A4%A7%E8%AE%B0%E5%BD%95">最小最大记录</a>,即<strong>新插入的数据 heap_no是从 2 开始的</strong><ul><li><code>heap_no = 0</code> : 最小记录</li><li><code>heap_no = 1</code> : 最大记录</li></ul></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="n_owned">n_owned<a class="hash-link" href="#n_owned" title="标题的直接链接">​</a></h5><ul><li>页目录中每个组中最后一条记录的头信息中回存储该组一共多少条记录,作为<strong>n_owned</strong>字段。占用<strong>4 bit</strong></li><li>参看<a href="/docs/Mysql/高级特性/InnoDB数据页结构#page-directory">页目录(Page Directory)</a></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="next_record">next_record<a class="hash-link" href="#next_record" title="标题的直接链接">​</a></h5><ul><li>当前记录到下一条记录的<code>地址偏移量</code>,而不是具体的数据地址。占用<strong>16bit </strong><ul><li>比如第一条记录的 next_record=32,那么第一条记录的位置后移 32 个字节就是下一条记录的位置</li><li><mark>我们常说页内数据是一个单向链表,就是这个next_record实现的</mark></li></ul></li><li><strong>说明:</strong><ol><li><strong>下一条记录并不是实际插入的下一条记录,而是按照主键从小到大排序的下一条记录(InnoDB默认会为主键生成一个聚簇索引,会按主键从小到大排序)</strong></li><li><strong>最小记录(Infimum)的下一条记录就是当前页中主键最小的记录</strong></li><li><strong>当前页中主键最大的用户记录的 next_record 就是最大记录(Supremum)</strong></li></ol></li></ul><p><img loading="lazy" alt="image-20220703161213276" src="/assets/images/image-20220703161213276-2751bc211e84f8d2d44de1a2261bd045.png" width="1189" height="572" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="记录的真实数据">记录的真实数据<a class="hash-link" href="#记录的真实数据" title="标题的直接链接">​</a></h4><p>行记录的真实数据除了自定义的列的数据以外,还会包含下面三个隐藏列:</p><table><thead><tr><th>列名</th><th>是否必须</th><th>占用空间(字节)</th><th>描述</th></tr></thead><tbody><tr><td><code>ROW_ID</code></td><td>❌</td><td><code>6</code></td><td>行 ID,唯一标识一条记录</td></tr><tr><td><code>ROW_TRX_ID</code></td><td>✅</td><td><code>6</code></td><td>事务 ID</td></tr><tr><td><code>ROW_ROLL_PTR</code></td><td>✅</td><td><code>7</code></td><td>回滚指针</td></tr></tbody></table><p>注意: <strong>一个表如果没有手动指定主键,那么会选择一个 Unique 键作为主键,如果连 Unique 也没有,那么就会默认的定义个名为 <code>row_id</code> 的隐藏列作为主键</strong></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>查看 MySQL 实际存储</div><div class="admonitionContent_vXIg"><p><strong>1. 创建表并且插入数据</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 创建表且指定行格式为 Compact</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> mytest</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    col1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    col2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    col3 </span><span class="token keyword" style="color:rgb(12, 150, 155)">char</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    col4 </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ENGINE</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">INNODB</span><span class="token plain"> ROW_FORMAT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">COMPACT</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 插入数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">into</span><span class="token plain"> mytest </span><span class="token keyword" style="color:rgb(12, 150, 155)">values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;bb&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;bb&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;ccc&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;d&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;ee&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;ee&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;fff&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;d&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;ccc&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">mysql</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> mytest</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">------+------+------+------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> col1 </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> col2 </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> col3 </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> col4 </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">------+------+------+------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> a    </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> bb   </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> bb   </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> ccc  </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> d    </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> ee   </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> ee   </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> fff  </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> d    </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> ccc  </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">------+------+------+------+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token number" style="color:rgb(170, 9, 130)">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.通过 命令 <code>hexdump-C-v mytest.ibd &gt; mytest.txt</code> 用 16 进制方式打开 ibd 文件</strong></p><p><img loading="lazy" alt="image-20220710101843624" src="/assets/images/image-20220710101843624-8d099781deb9f08b2ce99411ffa4ae8e.png" width="800" height="231" class="img_CujE"></p><p><strong>3.整理梳理</strong></p><p>对不同数据标记了颜色(图中数据与实际的数据不同),<strong>解析时一个每个都是 16 进制的数字,所以转为二进制就可以看出来了</strong></p><p><img loading="lazy" alt="image-20220710102945962" src="/assets/images/image-20220710102945962-ba4c04a16085a14a624a149824434003.png" width="953" height="303" class="img_CujE"></p><ul><li>第 1 行数据<ul><li><code>03  02  01 </code>  <ul><li>变长字段长度列表,可以看出是逆序的</li></ul></li><li><code>00</code> <ul><li>NULL 值标记位</li><li>第一行记录没有值为 NULL 的数据</li></ul></li><li><code>00 00 10 00 2c </code><ul><li>记录头信息(固定 5 字节)</li></ul></li><li><code>00 00 00 2b  68  00</code><ul><li>ROW_ID</li></ul></li><li><code>00 00 00 00 06 05</code><ul><li>ROW_TRX_ID</li></ul></li><li><code>80 00 00 00 32 01 10</code><ul><li>ROW_ROLL_PTR</li></ul></li><li><code>61</code> <ul><li>数据列 1 的值 a</li></ul></li><li><code>62 62</code><ul><li>数据列 2 的值 bb</li></ul></li><li><code>62  62 20 20 20 20 20 20 20 20</code><ul><li>数据列 3 的值 bb</li><li><strong>col3 是定长类型 char,当字段长度没有完全占据其长度空间时,使用 0x20 进行填充</strong></li></ul></li><li><code> 63 63 63</code><ul><li>数据列 4 的值 ccc</li></ul></li></ul></li><li>第 3 行数据<ul><li><code>03 01</code><ul><li>变长字段长度列表</li></ul></li><li><code>06</code><ul><li>NULL 值标记位</li><li>这里的0616 进制的, 转为二进制后为 00000110,第二位和第三位的值是 1, 对应了 col2 和 col3</li></ul></li><li><code>00 00 20 ff 98</code><ul><li>记录头信息(固定 5 字节)</li></ul></li><li>….</li></ul></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="dynamic和compressed行格式">Dynamic和Compressed行格式<a class="hash-link" href="#dynamic和compressed行格式" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_loeA" id="行溢出">行溢出<a class="hash-link" href="#行溢出" title="标题的直接链接">​</a></h4><blockquote><p><code>InnoDB 存储引擎可以将一条记录中的某些数据存储在真正的数据页面之外</code></p></blockquote><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>行溢出示例</div><div class="admonitionContent_vXIg"><p>我们知道,varchar(M)最大可以存储 65535 个字节,那么按下面的建表语句执行,发现会报错:</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 这里的字符集使用 ASCII,一个字符表示一个字节</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">mysql</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">table</span><span class="token plain"> varchar_size_demo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> c </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">65535</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">ASCII ROW_FORMAT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">COMPACT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">ERROR </span><span class="token number" style="color:rgb(170, 9, 130)">1118</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">42000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">: </span><span class="token keyword" style="color:rgb(12, 150, 155)">Row</span><span class="token plain"> size too large</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"> The maximum </span><span class="token keyword" style="color:rgb(12, 150, 155)">row</span><span class="token plain"> size </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> the used </span><span class="token keyword" style="color:rgb(12, 150, 155)">table</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">not</span><span class="token plain"> counting BLOBs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">is</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">65535.</span><span class="token plain"> This includes storage overhead</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">check</span><span class="token plain"> the manual</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"> You have </span><span class="token keyword" style="color:rgb(12, 150, 155)">to</span><span class="token plain"> change </span><span class="token keyword" style="color:rgb(12, 150, 155)">some</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">columns</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">to</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">or</span><span class="token plain"> BLOBs</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在实际测试发现,varchar类型最大能存放 65532 个字节 (少掉的三个字节为: <code>2 个字节的边长字段的长度 + 1 个字节的 NULL 值标识</code>)</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">mysql</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">table</span><span class="token plain"> varchar_size_demo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> c </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">65532</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">ASCII ROW_FORMAT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">COMPACT</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Query OK</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">rows</span><span class="token plain"> affected </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0.02</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然,如果修改字符集为 GBK,那么一个字节会占用两个字节,那么 65532 长度也无法存储,同样会报错</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">mysql</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">table</span><span class="token plain"> varchar_size_demo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> c </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">65532</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">GBK ROW_FORMAT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">COMPACT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">ERROR </span><span class="token number" style="color:rgb(170, 9, 130)">1074</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">42000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">: </span><span class="token keyword" style="color:rgb(12, 150, 155)">Column</span><span class="token plain"> length too big </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">column</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;c&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">max </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">32767</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">use</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">BLOB</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">or</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TEXT</span><span class="token plain"> instead</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>需要注意的是: 这里的 65535 长度指的是表中所有 varchar 类型的长度总和!</strong> 比如下面的两个 varchar 类型字段分别都没有超过 65535,但是依旧创建失败,因为两个 varchar 类型字段加起来超过了65535</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">mysql</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">table</span><span class="token plain"> size_demo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> c1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">65533</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> c2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">4</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">ASCII ROW_FORMAT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">COMPACT</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">ERROR </span><span class="token number" style="color:rgb(170, 9, 130)">1118</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">42000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">: </span><span class="token keyword" style="color:rgb(12, 150, 155)">Row</span><span class="token plain"> size too large</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"> The maximum </span><span class="token keyword" style="color:rgb(12, 150, 155)">row</span><span class="token plain"> size </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> the used </span><span class="token keyword" style="color:rgb(12, 150, 155)">table</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">not</span><span class="token plain"> counting BLOBs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">is</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">65535.</span><span class="token plain"> This includes storage overhead</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">check</span><span class="token plain"> the manual</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"> You have </span><span class="token keyword" style="color:rgb(12, 150, 155)">to</span><span class="token plain"> change </span><span class="token keyword" style="color:rgb(12, 150, 155)">some</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">columns</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">to</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">or</span><span class="token plain"> BLOBs</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>我们知道,InnoDB 存储引擎中一个页默认是 16kb,换算为字节就是: <code>16384字节</code>, 而一个 Varchar(M)最多可以存放 65535 个字节,那么这就出现一个问题: 一个数据页无法存放一条记录,这种现象就是<code>行溢出</code>。</p><p>在Compact和Reduntant行格式中，对于占用存储空间非常大的列，<strong>在记录的真实数据处只会存储该列的一部分数据，把剩余的数据分散存储在几个其他的页中进行</strong><code>分页存储</code>，<strong>然后记录的真实数据处用20个字节存储指向这些页的地址</strong>（当然这20个字节中还包括这些分散在其他页面中的数据的占用的字节数），从而可以找到剩余数据所在的页,这称为<code>页的扩展</code> </p><p><img loading="lazy" alt="image-20220710135559476" src="/assets/images/image-20220710135559476-d033dfed446c705e109b5b779cc9047d.png" width="636" height="300" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="dynamic-与-compressed">Dynamic 与 Compressed<a class="hash-link" href="#dynamic-与-compressed" title="标题的直接链接">​</a></h4><p>在 MySQL 8.0 中,默认行格式是<code>Dynamic</code>,Dynamic 、Compressed 行格式 和 Compact 行格式类似,但是在处理<code>行溢出</code> 的时候有所区分</p><ol><li>Compressed 、Dynamic 对于存放在 Blob 中的数据采用了<strong>完全的行溢出</strong>。即<strong>在数据页中只存放 20 个字节的指针(溢出页的地址),实际的数据都存放在溢出页(Off Page)中</strong></li><li>Compact 和 Redundant 两个行格式会记录真实数据的地方存储一部分存储真实数据(存放 768 个前缀自己)</li></ol><p>Compressed 行格式还有一个功能: <code>存储在 Compressed 行格式中的数据,会以 zlib 的算法进行压缩,</code>因此可以很好的存储 Blob、Text、varchar 这类大长度类型的数据</p><h2 class="anchor anchorWithStickyNavbar_loeA" id="区段碎片区">区、段、碎片区<a class="hash-link" href="#区段碎片区" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="数据页加载的-3-种方式">数据页加载的 3 种方式<a class="hash-link" href="#数据页加载的-3-种方式" title="标题的直接链接">​</a></h3><blockquote><p>InnoDB 从磁盘中读取数据的最小单位是<strong>页,</strong>那么想要得到 id=xxx 的数据,就是很多数据页中的很多行中的一行</p><p>对于 MySQL 存放的数据,逻辑概念上我们称之为表,在物理磁盘上是以数据页的形式存放的,当页加载到内存中,我们称之为<code>缓存页</code></p></blockquote><p>当缓存中没有某个页的数据,那么缓冲池有以下 3 种读取数据的方式:</p><ol><li><code>内存随机读取</code></li><li><code>随机 IO 读取</code></li><li><code>顺序 IO 读取</code></li></ol><h4 class="anchor anchorWithStickyNavbar_loeA" id="内存随机读取">内存随机读取<a class="hash-link" href="#内存随机读取" title="标题的直接链接">​</a></h4><p>如果数据存在于内存中,就是直接讲数据从内存读取到缓冲池中,基本在 <code>1ms</code>左右</p><p><img loading="lazy" alt="image-20220710144702040" src="/assets/images/image-20220710144702040-742ce82ce118a07732c164cfcb4f2755.png" width="348" height="233" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="随机io读取">随机IO读取<a class="hash-link" href="#随机io读取" title="标题的直接链接">​</a></h4><p>如果数据不在内存中,那么就需要在磁盘上对该页进行查找,整体时间预估为<code>10ms</code>左右,其中 6ms 是磁盘实际繁忙时间,还有3ms 是对可能发生的排队时间的预估值,另外的 1ms 是传输时间,将数据从磁盘服务器传输到数据库缓冲区。10ms 相对于内存的 1ms 慢了 10 倍,而且这个还只是加载一个页的时间</p><p><img loading="lazy" alt="image-20220710145031213" src="/assets/images/image-20220710145031213-b20ece3c30e49bbd95e01bdac169b930.png" width="988" height="380" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="顺序io读取">顺序IO读取<a class="hash-link" href="#顺序io读取" title="标题的直接链接">​</a></h4><p>顺序读取实际上是一种<code>批量读取</code>的方式,因为请求的<code>数据在磁盘上往往是相邻存储的</code>,顺序读取可以帮我我们批量的读取页面。这样的话,一次性加载到缓冲池就不需要再次磁盘 IO 了。假设一个磁盘的吞吐量是 40M/s,那么对于一个 16k 的页来说,1 次可以读取 2560 个页,平均下来一个页的读取时间是 0.4ms,比内存读取还要快!</p><h3 class="anchor anchorWithStickyNavbar_loeA" id="区extent-1">区(Extent)<a class="hash-link" href="#区extent-1" title="标题的直接链接">​</a></h3><p>B+Tree 每一层中的页都会形成一个双向链表,如果是以<code>页</code>为单位分配存储空间的话,那么即使是双向链表相邻的两个页,在物理磁盘上也可能离的非常远,那么在加载完一个页后,需要通过<code>随机I/O</code>找到下一页。但如果在物理磁盘上的两个页是相邻的,那么就只需要一次<code>顺序 IO </code>就可以找到对应的页。</p><p>引入<code>区</code>的概念,就是<code>一个区 = 磁盘上 64 个连续的页</code>,那么以区为单位分配空间的话,虽然数据可能无法填满整个区,但是连续的页可以在一定程度上减少了很多的<code>随机 IO</code></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="段segment-1">段(Segment)<a class="hash-link" href="#段segment-1" title="标题的直接链接">​</a></h3><p>对于范围查询,实际上是对 B+Tree 叶子节点中的记录进行顺序遍历,而如果不区分叶子节点和非叶子节点,统统把节点对应的页发在区中的话,那么扫描的效率就会降低。所以 InnoDB 将<code>叶子节点</code>和<code>非叶子节点</code> 进行了区分,即<code>叶子节点和非叶子节点分别有自己的独立的区</code>。<strong>这两个区所在的集合就是段,分别叫做: 叶子节点段(数据段)、非叶子节点段(索引段)</strong></p><p>出了常见的叶子节点段和非叶子节点段以外,InnoDB 还为一些特殊的数据定义了段,比如<code>回滚段</code></p><p>段实际不对应表空间中某一个连续的物理区域,而是一种<code>逻辑概念</code>,由<strong>若干个零散的页面以及一些完整的区组成</strong></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MagicalZhu/NoteLib/tree/main/docs/Mysql/高级特性/InnoDB数据页结构.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_N_05" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">最后<!-- -->由 <b>YuLiang Zhu</b> <!-- -->于 <b><time datetime="2022-12-06T01:19:52.000Z">2022年12月6日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Mysql/高级特性/设计索引"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">设计索引</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Mysql/高级特性/InnoDB表空间"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">InnoDB表空间</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><p class="content_nRws">Contents</p><ul class="table-of-contents table-of-contents__left-border"><li><a href="#innodb的存储结构" class="table-of-contents__link toc-highlight">InnoDB的存储结构</a><ul><li><a href="#存储的基本单位-页" class="table-of-contents__link toc-highlight">存储的基本单位-页</a></li><li><a href="#页结构" class="table-of-contents__link toc-highlight">页结构</a></li><li><a href="#页的大小" class="table-of-contents__link toc-highlight">页的大小</a></li><li><a href="#页的上层结构" class="table-of-contents__link toc-highlight">页的上层结构</a><ul><li><a href="#区extent" class="table-of-contents__link toc-highlight">区(Extent)</a></li><li><a href="#段segment" class="table-of-contents__link toc-highlight">段(Segment)</a></li><li><a href="#表空间" class="table-of-contents__link toc-highlight">表空间</a></li></ul></li></ul></li><li><a href="#数据页index的内部结构" class="table-of-contents__link toc-highlight">数据页(INDEX)的内部结构</a><ul><li><a href="#说明" class="table-of-contents__link toc-highlight">说明</a></li><li><a href="#文件头file-header" class="table-of-contents__link toc-highlight">文件头(File Header)</a></li><li><a href="#文件尾file-trailer" class="table-of-contents__link toc-highlight">文件尾(File Trailer)</a></li><li><a href="#最小最大记录" class="table-of-contents__link toc-highlight">最小最大记录</a></li><li><a href="#user-records--free-space" class="table-of-contents__link toc-highlight">User Records + Free Space</a></li><li><a href="#page-directory" class="table-of-contents__link toc-highlight">Page Directory</a><ul><li><a href="#说明-1" class="table-of-contents__link toc-highlight">说明</a></li><li><a href="#问题" class="table-of-contents__link toc-highlight">问题</a></li></ul></li><li><a href="#page-header" class="table-of-contents__link toc-highlight">Page Header</a></li></ul></li><li><a href="#行记录格式" class="table-of-contents__link toc-highlight">行记录格式</a><ul><li><a href="#指定行格式" class="table-of-contents__link toc-highlight">指定行格式</a></li><li><a href="#compact行格式" class="table-of-contents__link toc-highlight">COMPACT行格式</a><ul><li><a href="#变长字段长度列表" class="table-of-contents__link toc-highlight">变长字段长度列表</a></li><li><a href="#null-值标记位" class="table-of-contents__link toc-highlight">NULL 值标记位</a></li><li><a href="#记录头信息" class="table-of-contents__link toc-highlight">记录头信息</a><ul><li><a href="#delete_flag" class="table-of-contents__link toc-highlight">delete_flag</a></li><li><a href="#min_rec_flag" class="table-of-contents__link toc-highlight">min_rec_flag</a></li><li><a href="#record_type" class="table-of-contents__link toc-highlight">record_type</a></li><li><a href="#heap_no" class="table-of-contents__link toc-highlight">heap_no</a></li><li><a href="#n_owned" class="table-of-contents__link toc-highlight">n_owned</a></li><li><a href="#next_record" class="table-of-contents__link toc-highlight">next_record</a></li></ul></li><li><a href="#记录的真实数据" class="table-of-contents__link toc-highlight">记录的真实数据</a></li></ul></li><li><a href="#dynamic和compressed行格式" class="table-of-contents__link toc-highlight">Dynamic和Compressed行格式</a><ul><li><a href="#行溢出" class="table-of-contents__link toc-highlight">行溢出</a></li><li><a href="#dynamic-与-compressed" class="table-of-contents__link toc-highlight">Dynamic 与 Compressed</a></li></ul></li></ul></li><li><a href="#区段碎片区" class="table-of-contents__link toc-highlight">区、段、碎片区</a><ul><li><a href="#数据页加载的-3-种方式" class="table-of-contents__link toc-highlight">数据页加载的 3 种方式</a><ul><li><a href="#内存随机读取" class="table-of-contents__link toc-highlight">内存随机读取</a></li><li><a href="#随机io读取" class="table-of-contents__link toc-highlight">随机IO读取</a></li><li><a href="#顺序io读取" class="table-of-contents__link toc-highlight">顺序IO读取</a></li></ul></li><li><a href="#区extent-1" class="table-of-contents__link toc-highlight">区(Extent)</a></li><li><a href="#段segment-1" class="table-of-contents__link toc-highlight">段(Segment)</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">前端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://v3.cn.vuejs.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">React<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://ts.xcatliu.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TypeScript<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://developer.mozilla.org/zh-CN/docs/Web" target="_blank" rel="noopener noreferrer" class="footer__link-item">MDN<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">后端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spring<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">JVM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.infoq.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">InfoQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">文档构建</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://typoraio.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Typora<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 huakucha. Built With Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf86732a.js"></script>
<script src="/assets/js/main.98457ee6.js"></script>
</body>
</html>