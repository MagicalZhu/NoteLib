<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Mysql/高级特性/Explain">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">执行计划分析 | 花裤衩Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" name="twitter:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" property="og:url" content="https://huakucha.com/docs/Mysql/高级特性/Explain"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="执行计划分析 | 花裤衩Wiki"><meta data-rh="true" name="description" content="在数据库调优中,除了使用慢查询日志(slowquerylog), 还可以利用执行计划分析(explain) 对查询语句进行优化分析"><meta data-rh="true" property="og:description" content="在数据库调优中,除了使用慢查询日志(slowquerylog), 还可以利用执行计划分析(explain) 对查询语句进行优化分析"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huakucha.com/docs/Mysql/高级特性/Explain"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/Mysql/高级特性/Explain" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/Mysql/高级特性/Explain" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QZ9YPBGUYT-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="花裤衩Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="花裤衩Wiki Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="花裤衩Wiki JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="花裤衩Wiki" href="/opensearch.xml">

<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.font.im/css?family=Raleway:500,700&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.864d50a7.css">
<link rel="preload" href="/assets/js/runtime~main.bf86732a.js" as="script">
<link rel="preload" href="/assets/js/main.98457ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_D8pK">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="content_zf74 announcementBarContent_dpRF">🌟欢迎来到花裤衩的博客🌟</div><button type="button" aria-label="关闭" class="clean-btn close closeButton_ZdWa announcementBarClose_iXyO"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--light_PnYV"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--dark_eYgw"></div><b class="navbar__title text--truncate">花裤衩</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">基础知识🤖</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/currency">并发编程</a></li><li><a class="dropdown__link" href="/docs/networrk-basic">计算机网络</a></li><li><a class="dropdown__link" href="/docs/linuxCommand">Linux</a></li><li><a class="dropdown__link" href="/docs/dataStructure">数据结构与算法</a></li><li><a class="dropdown__link" href="/docs/leetCode">LeetCode</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/mysql">MySQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">后端框架👨‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/spring">Spring</a></li><li><a class="dropdown__link" href="/docs/springCloud">SpringCloud</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">方法论🚧</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/distribute/protol">分布式理论</a></li><li><a class="dropdown__link" href="/docs/distribute/basicTech">分布式技术点</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">中间件🚀</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/middleware/basicMiddleware">基础中间件</a></li><li><a class="dropdown__link" href="/docs/middleware/job">定时任务</a></li><li><a class="dropdown__link" href="/docs/middleware/cache">缓存</a></li><li><a class="dropdown__link" href="/docs/middleware/searchEngine">搜索引擎</a></li><li><a class="dropdown__link" href="/docs/middleware/messageQueue">消息队列</a></li><li><a class="dropdown__link" href="/docs/middleware/database">数据库</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">底层⛽️</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/JVM">JVM</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">前端技术👩‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/front/Vue">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其他工具👹</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Gradle">Gradle</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">物料中心👏</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/website/BE">后端产品</a></li><li><a class="dropdown__link" href="/website/COM">其他产品</a></li><li><a class="dropdown__link" href="/website/FE">前端产品</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.huakucha.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">关于<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/MagicalZhu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_MW0i colorModeToggle_x44X"><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SFTY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ekgs"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_H2mL"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_W2AM"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_ntye" type="button"></button><div class="docPage_qMb8"><aside class="theme-doc-sidebar-container docSidebarContainer_rpaz"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mysql">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/mysql基础与高级">MySQL基础与高级</a><button aria-label="打开/收起侧边栏菜单「MySQL基础与高级」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/基础知识">基础知识</a><button aria-label="打开/收起侧边栏菜单「基础知识」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/数据库管理">数据库管理</a><button aria-label="打开/收起侧边栏菜单「数据库管理」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/架构与引擎">架构与引擎</a><button aria-label="打开/收起侧边栏菜单「架构与引擎」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/存储结构与索引">存储结构与索引</a><button aria-label="打开/收起侧边栏菜单「存储结构与索引」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/性能优化">性能优化</a><button aria-label="打开/收起侧边栏菜单「性能优化」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/性能分析工具">性能分析工具</a><button aria-label="打开/收起侧边栏菜单「性能分析工具」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/基本分析工具">基本分析工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Mysql/高级特性/Explain">执行计划分析</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/性能监控工具">性能监控工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/索引与查询优化">索引与查询优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/数据库设计规范">数据库设计规范</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/数据库其他调优策略">数据库其他调优策略</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/事务与锁">事务与锁</a><button aria-label="打开/收起侧边栏菜单「事务与锁」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/运维">运维</a><button aria-label="打开/收起侧边栏菜单「运维」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Mysql/MySQL参数与命令">MySQL参数与命令</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_JQG6"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Iseg"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SLhD"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/mysql基础与高级"><span itemprop="name">MySQL基础与高级</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/性能优化"><span itemprop="name">性能优化</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/性能分析工具"><span itemprop="name">性能分析工具</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">执行计划分析</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_IbkY theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_p7nN">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>执行计划分析</h1></header><p>在数据库调优中,除了使用慢查询日志(slow_query_log), 还可以利用执行计划分析(explain) 对查询语句进行优化分析</p><h2 class="anchor anchorWithStickyNavbar_loeA" id="概述">概述<a class="hash-link" href="#概述" title="标题的直接链接">​</a></h2><blockquote><p>定位了慢 SQL 之后,我们可以使用<code>Explain</code> 或<code>Describe</code> 工具做针对性的分析,<strong>Describe</strong>的使用方法和 Explain 是一样的,且分析结果也是一样的</p><p>MySQL 中有专门负责优化 Select 语句的优化器模块,为客户端请求的 Sql 查询提供它认为的最优的<code>执行计划</code></p><p>这个执行计划展示了接下来具体执行查询的方式,比如多表连接的顺序是什么、对于每个表采用什么访问方法来具体执行查询等。MySQL 为我们提供了<code>Explain</code>语句帮助我们查看某个查询语句的具体执行计划是什么</p></blockquote><ul><li>可以做什么<ol><li>表的读取顺序</li><li>数据读取操作的操作类型</li><li>哪些索引可以被使用</li><li><strong>哪些索引被实际使用</strong></li><li>表之间的引用</li><li><strong>每张表有多少行被优化器查询</strong></li></ol></li><li>官网介绍<ul><li><a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html" target="_blank" rel="noopener noreferrer">MySQL5.7</a></li><li><a href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html" target="_blank" rel="noopener noreferrer">MySQL8.0</a></li></ul></li><li><strong>版本说明</strong><ul><li>MySQL 5.6.3 之前只能 <strong>Explain Select 语句</strong>,之后就可以使用<strong>Explain Delete/Update/Insert</strong></li></ul></li><li>Explain 总结相关的博客<ul><li><a href="https://blog.51cto.com/u_14299052/2986347" target="_blank" rel="noopener noreferrer">最完整的Explain总结，SQL优化不再困难</a></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="基本语法">基本语法<a class="hash-link" href="#基本语法" title="标题的直接链接">​</a></h2><ul><li><code>Explain SELECT | DELETE | INSERT | UPDATE语句</code></li><li><strong>Explain 输出说明</strong><ul><li><code>id</code><ul><li>在一个大的查询语句中每个SELECT关键字都对应一个 <strong>唯一的id</strong></li></ul></li><li><code>select_type</code><ul><li>Select 关键字对应的那个查询的类型</li></ul></li><li><code>table</code><ul><li>表名</li></ul></li><li><code>partitions</code><ul><li>匹配的分区信息</li></ul></li><li><code>type</code><ul><li>针对单表的访问方法</li></ul></li><li><code>possible_keys</code><ul><li>可能用到的索引</li></ul></li><li><code>key</code><ul><li>实际用到的索引</li></ul></li><li><code>key_len</code><ul><li>实际使用到的索引长度</li></ul></li><li><code>ref</code><ul><li>当使用索引列等值查询时，与索引列进行等值匹配的对象信息</li></ul></li><li><code>rows</code><ul><li>预估的需要读取的记录条数</li></ul></li><li><code>filtered</code><ul><li>某个表经过搜索条件过滤后剩余记录条数的百分比</li></ul></li><li><code>Extra</code><ul><li>一些额外的信息</li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="准备数据">准备数据<a class="hash-link" href="#准备数据" title="标题的直接链接">​</a></h2><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 建立表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> s1 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key3 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key_part1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key_part2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key_part3 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    common_field </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_key1 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">key1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_key2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">key2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_key3 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">key3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_key_part</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> key_part2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> key_part3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ENGINE</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">INNODB</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> s2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key3 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key_part1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key_part2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    key_part3 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    common_field </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_key1 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">key1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_key2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">key2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_key3 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">key3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_key_part</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">key_part1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> key_part2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> key_part3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ENGINE</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">INNODB</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 设置变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">set</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">global</span><span class="token plain"> log_bin_trust_function_creators</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 创建函数,该函数会返回一个字符串</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FUNCTION</span><span class="token plain"> rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">n </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">RETURNS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">255</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> chars_str </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> return_str </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">255</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHILE</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain"> n </span><span class="token keyword" style="color:rgb(12, 150, 155)">DO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> return_str </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">CONCAT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">return_str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">SUBSTRING</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">chars_str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">FLOOR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain">RAND</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">52</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHILE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">RETURN</span><span class="token plain"> return_str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 定义存储过程1,向 s1 插入数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PROCEDURE</span><span class="token plain"> insert_s1 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> min_num </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> max_num </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> autocommit </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">REPEAT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> s1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">min_num </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">6</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">min_num </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">6</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      UNTIL i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> max_num</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">REPEAT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">COMMIT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 定义存储过程2,向 s2 插入数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PROCEDURE</span><span class="token plain"> insert_s2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> min_num </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> max_num </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> autocommit </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">REPEAT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> s2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">min_num </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">6</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">min_num </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">6</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      rand_string1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      UNTIL i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> max_num </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">REPEAT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">COMMIT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 执行存储过程 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CALL</span><span class="token plain"> insert_s1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10001</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token number" style="color:rgb(170, 9, 130)">10000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 执行存储过程 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CALL</span><span class="token plain"> insert_s2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10001</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token number" style="color:rgb(170, 9, 130)">10000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-table">输出结果-table<a class="hash-link" href="#输出结果-table" title="标题的直接链接">​</a></h2><ul><li><p><strong>说明</strong> </p><ul><li><p><code>查询的每一行记录都对应一个单表(包括临时表)</code></p></li><li><p>不论我们的查询语句有多复杂，包含了多少个表 ，<strong>到最后也是需要对每个表进行<code>单表访问</code>的</strong></p><ul><li>即 MySQL 规定 <code>EXPLAIN语句输出的每条记录都对应着某个单表的访问方法</code></li></ul></li><li><p>该条记录的table列代表着该表的表名(有时不是真实的表名字，可能是简称)</p></li></ul></li><li><p><strong>小结</strong></p><ul><li><mark>多表关联查询中,会有多行记录,前面的表称为:驱动表,后面的的表称为:被驱动表</mark></li><li><mark>如果使用了 union 进行去重,还会有张临时表</mark></li></ul></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>示例</div><div class="admonitionContent_vXIg"><p><strong>1、只查询一个单表</strong></p><p><img loading="lazy" alt="image-20220731155757634" src="/assets/images/image-20220731155757634-5fe55aa73bef939d3480f825129e21db.png" width="2566" height="350" class="img_CujE"></p><p><strong>2、多表关联查询</strong></p><p><strong>这里的 s1 就是驱动表,s2 就是被驱动表</strong></p><p><img loading="lazy" alt="image-20220731155848406" src="/assets/images/image-20220731155848406-5d785e161f5107df27fda64b556ccc49.png" width="3026" height="382" class="img_CujE"></p></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-id">输出结果-id<a class="hash-link" href="#输出结果-id" title="标题的直接链接">​</a></h2><ul><li><strong>说明</strong><ul><li>在一个大的查询语句中<strong>每个 SELECT都对应一个唯一的 id</strong>,即复杂的子查询会有多个 id</li><li><strong>查询优化器可能会对涉及子查询的查询语句进行重写,转变为一个多表查询的操作</strong></li></ul></li><li><strong>小结</strong><ul><li><mark><strong>id列越大执行优先级越高，id相同则从上往下执行，id为NULL最后执行</strong></mark></li><li><mark><strong>关注点:id号每个号码，表示一趟独立的查询, 一个sql的查询次数越少越好</strong></mark></li></ul></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_vXIg"><p><strong>1.单表查询,只有一个 Select 关键字</strong></p><p>很明显只有一条记录,也只有一个 id</p><p><img loading="lazy" alt="image-20220731163649451" src="/assets/images/image-20220731163649451-f6e36e6327d0048b6e4c712fcf5be753.png" width="2632" height="336" class="img_CujE"></p><br><p><strong>2. 多表关联,但是也只有一个 Select 关键字</strong></p><p>我们看到,虽然多表关联查询了,但由于只有一个 Select 语句,所以 id 都是一样的 <strong>1</strong></p><p><img loading="lazy" alt="image-20220731163842827" src="/assets/images/image-20220731163842827-3c43cb4a25acee189d884bcd350f7e2c.png" width="3070" height="424" class="img_CujE"></p><br><p><strong>3.子查询,包含了两个 Select 关键字</strong></p><p>从输出结果可以看到:</p><ul><li><p>s1表在外层查询中,外层查询有一个独立的SELECT关键字，所以第一条记录的id值就是1。</p></li><li><p>t2表在子查询中，子查询有一个独立的SELECT关键字，所以第二条记录的id值就是2。</p></li></ul><p><img loading="lazy" alt="image-20220731164509738" src="/assets/images/image-20220731164509738-7e9aa0d65101476a7a69165f43a33372.png" width="2758" height="400" class="img_CujE"></p><br><p><strong>4.查询优化器是会对子查询语句重写的</strong></p><p>虽然我们的查询语句是一个子查询，但是执行计划中s1和s2表对应的记录的id值全部是1，这就表明了查询优化器将子查询转换为了多表的连接查询</p><p><img loading="lazy" alt="image-20220731164758523" src="/assets/images/image-20220731164758523-c67dad8f207badb770b381892c686f76.png" width="3566" height="390" class="img_CujE"></p><p><strong>5.Union 和 Union All</strong></p><p>union 去重需要使用临时表,所以有 3条记录,最后一条的 table 是&lt;union1,2&gt;, 但是 Union All 不需要,所以只有两条记录。它们都有两个 Select 关键字,所以id 有<!-- -->[1,2]</p><p><img loading="lazy" alt="image-20220731165556395" src="/assets/images/image-20220731165556395-4e3ab48eaaa060218e6534e422702c92.png" width="2882" height="840" class="img_CujE"></p></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-select_type">输出结果-select_type<a class="hash-link" href="#输出结果-select_type" title="标题的直接链接">​</a></h2><blockquote><p>一个查询语句中可以包含若干个 SELECT 关键字,<strong>每个SELECT关键字代表着一个小的查询语句</strong>,而每个 SELECT 关键字的 FROM 子句中都可以包含若干张表(用于连接查询)。<strong>每张表都对应着执行计划(explain)输出中的一条记录</strong>, 对于在同一个 SELECT 关键字中的表来说,它们的 id 值是相同的</p></blockquote><p>MySQL 为每个 SELECT 关键字代表的“小查询” 都定义了一个<code>select_type</code>的属性。通过这个属性值,我们可以知道<code>小查询在大查询中起了什么作用</code></p><p><strong>select_type 有以下的取值:</strong></p><ul><li><code>SIMPLE</code></li><li><code>PRIMARY</code></li><li><code>UNION</code></li><li><code>UNION RESULT</code></li><li><code>DEPENDENT UNION</code></li><li><code>SUBQUERY</code></li><li><code>DEPENDENT SUBQUERY</code></li><li><code>DERIVED</code></li><li><code>MATERIALIZED</code></li><li><code>UNCACHEABLE SUBQUERY	</code></li><li><code>UNCACHEABLE UNION</code></li></ul><mark>需要注意的是:优化器会对我们的查询语句进行它认为的优化,所以有时候 select_type 与实际编写的 sql 语句并不匹配</mark>,特别是子查询,会将子查询转为多表 join 的方式<h3 class="anchor anchorWithStickyNavbar_loeA" id="simple">SIMPLE<a class="hash-link" href="#simple" title="标题的直接链接">​</a></h3><ul><li>没有使用 union 、union all 、子查询, 当然<mark>多表连接查询也算是 simple 类型</mark> </li></ul><p><img loading="lazy" alt="image-20220731223535309" src="/assets/images/image-20220731223535309-a7e18ba91915c796d6128caa960abff8.png" width="3006" height="754" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="primaryunionunion-result">PRIMARY、UNION、UNION RESULT<a class="hash-link" href="#primaryunionunion-result" title="标题的直接链接">​</a></h3><ol><li><p>对于包含 <code>UNION、UNION ALL、子查询</code>的大查询来说,它是由几个小查询组成的,其中最左边的查询的 query_type 值就是<code>PRIMARY</code></p></li><li><p>对于包含 <code>UNION、UNION ALL</code>的大查询来说,它是由几个小查询组成的,除了最左边的小查询,其他小查询的 query_type 值就是<code>UNION</code></p></li><li><p>MySQL 使用临时表来完成<code>UNION</code>的去重工作,针对该临时表的查询的query_type 值就是<code>UNION RESULT</code></p></li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>示例</div><div class="admonitionContent_vXIg"><p>我们可以看到,UNION 与 UNION ALL 最左侧的查询(s1) 都是 <strong>PRIMARY</strong>的,其他的是<strong>UNION</strong>。然后UNION 由于需要去重,还增加了一个临时表的查询(<strong>UNION RESULT</strong>)</p><p><img loading="lazy" alt="image-20220731225140837" src="/assets/images/image-20220731225140837-4ab2db0df0aab445f8f893f5b115ce70.png" width="3096" height="894" class="img_CujE"></p></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="subquery">SUBQUERY<a class="hash-link" href="#subquery" title="标题的直接链接">​</a></h3><p><strong>如果包含</strong><code>子查询</code><strong>的查询语句不能转为对应的多表 join 连接查询,并且该子查询是</strong><code>不相关子查询</code>,<strong>那么该子查询的第一个 SELECT 关键字对应的查询就是</strong><code>SUBQUERY</code></p><p><img loading="lazy" alt="image-20220731230246005" src="/assets/images/image-20220731230246005-a16f83b8ca7fb584e945c726fc56094f.png" width="2768" height="426" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="dependent-subquery">DEPENDENT SUBQUERY<a class="hash-link" href="#dependent-subquery" title="标题的直接链接">​</a></h3><p><strong>如果包含</strong><code>子查询</code><strong>的查询语句不能转为对应的多表 join 连接查询,并且该子查询是</strong><code>相关子查询</code><strong>,那么该子查询的第一个 SELECT 关键字对应的查询就是</strong><code> DEPENDENT SUBQUERY</code></p><mark>需要注意的是: DEPENDENT SUBQUERY的子查询可能会被执行多次!</mark><p><img loading="lazy" alt="image-20220731230707414" src="/assets/images/image-20220731230707414-d9f0127bfbdfe83cbae7112465ef88cc.png" width="3352" height="396" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="dependent-union">DEPENDENT UNION<a class="hash-link" href="#dependent-union" title="标题的直接链接">​</a></h3><p><strong>如果子查询中包含</strong> <code>UNION、UNION ALL</code><strong>的小查询,且该子查询是</strong><code>相关子查询</code><strong>,那么该子查询的第一个SELECT 关键字对应的是</strong><code>DEPENDENT SUBQUERY</code><strong>,其他的则都是</strong><code>DEPENDENT UNION</code></p><p><img loading="lazy" alt="image-20220801090619430" src="/assets/images/image-20220801090619430-daa3d9c627d96a7ecc8ac85e99adf9db.png" width="3582" height="582" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="derived">DERIVED<a class="hash-link" href="#derived" title="标题的直接链接">​</a></h3><p>对于包含<code>派生表</code>的查询,该派生表对应的子查询的 query_type 就是<code>DERIVED</code></p><p><img loading="lazy" alt="image-20220801091628209" src="/assets/images/image-20220801091628209-c5022a40009b4788206dabcab4134cf5.png" width="2948" height="376" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="materialized">MATERIALIZED<a class="hash-link" href="#materialized" title="标题的直接链接">​</a></h3><p>当查询优化器在执行包含子查询的语句时,选择将子查询转为物化表之后与外层查询进行连接查询,那么该子查询的 query_type 就是<code>MATERIALIZED</code></p><p><img loading="lazy" alt="image-20220801092435945" src="/assets/images/image-20220801092435945-4dd7dd5e772491d374d603110f78381b.png" width="3642" height="448" class="img_CujE"></p><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-分区partitions">输出结果-分区(partitions)<a class="hash-link" href="#输出结果-分区partitions" title="标题的直接链接">​</a></h2><ul><li><strong>表示分区表中的命中情况,如果是非分区表,这个值为 <code>NULL</code></strong>,一般来说我们执行计划的 partitions 的值都是 null</li><li><a href="https://dev.mysql.com/doc/refman/5.7/en/partitioning-info.html" target="_blank" rel="noopener noreferrer">官方文档</a></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>测试分区</div><div class="admonitionContent_vXIg"><p><strong>1.创建分区表</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 创建分区表，按照id分区，id&lt;100 p0分区，其他p1分区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> user_partitions </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">auto_increment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        NAME </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">12</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token keyword" style="color:rgb(12, 150, 155)">PARTITION</span><span class="token plain"> p0 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> less than</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">PARTITION</span><span class="token plain"> p1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> less than MAXVALUE</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.测试分区信息</strong></p><p><img loading="lazy" alt="image-20220801093428783" src="/assets/images/image-20220801093428783-62e4a4a8d4b1d85136223d8df39130fa.png" width="3206" height="742" class="img_CujE"></p></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-访问方法type">输出结果-访问方法(type)🚧<a class="hash-link" href="#输出结果-访问方法type" title="标题的直接链接">​</a></h2><p>对于单个表的查询来说, MySQL 把查询的执行方式大致分为下边两种：</p><ol><li><p><code>使用全表扫描进行查询</code></p><ul><li>这种执行方式很好理解，就是把表的每一行记录都扫一遍嘛，把符合搜索条件的记录加入到结果集就完了。不管是啥查询都可以使用这种方式执行，当然，这种也是最笨的执行方式</li></ul></li><li><p><code>使用索引进行查询</code></p><ul><li><p>因为直接使用全表扫描的方式执行查询要遍历好多记录，所以代价可能太大了。如果查询语句中的搜索条件可以使用到某个索引，那直接使用索引来执行查询可能会加快查询执行的时间。使用索引来执行查询的方式五花八门，又可以细分为许多种类：</p><ul><li><p>针对主键或唯一二级索引的等值查询</p></li><li><p>针对普通二级索引的等值查询</p></li><li><p>针对索引列的范围查询</p></li><li><p>直接扫描整个索引</p></li></ul></li></ul></li></ol><p><strong>MySQL 执行查询语句的方式</strong>称之为<code>访问方法</code>或者<code>访问类型</code>, 也就是执行计划中的 <code>type</code> 列,是一个重要的指标。同一个查询语句可能可以使用多种不同的访问方法来执行，虽然最后的查询结果都是一样的,但是花费的时间相差可能是极大的</p><h3 class="anchor anchorWithStickyNavbar_loeA" id="system">system<a class="hash-link" href="#system" title="标题的直接链接">​</a></h3><ul><li>当表中<code>只有一条记录</code>,并且该表使用的存储引擎的统计数据是精确的,比如 MyISAM、Memory,那么对该表的访问是 <code>system</code></li><li><mark>是一种特殊的 const</mark></li></ul><p><img loading="lazy" alt="image-20220801094910549" src="/assets/images/image-20220801094910549-8866a973b7d73abf723daadc4e2f3a5e.png" width="2696" height="1190" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="const">const<a class="hash-link" href="#const" title="标题的直接链接">​</a></h3><ul><li><p>概述</p><ul><li><strong>如果某个表通过</strong><code>主键或唯一索引与常量值进行等值匹配</code><strong>的时候,对该表的访问方法就是</strong><code>const</code><ul><li><mark>常数值如果不在表中,那么 type 就是 null</mark></li><li><mark>不止适用于单表查询,也适用于 join 连接查询</mark></li></ul></li><li><strong>注意: 如果查询的列值 NULL,用的就不是 const 了,因为唯一二级索引列并不限制 NULL 值的数量</strong>, 比如(<em>select ... from tableName where field is null</em>)</li></ul></li><li><p>基本格式</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 单一查询条件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> tbl_name </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> primary_key</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">constValue</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 多个查询条件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> tbl_name </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> union_primary_key_part1</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">constValue1  </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> union_primary_key_part2</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">constValue2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><img loading="lazy" alt="image-20220801100338422" src="/assets/images/image-20220801100338422-f59b72eb2dec1427fd8630fba9ffd14b.png" width="2950" height="362" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="eq_ref">eq_ref<a class="hash-link" href="#eq_ref" title="标题的直接链接">​</a></h3><ul><li><p>概述</p><ul><li>在连接查询时,如果<code>被驱动表</code>是通过<code>主键或者唯一索引列与驱动表进行等值匹配</code>的方式进行访问的,则对该被驱动表的访问方法是<code>eq_ref</code></li><li><mark>如果主键或者唯一索引列是联合索引的话,所有的索引列都必须进行等值比较,最多只会返回一条符合条件的记录</mark></li></ul></li><li><p>基本格式</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    key_column:主键、唯一索引</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 连接查询, 主键或唯一索引与驱动表进行等值匹配</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ref_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">other_table</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> ref_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key_column</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">other_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">column</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ref_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">other_table</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> ref_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key_column_part1</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">other_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">column</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> ref_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key_column_part2</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">constValue</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>示例</div><div class="admonitionContent_vXIg"><p>可以看到 s2 作为被驱动表,通过主键与 s1 等值匹配,所以对s2 的方法方法是eq_ref</p><p><img loading="lazy" alt="image-20220801102444370" src="/assets/images/image-20220801102444370-68dc85e0b685b581afdb4d57aa63aa90.png" width="3320" height="742" class="img_CujE"></p></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="ref">ref<a class="hash-link" href="#ref" title="标题的直接链接">​</a></h3><ul><li><p>概述</p><ul><li>当<code>普通的二级索引与常量进行等值匹配</code>时来查询某个表,那么这个表的访问方法就是<code>ref</code><ul><li>查询的时候先利用普通二级索引定位到符合查询条件的<code>主键值</code>, 然后利用主键值通过<code>回表</code>的方式获取完整的记录值</li><li>在连接查询时,如果<code>被驱动表</code>是通过<code>普通的二级索引与驱动表进行等值匹配</code>的方式进行访问的,则对该<strong>被驱动表</strong>的访问方法是<code>ref</code></li></ul></li><li><mark>由于普通的二级索引不限制索引列值的唯一性,所以可能会返回多条记录,也就是说使用二级索引来执行查询的代价取决于等值匹配到的二级索引记录条数。如果匹配的记录较少，则回表的代价还是比较低的</mark></li></ul></li></ul><ul><li><p><strong>基本格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    key_column:普通二级索引</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 单表查询,普通二级索引与常量等值匹配</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ref_table </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> key_column</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">constValue</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 连接查询,普通二级索引与驱动表进行等值匹配</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ref_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">other_table</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> ref_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key_column</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">other_table</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">column</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><img loading="lazy" alt="image-20220801102020671" src="/assets/images/image-20220801102020671-36016a3cf1e3bf982ba80cbeb213794d.png" width="3010" height="698" class="img_CujE"></p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>二级索引列值为NULL</div><div class="admonitionContent_vXIg"><p>不论是普通的二级索引, 还是唯一二级索引, 它们的索引列对包含 NULL 值的数量并不限制。所以采用 key IS NULL这种形式的搜索条件最多只能使用 ref 的访问方法，而不是 const 的访问方法</p></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="ref_or_null">ref_or_null<a class="hash-link" href="#ref_or_null" title="标题的直接链接">​</a></h3><ul><li><p><strong>概述</strong></p><ul><li>当对<code>普通二级索引进行等值匹配查询时</code>,且该普通二级索引列的值也可以为<code>NULL</code>时,那么对该表的方法方法是<code>ref_or_null</code></li></ul></li><li><p><strong>基本格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    key_column:普通二级索引</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 单表或者连接查询中,普通二级索引进行等值匹配查询,或者普通二级索引可以为 NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ref_table</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> key_column</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">expr </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> key_column </span><span class="token operator" style="color:rgb(12, 150, 155)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><img loading="lazy" alt="image-20220801104330922" src="/assets/images/image-20220801104330922-b05b55b1f67bddef7c1ed2232359c27a.png" width="3152" height="320" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="index_merge">index_merge<a class="hash-link" href="#index_merge" title="标题的直接链接">​</a></h3><ul><li><p><strong>概述</strong></p><ul><li>合并索引</li><li>一般情况下对于某个表的查询只能使用到一个索引，但在某些场景下可以使用多种索引合并的方式来执行查询</li><li><a href="/docs/Mysql/高级特性/Explain#%E7%B4%A2%E5%BC%95%E5%90%88%E5%B9%B6">详细说明</a></li></ul></li><li><p><strong>基本格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 格式 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> tbl_name </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> const_key1_val </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> key2 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> const_key2_val</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 格式 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> tbl_name</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> const_key1_val </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> key2 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> const_key2_val</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> non_key </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> non_key_value</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 格式 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> t2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            t1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">const_key1_val1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">const_key1_val2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key2 </span><span class="token operator" style="color:rgb(12, 150, 155)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;const_key2_val%&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">some_col</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 格式 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> t2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> const_key1_val</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">t2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">some_col </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key2 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">some_col2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>合并的等价</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 等价 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> z </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">y </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 等价 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> z </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">OR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">y </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><img loading="lazy" alt="image-20220801104820012" src="/assets/images/image-20220801104820012-797446b30b6c31263efccf622efadbdd.png" width="3854" height="344" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="unique_subquery">unique_subquery<a class="hash-link" href="#unique_subquery" title="标题的直接链接">​</a></h3><ul><li><p><strong>概述</strong></p><ul><li>针对一些在<code>IN 子查询</code>的查询语句中,如果优化器将 IN 子查询转为<code>Exists 子查询</code>,而且子查询可以<code>使用到主键进行等值匹配</code>的话,那么这个子查询的 type 就是<code>unique_query</code></li></ul></li><li><p><strong>基本语法</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">value</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> primary_key </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> single_table </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> some_expr</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> some_expr</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><img loading="lazy" alt="image-20220801125626158" src="/assets/images/image-20220801125626158-893acd6f7e913bda68f270015ce75499.png" width="3158" height="358" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="index_subquery">index_subquery<a class="hash-link" href="#index_subquery" title="标题的直接链接">​</a></h3><ul><li><p><strong>概述</strong></p><ul><li>针对一些在<code>IN 子查询</code>的查询语句中,如果优化器将 IN 子查询转为<code>Exists 子查询</code>,而且子查询可以<code>使用到唯一索引进行等值匹配</code>的话,那么这个子查询的 type 就是<code>index_query</code></li></ul></li><li><p><strong>基本格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">value</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> key_column </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> single_table </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> some_expr</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> some_expr</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><img loading="lazy" alt="image-20220801144418918" src="/assets/images/image-20220801144418918-b5ac0d21451a95c3a4e89a55f730a2b3.png" width="2982" height="344" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="range">range<a class="hash-link" href="#range" title="标题的直接链接">​</a></h3><ul><li><p><strong>概述</strong></p><ul><li>如果使用索引(聚簇索引和二级索引)获取某些<code>范围区间</code>的记录,那么就会使用<code>range</code>访问方法</li><li>范围扫描通常出现在 <code>in 、between 、&gt; 、&lt; 、 &gt;= 、 &lt;=</code>等操作中</li></ul></li><li><p><strong>基本格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> tbl_name</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> key_column </span><span class="token operator" style="color:rgb(12, 150, 155)">BETWEEN</span><span class="token plain"> constValue1 </span><span class="token operator" style="color:rgb(12, 150, 155)">and</span><span class="token plain"> constValue2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> tbl_name</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> key_column </span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">constValue1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">constValue2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">constValue3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> tbl_name</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> key_part1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> constValue1 </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> key_part2 </span><span class="token operator" style="color:rgb(12, 150, 155)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">constValue2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">constValue3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">constValue4</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- ...</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20220801142530312" src="/assets/images/image-20220801142530312-a92eaacf244064cbe8bb0c3143a407af.png" width="2770" height="264" class="img_CujE"></p></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="index">index<a class="hash-link" href="#index" title="标题的直接链接">​</a></h3><ul><li>在二级索引中,当使用了<strong>索引覆盖</strong>,但是需要<strong>扫描全部的索引记录时</strong>,那么就会使用<code>index</code>访问方法<ul><li>即<strong>虽然 where 查询条件无法使索引,但是 select 子句中的字段就是该索引的索引列(只有部分也可以),那么就会遍历二级索引记录,而不是回表</strong></li></ul></li><li>索引覆盖: 简单的说就是不用回表,就可以查询到需要的字段</li></ul><p><img loading="lazy" alt="image-20220801142903772" src="/assets/images/image-20220801142903772-b0a8547d7b35d52d941b6de0cedf6f46.png" width="2972" height="292" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="all">all<a class="hash-link" href="#all" title="标题的直接链接">​</a></h3><p>就是全表扫描,性能最差</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>说明</div><div class="admonitionContent_vXIg"><ol><li>一般来说,上面的访问方法除了<code>ALL</code>之外,都用到了索引,除了<code>index_merge</code>都只用了1 个索引</li><li>性能从高到低依次为: <code>system、const、eq_ref、ref、fulltext、ref_or_null、index_merge、unique_subquery、index_subquery、range、index、all</code></li><li>性能优化目标:至少达到 range 级别,要求是 ref 级别,最好是 consts 级别</li></ol></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-possible_keykey">输出结果-possible_key&amp;key<a class="hash-link" href="#输出结果-possible_keykey" title="标题的直接链接">​</a></h2><ul><li><code>possible_keys</code><ul><li>查询中可能的索引</li></ul></li><li><code>key</code><ul><li>查询优化器计算完不同索引的成本后,最后决定的实际使用的索引</li><li>如果为 NULL,则说明没有使用索引</li></ul></li></ul><p><img loading="lazy" alt="image-20220801152046842" src="/assets/images/image-20220801152046842-d2a5506a5d14c1b9c311b52bf041da49.png" width="2646" height="304" class="img_CujE"></p><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-key_len-">输出结果-key_len 🚧<a class="hash-link" href="#输出结果-key_len-" title="标题的直接链接">​</a></h2><ul><li><p><strong>说明</strong></p><ul><li>实际使用到的<strong>索引长度(字节数)</strong></li><li>主要针对<code>联合索引</code>,可以帮助我们检查<strong>是否充分的利用上了索引</strong>, <code>值越大越好</code></li></ul></li><li><p><strong>不同编码的字符长度</strong></p><ul><li><code>utf8</code> : 3字节</li><li><code>gbk</code>  : 2字节</li><li><code>latin1</code> : 1字节</li></ul></li><li><p><strong>如何计算?</strong></p><ul><li><mark>varchar</mark><ul><li><strong>varchar(10) 允许为 NULL</strong> : 10*(编码的字符长度) + 1(Null) + 2(变长字段)</li><li><strong>varchar(10) 不允许为 NULL</strong> : 10*(编码的字符长度) + 2(变长字段)</li></ul></li><li><mark>char</mark><ul><li><strong>char(10) 允许为 NULL</strong>: 10*(编码的字符长度) + 1(Null)</li><li><strong>char(10) 不允许为 NULL</strong> : 10*(编码的字符长度)</li></ul></li><li><mark>int: 4字节</mark></li><li><mark>tinyint：1字节</mark></li><li><mark>bigint：8字节</mark></li><li><mark>date：3字节</mark></li><li><mark>timestamp：4字节</mark></li><li><mark>datetime：8字节</mark></li></ul></li></ul><p><img loading="lazy" alt="image-20220801160101558" src="/assets/images/image-20220801160101558-d854b3681e85972dc6b148e146059589.png" width="2660" height="1548" class="img_CujE"></p><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-ref">输出结果-ref<a class="hash-link" href="#输出结果-ref" title="标题的直接链接">​</a></h2><p><strong>当使用索引列等值查询时,与索引列进行等值查询匹配的对象信息</strong>。比如<code>一个常数、某个列</code></p><p><img loading="lazy" alt="image-20220801161541815" src="/assets/images/image-20220801161541815-a434f0f293585b96e4b2c3e0d507e17a.png" width="2726" height="986" class="img_CujE"></p><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-rows">输出结果-rows🚧<a class="hash-link" href="#输出结果-rows" title="标题的直接链接">​</a></h2><ul><li><strong>预估需要读取并判断的记录条数</strong>,<code>值越小越好</code><ul><li><mark>注意:这里的 rows 不是返回结果集的记录数</mark></li></ul></li><li>如果查询优化器决定使用<strong>全表扫描</strong>的方式对某个表执行查询时，执行计划的rows列就代表预计需要扫描的行数</li><li>如果<strong>使用索引</strong>来执行查询时，执行计划的rows列就代表预计扫描的<strong>索引记录行数</strong> </li></ul><p><img loading="lazy" alt="image-20220801162101355" src="/assets/images/image-20220801162101355-a980c5a720f2d1e0ccac69a4c660af5b.png" width="2740" height="322" class="img_CujE"></p><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-filtered">输出结果-filtered<a class="hash-link" href="#输出结果-filtered" title="标题的直接链接">​</a></h2><ul><li><strong>某个表进过搜索条件过滤后剩余记录条数的百分比</strong>,<code>值越大越好</code><ul><li>如果使用的是索引且进行单表扫描,那么计算时需要估计出满足除使用索引外,其他搜索条件的记录数</li></ul></li><li>对于单表查询来说,这个filter 没有什么意义,我们<code>更加关注连接查询中驱动表对应的执行计划的 filtered 的值</code>,它决定了<code>被驱动表要执行的次数: rows * filtered</code></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_vXIg"><p><strong>1. 连接查询驱动表的 rows + filtered</strong></p><p>可以看到,s1是驱动表,s2 是被驱动表。s2的执行次数: 9895*10% ≈990 次</p><p><img loading="lazy" alt="image-20220801163315592" src="/assets/images/image-20220801163315592-d38f7ebdec87446ea4c1e651945f339f.png" width="2850" height="358" class="img_CujE"></p></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="输出结果-extra">输出结果-Extra🚧<a class="hash-link" href="#输出结果-extra" title="标题的直接链接">​</a></h2><ul><li><p><strong>用于说明一些额外信息的,包含不适合在其他列中显示,但是很重要的额外信息</strong>,我们可以通过这些额外信息来<code>更准确的理解 MySQL 将如何执行给定的查询语句</code></p></li><li><p><strong>常见的信息</strong></p><ul><li><p><code>No tables used</code> </p><ul><li>当查询语句中没有 FROM 子句</li></ul></li><li><p><code>Impossible WHERE</code></p><ul><li>查询语句 where 子句永远是 false</li></ul></li><li><p><code>Using where</code></p><ul><li><p>使用全表扫描来执行对某个表的查询,并且该语句的<code>WHERE</code>子句中有针对该表的检索条件时</p></li><li><p>使用索引来对某个表进行查询,并且<code>WHERE</code>子句中除了该索引,还有其他搜索条件时</p></li></ul></li><li><p><code>No matching min/max row</code></p><ul><li>当查询列表中有<code>MIN、MAX</code>聚合函数,但是没有符合<code>WHERE</code>子句中的搜索条件的记录时</li></ul></li><li><p><code>Using index</code></p><ul><li>查询列表以及搜索条件中只包含索引列</li><li>可以使用覆盖索引,不需要进行回表</li></ul></li><li><p><code>Using index condition</code></p><ul><li>有些搜索条件虽然出现了索引列,但是却没有能使用索引</li></ul></li><li><p><code>Using join buffer (Block Nested Loop)</code></p><ul><li>在连接查询的时候,当被驱动表不能有效的利用索引时,MySQL 一般会为其分配一块名为<code>join buffer</code> 的内存块来加快查询速度,即<code>基于块的嵌套循环算法</code></li></ul></li><li><p><code>Not exists</code></p><ul><li>当使用左连接时,如果<code>where</code>子句中包含要求被驱动表的某个列等于<code>NULL</code>值的搜索条件,但那个列时不允许为 NULL 的</li></ul></li><li><p><code>Zero limit</code></p><ul><li>当 LIMIT 子句的参数为<code>0</code>时,即不打算从表中读取任何记录</li></ul></li><li><p><code>Using filesort</code></p><ul><li>很多情况下,排序操作无法使用到索引,只能在内存中(记录较少是时)或者磁盘中(记录较多时)进行排序,这种需要再内存或磁盘上进行排序的就是文件排序</li></ul></li><li><p><code>Using temporary</code></p><ul><li>在很多查询的执行过程中,MySQL 需要借助临时表完成一些功能,比如去重、排序等</li><li><strong>执行计划中出现了使用临时表不是很好的体现,会有一个较高的成本</strong></li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="explain注意事项type">Explain注意事项(type)<a class="hash-link" href="#explain注意事项type" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="二级索引与回表">二级索引与回表<a class="hash-link" href="#二级索引与回表" title="标题的直接链接">​</a></h3><p>一般情况下只能利用单个二级索引执行查询，比方说下边的这个查询：</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- key1的二级索引: idx_key1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- key2的二级索引: idx_key2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> single_table </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;abc&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> key2 </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查询优化器会识别出两个查询条件:</p><ol><li>key1 = &#x27;abc&#x27;</li><li>key2 &gt; 1000;</li></ol><p>优化器一般会根据 single_table 表的统计数据来判断到底使用哪个条件到对应的二级索引中查询扫描的行数会更少, 并且选择那个扫描行数较少的条件到对应的二级索引中查询,然后将从该二级索引中查询到的结果经过回表得到完整的用户记录后再根据其余的WHERE条件过滤记录。</p><p>一般来说，等值查找比范围查找需要扫描的行数更少,所以这里假设优化器决定使用 <em>idx_key1</em> 进行查询,那么整个查询过程可以分为<strong>下面两个步骤</strong>：</p><ol><li>使用二级索引定位记录的阶段, 也就是根据条件key1 = &#x27;abc&#x27; 从 <em>idx_key1</em> 代表的B+树中找到对应的二级索引记录</li><li><strong>回表阶段</strong>, 也就是根据上一步骤中找到的记录的主键值进行回表操作(到聚簇索引中找到对应的完整的用户记录), 再根据条件key2 &gt; 1000到完整的用户记录继续过滤, 将最终符合过滤条件的记录返回给用户</li></ol><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_vXIg"><ol><li><p>因为二级索引的节点中的记录只包含索引列和主键, 所以在步骤 1 中使用 <em>idx_key1</em> 索引进行查询时只会用到与 key1 列有关的搜索条件。其余条件，比如key2 &gt; 1000这个条件在步骤 1 中是用不到的，只有在步骤 2 完成回表操作后才能继续针对完整的用户记录中继续过滤。</p></li><li><p>虽然一般情况下执行一个查询只会用到单个二级索引, 但是不过还是有特殊情况的</p></li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="索引合并">索引合并<a class="hash-link" href="#索引合并" title="标题的直接链接">​</a></h3><p>一般来说,MySQL 在执行一次 SQL 查询的时候<strong>只会用到一个二级索引</strong>, 但是存在特殊情况:<strong>可以在一个 SQL 查询中使用多个二级索引</strong>, 也就是<strong>索引合并(index merget)</strong></p><p>具体的索引合并算法有下边三种:</p><p>1.<a href="/docs/Mysql/高级特性/Explain#%E4%BA%A4%E9%9B%86%E5%90%88%E5%B9%B6">交集合并(Intersection Merge)</a></p><p>2.并集合并(Union Merge)</p><p>3.Sort-Union Merge</p><h4 class="anchor anchorWithStickyNavbar_loeA" id="交集合并">交集合并<a class="hash-link" href="#交集合并" title="标题的直接链接">​</a></h4><blockquote><p><strong>某个查询可以使用多个二级索引，将从多个二级索引中查询到的结果取交集</strong></p></blockquote><p><strong>InnoDB 只会在某些特定场景使用索引交集合并</strong></p><ul><li><p><code>二级索引列是等值匹配。对于联合索引来说,在联合索引中的每个列都必须等值匹配,不能出现只匹配部分列的情况</code></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>案例</div><div class="admonitionContent_vXIg"><p>  <strong>1.下面的示例就可以使用 <em>idx_key1</em> 和 <em>idx_key_part</em> 这两个二级索引进行索引交集合并</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- idx_key1 是普通的二级索引,idx_key_part 是联合索引(key_part1、key_part2、key_part3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> s1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">where</span><span class="token plain"> key1</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">and</span><span class="token plain"> key_part1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> key_part2 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;b&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> key_part3 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;c&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  <strong>2.但是下面的查询就不能使用索引交集合并了</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 二级索引必须是等值匹配</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> s1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">where</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">and</span><span class="token plain"> key_part1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> key_part2 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;b&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> key_part3 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;c&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 存在联合索引,索引列需要全部存在,且等值匹配</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> s1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">where</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">and</span><span class="token plain"> key_part1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> key_part3 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;c&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  <strong>为什么二级索引需要是等值匹配呢?</strong></p><ol><li>二级索引的用户记录是由<code>索引列+主键值</code>组成的,根据<a href="/docs/Mysql/高级特性/索引#2%E7%9B%AE%E5%BD%95%E9%A1%B9%E8%AE%B0%E5%BD%95%E7%9A%84%E5%94%AF%E4%B8%80%E6%80%A7">二级索引的排序规则</a>我们知道</li></ol></div></div></li></ul><ul><li></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>示例说明</div><div class="admonitionContent_vXIg"><p>假设我们有下面的 SQL 语句:</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  key1 =&gt; idx_key1</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  key3 =&gt; idx_key3</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> s1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> key1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> key3 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;b&#x27;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><br><p>假设这条 SQL 查询语句使用交集合并的话,那这个过程就是这样的：</p><ol><li><p>从 <em>idx_key1</em> 中找到 <em>key1 = &#x27;a&#x27;</em> 的相关记录</p></li><li><p>从 <em>idx_key3</em> 中找到 <em>key3 = &#x27;b&#x27;</em> 的相关记录</p></li><li><p>二级索引的记录都是由索引列 + 主键构成的, 所以可以计算出上面两个结果集中id值的交集</p></li><li><p>按上一步生成的<strong>主键值列表</strong>进行回表操作, 也就是从聚簇索引中把指定主键值的完整用户记录取出来</p></li></ol><br><p><strong>问题: 为什么不使用某个索引得到的主键值进行回表得到数据后,再用另一个查询条件进行过滤呢?这样可以少读取一个索引呀?</strong></p><p>我们分析一下:</p><ol><li><p>只读取一个二级索引的成本:</p><ul><li>按照某个搜索条件读取一个二级索引</li><li>根据从该二级索引得到的主键值进行回表操作，然后再过滤其他的搜索条件</li></ul></li><li><p>读取多个二级索引之后取交集成本:</p><ul><li>按照不同的搜索条件分别读取不同的二级索引</li><li>将从多个二级索引得到的主键值取交集，然后进行回表操作</li></ul></li></ol><p>可以看到,虽然读取多个二级索引比读取一个二级索引消耗性能,但是请注意:<strong>读取索引是顺序 IO, 回表是随机 IO</strong>, 所以:如果只使用一个二级索引的话,那么需要回表的数量就特别多。而使用多个二级索引然后取主键值的交集的话,那么需要回表的数量相对就较少(降低了由于<code>回表随机IO</code>造成的性能损耗)</p></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="小结">小结<a class="hash-link" href="#小结" title="标题的直接链接">​</a></h2><ul><li><strong>EXPLAIN不考虑各种Cache</strong></li><li><strong>EXPLAIN不能显示MySQL在执行查询时所作的优化工作</strong></li><li><strong>EXPLAIN不会告诉你关于触发器、存储过程的信息或用户自定义函数对查询的影响情况</strong></li><li><strong>部分统计信息是估算的，并非精确值</strong></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="explain-拓展">Explain 拓展<a class="hash-link" href="#explain-拓展" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="其他输出方式">其他输出方式<a class="hash-link" href="#其他输出方式" title="标题的直接链接">​</a></h3><blockquote><p>Explain 提供了多种的输出格式,主要有以下的3种:</p><ol><li><strong>传统格式</strong><ul><li>这种方式就是上面使用的</li></ul></li><li><strong>JSON 格式</strong><ul><li><code>EXPLAIN FORMAT=JSON SQL语句</code></li></ul></li><li><strong>Tree 格式</strong><ul><li><code>EXPLAIN FORMAT=tree SQL语句</code></li></ul></li></ol></blockquote><h4 class="anchor anchorWithStickyNavbar_loeA" id="json-格式">JSON 格式<a class="hash-link" href="#json-格式" title="标题的直接链接">​</a></h4><ul><li>传统的Explain输出中缺少了了一个衡量执行计划好坏的重要属性:<code>成本</code>,而 JSON 格式是四种输出格式里面<code>信息最详细的格式</code>,其中就包含了<code>执行成本信息</code></li><li><strong>返回 JSON 部分属性说明</strong><ul><li><strong>cost_info#query_cost</strong>: <ul><li>查询成本</li><li>也可以通过 <em>show status like ‘last_query_cost’</em> 取得</li></ul></li><li><strong>nested_loop#table#cost_info</strong> :花费成本(最外层节点)<ul><li><strong>read_cost</strong><ul><li>由下面两部分组成<ul><li>IO 成本</li><li>检测 <code>rows × (1 - filter)</code> 条记录的 <code>CPU</code> 成本</li></ul></li></ul></li><li><strong>eval_cost</strong><ul><li>检测 <code>rows × filter</code> 条记录的成本。</li></ul></li><li><strong>prefix_cost</strong><ul><li><code>read_cost + eval_cost</code></li></ul></li><li><strong>data_read_per_join</strong><ul><li>在此次查询中需要读取的数据量</li></ul></li></ul></li></ul></li></ul><p><strong>Explain 传统输出列 与 JSON格式属性的对应关系</strong></p><table><thead><tr><th align="center">传统输出列</th><th align="center">对应 JSON 属性</th></tr></thead><tbody><tr><td align="center"><code>id</code></td><td align="center"><code>select_id</code></td></tr><tr><td align="center"><code>select_type</code></td><td align="center">❌</td></tr><tr><td align="center"><code>table</code></td><td align="center"><code>table_name</code></td></tr><tr><td align="center"><code>partitions</code></td><td align="center"><code>partitions</code></td></tr><tr><td align="center"><code>type</code></td><td align="center"><code>access_type</code></td></tr><tr><td align="center"><code>possible_keys</code></td><td align="center"><code>possible_keys</code></td></tr><tr><td align="center"><code>key</code></td><td align="center"><code>key</code></td></tr><tr><td align="center"><code>key_len</code></td><td align="center"><code>key_length</code></td></tr><tr><td align="center"><code>ref</code></td><td align="center"><code>ref</code></td></tr><tr><td align="center"><code>rows</code></td><td align="center"><code>rows</code></td></tr><tr><td align="center"><code>filtered</code></td><td align="center"><code>filtered</code></td></tr><tr><td align="center"><code>Extra</code></td><td align="center">❌</td></tr></tbody></table><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>示例</div><div class="admonitionContent_vXIg"><p><strong>1.explain分析查询语句</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">Explain</span><span class="token plain"> format</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">JSON </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> s1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">inner</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">join</span><span class="token plain"> s2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token plain"> s1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key1</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">s2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">key2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">where</span><span class="token plain"> s1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">common_field</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;a&#x27;</span><span class="token plain">\G</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.返回的 JSON 数据</strong></p><div class="language-json codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-json codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;query_block&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;select_id&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;cost_info&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;query_cost&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;1360.07&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;nested_loop&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;table&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;table_name&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;s1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;access_type&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;ALL&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;possible_keys&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;idx_key1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;rows_examined_per_scan&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">9895</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;rows_produced_per_join&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">989</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;filtered&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;10.00&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;cost_info&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;read_cost&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;914.80&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;eval_cost&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;98.95&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;prefix_cost&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;1013.75&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;data_read_per_join&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;1M&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;used_columns&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;attached_condition&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;((`atguigu1`.`s1`.`common_field` = &#x27;a&#x27;) and (`atguigu1`.`s1`.`key1` is not null))&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;table&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;table_name&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;s2&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;access_type&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;eq_ref&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;possible_keys&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;idx_key2&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;key&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;idx_key2&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;used_key_parts&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;key2&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;key_length&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;5&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;ref&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;atguigu1.s1.key1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;rows_examined_per_scan&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;rows_produced_per_join&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">989</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;filtered&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;100.00&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;index_condition&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;(cast(`atguigu1`.`s1`.`key1` as double) = cast(`atguigu1`.`s2`.`key2` as double))&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;cost_info&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;read_cost&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;247.38&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;eval_cost&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;98.95&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;prefix_cost&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;1360.08&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;data_read_per_join&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;1M&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;used_columns&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">...</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="tree-格式">TREE 格式<a class="hash-link" href="#tree-格式" title="标题的直接链接">​</a></h4><p>TREE格式是<strong>8.0.16</strong>版本之后引入的新格式，主要根据查询的 <code>各个部分之间的关系</code> 和 <code>各部分的执行顺序</code> 来描述如何查询</p><p><img loading="lazy" alt="image-20220801233243927" src="/assets/images/image-20220801233243927-fa19829a4d1d99a5e42012cf54f95aa1.png" width="3972" height="586" class="img_CujE"></p><h2 class="anchor anchorWithStickyNavbar_loeA" id="show-warnings">SHOW WARNINGS<a class="hash-link" href="#show-warnings" title="标题的直接链接">​</a></h2><p>在我们使用 explain 查看某个查询的执行计划后,可以紧接着使用<code>SHOW WARNINGS</code>查看和这个执行计划有关的拓展信息</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_vXIg"><p>有两个警告信息:</p><ol><li>无法使用表s1 的索引 key1</li><li>原本的子查询变成了 join 连接查询,并且由于 key1 与 id 的类型不匹配,发生了隐式转换</li></ol><p><img loading="lazy" alt="image-20220801234542111" src="/assets/images/image-20220801234542111-2f4cfccb9702926752ae7528f3a8f050.png" width="4142" height="1176" class="img_CujE"></p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MagicalZhu/NoteLib/tree/main/docs/Mysql/高级特性/执行计划分析.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_N_05" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">最后<!-- -->由 <b>YuLiang Zhu</b> <!-- -->于 <b><time datetime="2022-12-06T01:19:52.000Z">2022年12月6日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Mysql/高级特性/基本分析工具"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">基本分析工具</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Mysql/高级特性/性能监控工具"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">性能监控工具</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><p class="content_nRws">Contents</p><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#基本语法" class="table-of-contents__link toc-highlight">基本语法</a></li><li><a href="#准备数据" class="table-of-contents__link toc-highlight">准备数据</a></li><li><a href="#输出结果-table" class="table-of-contents__link toc-highlight">输出结果-table</a></li><li><a href="#输出结果-id" class="table-of-contents__link toc-highlight">输出结果-id</a></li><li><a href="#输出结果-select_type" class="table-of-contents__link toc-highlight">输出结果-select_type</a><ul><li><a href="#simple" class="table-of-contents__link toc-highlight">SIMPLE</a></li><li><a href="#primaryunionunion-result" class="table-of-contents__link toc-highlight">PRIMARY、UNION、UNION RESULT</a></li><li><a href="#subquery" class="table-of-contents__link toc-highlight">SUBQUERY</a></li><li><a href="#dependent-subquery" class="table-of-contents__link toc-highlight">DEPENDENT SUBQUERY</a></li><li><a href="#dependent-union" class="table-of-contents__link toc-highlight">DEPENDENT UNION</a></li><li><a href="#derived" class="table-of-contents__link toc-highlight">DERIVED</a></li><li><a href="#materialized" class="table-of-contents__link toc-highlight">MATERIALIZED</a></li></ul></li><li><a href="#输出结果-分区partitions" class="table-of-contents__link toc-highlight">输出结果-分区(partitions)</a></li><li><a href="#输出结果-访问方法type" class="table-of-contents__link toc-highlight">输出结果-访问方法(type)🚧</a><ul><li><a href="#system" class="table-of-contents__link toc-highlight">system</a></li><li><a href="#const" class="table-of-contents__link toc-highlight">const</a></li><li><a href="#eq_ref" class="table-of-contents__link toc-highlight">eq_ref</a></li><li><a href="#ref" class="table-of-contents__link toc-highlight">ref</a></li><li><a href="#ref_or_null" class="table-of-contents__link toc-highlight">ref_or_null</a></li><li><a href="#index_merge" class="table-of-contents__link toc-highlight">index_merge</a></li><li><a href="#unique_subquery" class="table-of-contents__link toc-highlight">unique_subquery</a></li><li><a href="#index_subquery" class="table-of-contents__link toc-highlight">index_subquery</a></li><li><a href="#range" class="table-of-contents__link toc-highlight">range</a></li><li><a href="#index" class="table-of-contents__link toc-highlight">index</a></li><li><a href="#all" class="table-of-contents__link toc-highlight">all</a></li></ul></li><li><a href="#输出结果-possible_keykey" class="table-of-contents__link toc-highlight">输出结果-possible_key&amp;key</a></li><li><a href="#输出结果-key_len-" class="table-of-contents__link toc-highlight">输出结果-key_len 🚧</a></li><li><a href="#输出结果-ref" class="table-of-contents__link toc-highlight">输出结果-ref</a></li><li><a href="#输出结果-rows" class="table-of-contents__link toc-highlight">输出结果-rows🚧</a></li><li><a href="#输出结果-filtered" class="table-of-contents__link toc-highlight">输出结果-filtered</a></li><li><a href="#输出结果-extra" class="table-of-contents__link toc-highlight">输出结果-Extra🚧</a></li><li><a href="#explain注意事项type" class="table-of-contents__link toc-highlight">Explain注意事项(type)</a><ul><li><a href="#二级索引与回表" class="table-of-contents__link toc-highlight">二级索引与回表</a></li><li><a href="#索引合并" class="table-of-contents__link toc-highlight">索引合并</a><ul><li><a href="#交集合并" class="table-of-contents__link toc-highlight">交集合并</a></li></ul></li></ul></li><li><a href="#小结" class="table-of-contents__link toc-highlight">小结</a></li><li><a href="#explain-拓展" class="table-of-contents__link toc-highlight">Explain 拓展</a><ul><li><a href="#其他输出方式" class="table-of-contents__link toc-highlight">其他输出方式</a><ul><li><a href="#json-格式" class="table-of-contents__link toc-highlight">JSON 格式</a></li><li><a href="#tree-格式" class="table-of-contents__link toc-highlight">TREE 格式</a></li></ul></li></ul></li><li><a href="#show-warnings" class="table-of-contents__link toc-highlight">SHOW WARNINGS</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">前端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://v3.cn.vuejs.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">React<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://ts.xcatliu.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TypeScript<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://developer.mozilla.org/zh-CN/docs/Web" target="_blank" rel="noopener noreferrer" class="footer__link-item">MDN<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">后端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spring<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">JVM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.infoq.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">InfoQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">文档构建</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://typoraio.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Typora<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 huakucha. Built With Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf86732a.js"></script>
<script src="/assets/js/main.98457ee6.js"></script>
</body>
</html>