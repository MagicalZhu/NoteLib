<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Mysql/高级特性/设计索引">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">设计索引 | 花裤衩Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" name="twitter:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" property="og:url" content="https://huakucha.com/docs/Mysql/高级特性/设计索引"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="设计索引 | 花裤衩Wiki"><meta data-rh="true" name="description" content="使用索引"><meta data-rh="true" property="og:description" content="使用索引"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huakucha.com/docs/Mysql/高级特性/设计索引"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/Mysql/高级特性/设计索引" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/Mysql/高级特性/设计索引" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QZ9YPBGUYT-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="花裤衩Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="花裤衩Wiki Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="花裤衩Wiki JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="花裤衩Wiki" href="/opensearch.xml">

<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.font.im/css?family=Raleway:500,700&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.864d50a7.css">
<link rel="preload" href="/assets/js/runtime~main.bf86732a.js" as="script">
<link rel="preload" href="/assets/js/main.98457ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_D8pK">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="content_zf74 announcementBarContent_dpRF">🌟欢迎来到花裤衩的博客🌟</div><button type="button" aria-label="关闭" class="clean-btn close closeButton_ZdWa announcementBarClose_iXyO"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--light_PnYV"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--dark_eYgw"></div><b class="navbar__title text--truncate">花裤衩</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">基础知识🤖</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/currency">并发编程</a></li><li><a class="dropdown__link" href="/docs/networrk-basic">计算机网络</a></li><li><a class="dropdown__link" href="/docs/linuxCommand">Linux</a></li><li><a class="dropdown__link" href="/docs/dataStructure">数据结构与算法</a></li><li><a class="dropdown__link" href="/docs/leetCode">LeetCode</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/mysql">MySQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">后端框架👨‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/spring">Spring</a></li><li><a class="dropdown__link" href="/docs/springCloud">SpringCloud</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">方法论🚧</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/distribute/protol">分布式理论</a></li><li><a class="dropdown__link" href="/docs/distribute/basicTech">分布式技术点</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">中间件🚀</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/middleware/basicMiddleware">基础中间件</a></li><li><a class="dropdown__link" href="/docs/middleware/job">定时任务</a></li><li><a class="dropdown__link" href="/docs/middleware/cache">缓存</a></li><li><a class="dropdown__link" href="/docs/middleware/searchEngine">搜索引擎</a></li><li><a class="dropdown__link" href="/docs/middleware/messageQueue">消息队列</a></li><li><a class="dropdown__link" href="/docs/middleware/database">数据库</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">底层⛽️</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/JVM">JVM</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">前端技术👩‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/front/Vue">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其他工具👹</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Gradle">Gradle</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">物料中心👏</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/website/BE">后端产品</a></li><li><a class="dropdown__link" href="/website/COM">其他产品</a></li><li><a class="dropdown__link" href="/website/FE">前端产品</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.huakucha.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">关于<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/MagicalZhu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_MW0i colorModeToggle_x44X"><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SFTY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ekgs"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_H2mL"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_W2AM"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_ntye" type="button"></button><div class="docPage_qMb8"><aside class="theme-doc-sidebar-container docSidebarContainer_rpaz"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mysql">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/mysql基础与高级">MySQL基础与高级</a><button aria-label="打开/收起侧边栏菜单「MySQL基础与高级」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/基础知识">基础知识</a><button aria-label="打开/收起侧边栏菜单「基础知识」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/数据库管理">数据库管理</a><button aria-label="打开/收起侧边栏菜单「数据库管理」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/架构与引擎">架构与引擎</a><button aria-label="打开/收起侧边栏菜单「架构与引擎」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/存储结构与索引">存储结构与索引</a><button aria-label="打开/收起侧边栏菜单「存储结构与索引」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/索引">索引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/索引的应用">索引的应用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Mysql/高级特性/设计索引">设计索引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/InnoDB数据页结构">InnoDB数据页结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/InnoDB表空间">InnoDB表空间</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/性能优化">性能优化</a><button aria-label="打开/收起侧边栏菜单「性能优化」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/事务与锁">事务与锁</a><button aria-label="打开/收起侧边栏菜单「事务与锁」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/运维">运维</a><button aria-label="打开/收起侧边栏菜单「运维」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Mysql/MySQL参数与命令">MySQL参数与命令</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_JQG6"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Iseg"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SLhD"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/mysql基础与高级"><span itemprop="name">MySQL基础与高级</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/存储结构与索引"><span itemprop="name">存储结构与索引</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">设计索引</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_IbkY theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_p7nN">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>设计索引</h1></header><h2 class="anchor anchorWithStickyNavbar_loeA" id="使用索引">使用索引<a class="hash-link" href="#使用索引" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="索引的分类">索引的分类<a class="hash-link" href="#索引的分类" title="标题的直接链接">​</a></h3><p>MySQL的索引包括 <strong>普通索引、唯一性索引、全文索引、单列索引、多列索引</strong>等</p><ol><li><p>从 <strong>功能逻辑</strong>上划分</p><ul><li><p><code>普通索引</code></p><ul><li><p>在创建索引时,不附加任何限制条件,只是用于提高查询效率,这类索引可以创建在<code>任何数据类型</code>中,<strong>其值是否唯一和非空,要由字段本身的完整性约束条件决定</strong></p></li><li><p>建立索引后可以通过索引进行查询</p></li><li><p>比如在表 student 的字段 name 上建立一个普通索引,查询记录的时候就可以根据该索引进行查询</p></li></ul></li><li><p><code>唯一索引</code></p><ul><li>使用<code>UNIQUE</code>参数可以设置索引为唯一索引,在创建唯一索引时,限制该索引的值必须是唯一的,但是允许有空值</li><li>在一张表中<code>可以有多个唯一索引</code></li><li>比如在表 student 的字段 email 中创建唯一索引,那么字段 email 的值就必须是唯一的。</li></ul></li><li><p><code>主键索引</code></p><ul><li>主键索引就是一种<code>特殊的唯一索引</code>,在唯一索引的基础上加上了<strong>不为空</strong>的约束,也就是 <em>NOT NULL + UNIQUE</em></li><li>在一张表中<code>最多只能有一个主键索引</code></li></ul></li><li><p><code>全文索引</code> </p><ul><li>是目前搜索引擎使用的关键技术,可以充分的利用<code>分词技术</code>等多种算法智能分析出文本文字中关键词的频率和重要性,然后按照一定的算法规则筛选出需要的搜索结果<ul><li>全文索引很适合大型数据集。对于小的数据集,用处较小</li></ul></li><li>使用参数<code>FULLTEXT</code> 可以设置为全文索引</li></ul></li></ul></li><li><p>从<strong>物理实现方式</strong>上划分</p><ul><li><code>聚簇索引</code></li><li><code>非聚簇索引</code></li></ul></li><li><p>从<strong>作用字段个数</strong>上划分</p><ul><li><code>单列索引</code><ul><li><strong>在表中的单个字段上创建索引,单列索引只根据该字段进行索引</strong></li><li>单列索引可以是普通索引,也可以是唯一索引,还可以是全文索引,<strong>只要保证该索引只对应一个字段即可</strong></li><li>在一张表中<code>可以有多个单列索引</code></li></ul></li><li><code>多列(组合、联合)索引</code><ul><li>多列索引是表的<code>多个字段组合</code>上创建一个索引,该索引指向多个字段,<strong>可以通过这几个字段进行查询</strong>, <code>只有查询条件中使用了这些索引字段的第一个字段才会被使用</code><ul><li>比如:表中的字段 id、name 和 gender 上建立一个 联合索引<em>idx_id_name_gender</em>, 那么只有<strong>查询条件</strong>中使用了字段 id 时,该索引才会被使用</li></ul></li><li>使用组合索引时遵循<code>最左前缀集合</code></li></ul></li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="查看索引">查看索引<a class="hash-link" href="#查看索引" title="标题的直接链接">​</a></h3><ul><li><p><strong>语法格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SHOW</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> 表名</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="删除索引">删除索引<a class="hash-link" href="#删除索引" title="标题的直接链接">​</a></h3><ul><li><p><strong>ALTER TABLE的方式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 非主键索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:rgb(12, 150, 155)">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> 索引名</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 主键索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:rgb(12, 150, 155)">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>DROP INDEX的方式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> 索引名 </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> 表名</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>说明</div><div class="admonitionContent_vXIg"><ol><li><p>删除表中的列时,如果要删除的列为索引的组成部分,则该列也会从索引中删除。<strong>如果组成 索引的所有列都被删除，则整个索引将被删除</strong></p></li><li><p><strong>添加了 AUTO_INCREMENT 约束字段的唯一索引不能被删除</strong></p></li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="创建索引">创建索引<a class="hash-link" href="#创建索引" title="标题的直接链接">​</a></h3><blockquote><p>MySQL 支持多种方法在单个或者多个列上建立索引:</p><ol><li><strong>在创建表的 create table 中指定索引列</strong></li><li><strong>使用 alter table 语句在已经存在的表上建立索引</strong></li><li><strong>使用 create index 语句在已经存在的表上建立索引</strong></li></ol></blockquote><h4 class="anchor anchorWithStickyNavbar_loeA" id="创建表时">创建表时<a class="hash-link" href="#创建表时" title="标题的直接链接">​</a></h4><p>使用 Create Table 创建表时,除了可以指定列的数据类型,还可以定义主键约束、外键约束或者唯一约束,不论指定哪种约束,<code>定义约束时相当于给指定列上建立了一个索引</code></p><p><strong>当然,也可以在创建表的时候,显式的建立索引,格式如下:</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> 表名 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    字段列表</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> FULLTEXT </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> SPATIAL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">indexName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">col_name </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">ASC</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DESC</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">INVISIBLE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><code>[UNIQUE | FULLTEXT | SPATIAL]</code> <ul><li><strong>可选参数</strong></li><li>分别表示主键索引、唯一索引、全文索引和空间索引</li></ul></li><li><code>INDEX | KEY</code><ul><li>两者的作用相同，用来指定创建索引</li></ul></li><li><code>[indexName]</code><ul><li>指定索引的名称，为可选参数。如果不指定，那么 MySQL 默认 col_name 为索引名</li></ul></li><li><code>col_name</code><ul><li>为需要创建索引的字段列，该列必须从数据表中定义的多个列中选择</li></ul></li><li><code>[length]</code><ul><li><strong>可选参数</strong></li><li>表示索引的长度，只有字符串类型的字段才能指定索引长度(<code>前缀索引</code>)</li></ul></li><li><code>[ASC | DESC]</code><ul><li><strong>可选参数</strong></li><li>指定升序或者降序的索引值存储</li></ul></li><li><code>[INVISIBLE]</code><ul><li><strong>可选参数</strong></li><li>MySQL 8.0中支持,设置索引为隐藏索引</li></ul></li></ol><h5 class="anchor anchorWithStickyNavbar_loeA" id="基于表约束">基于表约束<a class="hash-link" href="#基于表约束" title="标题的直接链接">​</a></h5><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> dept</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    dept_id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 主键约束 =&gt; 主键索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    dept_name </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    emp_id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 主键约束 =&gt; 主键索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    emp_name </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 唯一约束 =&gt; 唯一索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    dept_id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">CONSTRAINT</span><span class="token plain"> emp_dept_id_fk </span><span class="token keyword" style="color:rgb(12, 150, 155)">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">dept_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">REFERENCES</span><span class="token plain"> dept</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">dept_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 外键约束 =&gt; 外键索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20220716231528415" src="/assets/images/image-20220716231528415-c6fbbe34d30b677f2d71d499d252d1a8.png" width="3602" height="1068" class="img_CujE"></p><h5 class="anchor anchorWithStickyNavbar_loeA" id="显式创建">显式创建<a class="hash-link" href="#显式创建" title="标题的直接链接">​</a></h5><p><strong>1.普通索引</strong></p><p>即 index 前未指定索引类型的可选参数</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 在book表中的year_publication字段上建立普通索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 字段信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    book_id         </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  book_name     </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  authors       </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  info              </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">comment</span><span class="token plain">           </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  year_publication </span><span class="token keyword" style="color:rgb(12, 150, 155)">YEAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 索引信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">year_publication</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2. 唯一索引</strong></p><p>即 index 前指定索引类型的可选参数 unique, <strong>且唯一索引和唯一约束一样,索引中不允许有重复的记录,即不允许插入重复的数据</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 在book2表中的book_id字段上建立唯一索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 字段信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    book_id         </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  book_name     </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  authors       </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  info              </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">comment</span><span class="token plain">           </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  year_publication </span><span class="token keyword" style="color:rgb(12, 150, 155)">YEAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 索引信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">book_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20220716234039766" src="/assets/images/image-20220716234039766-8b1600deb19d5b755e401af1684478f6.png" width="3672" height="748" class="img_CujE"></p><p><strong>3.主键索引</strong></p><ul><li>和其他索引不同的是, <strong>主键索引只能通过主键约束(Primary Key)去创建</strong></li><li><strong>修改主键索引:</strong> <code>必须先删除掉(drop)原索引，再新建(add)索引</code></li></ul><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 在book3表中的book_id字段上建立主键索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book3 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 字段信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    book_id         </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  book_name     </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  authors       </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  info              </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">comment</span><span class="token plain">           </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  year_publication </span><span class="token keyword" style="color:rgb(12, 150, 155)">YEAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 主键约束</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">book_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 删除主键索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book3 </span><span class="token keyword" style="color:rgb(12, 150, 155)">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 修改主键索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 1.先删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book3 </span><span class="token keyword" style="color:rgb(12, 150, 155)">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 2.再添加新的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book3 </span><span class="token keyword" style="color:rgb(12, 150, 155)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">comment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20220716235403345" src="/assets/images/image-20220716235403345-a5e8c1a2d03b70724e4dcaecd454c7d5.png" width="3648" height="572" class="img_CujE"></p><p><strong>4.组合索引</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 在book3表中的 book_name, authors 字段上建立组合索引(唯一)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book4 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 字段信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    book_id         </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  book_name     </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  authors       </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  info              </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">comment</span><span class="token plain">           </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  year_publication </span><span class="token keyword" style="color:rgb(12, 150, 155)">YEAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 组合索引信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">   </span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> book4_combine_key</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">book_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> authors</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20220717001330348" src="/assets/images/image-20220717001330348-2fef2337b1771d94451e52b44d225d7f.png" width="3596" height="638" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="已有表">已有表<a class="hash-link" href="#已有表" title="标题的直接链接">​</a></h4><p>对于已经存在的表,需要创建、添加索引的,有下面两种方式:</p><ol><li><p>使用<code>ALTER TABLE ... ADD...</code> 创建索引</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 基本语法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:rgb(12, 150, 155)">ADD</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> FULLTEXT </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> SPATIAL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">indexName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">col_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">ASC</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DESC</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">INVISIBLE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>使用<code>CREATE INDEX</code> 创建索引</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 基本语法,在MySQL中， CREATE INDEX被映射到一个ALTER TABLE语句上</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> FULLTEXT </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> SPATIAL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">indexName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> 表名 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">col_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">ASC</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DESC</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">INVISIBLE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>示例</div><div class="admonitionContent_vXIg"><p><strong>1.先创建表</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book5 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    book_id         </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    book_name       </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    authors         </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    info            </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">comment</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    year_publication </span><span class="token keyword" style="color:rgb(12, 150, 155)">YEAR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.此时表中是没有索引的,使用 alter table 的方式新加一个索引</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> book5 </span><span class="token keyword" style="color:rgb(12, 150, 155)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_book_id </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">book_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20220717101923098" src="/assets/images/image-20220717101923098-297fd036e24a2f69f59adc6b6f34d571.png" width="3638" height="700" class="img_CujE"></p><p><strong>3.使用 create index 的方式再创建一个索引</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_name_author </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> book5 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">book_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">authors</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20220717102136100" src="/assets/images/image-20220717102136100-2a737a922817fdba001da7a3947998f2.png" width="3622" height="568" class="img_CujE"></p></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="索引新特性">索引新特性<a class="hash-link" href="#索引新特性" title="标题的直接链接">​</a></h2><p>MySQL 8.0 索引支持下面几个新特性:</p><ol><li><strong>支持降序索引</strong></li><li><strong>支持隐藏索引</strong></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="降序索引innodb">降序索引(InnoDB)<a class="hash-link" href="#降序索引innodb" title="标题的直接链接">​</a></h3><blockquote><p>降序索引是以<strong>降序</strong>的方式存储键值,MySQL8.0之前创建的是升序索引,使用时进行<strong>反向扫描</strong>,降低了数据库的效率。</p><p>在某些场景下,降序索引很有意义,比如某个查询就是需要对某个字段进行降序,索引一般都是升序的,<strong>数据库就需要使用额外的文件排序操作</strong>,而使用降序索引可以避免这个问题</p></blockquote><p>我们在 MySQL5.7 和 MySQL8.0 中同样的创建一个降序索引:</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> ts1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  a </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  b </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">index</span><span class="token plain"> idx_a_b</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">b </span><span class="token keyword" style="color:rgb(12, 150, 155)">desc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后看下在 MySQL8.0 该表的索引信息,可以看到字段 b 的排序规则 collation的值为 <strong>D</strong>(desc)</p><p><img loading="lazy" alt="image-20220717124912930" src="/assets/images/image-20220717124912930-a30d9d2e4cf8d8313ba1ab26c4de83cb.png" width="3612" height="694" class="img_CujE"></p><p>再看下 MySQL5.7 下面的该表的索引信息,可以看到虽然为组合索引中字段 b 排序规则设置为 desc,但实际依然是 asc</p><p><img loading="lazy" alt="image-20220717130353662" src="/assets/images/image-20220717130353662-c6ed2dcced10118345e11b5b453051e0.png" width="3160" height="826" class="img_CujE"></p><p>我们写一段存储过程去生成测试数据:</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PROCEDURE</span><span class="token plain"> ts_insert</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHILE</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">into</span><span class="token plain"> ts1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">select</span><span class="token plain"> rand</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">80000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">rand</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">80000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHILE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">commit</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 执行存储过程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">call</span><span class="token plain"> ts_insert</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>MySQL5.7中查看执行计划</strong></p><p>可以看到计划扫描的数量(<code>rows</code>) 为 799,并且使用了<code>Using filesort</code>, 也就是文件排序。</p><p><strong>Using filesort 是一种速度比较慢的外部排序,可以通过优化索引来尽量避免出现Using filesort</strong></p><p><img loading="lazy" alt="image-20220717131110758" src="/assets/images/image-20220717131110758-3e107573f3285a6f4e990fd0452c6983.png" width="3080" height="704" class="img_CujE"></p><p><strong>MySQL8.0中查看执行计划</strong></p><p>可以看到计划扫描的数量(<code>rows</code>) 为 5,并且也没有出现 <strong>using filesort</strong></p><p><img loading="lazy" alt="image-20220717131459479" src="/assets/images/image-20220717131459479-adae154deae382d63eb9ea0b72f71d49.png" width="2762" height="716" class="img_CujE"></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>问题</div><div class="admonitionContent_vXIg"><p><strong>如果我们对所有的字段都进行降序查询呢?</strong></p><p><strong>MySQL5.7中查看执行计划</strong></p><p>可以看到计划扫描的数量(<code>rows</code>) 为 5,并且乜有出现 <strong>using filesort</strong></p><p><img loading="lazy" alt="image-20220717132059596" src="/assets/images/image-20220717132059596-359892fcd14165a71b4a11a4ab23a064.png" width="2722" height="340" class="img_CujE"></p><p><strong>MySQL8.0中查看执行计划</strong></p><p>可以看到计划扫描的数量(<code>rows</code>) 为 799,并且使用了<code>Using filesort</code></p><p><img loading="lazy" alt="image-20220717132134558" src="/assets/images/image-20220717132134558-acc0ab006d1d2ff67587747b6a2e3fab.png" width="3070" height="354" class="img_CujE"></p><p><strong>我们可以看到,MySQL 5.7的执行计划要明显好于MySQL 8.0</strong></p></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="隐藏索引">隐藏索引<a class="hash-link" href="#隐藏索引" title="标题的直接链接">​</a></h3><blockquote><p>在 MySQL5.7 及之前的版本中,只能通过显式的方式删除索引。如果删除后需要重新创建的话就需要通过显式创建索引的方式将删除的索引创建回来,如果表数据很多,那么这个操作就会消耗系统过多的资源，操作成本非常高。</p><p>从 MySQL 8.x 开始支持<code>隐藏索引(invisible indexes)</code>。 <strong>只需要将待删除的索引设置为隐藏索引，使查询优化器不再使用这个索引</strong>,即使使用<strong>force index</strong>(强制使用索引)，优化器也不会使用该索引。确认将索引设置为隐藏索引后系统不受任何响应，就可以彻底删除索引。</p><p>这种<code>先将索引设置为隐藏索引,再删除索引的方式就是软删除</code></p></blockquote><h4 class="anchor anchorWithStickyNavbar_loeA" id="创建隐藏索引">创建隐藏索引<a class="hash-link" href="#创建隐藏索引" title="标题的直接链接">​</a></h4><ol><li><p><strong>创建表时直接创建</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> tablename </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    字段列表</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> FULLTEXT </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> SPATIAL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">index_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">索引字段 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">ASC</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DESC</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> INVISIBLE</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>通过CREATE INDEX语句创建</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> FULLTEXT </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> SPATIAL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> index_name </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> tablename </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">索引字段 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">ASC</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DESC</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> INVISIBLE</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>通过ALTER TABLE语句创建</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> tablename </span><span class="token keyword" style="color:rgb(12, 150, 155)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> FULLTEXT </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> SPATIAL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> index_name </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">索引字段 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">ASC</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DESC</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> INVISIBLE</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>切换索引可见状态</code></p><ul><li>已存在的索引可通过如下语句切换可见状态:</li></ul><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 切换成隐藏索引 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> tablename </span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> index_name INVISIBLE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 切换成非隐藏索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> tablename </span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> index_name VISIBLE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_vXIg"><p>当索引被隐藏时，它的内容仍然是和正常索引一样实时更新的。如果一个索引需要长期被隐藏，那么可以将其删除，因为索引的存在会影响插入、更新和删除的性能。</p></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="对优化器可见">对优化器可见<a class="hash-link" href="#对优化器可见" title="标题的直接链接">​</a></h4><blockquote><p>我们可能会对某个索引进行测试,查看这个有这个索引与没有这个索引前后的性能,那么就可以利用这个特性,控制某个查询中开启隐藏索引对优化器可见或者不可见来进行测试</p></blockquote><ul><li><strong>参数设置</strong><ul><li><strong><code>use_invisible_indexes</code></strong><ul><li><strong>查询优化器的参数, 可以控制隐藏索引对查询优化器是否可见</strong></li><li>默认值为<code>off</code></li><li>如果设置为<code>on</code>, 即使隐藏索引不可见，优化器在生成执行计划时仍会考虑使用隐藏索引</li></ul></li><li><code>select @@optimizer_switch \G</code><ul><li>查看查询优化器的开关设置</li></ul></li></ul></li><li><strong>注意</strong><ul><li><strong>主键以及具有非空唯一约束的字段,都不能被设置为隐藏索引</strong></li></ul></li></ul><p><strong>1. 首先查看查询优化器的开关参数设置</strong></p><p>默认 <code>use_invisible_indexes=off</code></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">mysql</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#查看查询优化器的开关设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">mysql</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">select</span><span class="token plain"> @</span><span class="token variable" style="color:rgb(201, 103, 101)">@optimizer_switch</span><span class="token plain"> \G</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1.</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">row</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">@</span><span class="token variable" style="color:rgb(201, 103, 101)">@optimizer_switch</span><span class="token plain">: index_merge</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">index_merge_union</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">index_merge_sort_union</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">index_merge_intersection</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">engine_condition_pushdown</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">index_condition_pushdown</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">mrr</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">mrr_cost_based</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">block_nested_loop</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">batched_key_access</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">off</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">materialization</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">semijoin</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">loosescan</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">firstmatch</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">duplicateweedout</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">subquery_materialization_cost_based</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">use_index_extensions</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">condition_fanout_filter</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">derived_merge</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">use_invisible_indexes</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">off</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">skip_scan</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">hash_join</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">subquery_to_derived</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">off</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">prefer_ordering_index</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">hypergraph_optimizer</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">off</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">derived_condition_pushdown</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.设置session级别的查询中隐藏索引对查询优化器可见</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">set</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">session</span><span class="token plain"> optimizer_switch</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;use_invisible_indexes=on&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3.再次查看查询优化器的开关设置</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">mysql</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">select</span><span class="token plain"> @</span><span class="token variable" style="color:rgb(201, 103, 101)">@optimizer_switch</span><span class="token plain"> \G</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1.</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">row</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">@</span><span class="token variable" style="color:rgb(201, 103, 101)">@optimizer_switch</span><span class="token plain">: index_merge</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">index_merge_union</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">index_merge_sort_union</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">index_merge_intersection</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">engine_condition_pushdown</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">index_condition_pushdown</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">mrr</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">mrr_cost_based</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">block_nested_loop</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">batched_key_access</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">off</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">materialization</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">semijoin</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">loosescan</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">firstmatch</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">duplicateweedout</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">subquery_materialization_cost_based</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">use_index_extensions</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">condition_fanout_filter</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">derived_merge</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain">use_invisible_indexes</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">skip_scan</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">hash_join</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">subquery_to_derived</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">off</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">prefer_ordering_index</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">hypergraph_optimizer</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">off</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">derived_condition_pushdown</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">row</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0.00</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="设计原则">设计原则<a class="hash-link" href="#设计原则" title="标题的直接链接">​</a></h2><blockquote><p>为了索引的使用效率更高,在创建索引的时候,必须考虑在哪些字段上创建索引、创建什么类型的索引等等,<strong>索引设计不合理或者缺少索引都会影响数据库和系统的性能</strong></p></blockquote><p><img loading="lazy" alt="image-20220731234025487" src="/assets/images/image-20220731234025487-91315db1098928f1abd48781f321d2ac.png" width="2046" height="1094" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="准备数据">准备数据<a class="hash-link" href="#准备数据" title="标题的直接链接">​</a></h3><p><strong>1.准备表</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 学生信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> student_info </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  id  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">11</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  student_id  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain">       </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  name  </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  course_id  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain">        </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  class_id  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">11</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  create_time  </span><span class="token keyword" style="color:rgb(12, 150, 155)">DATETIME</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ENGINE</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">INNODB</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 课程表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> course </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">11</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  course_id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  course_name </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">40</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ENGINE</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">INNODB</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2. 创建函数用于生成数据</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#该函数会随机返回一个字符串</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FUNCTION</span><span class="token plain"> rand_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">n </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">RETURNS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">255</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> chars_str </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> return_str </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">255</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHILE</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain"> n </span><span class="token keyword" style="color:rgb(12, 150, 155)">DO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> return_str </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">CONCAT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">return_str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">SUBSTRING</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">chars_str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">FLOOR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain">RAND</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">52</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHILE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">RETURN</span><span class="token plain"> return_str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 随机数函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FUNCTION</span><span class="token plain"> rand_num </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">from_num </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">to_num </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">RETURNS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">11</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> FLOOR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">from_num </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain">RAND</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">to_num </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token plain"> from_num</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">RETURN</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3.问题处理</strong></p><p>在创建函数的过程中报错:  <code>This function has none of DETERMINISTIC......</code></p><ul><li><p>问题说明:</p><ul><li>由于开启过慢查询日志 bin-log, 我们就必须为function指定一个参数。</li><li>主从复制，主机会将写操作记录在bin-log日志中。从机读取bin-log日志，执行语句来同步数据。如果使用函数来操作数据，会导致从机和主键操作时间不一致。所以，<strong>默认情况下，mysql不开启创建函数设置</strong></li></ul></li><li><p>问题处理</p><ol><li><p><strong>查看mysql是否允许创建函数</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">show</span><span class="token plain"> variables </span><span class="token operator" style="color:rgb(12, 150, 155)">like</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;log_bin_trust_function_creators&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>命令开启:允许创建函数设置</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 如果不加 global 就只对当前窗口会话有效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">set</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">global</span><span class="token plain"> log_bin_trust_function_creators</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>mysqld 的参数配置</strong></p><div class="language-ini codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-ini codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># /etc/my.cnf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token section punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token section section-name selector" style="color:rgb(153, 76, 195);font-style:normal">mysqld</span><span class="token section punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key attr-name" style="color:rgb(72, 118, 214);font-style:normal">log_bin_trust_function_creators</span><span class="token punctuation" style="color:rgb(153, 76, 195)">=</span><span class="token value attr-value">1</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>创建并执行插入模拟数据的存储过程</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 存储过程1:插入课程表存储过程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PROCEDURE</span><span class="token plain"> insert_course</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"> max_num </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> autocommit </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#设置手动提交事务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">REPEAT</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">i</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#赋值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> course </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">course_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> course_name </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rand_num</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token number" style="color:rgb(170, 9, 130)">10100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">rand_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">6</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    UNTIL i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> max_num</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">REPEAT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">COMMIT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#提交事务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 存储过程2: 插入学生信息表存储过程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PROCEDURE</span><span class="token plain"> insert_stu</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"> max_num </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> autocommit </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#设置手动提交事务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">REPEAT</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">i</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#赋值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> student_info </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">course_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> class_id </span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">student_id </span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">NAME </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rand_num</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token number" style="color:rgb(170, 9, 130)">10100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">rand_num</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token number" style="color:rgb(170, 9, 130)">10200</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">rand_num</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token number" style="color:rgb(170, 9, 130)">200000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">rand_string</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">6</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        UNTIL i </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> max_num</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">REPEAT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">COMMIT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#提交事务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">END</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 调用存储过程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CALL</span><span class="token plain"> insert_course</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CALL</span><span class="token plain"> insert_stu</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1000000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="适合创建索引">适合创建索引<a class="hash-link" href="#适合创建索引" title="标题的直接链接">​</a></h3><p>下面集中情况是创建索引的合适条件:</p><ol><li><strong>字段的数值具有唯一的限制</strong></li><li><strong>频繁作为 where 查询条件的字段</strong></li><li><strong>经常 Group By、Order By 的字段</strong></li><li><strong>Update、Delete 的 where 条件列</strong></li><li><strong>Distinct 字段需要创建索引</strong></li><li><strong>多表 Join 连接操作时，创建索引注意事项</strong></li><li><strong>使用列的类型小的创建索引</strong></li><li><strong>使用字符串前缀创建索引</strong></li><li><strong>区分度高(散列性高)的列适合作为索引</strong></li><li><strong>使用最频繁的列放到联合索引的左侧</strong></li><li><strong>在多个字段都要创建索引的情况下，联合索引优于单值索引</strong></li></ol><h4 class="anchor anchorWithStickyNavbar_loeA" id="1字段数值唯一">1.字段数值唯一<a class="hash-link" href="#1字段数值唯一" title="标题的直接链接">​</a></h4><p><strong>索引本身可以起到约束的作用</strong>,比如唯一索引、主键索引都可以起到唯一约束的作用。那么我们在创建数据表的时候,<strong>如果某个字段或者组合字段是唯一的,就可以</strong><code>直接创建唯一性索引或主键索引</code>。这样子,我们可以更快的通过该索引查询到指定的数据。</p><p>比如: 学生表中的学号是具有唯一性的字段, 所以可以为该字段建立唯一索引。</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_vXIg"><p>业务上具有唯一特性的字段，即使是组合字段，也必须建成唯一索引。(来源:Alibaba) </p><p>不要以为唯一索引影响了 insert 速度，相对于查找速度来说,这个速度损耗可以忽略的。</p></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="2频繁作为where条件">2.频繁作为WHERE条件<a class="hash-link" href="#2频繁作为where条件" title="标题的直接链接">​</a></h4><p><strong>某个字段在 Select 语句的 Where 条件中经常被使用,那么就需要给这个字段创建索引</strong>,尤其在数据量大的情况下,即使创建普通索引也可以显著的提高查询的效率了。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>测试</div><div class="admonitionContent_vXIg"><p><strong>我们在 student_id 没有索引的情况下进行查询</strong> : 可以看到查询耗时 0.25s</p><p><img loading="lazy" alt="image-20220717170844690" src="/assets/images/image-20220717170844690-3f27af226ffa9d5bd9e32d7ef5089add.png" width="1746" height="432" class="img_CujE"></p><br><p><strong>为 student_id 加上索引,然后再查询</strong>: 可以看到查询时间得到了极为明显的优化</p><p><img loading="lazy" alt="image-20220717171250451" src="/assets/images/image-20220717171250451-e79da836d7f999344cf9a3e3810ee04a.png" width="2136" height="628" class="img_CujE"></p></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="3频繁分组排序的列">3.频繁分组排序的列<a class="hash-link" href="#3频繁分组排序的列" title="标题的直接链接">​</a></h4><p><strong>索引就是然数据按照某种顺序进行存储或者检索,因此当我们使用 group by 或者 order by 进行分组排序的时候, 就可以</strong><code>对分组、排序的字段进行索引</code>。如果分组排序的列有多个,<code>就用这些列建立组合索引</code></p><p><strong>说明:</strong> <mark>表中有多个索引的时候,当多个查询条件中使用了某个索引之后,一般就不使用其他索引了,并且注意 sql 执行顺序与索引字段顺序</mark></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>测试</div><div class="admonitionContent_vXIg"><p><strong>我们根据 student_id 进行分组,查看每组的学生数量</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> student_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">count</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> student_info</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">BY</span><span class="token plain"> student_id </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">100</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到耗时在 0.7s 左右,并且我们通过 explain 分析看到</p><p><img loading="lazy" alt="image-20220724100147893" src="/assets/images/image-20220724100147893-a8fdea0cc1043db5966ea4dffc05c56e.png" width="2970" height="1800" class="img_CujE"></p><p><img loading="lazy" alt="image-20220724100632122" src="/assets/images/image-20220724100632122-d93fde983573e5619528db115184d05f.png" width="3134" height="374" class="img_CujE"></p><p>我们为需要 Group By 的字段<em>student_id</em> 建立索引信息,然后 explain 可以看到使用了索引</p><p><img loading="lazy" alt="image-20220724101111685" src="/assets/images/image-20220724101111685-a84d81671b9f73c1024d29610b5134f7.png" width="3042" height="562" class="img_CujE"></p><p>同时查询的耗时也从 750ms 降到了 10ms</p><p><img loading="lazy" alt="image-20220724101200865" src="/assets/images/image-20220724101200865-0b2351483f07cb47192108342498abe3.png" width="2984" height="1286" class="img_CujE"></p><p><strong>如果同时使用 Group By 和 Order By呢?</strong> 这里我们对 student_id 进行分组,按 create_time 进行排序</p><p><strong>方案一: 分别对 student_id 和 create_time 建立索引</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">index</span><span class="token plain"> idx_sid </span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token plain"> student_info </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">student_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">index</span><span class="token plain"> idx_ctime </span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token plain"> student_info </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">create_time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 explain 分析可以看到只使用了 studen_id 的相关索引</p><p><img loading="lazy" alt="image-20220724104354090" src="/assets/images/image-20220724104354090-70851d2e8cee728e85afae690da0a077.png" width="2778" height="316" class="img_CujE"></p><p><strong>方案二: 对 student_id 和 create_time 建立联合索引</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">index</span><span class="token plain"> idx_sid_ctime </span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token plain"> student_info </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">student_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> create_time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到使用了联合索引(student_id, create_time), 并且耗时在 0.2s, <strong>即这种的建立索引方式的性能更好</strong></p><p><img loading="lazy" alt="image-20220724105216701" src="/assets/images/image-20220724105216701-d9129bba501f64b2cff891466eb16e52.png" width="3282" height="486" class="img_CujE"></p></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="4updatedelete-的-where-条件列">4.UPDATE、DELETE 的 WHERE 条件列<a class="hash-link" href="#4updatedelete-的-where-条件列" title="标题的直接链接">​</a></h4><p>实际上,<strong>当我们对某条数据进行 UPDATE、DELETE操作的时候,也可以为 WHERE 条件列建立索引 </strong>。因为删除也需要找到指定的数据,使用索引可以更快的定位到需要更新、删除的数据。</p><p>当数据按照某个条件需要某个条件进行查询之后,再进行 UPDATE、DELETE 的操作, 如果对 WHERE 字段创建了索引,就可以大幅度的提高效率,因为本质上就是根据带索引的 WHERE 条件列进行检索,检索出来之后再进行删除。</p><p><strong>如果是进行更新操作,且更新的字段是非索引字段,那么效率的提升会更加的明显,</strong><code>因为非索引字段的更新不会触发索引的维护。</code></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="5distinct-字段">5.DISTINCT 字段<a class="hash-link" href="#5distinct-字段" title="标题的直接链接">​</a></h4><p>有时候我们需要使用 distinct 对某个字段进行去重,对这个字段建立索引,也可以提升查询效率。<code>因为索引是排序后的数据,而排序会提升去重的效率,可能不需要完整的线性迭代</code></p><p>::: info 测试</p><p><strong>测试 case: 查询 student_info 表中不同的 course_id 有哪些?</strong></p><p><strong>1. 正常没有为 course_id 建立索引</strong></p><p>我们看到查询需要 265ms</p><p><img loading="lazy" alt="image-20220724134057534" src="/assets/images/image-20220724134057534-82693c39194bb813a5063039f91e8163.png" width="2974" height="772" class="img_CujE"></p><p><strong>2. 为 course_id 建立索引之后</strong></p><p>查询速度从 265ms 降低到了 14ms</p><p><img loading="lazy" alt="image-20220724134303306" src="/assets/images/image-20220724134303306-7e6fef23eeda03282e53e2a4be76bc4f.png" width="2994" height="1028" class="img_CujE"></p><p>:::</p><h4 class="anchor anchorWithStickyNavbar_loeA" id="6多表join">6.多表JOIN<a class="hash-link" href="#6多表join" title="标题的直接链接">​</a></h4><p>多表连接操作时,创建索引的话有以下的注意点:</p><ol><li><code>连接表的数量尽量不要超过 3 张</code><ul><li><strong>因为每增加一张表就相当于增加一层嵌套的循环,数量级增长的很快</strong></li></ul></li><li><code>对 WHERE 条件建立索引</code><ul><li>因为 WHERE 条件才是对数据条件的过滤,如果在数据量极大的情况下,没有WHERE 条件是很可怕的</li></ul></li><li><code>对用于连接的字段建立索引,并且该字段在多张表之间的类型必须一致</code><ul><li><strong>数据类型一致是为了避免出现类型的隐式转换</strong></li></ul></li></ol><h4 class="anchor anchorWithStickyNavbar_loeA" id="7列类型小的建索引">7.列类型小的建索引<a class="hash-link" href="#7列类型小的建索引" title="标题的直接链接">​</a></h4><blockquote><p>这里说明的<code>类型大小</code> 指的是该类型表的数据范围的大小</p></blockquote><p>我们在定义表结构的时候需要显式的指定列的类型,以整数类型为例,有TINYINT、MEDIUMINT、INT、BIGINT 等,它们占用的存储空间依次递增,能表示的整数范围也是依次递增。<strong>如果我们想要对某个整数列建立索引的话,尽量让索引列选择使用较小的类型列</strong>,比如我们能使用 <em>INT</em> 就不要使用<em>BIGINT</em>,因为:</p><ol><li>数据类型越小,在查询的时候进行的比较操作就越快</li><li>数据类型越小,索引所占据的存储空间就越小,一个数据页中可以<code>存放更多的记录</code>,从而减少磁盘 IO 的次数</li></ol><p>对于这个<code>一般适用于表的主键</code>, 因为不仅是聚簇索引中会存储主键值,在非聚簇索引中也会存储主键值,如果主键能选择适当的数据类型,可以节省更多的存储空间</p><h4 class="anchor anchorWithStickyNavbar_loeA" id="8使用字符串前缀创建索引">8.使用字符串前缀创建索引<a class="hash-link" href="#8使用字符串前缀创建索引" title="标题的直接链接">​</a></h4><p>假设我们的字符串很长,那么存储一个字符串就需要占用很大的空间。我们为这个字符串列建立索引意味着:</p><ol><li>B+Tree 索引中的记录需要将该列的完整字符串记录下来,那么索引就会占用很大的存储空间</li><li>如果字符串很长,那么在字符串比较的时候会占用更多的时间</li></ol><p><strong>我们可以截取字段前面的一部分内容建立索引,这个就是</strong><code>前缀索引</code>。这样在查询记录时虽然无法精确的定位到记录的位置,但是能定位到索引前缀的位置,再通过主键值进行回表操作拿到完整字符串的位置</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 示例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">create</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">index</span><span class="token plain"> idx_address </span><span class="token keyword" style="color:rgb(12, 150, 155)">on</span><span class="token plain"> shop</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">12</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>问题是,我们应该如何界定这个索引长度呢? <mark>如果索引长度太短,那么重复的内容就会很多,区分度就会很低;如果索引长度很长,虽然区分度搞了,但又会占用很多的存储空间</mark>。我们有下面的公式:</p><ol><li><p>字段在全部数据中的区分度,越接近于 1 区分度就越高</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 非重复的字段数 / 字段总数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">count</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">discint 字段名</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">count</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> 表名</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>通过不同字段长度查看区分度</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 截断指定长度后非重复的字段数 / 字段总数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">count</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">discint </span><span class="token keyword" style="color:rgb(12, 150, 155)">left</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">字段名</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">长度</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">count</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">from</span><span class="token plain"> 表名</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>另外需要注意的是, 如果这个字段<code>使用前缀索引且需要排序</code>的话,就可能会出现一个问题: 前缀索引的值是一样的,那么就无法利用<code>索引排序</code>,需要使用<code>文件排序</code>,这种的速度较慢</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>阿里开发规约</div><div class="admonitionContent_vXIg"><p>[<strong>强制</strong>]<!-- --> : 在 varchar 字段上建立索引,必须指定索引的长度,没必要对全字段建立索引,根据实际的文本区分度决定索引长度</p><p>说明: 索引的长度与区分度是不可兼得的,一般字符串类型的数据,长度为 20 的索引,区分度可以高达 <strong>90%</strong> 以上</p></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="9区分度高的列建索引cardinality">9.区分度高的列建索引(Cardinality)<a class="hash-link" href="#9区分度高的列建索引cardinality" title="标题的直接链接">​</a></h4><blockquote><p><code>列的基数(Cardinality)</code> 指的是某一列中不重复数据的个数</p></blockquote><p>比如某个列包含的值有 <!-- -->[2,5,8,2,5,8,2,5,8]<!-- -->,虽然有 9 个数据,但是该列的基数却只有 3。也就是说<strong><mark>在记录行数一定的情况下,列的基数越大,该列中的值越分散;列的基数越小,该列中的值越集中</mark></strong>。</p><p>列的基数的这个指标很重用,会影响到我们是否能高效的利用好索引,<strong>最好为列的基数大的列作为索引</strong>。</p><p>当然,可以使用公式<code>select count(distinct 字段) / count(*) from table</code> 去计算区分度,越接近于 1 越好,但<code>一般超过 33%</code> 就是比较高效的索引了</p><h4 class="anchor anchorWithStickyNavbar_loeA" id="10高频列放在组合索引左侧">10.高频列放在组合索引左侧<a class="hash-link" href="#10高频列放在组合索引左侧" title="标题的直接链接">​</a></h4><p>可以为使用很频繁的列建立一个联合索引,并且按频繁度从<code>从左到右</code>排列(依据<code>最左前缀法则</code>),这样可以建立较少的索引。</p><h4 class="anchor anchorWithStickyNavbar_loeA" id="11多字段索引联合优于单值">11.多字段索引,联合优于单值<a class="hash-link" href="#11多字段索引联合优于单值" title="标题的直接链接">​</a></h4><p>因为查询的时候,当满足并使用了某个索引后,一般就不会使用其他索引,那么联合索引可以保证锁哥字段使用索引,查询效率会更好,并且在更新的时候,只需要维护一个索引就行。要求就是:<strong>查询条件的字段中必须含有索引列中的第一个字段</strong></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="限制索引数量">限制索引数量<a class="hash-link" href="#限制索引数量" title="标题的直接链接">​</a></h3><p>虽然索引很好使,但是我们也需要明白索引也是有成本的(空间成本、维护成本等),所以我们需要注意平衡,即<strong>索引的数量不是越多越好好,我们需要限制单表上的索引数量</strong>,建议单表索引树不超过<code>6</code> 个,原因:</p><ol><li>每个索引都需要占用<strong>磁盘空间</strong>,索引越多,需要的磁盘空间就越多</li><li>索引会影响<strong>INSERT、DELETE、UPDATE</strong> 语句的性能,因为表中数据修改后,索引也需要进行调整和更新,属于额外的维护成本</li><li><strong>优化器在选择如何优化查询的时候,会根据已有的信息,对每个可以用到索引的索引进行评估,以生成一个最好的执行计划</strong>,如果有很多的索引,那么优化器就需要花更多的时间去生成执行计划<ul><li>通过 explain 我们可以看到有一个<code>possible_keys</code>,这个是查询可能使用的索引,后面的<code>key</code> 就是优化器选择使用的索引</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="不适合建索引">不适合建索引<a class="hash-link" href="#不适合建索引" title="标题的直接链接">​</a></h3><p>下面集中情况不适合建立索引:</p><ol><li><strong>where中使用不到的字段</strong></li><li><strong>数据量小的表最好不要使用索引</strong></li><li><strong>有大量重复数据的列上不要建立索引</strong></li><li><strong>避免对经常更新的表创建过多的索引</strong></li><li><strong>不建议用无序的值作为索引</strong></li><li><strong>删除不再使用或者很少使用的索引</strong></li><li><strong>不要定义冗余或重复的索引</strong></li></ol><h4 class="anchor anchorWithStickyNavbar_loeA" id="1where中使用不到的字段">1.where中使用不到的字段<a class="hash-link" href="#1where中使用不到的字段" title="标题的直接链接">​</a></h4><p>WHERE 条件(也包括 GROUP BY、ORDER BY)里用不到的字段不需要建立索引,因为索引的意义就是快速定位,如果起不到快速定位的字段通常是不需要建立索引的,比如:</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 比如这里使用 student_id作为检索,可以为其加上索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 但是其他 course_id,student_id,create_time 字段则不需要建立索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">-- 因为这些字段仅仅出现在 Select 中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> course_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">student_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">create_time</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> student_info</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> student_id</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">1231</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="2数据量小的表">2.数据量小的表<a class="hash-link" href="#2数据量小的表" title="标题的直接链接">​</a></h4><p>如果表的记录太少,比如说小于 1000 个,那么是不需要建立索引的。表的记录太少,是否创建索引<strong>对查询效率的影响并大</strong>,甚至可能比索引还要快(比如非聚簇索引还需要回表)</p><h4 class="anchor anchorWithStickyNavbar_loeA" id="3有大量重复数据">3.有大量重复数据<a class="hash-link" href="#3有大量重复数据" title="标题的直接链接">​</a></h4><mark>与区分度高的列适合建索引相对的,如果某列字段的有大量的重复数据,那么就不适合创建索引</mark><p>比如在学生表的<strong>性别</strong>字段上只有“男”和“女”两个不同的值,所以不需要建立索引,建立索引反而会<strong>严重降低数据更新速度</strong></p><p><strong>举例</strong>: 要在 100 万条数据中查找其中的 50 万行(比如性别为男的数据),一旦建立索引就需要访问 50 万次索引,而且由于性别是非聚簇索引,所以每次索引都需要一次回表,也就是需要 50 万次回表操作,这种开销可能比不使用索引还高。</p><h4 class="anchor anchorWithStickyNavbar_loeA" id="4经常更新的表">4.经常更新的表<a class="hash-link" href="#4经常更新的表" title="标题的直接链接">​</a></h4><blockquote><p>对于经常更新的表,我们不应该创建过多的索引</p></blockquote><p>有两层的含义:</p><ol><li><code>频繁更新的字段不一定要创建索引</code><ul><li>因为更新数据的时候,也需要更新索引。如果索引太多,维护索引的成本也很高</li></ul></li><li><code>避免对经常更新的表创建过多的索引, 并且索引中的尽可能的少</code><ul><li>经常更新表,意味着需要频繁的更新索引信息,就会降低表的更新速度</li></ul></li></ol><h4 class="anchor anchorWithStickyNavbar_loeA" id="5不用无序的值作为索引">5.不用无序的值作为索引<a class="hash-link" href="#5不用无序的值作为索引" title="标题的直接链接">​</a></h4><p>索引中的用户记录是经过排序的,如果记录是无序的(比如 UUID、身份证、MD5、Hash、无序长字符串…),那么就意味着可能会造成<code>页分裂</code></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="6-删除不再使用或者很少使用的索引">6. 删除不再使用或者很少使用的索引<a class="hash-link" href="#6-删除不再使用或者很少使用的索引" title="标题的直接链接">​</a></h4><p>索引是需要维护成本的,如果一个索引很少或者不被使用,那么这些索引应该被清除掉,从而减少索引对更新操作的影响,并且可以释放磁盘空间。</p><h4 class="anchor anchorWithStickyNavbar_loeA" id="7不定义冗余或重复索引">7.不定义冗余或重复索引<a class="hash-link" href="#7不定义冗余或重复索引" title="标题的直接链接">​</a></h4><blockquote><p>冗余的索引可能会导致无法利用到其他组合索引,导致效率降低</p></blockquote><p><strong>1.冗余索引</strong></p><p>有时会对同一个列建立多个索引,比如 <strong>index(a,b,c) 相当于 index(a)、index(b)、index(c)</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    比如这里的 idx_name_birth_phone 索引就可以对 name 列进行快速检索,</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    后面的idx_name就是一个冗余索引</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> person_info</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  id </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  name </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  birthday </span><span class="token keyword" style="color:rgb(12, 150, 155)">DATE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  phone_number </span><span class="token keyword" style="color:rgb(12, 150, 155)">CHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">11</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  country </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> idx_name_birth_phone </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> birthday</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> phone_number</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> idx_name </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2.重复索引</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    我们已经为 col1定义了主键约束,就会有主键索引(唯一的),</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    后面又分别创建了 uk_idx_c1 和 idx_c1,就属于是重复的索引</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> repeat_index_demo </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  col1 </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    col2 </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">UNIQUE</span><span class="token plain"> uk_idx_c1 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INDEX</span><span class="token plain"> idx_c1 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="设计原则总结">设计原则总结<a class="hash-link" href="#设计原则总结" title="标题的直接链接">​</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MagicalZhu/NoteLib/tree/main/docs/Mysql/高级特性/设计索引.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_N_05" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">最后<!-- -->由 <b>YuLiang Zhu</b> <!-- -->于 <b><time datetime="2022-12-06T01:19:52.000Z">2022年12月6日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Mysql/高级特性/索引的应用"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">索引的应用</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Mysql/高级特性/InnoDB数据页结构"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">InnoDB数据页结构</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><p class="content_nRws">Contents</p><ul class="table-of-contents table-of-contents__left-border"><li><a href="#使用索引" class="table-of-contents__link toc-highlight">使用索引</a><ul><li><a href="#索引的分类" class="table-of-contents__link toc-highlight">索引的分类</a></li><li><a href="#查看索引" class="table-of-contents__link toc-highlight">查看索引</a></li><li><a href="#删除索引" class="table-of-contents__link toc-highlight">删除索引</a></li><li><a href="#创建索引" class="table-of-contents__link toc-highlight">创建索引</a><ul><li><a href="#创建表时" class="table-of-contents__link toc-highlight">创建表时</a><ul><li><a href="#基于表约束" class="table-of-contents__link toc-highlight">基于表约束</a></li><li><a href="#显式创建" class="table-of-contents__link toc-highlight">显式创建</a></li></ul></li><li><a href="#已有表" class="table-of-contents__link toc-highlight">已有表</a></li></ul></li></ul></li><li><a href="#索引新特性" class="table-of-contents__link toc-highlight">索引新特性</a><ul><li><a href="#降序索引innodb" class="table-of-contents__link toc-highlight">降序索引(InnoDB)</a></li><li><a href="#隐藏索引" class="table-of-contents__link toc-highlight">隐藏索引</a><ul><li><a href="#创建隐藏索引" class="table-of-contents__link toc-highlight">创建隐藏索引</a></li><li><a href="#对优化器可见" class="table-of-contents__link toc-highlight">对优化器可见</a></li></ul></li></ul></li><li><a href="#设计原则" class="table-of-contents__link toc-highlight">设计原则</a><ul><li><a href="#准备数据" class="table-of-contents__link toc-highlight">准备数据</a></li><li><a href="#适合创建索引" class="table-of-contents__link toc-highlight">适合创建索引</a><ul><li><a href="#1字段数值唯一" class="table-of-contents__link toc-highlight">1.字段数值唯一</a></li><li><a href="#2频繁作为where条件" class="table-of-contents__link toc-highlight">2.频繁作为WHERE条件</a></li><li><a href="#3频繁分组排序的列" class="table-of-contents__link toc-highlight">3.频繁分组排序的列</a></li><li><a href="#4updatedelete-的-where-条件列" class="table-of-contents__link toc-highlight">4.UPDATE、DELETE 的 WHERE 条件列</a></li><li><a href="#5distinct-字段" class="table-of-contents__link toc-highlight">5.DISTINCT 字段</a></li><li><a href="#6多表join" class="table-of-contents__link toc-highlight">6.多表JOIN</a></li><li><a href="#7列类型小的建索引" class="table-of-contents__link toc-highlight">7.列类型小的建索引</a></li><li><a href="#8使用字符串前缀创建索引" class="table-of-contents__link toc-highlight">8.使用字符串前缀创建索引</a></li><li><a href="#9区分度高的列建索引cardinality" class="table-of-contents__link toc-highlight">9.区分度高的列建索引(Cardinality)</a></li><li><a href="#10高频列放在组合索引左侧" class="table-of-contents__link toc-highlight">10.高频列放在组合索引左侧</a></li><li><a href="#11多字段索引联合优于单值" class="table-of-contents__link toc-highlight">11.多字段索引,联合优于单值</a></li></ul></li><li><a href="#限制索引数量" class="table-of-contents__link toc-highlight">限制索引数量</a></li><li><a href="#不适合建索引" class="table-of-contents__link toc-highlight">不适合建索引</a><ul><li><a href="#1where中使用不到的字段" class="table-of-contents__link toc-highlight">1.where中使用不到的字段</a></li><li><a href="#2数据量小的表" class="table-of-contents__link toc-highlight">2.数据量小的表</a></li><li><a href="#3有大量重复数据" class="table-of-contents__link toc-highlight">3.有大量重复数据</a></li><li><a href="#4经常更新的表" class="table-of-contents__link toc-highlight">4.经常更新的表</a></li><li><a href="#5不用无序的值作为索引" class="table-of-contents__link toc-highlight">5.不用无序的值作为索引</a></li><li><a href="#6-删除不再使用或者很少使用的索引" class="table-of-contents__link toc-highlight">6. 删除不再使用或者很少使用的索引</a></li><li><a href="#7不定义冗余或重复索引" class="table-of-contents__link toc-highlight">7.不定义冗余或重复索引</a></li></ul></li></ul></li><li><a href="#设计原则总结" class="table-of-contents__link toc-highlight">设计原则总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">前端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://v3.cn.vuejs.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">React<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://ts.xcatliu.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TypeScript<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://developer.mozilla.org/zh-CN/docs/Web" target="_blank" rel="noopener noreferrer" class="footer__link-item">MDN<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">后端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spring<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">JVM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.infoq.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">InfoQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">文档构建</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://typoraio.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Typora<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 huakucha. Built With Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf86732a.js"></script>
<script src="/assets/js/main.98457ee6.js"></script>
</body>
</html>