<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Mysql/高级特性/事务基础">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">事务基础 | 花裤衩Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" name="twitter:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" property="og:url" content="https://huakucha.com/docs/Mysql/高级特性/事务基础"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="事务基础 | 花裤衩Wiki"><meta data-rh="true" name="description" content="数据库事务"><meta data-rh="true" property="og:description" content="数据库事务"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huakucha.com/docs/Mysql/高级特性/事务基础"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/Mysql/高级特性/事务基础" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/Mysql/高级特性/事务基础" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QZ9YPBGUYT-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="花裤衩Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="花裤衩Wiki Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="花裤衩Wiki JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="花裤衩Wiki" href="/opensearch.xml">

<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.font.im/css?family=Raleway:500,700&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.864d50a7.css">
<link rel="preload" href="/assets/js/runtime~main.bf86732a.js" as="script">
<link rel="preload" href="/assets/js/main.98457ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_D8pK">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="content_zf74 announcementBarContent_dpRF">🌟欢迎来到花裤衩的博客🌟</div><button type="button" aria-label="关闭" class="clean-btn close closeButton_ZdWa announcementBarClose_iXyO"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--light_PnYV"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--dark_eYgw"></div><b class="navbar__title text--truncate">花裤衩</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">基础知识🤖</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/currency">并发编程</a></li><li><a class="dropdown__link" href="/docs/networrk-basic">计算机网络</a></li><li><a class="dropdown__link" href="/docs/linuxCommand">Linux</a></li><li><a class="dropdown__link" href="/docs/dataStructure">数据结构与算法</a></li><li><a class="dropdown__link" href="/docs/leetCode">LeetCode</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/mysql">MySQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">后端框架👨‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/spring">Spring</a></li><li><a class="dropdown__link" href="/docs/springCloud">SpringCloud</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">方法论🚧</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/distribute/protol">分布式理论</a></li><li><a class="dropdown__link" href="/docs/distribute/basicTech">分布式技术点</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">中间件🚀</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/middleware/basicMiddleware">基础中间件</a></li><li><a class="dropdown__link" href="/docs/middleware/job">定时任务</a></li><li><a class="dropdown__link" href="/docs/middleware/cache">缓存</a></li><li><a class="dropdown__link" href="/docs/middleware/searchEngine">搜索引擎</a></li><li><a class="dropdown__link" href="/docs/middleware/messageQueue">消息队列</a></li><li><a class="dropdown__link" href="/docs/middleware/database">数据库</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">底层⛽️</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/JVM">JVM</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">前端技术👩‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/front/Vue">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其他工具👹</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Gradle">Gradle</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">物料中心👏</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/website/BE">后端产品</a></li><li><a class="dropdown__link" href="/website/COM">其他产品</a></li><li><a class="dropdown__link" href="/website/FE">前端产品</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.huakucha.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">关于<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/MagicalZhu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_MW0i colorModeToggle_x44X"><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SFTY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ekgs"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_H2mL"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_W2AM"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_ntye" type="button"></button><div class="docPage_qMb8"><aside class="theme-doc-sidebar-container docSidebarContainer_rpaz"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mysql">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/mysql基础与高级">MySQL基础与高级</a><button aria-label="打开/收起侧边栏菜单「MySQL基础与高级」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/基础知识">基础知识</a><button aria-label="打开/收起侧边栏菜单「基础知识」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/数据库管理">数据库管理</a><button aria-label="打开/收起侧边栏菜单「数据库管理」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/架构与引擎">架构与引擎</a><button aria-label="打开/收起侧边栏菜单「架构与引擎」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/存储结构与索引">存储结构与索引</a><button aria-label="打开/收起侧边栏菜单「存储结构与索引」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/性能优化">性能优化</a><button aria-label="打开/收起侧边栏菜单「性能优化」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/事务与锁">事务与锁</a><button aria-label="打开/收起侧边栏菜单「事务与锁」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Mysql/高级特性/事务基础">事务基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/Redo日志">Redo日志</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/Undo日志">Undo日志</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/锁">锁机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Mysql/高级特性/MVCC">多版本并发控制</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/运维">运维</a><button aria-label="打开/收起侧边栏菜单「运维」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Mysql/MySQL参数与命令">MySQL参数与命令</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_JQG6"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Iseg"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SLhD"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/mysql基础与高级"><span itemprop="name">MySQL基础与高级</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/事务与锁"><span itemprop="name">事务与锁</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">事务基础</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_IbkY theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_p7nN">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>事务基础</h1></header><h2 class="anchor anchorWithStickyNavbar_loeA" id="数据库事务">数据库事务<a class="hash-link" href="#数据库事务" title="标题的直接链接">​</a></h2><p><strong>事务是数据库区别的文件系统的重要特性之一</strong></p><ol><li>事务就可以让数据库始终保持<code>一致性</code></li><li>可以通过事务的机制<code>恢复到某个时间点</code>,这样可以保证提交到数据库的修改不会因为系统崩溃而丢失</li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="存储引擎的支持情况">存储引擎的支持情况<a class="hash-link" href="#存储引擎的支持情况" title="标题的直接链接">​</a></h3><blockquote><p>MySQL 只有<strong>InnoDB</strong> 支持事务</p></blockquote><p><code>SHOW ENGINES</code> 命令来查看当前MySQL支持的存储引擎都有哪些，以及这些存储引擎是否支持事务</p><p><img loading="lazy" alt="image-20220804163343357" src="/assets/images/image-20220804163343357-216bf4386ede74e799201de8d791067c.png" width="3298" height="776" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="基本概念">基本概念<a class="hash-link" href="#基本概念" title="标题的直接链接">​</a></h3><ol><li>事务是 <strong>一组逻辑操作单元，使数据从一种状态变换到另一种状态</strong></li><li><code>事务处理的原则</code><ul><li>保证所有事务都作为<code>一个工作单元</code> 来执行, 即使出现了故障,都不能改变这种执行方式。</li><li>当在一个事务中执行多个操作时 :<ul><li>要么所有的事务都被提交<code>Commit</code>,那么这些修改就 <code>永久</code> 地保存下来</li><li>要么数据库管理系统将 <code>放弃</code> 所作的所有<code>修改</code>, 整个事务回滚<code>rollback</code></li></ul></li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="acid">ACID<a class="hash-link" href="#acid" title="标题的直接链接">​</a></h3><p>事务的 ACID 指的是:</p><ol><li><strong>原子性 (atomicity)</strong></li><li><strong>一致性 (consistency)</strong></li><li><strong>隔离型 (isolation)</strong></li><li><strong>持久性 (durability)</strong></li></ol><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>说明</div><div class="admonitionContent_vXIg"><p>ACID 是事务的 4 大特性,这四个特性中:<strong>原子性是基础,一致性是约束条件,隔离性是手段,持久性是最终目标</strong></p></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="atomicity">atomicity<a class="hash-link" href="#atomicity" title="标题的直接链接">​</a></h4><blockquote><p>多个操作不可分割</p></blockquote><ul><li><strong>原子性是指事务是一个不可分割的工作单位。要么全部提交,要么全部失败回滚</strong></li><li>即要么转账成功,要么失败,不存在一种中间状态。如果没有事务,就会出现 A 账户增加 100,但是 B 账户没有扣除 100</li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="consistency">consistency<a class="hash-link" href="#consistency" title="标题的直接链接">​</a></h4><blockquote><p>用设定的目标规则是否一致</p></blockquote><ul><li><p><strong>一致性是指事务执行前后，数据从一个<code>合法性状态</code> 变换到另外一个 <code>合法性状态</code>。这种状态是<code> 语义</code>上的而不是语法上的,跟具体的业务有关</strong></p></li><li><p>那么什么事合法的数据状态呢?</p><ul><li>满足<code>预定的约束</code> 的状态就叫做合法的状态。这状态是自定义的。<strong>满足这个状态,数据就是一致的，不满足这个状态，数据就是不一致的</strong></li><li><strong>如果事务中某个操作失败了,系统就会自动撤销当前正在执行的事务,返回到执行事务之前的状态</strong></li></ul></li></ul><p><strong>示例:</strong></p><p>比如 A 账户只有 200 元,但是却转出去 300 元,账户余额变成了 -100元。这个就是不一致的体现,因为定义了一个状态<strong>余额&gt;=0</strong></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="isolation">isolation<a class="hash-link" href="#isolation" title="标题的直接链接">​</a></h4><blockquote><p>多个事务互不影响</p></blockquote><ul><li><strong>事务的隔离性是指一个事务的执行不能被其他事务干扰</strong><ul><li>即一个事务内部的操作及使用的数据对<code>并发的其他事务</code>是隔离的，并发执行的各个事务之间不能互相干扰</li></ul></li><li>隔离性还有其他的称呼: <strong>并发控制(concurrency control)、可串行化(serializability)、锁(locking)等</strong></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>示例</div><div class="admonitionContent_vXIg"><p>如果无法保证隔离性会怎么样?假设A账户有200元，B账户0元。A账户往B账户转账两次，每次金额为50 元，分别在两个事务中执行</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">UPDATE</span><span class="token plain"> accounts </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> money </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> money </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">50</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> NAME </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;AA&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">UPDATE</span><span class="token plain"> accounts </span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> money </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> money </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">50</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> NAME </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;BB&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果无法保证隔离性，会出现下面的情形:</p><p><img loading="lazy" alt="image-20220804225848837" src="/assets/images/image-20220804225848837-aab73e18bc618272b13232c53319b7d1.png" width="1898" height="1050" class="img_CujE"></p></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="durability">durability<a class="hash-link" href="#durability" title="标题的直接链接">​</a></h4><ul><li><p><strong>持久性是指一个事务一旦被提交(刷新到磁盘了)，它对数据库中数据的改变就是</strong><code>永久性的</code><strong>,接下来的其他操作和数据库故障不应该对其有任何影响</strong></p></li><li><p>持久性是通过<code>事务日志</code> 来保证的,日志包括了 <code>重做日志</code> 和 <code>回滚日志</code></p></li><li><p><strong>当我们通过事务对数据进行修改 的时候，首先会将数据库的变化信息记录到重做日志中，然后再对数据库中对应的行进行修改</strong></p><ul><li>这样做即使数据库系统崩溃，<strong>数据库重启后也能找到没有更新到数据库系统中的重做日志,重新执行,从而使事务具有持久性</strong></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="事务的状态">事务的状态<a class="hash-link" href="#事务的状态" title="标题的直接链接">​</a></h3><p>我们现在知道<code>事务</code>是一个抽象的概念, 它<strong>其实对应着一个或多个数据库操作</strong>,MySQL根据这些操作所执行的不同阶段把事务大致划分成几个状态:</p><ol><li><code>活动的 (active)</code><ul><li><strong>事务对应的数据库操作正在执行过程中时</strong>, 我们就说该事务处在<code>活动的</code>状态</li></ul></li><li><code>部分提交的 (partially committed)</code><ul><li>当事务中的最后一个操作执行完成,但由于操作都在内存中执行，所造成的影响并<code>没有刷新到磁盘</code>时，我们就说该事务处在<code>部分提交的</code>状态</li></ul></li><li><code>失败 (failed)</code><ul><li>当事务处在<code>活动的</code>或者<code>部分提交的</code>状态时,<strong>可能遇到了某些错误(数据库自身的错误、操作系统 错误或者直接断电等)而无法继续执行，或者人为的停止当前事务的执行</strong>，我们就说该事务处在<code>失败的</code>状态</li></ul></li><li><code>终止的 (aborted)</code><ul><li>如果事务执行了一部分而变为<code>失败的</code> 状态，那么就需要<strong>把已经修改的事务中的操作还原到事务执行前的状态</strong><ul><li>即要撤销失败事务对当前数据库造成的影响。我们把这个撤销的过程称之为 <code>回滚</code> </li></ul></li><li><strong>当<code>回滚</code>操作执行完毕时，也就是数据库恢复到了执行事务之前的状态,我们就说该事务处在了 <code>中止的</code> 的状态</strong></li></ul></li><li><code>提交的 (committed)</code><ul><li><strong>当一个处在<code>部分提交的</code>状态的事务将修改过的数据都 <code>同步到磁盘</code> 上之后，我们就可以说该事务处在了</strong><code>提交</code><strong>状态</strong></li></ul></li></ol><p><strong>基本的事务状态转换图如下所示:</strong></p><p><img loading="lazy" alt="image-20220804232155697" src="/assets/images/image-20220804232155697-b05201deabf2e2dd3a851ca5905a8214.png" width="1822" height="1248" class="img_CujE"></p><h2 class="anchor anchorWithStickyNavbar_loeA" id="使用事务">使用事务<a class="hash-link" href="#使用事务" title="标题的直接链接">​</a></h2><p><strong>使用事务有两种方式:</strong></p><ol><li><code>显式事务</code></li><li><code>隐式事务</code></li></ol><mark>默认使用隐式事务,如果指定了显式事务,就使用显式事务</mark><h3 class="anchor anchorWithStickyNavbar_loeA" id="显式事务">显式事务<a class="hash-link" href="#显式事务" title="标题的直接链接">​</a></h3><p>指定一个显式的事务有以下的操作步骤:</p><ol><li><p>使用<code>START TRANSACTION </code>或 <code>BEGIN</code> 显式开启一个事务</p></li><li><p>指定事务中的一系列的操作 (<strong>主要是 DML,不含 DDL</strong>)</p></li><li><p><strong>提交事务</strong>或者<strong>终止事务(回滚)</strong></p></li></ol><h4 class="anchor anchorWithStickyNavbar_loeA" id="开启事务">开启事务<a class="hash-link" href="#开启事务" title="标题的直接链接">​</a></h4><ul><li><p><strong>基本语法格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#或者</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">START</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TRANSACTION</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>START TRANSACTION 语句相较于 BEGIN 特别之处在于,后边能跟随几个修饰符:</strong></p><ul><li><code>READ ONLY</code><ul><li>标识当前事务是一个<code>只读事务</code>,也就是属于该事务的数据库操作只能读取数据,而不能修改数据</li></ul></li><li><code>READ WRITE</code><ul><li>标识当前事务是一个<code>读写事务</code>,也就是属于该事务的数据库操作既可以读取数据,也可以修改数据</li><li><strong>默认的</strong></li></ul></li><li><code>WITH CONSISTENT SNAPSHOT</code><ul><li>启动一致性读, 还能和 <em>read only 和 read write</em>搭配</li></ul></li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="提交回滚事务">提交/回滚事务<a class="hash-link" href="#提交回滚事务" title="标题的直接链接">​</a></h4><ul><li><code>COMMIT</code>   : 提交</li><li><code>ROLLBACK</code> : 回滚 </li></ul><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 提交事务。当提交事务后，对数据库的修改是永久性的。 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">COMMIT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 回滚事务,即撤销正在进行的所有没有提交的修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ROLLBACK</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="savepoint">SavePoint<a class="hash-link" href="#savepoint" title="标题的直接链接">​</a></h4><ul><li><p><strong>可以在一个事务中创建多个保存点,方便后续针对保存点进行回滚。</strong></p></li><li><p><code>有两个回滚点 A、B,当回滚到 A 在回滚到 B 后,回滚点 A 就不存在了</code></p></li><li><mark>回滚到指定的保存点并不是让事务进入 <strong>中止状态</strong>,而是可以接着往下执行,最后选择 commit 或者 rollback</mark></li><li><p><strong>基本格式</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 在事务中创建一个保存点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SAVEPOINT</span><span class="token plain"> 保存点名称</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 将事务回滚到某个保存点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ROLLBACK</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TO</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">保存点名称</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 删除某个保存点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">RELEASE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">SAVEPOINT</span><span class="token plain"> 保存点名称</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><img loading="lazy" alt="image-20220805090052465" src="/assets/images/image-20220805090052465-af22ae61c0bbb5dd5b29acdfcab134e2.png" width="1484" height="1040" class="img_CujE"></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>保存点示例</div><div class="admonitionContent_vXIg"><p><strong>1.回滚savepoint操作</strong></p><p>我们可以看到,通过 savepoint 可以保存一个时间点,并且让事务回到该时间点,然后可以指定提交还是整体回滚。</p><p><img loading="lazy" alt="image-20220805101031725" src="/assets/images/image-20220805101031725-74708672d17e23cdc88bef6069b97017.png" width="1368" height="1998" class="img_CujE"></p><br><p><strong>2.重复回滚问题</strong></p><p><img loading="lazy" alt="image-20220805102342405" src="/assets/images/image-20220805102342405-08aa3c92f96c1ab4eeed9e22de9f2722.png" width="1220" height="1676" class="img_CujE"></p></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="隐式事务">隐式事务<a class="hash-link" href="#隐式事务" title="标题的直接链接">​</a></h3><p>MySQL 中有一个系统变量 <code>autocommit</code>用于控制自动提交,开启这个参数意味着<strong>每一个 DML 语句都是一个独立的事务</strong></p><p><img loading="lazy" alt="image-20220804234124287" src="/assets/images/image-20220804234124287-090cd37e362b2b45bcb0bc817b115023.png" width="932" height="348" class="img_CujE"></p><p>当然，如果我们想关闭这种<code>自动提交</code> 的功能，可以使用下边两种方法之一:</p><ol><li><p><strong>显式的的使用 START TRANSACTION 或者 BEGIN 语句开启一个事务</strong>。这样在本次事务提交或者回滚前会暂时关闭掉自动提交的功能</p></li><li><p><strong>把系统变量 <code>autocommit</code> 的值设置为 <code>OFF</code></strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 关闭自动提交</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> autocommit </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">OFF</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#  开启自动提交</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> autocommit </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p><img loading="lazy" alt="image-20220805093342746" src="/assets/images/image-20220805093342746-42107c48e78ee00288003cdcd5b3dcf8.png" width="2306" height="1594" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="隐式提交事务的情况">隐式提交事务的情况<a class="hash-link" href="#隐式提交事务的情况" title="标题的直接链接">​</a></h3><blockquote><p>除了手动的使用 Commit 提交事务,在下面的集中情况下, MySQL 还会对事务进行隐式的提交</p></blockquote><ol><li><p><code>DDL:数据定义语言</code></p><ul><li><p>数据库对象就是<strong>数据库、表、视图、存储过程等结构</strong>,当我们使用 <strong><em>CREATE、ALTER、DROP、TRUNCATE</em> 等</strong>语句去修改数据库对象的时候,就会<code>隐式的提交</code>该语句前的事务</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/* 示例 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 事务的第一条语句</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 事务的第二条语句</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">#事务的其他语句</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 执行下面 DDL 的语句时,会自动提交上面语句所属的事务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ALTER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">DROP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p><code>隐式的使用或修改 mysql 数据库中的表</code></p><ul><li>当我们使用 <strong><em>ALTER USER、CREATE USER、DROP USER、GRANT、SETPASSWORD</em></strong> 等语句时,也会<code>隐式的提交</code>该语句前面的事务</li></ul></li><li><p><code>事务控制 或 关于锁定的语句 </code></p><ul><li><p><strong>在一个事务还没 提交或回滚时 就又手动(START TRANSACTION 或者 BEGIN)开启了另一个事务时</strong>, 会 <code>隐式的提交</code> 上一个事务</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 开启事务 A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 事务A的第一条语句</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">   </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 事务A的第二条语句</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 事务A的其他语句</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 事务没有结束,但是此时开启事务 B的话, 会提交事务 A</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>当前的 autocommit 系统变量的值为 OFF, 我们手动把它调为 ON 时，也会 隐式的提交前面的事务</strong></p></li><li><p>使用 <strong><em>LOCK TABLES、UNLOCK TABLES</em></strong> 等关于<strong>锁定的语句</strong>也会<code>隐式的提交</code>前边语句所属的事务。</p></li></ul></li><li><p><code>加载数据的语句</code></p><ul><li>使用 <strong><em>LOAD DATA</em></strong> 向数据库中批量的导入数据时,也会<code>隐式的提交</code>前边语句所属的事务</li></ul></li><li><p><code>MySQL复制的语句</code></p><ul><li>使用 <strong><em>START SLAVE、STOP SLAVE 、RESET SLAVE、CHANGE MASTER TO</em></strong> 等语句时也会<code>隐式的提交</code>前边语句所属的事务。</li></ul></li><li><p><code>其他的语句</code></p><ul><li><strong>使用 <em>analyze table、cache index、check table</em></strong> 等语句时,也会<code>隐式的提交</code>前边语句所属的事务</li></ul></li></ol><h2 class="anchor anchorWithStickyNavbar_loeA" id="事务隔离级别">事务隔离级别<a class="hash-link" href="#事务隔离级别" title="标题的直接链接">​</a></h2><ul><li>MySQL 是基于<strong>客户端/服务器</strong> 架构的,对于同一个服务器来说,可以同时和若干个客户端连接，每个客户端与服务器连接上之后,就是一个<code>会话 (Session)</code>。 每个客户端都可以在自己的会话中向服务器发出请求语句,<strong>一个请求语句可能是某个事务的一部分,也就是对于服务器来说会同时处理多个事务</strong></li><li>事务有<code>隔离性</code>的特性，理论上<strong>在某个事务对某个数据进行访问时，其他事务应该进行<code>排队</code></strong>, 当该事务提交之后其他事务才可以继续访问这个数据,这种方式<strong>对性能影响很大</strong></li><li>我们既想拥有<strong>事务的隔离性</strong>,又想让服务器<strong>在处理访问同一个数据的多个事务时保持<code>高性能</code></strong>,这时候就需要<code>事务隔离级别</code> (鱼和熊掌如何兼得?)</li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="数据准备">数据准备<a class="hash-link" href="#数据准备" title="标题的直接链接">​</a></h3><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 创建表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TABLE</span><span class="token plain"> student </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  studentno </span><span class="token keyword" style="color:rgb(12, 150, 155)">INT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    name </span><span class="token keyword" style="color:rgb(12, 150, 155)">VARCHAR</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    class </span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">studentno</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">Engine</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token keyword" style="color:rgb(12, 150, 155)">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">CHARSET</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 插入一条数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> student </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;小谷&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;1班&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="四种事务并发问题">四种事务并发问题<a class="hash-link" href="#四种事务并发问题" title="标题的直接链接">​</a></h3><p><strong>针对事务的隔离性和并发性</strong>,我们怎么做取舍呢?先看一下访问相同数据的事务在<strong>不保证串行执行</strong> (也就是执行完一个再执行另一个)的情况下可能会出现哪些问题:</p><ol><li><p><code>脏写 (Dirty Write)</code></p><ul><li><strong>对于两个事务 T1、T2, 如果 T1 修改了另一个<code>未提交</code>T2 修改过的数据，那就意味着发生了<code>脏写</code></strong> </li></ul></li><li><p><code>脏读 (Dirty Read)</code></p><ul><li><strong>对于两个事务 T1、T2,<code>T1读取了</code>已经被<code>T2 更新但还没有被提交</code> 的字段,如果之后 T2 回滚,那么 <code>T1读取的内容就是临时无效的</code></strong></li><li>即 T1、T2 各开启一个事务,T2 修改了字段 A 的值,但是还没有提交,此时 T1 读取了这个没有提交的值。然后 T2 回滚了之前的对字段 A 的修改,那么此时 T1 读取的字段A 的值就是错误的,也就是<strong>脏读</strong></li></ul></li><li><p><code>不可重复读 (Non-Repeatable Read)</code></p><ul><li><strong>对于两个事务 T1、T2, <code>T1 读取了某个字段A</code>,之后<code>T2 又更新这个字段A </code>,之后 <code>T1再次读取字段 A</code>时发现与<code>值上次读取的值不一样</code>了,也就是<code>不可重复读</code></strong></li><li>我们在T1 中提交了几个<strong>隐式事务</strong>,这些事务中都对字段 A 进行了更新,每次提交完事务之后,T1 都可以读取到的值都是最新的值,这也是<strong>不可重复读</strong></li></ul></li><li><p><code>幻读 (Phantom)</code></p><ul><li><p><strong>对于两个事务 T1、T2,<code>T1 从表中读取了一些数据</code>,然后<code>T2 往该表中插入了一些数据</code>,然后 <code>T1 再次读取该表</code>时发现<code>表的数据多了</code>,这就是<code>幻读</code>,我们称 T2 插入的数据为<code>幻影记录</code></strong></p></li><li><p>T1 先根据查询条件查询某表得到结果集 A,然后 T2 向该表中又插入了几条数据,当 T1 再次查询的时候发现结果集变多了</p></li><li><mark>注意: 如果 T2 是删除了几条数据,那不算是幻读!</mark></li></ul></li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>问题的示意图</div><div class="admonitionContent_vXIg"><p><strong>1、脏写</strong></p><p>SessionA 的提交的数据被 SessionB 覆盖了(通过提交、回滚)</p><p><img loading="lazy" alt="image-20220805132827959" src="/assets/images/image-20220805132827959-ccaf6950c356c90a074e8f0cfe25dc27.png" width="1554" height="838" class="img_CujE"></p><br><p><strong>2.脏读</strong></p><p>SessionA读到了 SessionB 没有提交的事务中更新的数据</p><p><img loading="lazy" alt="image-20220805133345475" src="/assets/images/image-20220805133345475-4057a19636f1fdc6e4e6978e61779b77.png" width="1474" height="834" class="img_CujE"></p><br><p><strong>3.不可重复读</strong></p><p>SessionA 每次读表中的某条数据都不一样,因为 SessionB 一致在更新数据并提交事务</p><p><img loading="lazy" alt="image-20220805134029954" src="/assets/images/image-20220805134029954-0a23ee887f54138cbf90ca3021549a04.png" width="1508" height="1058" class="img_CujE"></p><br><p><strong>4.幻读</strong></p><p>SessionA 通过相同的查询条件去查询,每次得到的结果<strong>数量</strong>都会增加,因为SessionB <strong>插入</strong>了条数据</p><p><img loading="lazy" alt="image-20220805134252898" src="/assets/images/image-20220805134252898-de32d5215c7871eebeeebf059268c80a.png" width="1618" height="800" class="img_CujE"></p></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="sql的四种隔离级别">SQL的四种隔离级别<a class="hash-link" href="#sql的四种隔离级别" title="标题的直接链接">​</a></h3><blockquote><p>上面的几种并发事务执行过程的一些问题按照严重性来排序:<code>脏写 &gt; 脏读 &gt; 不可重复读 &gt; 幻读</code></p></blockquote><ul><li><p>我们可以舍弃一部分隔离性来换取一部分性能,在这里就体现在:<strong>设立一些隔离级别，隔离级别越低，并发问题发生的就越多</strong></p></li><li><p>SQL标准中设立了4个隔离级别 :</p><ul><li><code>READ UNCOMMITTED </code><ul><li><strong>读未提交</strong></li><li>在该隔离级别,所有事务都可以看到其他未提交事务的执行结果。</li><li><strong>不能避免脏读、不可重复读、幻读</strong></li></ul></li><li><code>READ COMMITTED</code><ul><li><strong>读已提交 =&gt; 类似于多线程直接读取共享数据</strong></li><li>满足了隔离的简单定义:<strong>一个事务只能看见已经提交事务所做的改变</strong>。这是大多数数据库系统的默认隔离级别(但<strong>不是MySQL默认的</strong>)</li><li><strong>可以避免脏读, 但不可重复读、幻读问题仍然存在</strong></li></ul></li><li><code>REPEATABLE READ </code><ul><li><strong>可重复读 <!-- -->[MySQL的默认隔离级别]<!-- --> =&gt; 类似于多线程将共享数据存入本地栈操作</strong></li><li>事务A在读到一条数据之后,此时事务B对该数据进行了修改并提交，那么事务A再读该数据，读到的还是原来的内容</li><li><strong>可以避免脏读、不可重复读，但幻读问题仍然存在</strong></li></ul></li><li><code>SERIALIZABLE</code><ul><li><strong>可串行化</strong></li><li>确保事务可以从一个表中读取相同的行, <strong>在这个事务持续期间,禁止其他事务对该表执行插入、更新和删除操作。所有的并发问题都可以避免，但性能十分低下</strong></li><li><strong>能避免脏读、不可重复读和幻读</strong></li></ul></li></ul></li><li><p>不同的隔离级别有不同的现象,并且<strong>有不同的锁和并发机制, 并且隔离级别越高,数据库的并发性能越低</strong></p></li><li><mark>需要注意的是,脏写是很严重的,所以所有的 DBMS 都会解决脏写的问题</mark></li></ul><p><img loading="lazy" alt="image-20220805140345680" src="/assets/images/image-20220805140345680-32e7479da555952684ebe721900393ee.png" width="1590" height="502" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="mysql-支持的四种隔离级别">MySQL 支持的四种隔离级别<a class="hash-link" href="#mysql-支持的四种隔离级别" title="标题的直接链接">​</a></h3><ul><li><p><strong>MySQL的默认隔离级别为<code>REPEATABLE READ</code></strong>，我们可以手动修改一下事务的隔离级别</p><ul><li>虽然默认隔离级别是<em>repeatable read</em>, 但是 InnoDB 实现的<a href="/docs/Mysql/高级特性/MVCC#%E8%A7%A3%E5%86%B3%E5%B9%BB%E8%AF%BB">MVCC机制</a>可以<code>在一定的程度上避免幻读的问题</code></li></ul></li><li><p><strong>查看 MySQL 的隔离级别</strong></p><ul><li><p>5.7.20的版本之前:</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SHOW</span><span class="token plain"> VARIABLES </span><span class="token operator" style="color:rgb(12, 150, 155)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;tx_isolation&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>5.7.20版本之后:</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SHOW</span><span class="token plain"> VARIABLES </span><span class="token operator" style="color:rgb(12, 150, 155)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;transaction_isolation&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>各个版本都支持的</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> @</span><span class="token variable" style="color:rgb(201, 103, 101)">@transaction_isolation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="如何设置事务隔离级别">如何设置事务隔离级别<a class="hash-link" href="#如何设置事务隔离级别" title="标题的直接链接">​</a></h3><ul><li><p><strong>语法格式1</strong></p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    隔离级别可选值:</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">         1. READ UNCOMMITTED</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">         2. READ COMMITTED</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">         3. REPEATABLE READ</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">         4. SERIALIZABLE</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">GLOBAL</span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token keyword" style="color:rgb(12, 150, 155)">SESSION</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">TRANSACTION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">ISOLATION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">LEVEL</span><span class="token plain"> 隔离级别</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>语法格式2 <!-- -->[推荐使用该方式]</strong> ✔️</p><div class="language-sql codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-sql codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    隔离级别可选值:</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">         1. READ-UNCOMMITTED</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">         2. READ-COMMITTED</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">         3. REPEATABLE-READ</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">         4. SERIALIZABLE</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token keyword" style="color:rgb(12, 150, 155)">GLOBAL</span><span class="token operator" style="color:rgb(12, 150, 155)">|</span><span class="token keyword" style="color:rgb(12, 150, 155)">SESSION</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> TRANSACTION_ISOLATION </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;隔离级别&#x27;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>设置隔离级别的示例</div><div class="admonitionContent_vXIg"><p><img loading="lazy" alt="image-20220805141705620" src="/assets/images/image-20220805141705620-dc1a0f3fe944f594c53d9beafa9e8ce7.png" width="1496" height="852" class="img_CujE"></p></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="不同隔离级别演示">不同隔离级别演示<a class="hash-link" href="#不同隔离级别演示" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_loeA" id="1读未提交">1.读未提交<a class="hash-link" href="#1读未提交" title="标题的直接链接">​</a></h4><blockquote><p>将事务的隔离级别设置为 <strong>READ-UNCOMMITTED</strong></p></blockquote><p><img loading="lazy" alt="image-20220805142257720" src="/assets/images/image-20220805142257720-26dad59dcd36aab5dedbdc5ec6c8647a.png" width="2044" height="610" class="img_CujE"></p><br><h4 class="anchor anchorWithStickyNavbar_loeA" id="2读已提交">2.读已提交<a class="hash-link" href="#2读已提交" title="标题的直接链接">​</a></h4><blockquote><p>将事务的隔离级别设置为 <strong>READ-COMMITTED</strong></p></blockquote><p><img loading="lazy" alt="image-20220805142356936" src="/assets/images/image-20220805142356936-2198fdf374045c84da389bf5a7d0d5ff.png" width="2070" height="916" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="3可重复读">3.可重复读<a class="hash-link" href="#3可重复读" title="标题的直接链接">​</a></h4><blockquote><p>将事务的隔离级别设置为 <strong>REPEATABLE-READ</strong></p></blockquote><p><img loading="lazy" alt="image-20220805142504885" src="/assets/images/image-20220805142504885-aacf4dd4fbd4e515d35b2e1701ce49e6.png" width="2078" height="830" class="img_CujE"></p><h2 class="anchor anchorWithStickyNavbar_loeA" id="事务分类">事务分类<a class="hash-link" href="#事务分类" title="标题的直接链接">​</a></h2><p>从事务的理论上说,可以把事务分为几种类型:</p><ol><li><code>扁平事务 (Flat Transactions)</code></li><li><code>带有保存点的扁平事务 (Flat Transactions With Savepoints )</code></li><li><code>链式事务 (Chained Transactions)</code></li><li><code>嵌套事务 (Nested Transactions)</code></li><li><code>分布式事务 (Distributed Transactions)</code></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="扁平事务">扁平事务<a class="hash-link" href="#扁平事务" title="标题的直接链接">​</a></h3><ul><li>是事务类型中最简单的一种,但是在实际生产环境中使用最为频繁的事务</li><li>在扁平事务中,所有的操作都处于同一个层次,有<strong>BEGIN WORK 开始,由 COMMIT WORK、ROLLBACK WORK 结束</strong>,中间的操作是原子的<ul><li>要么一起执行成功,要么一起执行失败</li><li><strong>由于使用简单和频繁,所以每个数据库都支持 扁平事务</strong></li></ul></li><li><strong>扁平事务的主要限制是不能提交或者回滚事务的某一部分,或者分步骤提交</strong></li><li>扁平事务一般有三种结果<ul><li>事务成功完成</li><li>应用程序要求停止事务,比如在程序中捕获到异常后回滚事务</li><li>外界因素强制终止事务,比如超时连接、连接断开</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="带保存点的扁平事务">带保存点的扁平事务<a class="hash-link" href="#带保存点的扁平事务" title="标题的直接链接">​</a></h3><ul><li><strong>除了支持扁平事务外,还允许事务执行过程中回滚到该事务中较早的一个状态(保存点)</strong><ul><li>因为某些事务可能在执行过程中不会导致所有的操作都无效,放弃整个事务相对不合理且开销大</li></ul></li><li><strong>保存点(SavePoint)</strong><ul><li><strong>用于通知事务系统记住事务的当前状态</strong>,以便当之后发生错误时,事务能回到保存点当时的状态</li><li>对于扁平事务来说<strong>,隐式的设置了一个保存点,且整个事务中只有这一个保存点</strong>,所以回滚只能回到事务最开始的时候</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="链式事务">链式事务<a class="hash-link" href="#链式事务" title="标题的直接链接">​</a></h3><ul><li><p>是指<strong>一个事务由多个子事务链式组成,可以被视为保存点模式的一个变种</strong>。带有保存点的扁平事务,当系统崩溃时,所有的保存点都会消失,意味着系统从崩溃恢复之后,事务需要从头开始重新执行,而不能从最近的一个保存点继续执行</p></li><li><p><strong>链式事务的思想:</strong></p><ul><li>在提交一个事务时,释放不需要的数据对象,将必要的处理上下文隐式的传给下一个要开始的事务,前一个子事务的提交操作和下一个子实物的开始操作合并成一个原子操作</li><li><strong>下一个事务可以看到上一个事务的结果,就好像在一个事务中进行一样,这样在提交子事务是就释放不需要的数据对象,而不是等整个事务完成后释放</strong></li></ul></li><li><p><strong>链式事务与带保存点的扁平事务的区别?</strong></p><ul><li>带保存点的扁平事务可以回滚到任意的正确的保存点,但是<strong>链式事务仅限于当前事务,只能回滚到最近的一个保存点</strong></li><li><code>对锁的处理,两个事务也不同</code><ul><li><strong>链式事务在执行 COMMIT 之后就释放了当前持有的锁</strong></li><li><strong>带有保存点的扁平事务不影响迄今为止所持有的锁</strong></li></ul></li></ul></li></ul><p><img loading="lazy" alt="image-20220805123736532" src="/assets/images/image-20220805123736532-054295c759a62150582775b9f3c2118a.png" width="1576" height="196" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="completion_type">completion_type<a class="hash-link" href="#completion_type" title="标题的直接链接">​</a></h4><p><code>completion_type</code>有三种取值</p><ol><li><p><strong>completion_type = 0  <!-- -->[默认情况]</strong> </p><ul><li>当执行 COMMIT 的时候会提交事务,执行下一个事务的时候还需要 BEGIN、START TRANSACTION 开启</li></ul></li><li><p><strong>completion_type = 1</strong></p><ul><li><p>这种情况,我们提交事务之后,相当于执行了<code>COMMIT AND CHAIN</code>,也就是<strong>开启了一个链式事务</strong></p></li><li><p><strong>即提交事务之后,还会自动开启一个相同隔离级别的事务</strong></p></li></ul></li><li><p><strong>completion_type = 2</strong></p><ul><li><p>这种情况下<code>COMMIT = COMMIT AND RELEASE</code></p></li><li><p><strong>也就是我们提交事务后,会自动与服务器断开连接</strong></p></li></ul></li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>测试链式事务</div><div class="admonitionContent_vXIg"><p><img loading="lazy" alt="image-20220805104249545" src="/assets/images/image-20220805104249545-35a75e5b06f01c0c5435cb77bcb1b490.png" width="2044" height="1620" class="img_CujE"></p></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="嵌套事务">嵌套事务<a class="hash-link" href="#嵌套事务" title="标题的直接链接">​</a></h3><ul><li>是一个层次结构框架,由一个<strong>顶层事务(Top-Level Transaction)</strong>控制各个层次的事务,顶层事务之下嵌套的事务被称为<strong>子事务(Subtransaction)</strong></li><li>它控制着每一个局部的变换,子事务本身也可以是嵌套事务。 </li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="分布式事务">分布式事务<a class="hash-link" href="#分布式事务" title="标题的直接链接">​</a></h3><p>通常是在<strong>分布式环境</strong>下运行的<strong>扁平事务</strong>,需要根据数据所在位置访问网络中不同节点的数据库资源</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MagicalZhu/NoteLib/tree/main/docs/Mysql/高级特性/事务基础.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_N_05" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">最后<!-- -->由 <b>YuLiang Zhu</b> <!-- -->于 <b><time datetime="2022-12-06T01:19:52.000Z">2022年12月6日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/事务与锁"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">事务与锁</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Mysql/高级特性/Redo日志"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Redo日志</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><p class="content_nRws">Contents</p><ul class="table-of-contents table-of-contents__left-border"><li><a href="#数据库事务" class="table-of-contents__link toc-highlight">数据库事务</a><ul><li><a href="#存储引擎的支持情况" class="table-of-contents__link toc-highlight">存储引擎的支持情况</a></li><li><a href="#基本概念" class="table-of-contents__link toc-highlight">基本概念</a></li><li><a href="#acid" class="table-of-contents__link toc-highlight">ACID</a><ul><li><a href="#atomicity" class="table-of-contents__link toc-highlight">atomicity</a></li><li><a href="#consistency" class="table-of-contents__link toc-highlight">consistency</a></li><li><a href="#isolation" class="table-of-contents__link toc-highlight">isolation</a></li><li><a href="#durability" class="table-of-contents__link toc-highlight">durability</a></li></ul></li><li><a href="#事务的状态" class="table-of-contents__link toc-highlight">事务的状态</a></li></ul></li><li><a href="#使用事务" class="table-of-contents__link toc-highlight">使用事务</a><ul><li><a href="#显式事务" class="table-of-contents__link toc-highlight">显式事务</a><ul><li><a href="#开启事务" class="table-of-contents__link toc-highlight">开启事务</a></li><li><a href="#提交回滚事务" class="table-of-contents__link toc-highlight">提交/回滚事务</a></li><li><a href="#savepoint" class="table-of-contents__link toc-highlight">SavePoint</a></li></ul></li><li><a href="#隐式事务" class="table-of-contents__link toc-highlight">隐式事务</a></li><li><a href="#隐式提交事务的情况" class="table-of-contents__link toc-highlight">隐式提交事务的情况</a></li></ul></li><li><a href="#事务隔离级别" class="table-of-contents__link toc-highlight">事务隔离级别</a><ul><li><a href="#数据准备" class="table-of-contents__link toc-highlight">数据准备</a></li><li><a href="#四种事务并发问题" class="table-of-contents__link toc-highlight">四种事务并发问题</a></li><li><a href="#sql的四种隔离级别" class="table-of-contents__link toc-highlight">SQL的四种隔离级别</a></li><li><a href="#mysql-支持的四种隔离级别" class="table-of-contents__link toc-highlight">MySQL 支持的四种隔离级别</a></li><li><a href="#如何设置事务隔离级别" class="table-of-contents__link toc-highlight">如何设置事务隔离级别</a></li><li><a href="#不同隔离级别演示" class="table-of-contents__link toc-highlight">不同隔离级别演示</a><ul><li><a href="#1读未提交" class="table-of-contents__link toc-highlight">1.读未提交</a></li><li><a href="#2读已提交" class="table-of-contents__link toc-highlight">2.读已提交</a></li><li><a href="#3可重复读" class="table-of-contents__link toc-highlight">3.可重复读</a></li></ul></li></ul></li><li><a href="#事务分类" class="table-of-contents__link toc-highlight">事务分类</a><ul><li><a href="#扁平事务" class="table-of-contents__link toc-highlight">扁平事务</a></li><li><a href="#带保存点的扁平事务" class="table-of-contents__link toc-highlight">带保存点的扁平事务</a></li><li><a href="#链式事务" class="table-of-contents__link toc-highlight">链式事务</a><ul><li><a href="#completion_type" class="table-of-contents__link toc-highlight">completion_type</a></li></ul></li><li><a href="#嵌套事务" class="table-of-contents__link toc-highlight">嵌套事务</a></li><li><a href="#分布式事务" class="table-of-contents__link toc-highlight">分布式事务</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">前端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://v3.cn.vuejs.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">React<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://ts.xcatliu.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TypeScript<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://developer.mozilla.org/zh-CN/docs/Web" target="_blank" rel="noopener noreferrer" class="footer__link-item">MDN<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">后端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spring<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">JVM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.infoq.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">InfoQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">文档构建</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://typoraio.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Typora<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 huakucha. Built With Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf86732a.js"></script>
<script src="/assets/js/main.98457ee6.js"></script>
</body>
</html>