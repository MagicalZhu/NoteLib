<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-SpringCloud/Alibaba/Sentinel">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">æœåŠ¡å®¹é”™-Sentinel | èŠ±è£¤è¡©Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" name="twitter:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" property="og:url" content="https://huakucha.com/docs/SpringCloud/Alibaba/Sentinel"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="æœåŠ¡å®¹é”™-Sentinel | èŠ±è£¤è¡©Wiki"><meta data-rh="true" name="description" content="1. Sentinel"><meta data-rh="true" property="og:description" content="1. Sentinel"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huakucha.com/docs/SpringCloud/Alibaba/Sentinel"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/SpringCloud/Alibaba/Sentinel" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/SpringCloud/Alibaba/Sentinel" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QZ9YPBGUYT-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="èŠ±è£¤è¡©Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="èŠ±è£¤è¡©Wiki Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="èŠ±è£¤è¡©Wiki JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="èŠ±è£¤è¡©Wiki" href="/opensearch.xml">

<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.font.im/css?family=Raleway:500,700&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.864d50a7.css">
<link rel="preload" href="/assets/js/runtime~main.bf86732a.js" as="script">
<link rel="preload" href="/assets/js/main.98457ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a href="#" class="skipToContent_D8pK">è·³åˆ°ä¸»è¦å†…å®¹</a></div><div class="announcementBar_s0pr" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="content_zf74 announcementBarContent_dpRF">ğŸŒŸæ¬¢è¿æ¥åˆ°èŠ±è£¤è¡©çš„åšå®¢ğŸŒŸ</div><button type="button" aria-label="å…³é—­" class="clean-btn close closeButton_ZdWa announcementBarClose_iXyO"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="èŠ±è£¤è¡©çš„åšå®¢" class="themedImage_Pn4p themedImage--light_PnYV"><img src="/img/logo.svg" alt="èŠ±è£¤è¡©çš„åšå®¢" class="themedImage_Pn4p themedImage--dark_eYgw"></div><b class="navbar__title text--truncate">èŠ±è£¤è¡©</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">åŸºç¡€çŸ¥è¯†ğŸ¤–</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/currency">å¹¶å‘ç¼–ç¨‹</a></li><li><a class="dropdown__link" href="/docs/networrk-basic">è®¡ç®—æœºç½‘ç»œ</a></li><li><a class="dropdown__link" href="/docs/linuxCommand">Linux</a></li><li><a class="dropdown__link" href="/docs/dataStructure">æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li><li><a class="dropdown__link" href="/docs/leetCode">LeetCode</a></li><li><a class="dropdown__link" href="/docs/mysql">MySQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">åç«¯æ¡†æ¶ğŸ‘¨â€ğŸ’»</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/spring">Spring</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/springCloud">SpringCloud</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">æ–¹æ³•è®ºğŸš§</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/distribute/protol">åˆ†å¸ƒå¼ç†è®º</a></li><li><a class="dropdown__link" href="/docs/distribute/basicTech">åˆ†å¸ƒå¼æŠ€æœ¯ç‚¹</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ä¸­é—´ä»¶ğŸš€</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/middleware/basicMiddleware">åŸºç¡€ä¸­é—´ä»¶</a></li><li><a class="dropdown__link" href="/docs/middleware/job">å®šæ—¶ä»»åŠ¡</a></li><li><a class="dropdown__link" href="/docs/middleware/cache">ç¼“å­˜</a></li><li><a class="dropdown__link" href="/docs/middleware/searchEngine">æœç´¢å¼•æ“</a></li><li><a class="dropdown__link" href="/docs/middleware/messageQueue">æ¶ˆæ¯é˜Ÿåˆ—</a></li><li><a class="dropdown__link" href="/docs/middleware/database">æ•°æ®åº“</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">åº•å±‚â›½ï¸</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/JVM">JVM</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">å‰ç«¯æŠ€æœ¯ğŸ‘©â€ğŸ’»</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/front/Vue">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">å…¶ä»–å·¥å…·ğŸ‘¹</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Gradle">Gradle</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ç‰©æ–™ä¸­å¿ƒğŸ‘</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/website/BE">åç«¯äº§å“</a></li><li><a class="dropdown__link" href="/website/COM">å…¶ä»–äº§å“</a></li><li><a class="dropdown__link" href="/website/FE">å‰ç«¯äº§å“</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.huakucha.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">å…³äº<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/MagicalZhu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_MW0i colorModeToggle_x44X"><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SFTY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ekgs"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_H2mL"><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_W2AM"><button aria-label="å›åˆ°é¡¶éƒ¨" class="clean-btn theme-back-to-top-button backToTopButton_ntye" type="button"></button><div class="docPage_qMb8"><aside class="theme-doc-sidebar-container docSidebarContainer_rpaz"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springCloud">ç®€ä»‹</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/å¾®æœåŠ¡åŸºç¡€">å¾®æœåŠ¡åŸºç¡€</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œå¾®æœåŠ¡åŸºç¡€ã€" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/å¾®æœåŠ¡æŠ€æœ¯æ ˆ">å¾®æœåŠ¡æŠ€æœ¯æ ˆ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/springcloud-netflix">SpringCloud-Netflix</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€ŒSpringCloud-Netflixã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/springcloud-alibaba">SpringCloud-Alibaba</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€ŒSpringCloud-Alibabaã€" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Alibaba/Nacos">æœåŠ¡æ³¨å†Œä¸é…ç½®ä¸­å¿ƒ-Nacos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/SpringCloud/Alibaba/Sentinel">æœåŠ¡å®¹é”™-Sentinel</a></li></ul></li></ul></li></ul></nav><button type="button" title="æ”¶èµ·ä¾§è¾¹æ " aria-label="æ”¶èµ·ä¾§è¾¹æ " class="button button--secondary button--outline collapseSidebarButton_JQG6"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Iseg"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="é¡µé¢è·¯å¾„"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ä¸»é¡µé¢" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SLhD"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/å¾®æœåŠ¡åŸºç¡€"><span itemprop="name">å¾®æœåŠ¡åŸºç¡€</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/springcloud-alibaba"><span itemprop="name">SpringCloud-Alibaba</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">æœåŠ¡å®¹é”™-Sentinel</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_IbkY theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_p7nN">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><header><h1>æœåŠ¡å®¹é”™-Sentinel</h1></header><h2 class="anchor anchorWithStickyNavbar_loeA" id="1-sentinel">1. Sentinel<a class="hash-link" href="#1-sentinel" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="11-sentinelæ¦‚è¿°">1.1 Sentinelæ¦‚è¿°<a class="hash-link" href="#11-sentinelæ¦‚è¿°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li><p>Sentinelæ˜¯<mark>åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µ</mark>, ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»<mark>æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§</mark></p></li><li><font color="red"><strong>å¸¸è§çš„å®¹é”™æ–¹æ¡ˆ</strong></font><ul><li><code>è¶…æ—¶</code></li><li><code>é™æµ</code></li><li><code>ä»“å£æ¨¡å¼</code>  <ul><li>ä¸€èˆ¬å¯ä»¥é€šè¿‡ å°†ä¸€ä¸ªæœåŠ¡æ”¾åœ¨çº¿ç¨‹æ± ä¸­ , é€šè¿‡çº¿ç¨‹æ± å°†å¤šä¸ªæœåŠ¡è¿›è¡Œéš”ç¦»</li></ul></li><li><code>æ–­è·¯å™¨æ¨¡å¼</code></li></ul></li><li><p>Sentinelå¯ä»¥å¤„ç†å“ªäº›é—®é¢˜?</p><ul><li>æœåŠ¡é›ªå´©</li><li>æœåŠ¡é™çº§</li><li>æœåŠ¡ç†”æ–­</li><li>æœåŠ¡é™æµ	</li></ul></li><li><font color="red">Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾</font><ul><li><mark>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</mark></li></ul></li><li><p>æ¯”å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰</p><ul><li><mark>å®Œå¤‡çš„å®æ—¶ç›‘æ§</mark></li><li><p>å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</p></li></ul></li><li><mark>å®Œå–„çš„ SPI æ‰©å±•ç‚¹</mark><ul><li>æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ï¼Œå¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰</li></ul></li><li><font color="red">Sentinelåˆ†ä¸ºä¸¤éƒ¨åˆ†</font><ul><li>æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰<ul><li>ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚</li></ul></li><li>æ§åˆ¶å°ï¼ˆDashboardï¼‰<ul><li>åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚</li></ul></li></ul></li><li><mark>æ³¨æ„ï¼šSentinel æ§åˆ¶å°ç›®å‰ä»…æ”¯æŒå•æœºéƒ¨ç½²ã€‚</mark></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="12-sentinel-åŸºæœ¬ç¯å¢ƒæ­å»º">1.2 Sentinel åŸºæœ¬ç¯å¢ƒæ­å»º<a class="hash-link" href="#12-sentinel-åŸºæœ¬ç¯å¢ƒæ­å»º" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_loeA" id="121-æ§åˆ¶å°æ­å»º">1.2.1 æ§åˆ¶å°æ­å»º<a class="hash-link" href="#121-æ§åˆ¶å°æ­å»º" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li><font color="red">Sentinel æ§åˆ¶å°æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ</font><ol><li><code>æŸ¥çœ‹æœºå™¨åˆ—è¡¨ä»¥åŠå¥åº·æƒ…å†µ</code><ul><li>æ”¶é›† Sentinel å®¢æˆ·ç«¯å‘é€çš„å¿ƒè·³åŒ…ï¼Œç”¨äºåˆ¤æ–­æœºå™¨æ˜¯å¦åœ¨çº¿</li></ul></li><li><code>ç›‘æ§ (å•æœºå’Œé›†ç¾¤èšåˆ)</code><ul><li>é€šè¿‡ Sentinel å®¢æˆ·ç«¯æš´éœ²çš„ç›‘æ§apiï¼Œå®šæœŸæ‹‰å–å¹¶ä¸”èšåˆåº”ç”¨ç›‘æ§ä¿¡æ¯ï¼Œæœ€ç»ˆå¯ä»¥å®ç°ç§’çº§çš„å®æ—¶ç›‘æ§ã€‚</li></ul></li><li><code>è§„åˆ™ç®¡ç†å’Œæ¨é€</code><ul><li>ç»Ÿä¸€ç®¡ç†æ¨é€è§„åˆ™</li></ul></li><li><code>é‰´æƒ</code></li></ol></li><li><font color="red">æ“ä½œæ­¥éª¤ï¼Ÿ</font><ol><li><a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">ä¸‹è½½æ§åˆ¶å°</a></li><li>å¯åŠ¨æ§åˆ¶å°<ul><li><code>-Dserver.port=8080</code><ul><li>ç”¨äºæŒ‡å®šæ§åˆ¶å°ç«¯å£ä¸º <code>8080</code></li></ul></li><li><code>-Dcsp.sentinel.dashboard.server=consoleIp:port</code> <ul><li>æŒ‡å®šæ§åˆ¶å°åœ°å€å’Œç«¯å£</li></ul></li><li><code>-Dproject.name=xxx</code><ul><li>æŒ‡å®šé¡¹ç›®åç§°</li></ul></li><li><code>-Dcsp.sentinel.log.dir</code><ul><li>æŒ‡å®šæ—¥å¿—è¾“å‡ºç›®å½•</li></ul></li><li><code>-Dcsp.sentinel.api.port=xxxx</code><ul><li>æŒ‡å®šå®¢æˆ·ç«¯ç›‘æ§ api çš„ç«¯å£,<mark>é»˜è®¤æ˜¯ 8719</mark></li></ul></li></ul></li></ol></li></ul><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">java -Dserver.port</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">8080</span><span class="token plain"> -Dcsp.sentinel.dashboard.server</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">localhost:8080 -Dproject.name</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">sentinel-dashboard -jar  </span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®¿é—®æ§åˆ¶å° http://localhost:8080, ç”¨æˆ·åå¯†ç é»˜è®¤æ˜¯ <code>sentinel</code></p><p>  <strong>â‘ ã€ å¯åŠ¨Sentinelæ§åˆ¶å°</strong></p><div class="language-shell codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-shell codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">java -Dserver.port</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token plain"> -Dcsp.sentinel.dashboard.server</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">localhost:8088 -Dproject.name</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">sentinel-dashboard -Dcsp.sentinel.log.dir</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">/Users/yoey/WorkSpace/Software/SpringCloud/sentinel/logs -jar sentinel-dashboard-1.8.0.jar</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  <strong>â‘¡ã€ è®¿é—®Sentinelæ§åˆ¶å°</strong></p><p>  <img loading="lazy" alt="image-20201219122039928" src="/assets/images/image-20201219122039928-d26288bcc28501aa352e88c41b087987.png" width="1455" height="676" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="122-sentinelå®¢æˆ·ç«¯nacosé›†ç¾¤sentinel">1.2.2 Sentinelå®¢æˆ·ç«¯(Nacosé›†ç¾¤+Sentinel)<a class="hash-link" href="#122-sentinelå®¢æˆ·ç«¯nacosé›†ç¾¤sentinel" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li><font color="red">æ“ä½œæ­¥éª¤</font><ol><li>å¼•å…¥ Nacos æœåŠ¡å‘ç°ä¸é…ç½®ä¸­å¿ƒçš„ä¾èµ–</li><li>å¼•å…¥Sentinelçš„ä¾èµ– <code>spring-cloud-starter-alibaba-sentinel</code></li><li>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé…ç½® Sentinelä¿¡æ¯,å¹¶ä¸”æš´éœ²actuator çš„ç›‘æ§ç«¯ç‚¹<ul><li><code>spring.cloud.sentinel.transport.dashboard</code><ul><li>æŒ‡å®šSentinel æ§åˆ¶å°çš„åœ°å€</li></ul></li><li><code>spring.cloud.sentinel.transport.port</code><ul><li>å®¢æˆ·ç«¯ç›‘æ§ API çš„ç«¯å£</li></ul></li></ul></li></ol></li></ul><p><strong>â‘ ã€ å¼•å…¥ä¾èµ–</strong></p><div class="language-xml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-xml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">&lt;!--Sentinel--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-sentinel</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">&lt;!--Nacos æœåŠ¡å‘ç°--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">&lt;!--Nacosé…ç½®ä¸­å¿ƒ--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-config</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>â‘¡ã€ ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><div class="language-yml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token key atrule">spring</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">provider</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token number" style="color:rgb(170, 9, 130)">8007</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">profiles</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">active</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">nacos</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">ip</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> 172.24.230.126</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">provider</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">sentinel</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># ä½¿ç”¨nginx æ­å»ºnacos é›†ç¾¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> 172.24.95.56</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># ä½¿ç”¨è‡ªå®šä¹‰çš„namespace id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> dev</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">coustom</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token number" style="color:rgb(170, 9, 130)">20201219</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> dev</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">coustom</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token number" style="color:rgb(170, 9, 130)">20201219</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> 172.24.95.56</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">prefix</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">provider</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token number" style="color:rgb(170, 9, 130)">8007</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">file-extension</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> yaml</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># é…ç½® Sentinel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">transport</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">dashboard</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8719</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># æš´éœ²actuatorç«¯ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">management</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">endpoints</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">web</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">exposure</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">include</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;*&#x27;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>â‘¢ã€ è¯·æ±‚æœåŠ¡ï¼ŒæŸ¥çœ‹Sentinel æ§åˆ¶å°</strong></p><p><img loading="lazy" alt="image-20201219154400132" src="/assets/images/image-20201219154400132-efef3dad80a479aae7835ed5d28420c1.png" width="1583" height="587" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="13-sentinelå·¥ä½œæµç¨‹-è´£ä»»é“¾æ¨¡å¼">1.3 Sentinelå·¥ä½œæµç¨‹ <!-- -->[è´£ä»»é“¾æ¨¡å¼]<a class="hash-link" href="#13-sentinelå·¥ä½œæµç¨‹-è´£ä»»é“¾æ¨¡å¼" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li>åœ¨ Sentinel é‡Œé¢ï¼Œæ‰€æœ‰çš„èµ„æºéƒ½å¯¹åº”ä¸€ä¸ªèµ„æºåç§°(<font color="red">resourceName</font> )ï¼Œæ¯æ¬¡èµ„æºè°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Entry å¯¹è±¡<ul><li>Entry å¯ä»¥é€šè¿‡å¯¹ä¸»æµæ¡†æ¶çš„é€‚é…è‡ªåŠ¨åˆ›å»ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ³¨è§£çš„æ–¹å¼æˆ–è°ƒç”¨ SphU API æ˜¾å¼åˆ›å»º</li><li>Entry åˆ›å»ºçš„æ—¶å€™ï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ›å»ºä¸€ç³»åˆ—åŠŸèƒ½æ’æ§½ï¼ˆslot chainï¼‰ï¼Œè¿™äº›æ’æ§½æœ‰ä¸åŒçš„èŒè´£ï¼Œä¾‹å¦‚:<ul><li><code>NodeSelectorSlot</code><ul><li><font color="purple">å»ºç«‹æ ‘çŠ¶ç»“æ„(è°ƒç”¨é“¾è·¯)</font></li><li>æ”¶é›†èµ„æºçš„è·¯å¾„ï¼Œå¹¶å°†è¿™äº›èµ„æºçš„è°ƒç”¨è·¯å¾„ï¼Œä»¥æ ‘çŠ¶ç»“æ„å­˜å‚¨èµ·æ¥ï¼Œç”¨äºæ ¹æ®è°ƒç”¨è·¯å¾„æ¥é™æµé™çº§ï¼›</li></ul></li><li><code>ClusterBuilderSlot</code><ul><li><font color="purple">æ ¹æ®èµ„æºä¿å­˜ç»Ÿè®¡ç°‡ç‚¹</font></li><li>å­˜å‚¨èµ„æºçš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠè°ƒç”¨è€…ä¿¡æ¯ï¼Œä¾‹å¦‚è¯¥èµ„æºçš„ RT, QPS, thread count ç­‰ç­‰ï¼Œè¿™äº›ä¿¡æ¯å°†ç”¨ä½œä¸ºå¤šç»´åº¦é™æµï¼Œé™çº§çš„ä¾æ®ï¼›</li></ul></li><li><code>StatisticSlot</code><ul><li><font color="purple">å®æ—¶æ•°æ®ç»Ÿè®¡</font></li><li>è®°å½•ã€ç»Ÿè®¡ä¸åŒçº¬åº¦çš„ runtime æŒ‡æ ‡ç›‘æ§ä¿¡æ¯ï¼›</li></ul></li><li><code>FlowSlot</code><ul><li><font color="purple">æµé‡æ§åˆ¶</font></li><li>åˆ™ç”¨äºæ ¹æ®é¢„è®¾çš„é™æµè§„åˆ™ä»¥åŠå‰é¢ slot ç»Ÿè®¡çš„çŠ¶æ€ï¼Œæ¥è¿›è¡Œæµé‡æ§åˆ¶ï¼›</li></ul></li><li><code>DegradeSlot</code><ul><li><font color="purple">ç†”æ–­é™çº§</font></li><li>é€šè¿‡ç»Ÿè®¡ä¿¡æ¯ä»¥åŠé¢„è®¾çš„è§„åˆ™ï¼Œæ¥åšç†”æ–­é™çº§ï¼›</li></ul></li><li><code>SystemSlot</code><ul><li><font color="purple">ç³»ç»Ÿè¿‡è½½ä¿æŠ¤</font></li><li>é€šè¿‡ç³»ç»Ÿçš„çŠ¶æ€ï¼Œä¾‹å¦‚ load1 ç­‰ï¼Œæ¥æ§åˆ¶æ€»çš„å…¥å£æµé‡</li></ul></li><li><code>AuthoritySlot</code><ul><li>æ ¹æ®é…ç½®çš„é»‘ç™½åå•å’Œè°ƒç”¨æ¥æºä¿¡æ¯ï¼Œæ¥åšé»‘ç™½åå•æ§åˆ¶ï¼›</li></ul></li></ul></li></ul></li></ul><p><strong>æ€»ä½“çš„æ¡†æ¶:</strong></p><p><img loading="lazy" alt="image-20201219161355142" src="/assets/images/image-20201219161355142-58f3c968fe4ffeaab3df994a577fd1df.png" width="1065" height="680" class="img_CujE"></p><ul><li><mark>Sentinel ä¹Ÿæ”¯æŒè‡ªå®šä¹‰Slot æ‹“å±•</mark><ul><li>Sentinel å°† <code>ProcessorSlot</code> ä½œä¸º SPI æ¥å£è¿›è¡Œæ‰©å±•ï¼Œä½¿å¾— Slot Chain å…·å¤‡äº†æ‰©å±•çš„èƒ½åŠ›ã€‚</li></ul></li></ul><p><img loading="lazy" alt="alt" src="/assets/images/image-20201220130706656-4ee057c0b619b603a5990fba5e578b75.png" width="880" height="269" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="14-sentinelè§„åˆ™">1.4 Sentinelè§„åˆ™<a class="hash-link" href="#14-sentinelè§„åˆ™" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li><mark>Sentinel çš„æ‰€æœ‰è§„åˆ™éƒ½å¯ä»¥åœ¨å†…å­˜æ€ä¸­åŠ¨æ€åœ°æŸ¥è¯¢åŠä¿®æ”¹ï¼Œä¿®æ”¹ä¹‹åç«‹å³ç”Ÿæ•ˆã€‚åŒæ—¶ Sentinel ä¹Ÿæä¾›ç›¸å…³ APIï¼Œæ¥å®šåˆ¶è‡ªå·±çš„è§„åˆ™ç­–ç•¥</mark></li><li><font color="red">å¸¸è§çš„è§„åˆ™ç§ç±»</font><ul><li><code>æµé‡æ§åˆ¶</code></li><li><code>ç†”æ–­é™çº§</code></li><li><code>ç³»ç»Ÿä¿æŠ¤</code></li><li><code>æ¥æºè®¿é—®æ§åˆ¶</code></li><li><code>çƒ­ç‚¹å‚æ•°</code></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="2-sentinelè§„åˆ™-æµæ§è§„åˆ™flowrule">2. Sentinelè§„åˆ™-æµæ§è§„åˆ™(FlowRule)<a class="hash-link" href="#2-sentinelè§„åˆ™-æµæ§è§„åˆ™flowrule" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ul><li><font color="red">æµé‡æ§åˆ¶</font><ul><li><mark>é€šè¿‡<font color="red">ç›‘æ§åº”ç”¨æµé‡çš„ QPS æˆ–å¹¶å‘çº¿ç¨‹æ•°ç­‰æŒ‡æ ‡</font>ï¼Œå½“è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼æ—¶å¯¹æµé‡è¿›è¡Œæ§åˆ¶ï¼Œä»¥é¿å…è¢«ç¬æ—¶çš„æµé‡é«˜å³°å†²å®ï¼Œä»è€Œä¿éšœåº”ç”¨çš„é«˜å¯ç”¨æ€§</mark></li><li><code>FlowSlot</code> ä¼šæ ¹æ®é¢„è®¾çš„è§„åˆ™(FlowRule)ï¼Œç»“åˆ <code>NodeSelectorSlot</code>ã€<code>ClusterBuilderSlot</code>ã€<code>StatisticSlot</code> ç»Ÿè®¡å‡ºæ¥çš„å®æ—¶ä¿¡æ¯è¿›è¡Œæµé‡æ§åˆ¶</li></ul></li></ul><p><img loading="lazy" alt="image-20201222193547149" src="/assets/images/image-20201222193547149-0724d0017217647be87b9d7f686b5762.png" width="1115" height="299" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="20-é™æµè§„åˆ™è¯´æ˜">2.0 é™æµè§„åˆ™è¯´æ˜<a class="hash-link" href="#20-é™æµè§„åˆ™è¯´æ˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li><font color="red">åŒä¸€ä¸ªèµ„æºå¯ä»¥åˆ›å»ºå¤šæ¡é™æµè§„åˆ™</font><ul><li><code>FlowSlot</code> ä¼šå¯¹è¯¥èµ„æºçš„æ‰€æœ‰é™æµè§„åˆ™ä¾æ¬¡éå†ï¼Œç›´åˆ°æœ‰è§„åˆ™è§¦å‘é™æµæˆ–è€…æ‰€æœ‰è§„åˆ™éå†å®Œæ¯•</li></ul></li><li><p><strong>ä¸€æ¡é™æµè§„åˆ™ä¸»è¦ç”±ä¸‹é¢å‡ ä¸ªå› ç´ ç»„æˆï¼Œé€šè¿‡ç»„åˆè¿™äº›å…ƒç´ æ¥å®ç°ä¸åŒçš„é™æµæ•ˆæœ</strong>ï¼š</p></li></ul><table><thead><tr><th>Field</th><th>è¯´æ˜</th><th>å¯é€‰å€¼</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><font color="red"><code>resource</code></font></td><td>èµ„æºåï¼Œå³é™æµè§„åˆ™çš„ä½œç”¨å¯¹è±¡</td><td></td><td>è¯·æ±‚è·¯å¾„PATH</td></tr><tr><td><font color="red"><code>count</code></font></td><td>é™æµé˜ˆå€¼</td><td></td><td></td></tr><tr><td><font color="red"><code>grade</code></font></td><td>é™æµé˜ˆå€¼ç±»å‹ <mark>(QPS æˆ–å¹¶å‘çº¿ç¨‹æ•°)</mark></td><td><font color="red"><code>0</code></font> : å¹¶å‘çº¿ç¨‹æ¨¡å¼   <font color="red"><code>1</code></font> : QPSæ¨¡å¼</td><td>QPS æ¨¡å¼</td></tr><tr><td><font color="red"><code>limitApp</code></font></td><td>æµé‡æ§åˆ¶é’ˆå¯¹çš„è°ƒç”¨æ¥æº</td><td></td><td>é»˜è®¤ä¸º <font color="red"><code>default</code></font>ï¼Œä¸åŒºåˆ†è°ƒç”¨æ¥æº</td></tr><tr><td><font color="red"><code>strategy</code></font></td><td>é™æµæ¨¡å¼  (<font color="red">ç›´æ¥ã€é“¾è·¯ã€å…³è”</font>)</td><td></td><td>æ ¹æ®èµ„æºæœ¬èº«ï¼ˆ<font color="red">ç›´æ¥</font>ï¼‰</td></tr><tr><td><font color="red"><code>controlBehavior</code></font></td><td>QPSé™æµæ•ˆæœ,ä¸æ”¯æŒæŒ‰è°ƒç”¨å…³ç³»é™æµ</td><td>ç›´æ¥æ‹’ç»ã€Warm Upã€åŒ€é€Ÿæ’é˜Ÿ</td><td>ç›´æ¥æ‹’ç»</td></tr><tr><td><font color="red"><code>clusterMode</code></font></td><td>æ˜¯å¦é›†ç¾¤é™æµ</td><td></td><td>å¦</td></tr><tr><td><font color="red"><code>maxQueueingTimeMs</code></font></td><td>æœ€å¤§æ’é˜Ÿç­‰å¾…æ—¶é•¿</td><td></td><td></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_loeA" id="21-é™æµé˜ˆå€¼ç»Ÿè®¡æ–¹å¼">2.1 é™æµé˜ˆå€¼ç»Ÿè®¡æ–¹å¼<a class="hash-link" href="#21-é™æµé˜ˆå€¼ç»Ÿè®¡æ–¹å¼" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li><p>ä¸»è¦æœ‰ä¸¤ç§é˜ˆå€¼ç»Ÿè®¡ç±»å‹, <mark>å…¶ä¸­çº¿ç¨‹æ•°ã€QPS å€¼ï¼Œéƒ½æ˜¯ç”± <font color="red">StatisticSlot</font>å®æ—¶ç»Ÿè®¡è·å–çš„</mark> </p></li><li><font color="red">ç»Ÿè®¡å¹¶å‘çº¿ç¨‹æ•° -&gt; FlowSlot.grade=0</font><ul><li>é‡‡ç”¨JMeter ç­‰å‹æµ‹å·¥å…·è¿›è¡Œæµ‹è¯•</li></ul></li><li><font color="red">ç»Ÿè®¡QPSÂ -&gt; FlowSlot.grade=1</font></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="211-åŸºäºå¹¶å‘çº¿ç¨‹æ•°æœåŠ¡ç«¯æœ€å¤šå…è®¸å¤šå°‘çº¿ç¨‹å¤„ç†è¯·æ±‚">2.1.1 åŸºäºå¹¶å‘çº¿ç¨‹æ•°ï¼ˆæœåŠ¡ç«¯æœ€å¤šå…è®¸å¤šå°‘çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼‰<a class="hash-link" href="#211-åŸºäºå¹¶å‘çº¿ç¨‹æ•°æœåŠ¡ç«¯æœ€å¤šå…è®¸å¤šå°‘çº¿ç¨‹å¤„ç†è¯·æ±‚" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li><font color="red">å¹¶å‘æ•°æ§åˆ¶ç”¨äºä¿æŠ¤ä¸šåŠ¡çº¿ç¨‹æ± ä¸è¢«æ…¢è°ƒç”¨è€—å°½</font><ul><li>æ¯”å¦‚åº”ç”¨æ‰€ä¾èµ–çš„ä¸‹æ¸¸åº”ç”¨ç”±äºæŸç§åŸå› å¯¼è‡´æœåŠ¡ä¸ç¨³å®šã€å“åº”å»¶è¿Ÿå¢åŠ ï¼Œå¯¹äºè°ƒç”¨è€…æ¥è¯´ï¼Œæ„å‘³ç€ååé‡ä¸‹é™å’Œæ›´å¤šçš„çº¿ç¨‹æ•°å ç”¨ï¼Œæç«¯æƒ…å†µä¸‹ç”šè‡³å¯¼è‡´çº¿ç¨‹æ± è€—å°½</li></ul></li><li><p>Sentinel å¹¶å‘æ§åˆ¶ä¸è´Ÿè´£åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹æ± ï¼Œè€Œæ˜¯ç®€å•ç»Ÿè®¡å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡çš„çº¿ç¨‹æ•°ç›®ï¼ˆæ­£åœ¨æ‰§è¡Œçš„è°ƒç”¨æ•°ç›®ï¼‰</p><ul><li>å¦‚æœè¶…å‡ºé˜ˆå€¼ï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»ï¼Œæ•ˆæœç±»ä¼¼äºä¿¡å·é‡éš”ç¦»</li></ul></li><li><font color="red">çº¿ç¨‹å¹¶å‘æ•°æ§åˆ¶é€šå¸¸åœ¨è°ƒç”¨ç«¯è¿›è¡Œé…ç½®</font></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="212-åŸºäºqpsæ¯ç§’æœ€å¤šå…è®¸å¤šå°‘è¯·æ±‚è¿›å…¥æœåŠ¡ç«¯å¤„ç†">2.1.2 åŸºäºQPSï¼ˆæ¯ç§’æœ€å¤šå…è®¸å¤šå°‘è¯·æ±‚è¿›å…¥æœåŠ¡ç«¯å¤„ç†ï¼‰<a class="hash-link" href="#212-åŸºäºqpsæ¯ç§’æœ€å¤šå…è®¸å¤šå°‘è¯·æ±‚è¿›å…¥æœåŠ¡ç«¯å¤„ç†" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li>å½“ QPS è¶…è¿‡æŒ‡å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼Œåˆ™é‡‡å–æªæ–½è¿›è¡Œé™æµ,<mark>ä¸»è¦æœ‰ä¸‹é¢ä¸‰ç§é™æµè¡Œä¸º</mark><ul><li><code>å¿«é€Ÿå¤±è´¥ (é»˜è®¤)</code></li><li><code>Warm Up -&gt; é¢„çƒ­/å†·å¯åŠ¨</code></li><li><code>æ’é˜Ÿç­‰å¾…</code></li></ul></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="2121-é™æµæ•ˆæœ-å¿«é€Ÿå¤±è´¥é»˜è®¤">2.1.2.1 é™æµæ•ˆæœ-å¿«é€Ÿå¤±è´¥ï¼ˆé»˜è®¤ï¼‰<a class="hash-link" href="#2121-é™æµæ•ˆæœ-å¿«é€Ÿå¤±è´¥é»˜è®¤" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><ul><li><font color="red">RuleConstant.CONTROL_BEHAVIOR_DEFAULT</font></li><li>å½“QPSè¶…è¿‡ä»»æ„è§„åˆ™çš„é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚å°±ä¼šè¢«ç«‹å³æ‹’ç»ï¼Œæ‹’ç»æ–¹å¼ä¸ºæŠ›å‡º<code>FlowException</code></li><li>æºç : <code>com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController</code></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="2122-é™æµæ•ˆæœ-å†·å¯åŠ¨">2.1.2.2 é™æµæ•ˆæœ-å†·å¯åŠ¨<a class="hash-link" href="#2122-é™æµæ•ˆæœ-å†·å¯åŠ¨" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><ul><li><font color="red">RuleConstant.CONTROL_BEHAVIOR_WARM_UP</font></li><li>è®©é€šè¿‡çš„æµé‡ç¼“æ…¢å¢åŠ ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…é€æ¸å¢åŠ åˆ°é˜ˆå€¼ä¸Šé™ï¼Œç»™å†·ç³»ç»Ÿä¸€ä¸ªé¢„çƒ­çš„æ—¶é—´ï¼Œé¿å…å†·ç³»ç»Ÿè¢«å‹å®</li><li><font color="red">é»˜è®¤<code>å†·åŠ è½½å› å­</code>coldFactorä¸º3ï¼Œå³è¯·æ±‚QPSä»threshold/3å¼€å§‹ï¼Œç»æŒ‡å®šçš„é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„QPSé˜ˆå€¼ã€‚</font></li><li>é€‚ç”¨åœºæ™¯<ul><li>è¿™ä¸ªåœºæ™¯ä¸»è¦ç”¨äºå¯åŠ¨éœ€è¦é¢å¤–å¼€é”€çš„åœºæ™¯ï¼Œä¾‹å¦‚å»ºç«‹æ•°æ®åº“è¿æ¥ç­‰</li></ul></li><li>æºç : <code>com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController</code></li></ul><h6 class="anchor anchorWithStickyNavbar_loeA" id="21221-è®¾ç½®è§„åˆ™æ§åˆ¶å°">2.1.2.2.1 è®¾ç½®è§„åˆ™(æ§åˆ¶å°)<a class="hash-link" href="#21221-è®¾ç½®è§„åˆ™æ§åˆ¶å°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><p>ä¸‹å›¾è¡¨ç¤º: èµ„æºåœ¨å‰30sçš„QPSé˜ˆå€¼ä¸º 20/3â‰ˆ6,ç»è¿‡30sçš„ç³»ç»Ÿé¢„çƒ­åï¼ŒQPS é˜ˆå€¼ç¨³æ­¥çš„æå‡åˆ° 20</p><p><img loading="lazy" src="/assets/images/image-20201221095044809-a4416584a23e2494e07b5465440b12ae.png" width="657" height="511" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="21222-è®¾ç½®è§„åˆ™ä»£ç ">2.1.2.2.2 è®¾ç½®è§„åˆ™(ä»£ç )<a class="hash-link" href="#21222-è®¾ç½®è§„åˆ™ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><ul><li><font color="red">æ–¹æ³•å«ä¹‰è¯´æ˜</font><ol><li><code>rule.setCount</code><ul><li>é¢„çƒ­å®Œæˆåï¼Œè¯·æ±‚æ‰€è¾¾åˆ°çš„æœ€ç»ˆé˜ˆå€¼</li></ul></li><li><code>rule.setWarmUpPeriodSec</code><ul><li>å†·ç³»ç»Ÿé¢„çƒ­æ‰€éœ€æ—¶é—´</li></ul></li></ol></li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* åŸºäºQPS å†·å¯åŠ¨é™æµ</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">InitWarmUpQPSFlow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CollectionUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">isEmpty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rules</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Lists</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">newArrayList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é˜ˆå€¼ç±»å‹-&gt; qps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStrategy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">STRATEGY_DIRECT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é™æµæ•ˆæœ-&gt;é¢„çƒ­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_WARM_UP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é¢„çƒ­åæ¯ç§’å…è®¸é€šè¿‡20ä¸ª</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®éœ€è¦5s çš„é¢„çƒ­æ—¶é—´</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setWarmUpPeriodSec</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">30</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_loeA" id="2123-é™æµæ•ˆæœ-æ’é˜Ÿç­‰å¾…">2.1.2.3 é™æµæ•ˆæœ-æ’é˜Ÿç­‰å¾…<a class="hash-link" href="#2123-é™æµæ•ˆæœ-æ’é˜Ÿç­‰å¾…" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><ul><li><p>è¯´æ˜</p><ul><li><font color="red">RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER</font></li><li>è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³• -&gt; åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼æš‚æ—¶ä¸æ”¯æŒ QPS &gt; 1000 çš„åœºæ™¯</li></ul></li><li><font color="red">ä¸­å¿ƒæ€æƒ³</font><ul><li>ä»¥å›ºå®šçš„é—´éš”æ—¶é—´è®©è¯·æ±‚é€šè¿‡ï¼Œå½“è¯·æ±‚åˆ°æ¥çš„æ—¶å€™<ul><li>å¦‚æœå½“å‰è¯·æ±‚è·ç¦»ä¸Šä¸ªé€šè¿‡çš„è¯·æ±‚é€šè¿‡çš„æ—¶é—´é—´éš”ä¸å°äºé¢„è®¾å€¼ï¼Œåˆ™è®©å½“å‰è¯·æ±‚é€šè¿‡</li><li>å¦åˆ™ï¼Œè®¡ç®—å½“å‰è¯·æ±‚çš„é¢„æœŸé€šè¿‡æ—¶é—´<ul><li>å¦‚æœè¯¥è¯·æ±‚çš„é¢„æœŸé€šè¿‡æ—¶é—´å°äºè§„åˆ™é¢„è®¾çš„æœ€å¤§æ’é˜Ÿæ—¶é•¿æ—¶é—´ï¼Œåˆ™è¯¥è¯·æ±‚ä¼šç­‰å¾…ç›´åˆ°é¢„è®¾æ—¶é—´åˆ°æ¥é€šè¿‡ï¼ˆæ’é˜Ÿç­‰å¾…å¤„ç†ï¼‰<ul><li><mark><font color="red">ä¹Ÿå°±æ˜¯å°†è¯·æ±‚æ”¾åœ¨è™šæ‹Ÿé˜Ÿåˆ—ä¸­ï¼</font></mark></li></ul></li><li>è‹¥é¢„æœŸçš„é€šè¿‡æ—¶é—´è¶…å‡ºæœ€å¤§æ’é˜Ÿæ—¶é•¿ï¼Œåˆ™ç›´æ¥æ‹’æ¥è¿™ä¸ªè¯·æ±‚</li></ul></li></ul></li></ul></li><li><p>é€‚ç”¨åœºæ™¯</p><ul><li>é€‚åˆç”¨äºè¯·æ±‚ä»¥çªåˆºçŠ¶æ¥åˆ°ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›ä¸€ä¸‹å­æŠŠæ‰€æœ‰çš„è¯·æ±‚éƒ½é€šè¿‡ï¼Œè¿™æ ·å¯èƒ½ä¼šæŠŠç³»ç»Ÿå‹å®ï¼›åŒæ—¶æˆ‘ä»¬ä¹ŸæœŸå¾…ç³»ç»Ÿä»¥ç¨³å®šçš„é€Ÿåº¦ï¼Œé€æ­¥å¤„ç†è¿™äº›è¯·æ±‚ï¼Œä»¥èµ·åˆ°â€œå‰Šå³°å¡«è°·â€çš„æ•ˆæœï¼Œè€Œä¸æ˜¯æ‹’ç»æ‰€æœ‰è¯·æ±‚</li></ul></li></ul><h6 class="anchor anchorWithStickyNavbar_loeA" id="21231-è®¾ç½®è§„åˆ™æ§åˆ¶å°">2.1.2.3.1 è®¾ç½®è§„åˆ™(æ§åˆ¶å°)<a class="hash-link" href="#21231-è®¾ç½®è§„åˆ™æ§åˆ¶å°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><p><img loading="lazy" src="/assets/images/image-20201221090343257-652833158d8c6d35d38f854ab6fb14fa.png" width="665" height="510" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="21232-è®¾ç½®è§„åˆ™ä»£ç ">2.1.2.3.2 è®¾ç½®è§„åˆ™(ä»£ç )<a class="hash-link" href="#21232-è®¾ç½®è§„åˆ™ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><ul><li><font color="red">æ–¹æ³•å«ä¹‰è¯´æ˜</font><ol><li><code>rule.setCount</code><ul><li>æ­¤æ—¶è¡¨ç¤ºæ¯ä¸€ç§’å…è®¸é€šè¿‡çš„è¯·æ±‚æ•°ï¼Œè¶…è¿‡çš„è¯·æ±‚ä¼šæ”¾åœ¨è™šæ‹Ÿé˜Ÿåˆ—ä¸­è¿›è¡Œç­‰å¾…</li><li>å¦‚æœè®¾ç½®ä¸º10ï¼Œé‚£ä¹ˆæ¯ä¸ªè¯·æ±‚å¹³å‡é—´éš”æ’å®šä¸º <code>1000 / 10 = 100 ms</code></li></ul></li><li><code>rule.setMaxQueueingTimeMs</code><ul><li>è™šæ‹Ÿé˜Ÿåˆ—ä¸­è¯·æ±‚å…è®¸çš„æœ€å¤§ç­‰å¾…æ—¶é—´ -&gt; è¶…æ—¶æ—¶é—´</li></ul></li></ol></li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* åŸºäºQPS æ’é˜Ÿç­‰å¾…é™æµ</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">InitRateLimiterQPSFlow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CollectionUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">isEmpty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rules</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Lists</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">newArrayList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é˜ˆå€¼ç±»å‹-&gt; qps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// æ¯ä¸€ç§’åŒ€é€Ÿé€šè¿‡5ä¸ªè¯·æ±‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é™æµæ¨¡å¼ -&gt; ç›´æ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStrategy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">STRATEGY_DIRECT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é™æµæ•ˆæœ-&gt;åŒ€é€Ÿæ’é˜Ÿ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_RATE_LIMITER</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// æ¯ä¸€ä¸ªè¯·æ±‚çš„æœ€é•¿é•¿æ’é˜Ÿç­‰å¾…æ—¶é—´: 20s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setMaxQueueingTimeMs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">1000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    æ§åˆ¶å°è¾“å‡º :å¯ä»¥çœ‹åˆ°è¯·æ±‚ä»¥æ¯1sé€šè¿‡5ä¸ªçš„é€Ÿç‡é€šè¿‡</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    2020-12-21 09:10:42.028  WARN 1967 --- [nio-8007-exec-3] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:42.231  WARN 1967 --- [nio-8007-exec-4] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:42.429  WARN 1967 --- [nio-8007-exec-5] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:42.631  WARN 1967 --- [nio-8007-exec-6] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:42.825  WARN 1967 --- [nio-8007-exec-7] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.029  WARN 1967 --- [nio-8007-exec-8] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.431  WARN 1967 --- [nio-8007-exec-9] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.227  WARN 1967 --- [io-8007-exec-10] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.625  WARN 1967 --- [nio-8007-exec-1] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.829  WARN 1967 --- [nio-8007-exec-2] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="22-é™æµæ¨¡å¼">2.2 é™æµæ¨¡å¼<a class="hash-link" href="#22-é™æµæ¨¡å¼" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li><mark>é€‚ç”¨åŸºäºQPS å’Œå¹¶å‘çº¿ç¨‹æ•°çš„é˜ˆå€¼ç±»å‹</mark></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="221-é™æµæ¨¡å¼---ç›´æ¥-é™åˆ¶èµ„æºæœ¬èº«">2.2.1 é™æµæ¨¡å¼ - ç›´æ¥ ï¼ˆé™åˆ¶èµ„æºæœ¬èº«ï¼‰<a class="hash-link" href="#221-é™æµæ¨¡å¼---ç›´æ¥-é™åˆ¶èµ„æºæœ¬èº«" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li><font color="red">RuleConstant.STRATEGY_DIRECT</font></li><li>æŒ‡å®šçš„èµ„æºåˆ°è¾¾é™æµé˜ˆå€¼æ—¶ï¼Œå°±å¯¹è¯¥èµ„æºè¿›è¡Œé™æµ</li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="2211-è®¾ç½®è§„åˆ™æ§åˆ¶å°">2.2.1.1 è®¾ç½®è§„åˆ™(æ§åˆ¶å°)<a class="hash-link" href="#2211-è®¾ç½®è§„åˆ™æ§åˆ¶å°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><p><img loading="lazy" src="/assets/images/image-20201220151904290-36abb2262677d313fbc31c4502dd4e3f.png" width="670" height="476" class="img_CujE"></p><h5 class="anchor anchorWithStickyNavbar_loeA" id="2212-è®¾ç½®è§„åˆ™ä»£ç ">2.2.1.2 è®¾ç½®è§„åˆ™(ä»£ç )<a class="hash-link" href="#2212-è®¾ç½®è§„åˆ™ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><ul><li><font color="red">æ“ä½œæ­¥éª¤</font><ul><li>é€šè¿‡ <code>FlowRuleManager.loadRules(List&lt;FlowRule&gt; rules)</code> æ–¹æ³•åŠ è½½æµæ§è§„åˆ™</li></ul></li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowConfig</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">CommandLineRunner</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// æŒ‡å®šèµ„æºå</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é™æµé˜ˆå€¼ç±»å‹-&gt; qps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é™æµé˜ˆå€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1d</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é™æµæ¨¡å¼ -&gt; ç›´æ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStrategy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">STRATEGY_DIRECT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é™æµè¡Œä¸º-&gt;å¿«é€Ÿå¤±è´¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_DEFAULT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CollectionUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">isEmpty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            rules</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Lists</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">newArrayList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="222-é™æµæ¨¡å¼---å…³è”-é™åˆ¶ä¸Šæ¸¸èµ„æº">2.2.2 é™æµæ¨¡å¼ - å…³è” (é™åˆ¶ä¸Šæ¸¸èµ„æº)<a class="hash-link" href="#222-é™æµæ¨¡å¼---å…³è”-é™åˆ¶ä¸Šæ¸¸èµ„æº" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li><font color="red">RuleConstant.STRATEGY_RELATE</font><ul><li>èµ„æºAæœ¬èº«ä¸€èˆ¬ä¸ä¼šè®¾ç½®é˜ˆå€¼</li><li>å½“èµ„æºAçš„å…³è”çš„èµ„æºBåˆ°è¾¾é™æµé˜ˆå€¼æ—¶ï¼Œå°±é™æµèµ„æºA</li></ul></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="2221-è®¾ç½®è§„åˆ™æ§åˆ¶å°">2.2.2.1 è®¾ç½®è§„åˆ™(æ§åˆ¶å°)<a class="hash-link" href="#2221-è®¾ç½®è§„åˆ™æ§åˆ¶å°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><p><img loading="lazy" src="/assets/images/image-20201220164747762-aa16fe5e1b5f37e4109839b3091b1080.png" width="675" height="531" class="img_CujE"></p><h5 class="anchor anchorWithStickyNavbar_loeA" id="2222-è®¾ç½®è§„åˆ™ä»£ç ">2.2.2.2 è®¾ç½®è§„åˆ™(ä»£ç )<a class="hash-link" href="#2222-è®¾ç½®è§„åˆ™ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* åŸºäºQPS  å…³è”é™æµ</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">InitRelateQPSFlow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CollectionUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">isEmpty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rules</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Lists</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">newArrayList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  * èµ„æºA</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// é™æµæ¨¡å¼ -&gt; å…³è”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStrategy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">STRATEGY_RELATE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_DEFAULT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  * èµ„æºB</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> relateRule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo2&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_DEFAULT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setRefResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">relateRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="223-é™æµæ¨¡å¼---é“¾è·¯">2.2.3 é™æµæ¨¡å¼ - é“¾è·¯<a class="hash-link" href="#223-é™æµæ¨¡å¼---é“¾è·¯" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li><font color="red">RuleConstant.STRATEGY_CHAIN</font></li><li>åªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡ï¼Œå¦‚æœåˆ°è¾¾é˜ˆå€¼å°±é™æµ</li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="3sentinelè§„åˆ™-ç†”æ–­é™çº§degraderule">3.Sentinelè§„åˆ™-ç†”æ–­é™çº§(DegradeRule)<a class="hash-link" href="#3sentinelè§„åˆ™-ç†”æ–­é™çº§degraderule" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="31-ç†”æ–­é™çº§è¯´æ˜">3.1 ç†”æ–­é™çº§è¯´æ˜<a class="hash-link" href="#31-ç†”æ–­é™çº§è¯´æ˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ol><li>é™¤äº†æµé‡æ§åˆ¶ä¹‹å¤–ï¼Œå¯¹è°ƒç”¨é“¾è·¯ä¸­<code>ä¸ç¨³å®šçš„èµ„æºè¿›è¡Œç†”æ–­é™çº§</code>ä¹Ÿæ˜¯ä¿éšœé«˜å¯ç”¨çš„é‡è¦æªæ–½ä¹‹ä¸€ã€‚</li><li>ä¸€ä¸ªæœåŠ¡é€šå¸¸ä¼šè°ƒç”¨å…¶ä»–çš„æœåŠ¡ï¼Œä¾èµ–çš„æœåŠ¡çš„ç¨³å®šæ€§æ— æ³•ä¿è¯å¦‚æœä¾èµ–çš„æœåŠ¡è¯·æ±‚å“åº”æ—¶é—´å˜é•¿ï¼Œé‚£ä¹ˆè°ƒç”¨æœåŠ¡çš„æ–¹æ³•çš„å“åº”æ—¶é—´ä¹Ÿä¼šå˜é•¿ï¼Œ<font color="red">çº¿ç¨‹ä¼šå †ç§¯ï¼Œæœ€ç»ˆå¯èƒ½è€—å°½ä¸šåŠ¡è‡ªèº«çš„çº¿ç¨‹èµ„æºï¼ŒæœåŠ¡å˜å¾—ä¸å¯ç”¨</font></li><li>å¾®æœåŠ¡æ¶æ„ä¸­æœ‰å¾ˆå¤šçš„æœåŠ¡ç»„æˆï¼Œä¸åŒæœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œç»„æˆå¤æ‚çš„è°ƒç”¨é“¾è·¯ã€‚æŸä¸ªæœåŠ¡äº§ç”Ÿçš„é—®é¢˜åœ¨é“¾è·¯è°ƒç”¨ä¸­ä¼šäº§ç”Ÿæ”¾å¤§çš„æ•ˆæœã€‚</li><li>å¤æ‚é“¾è·¯ä¸Šçš„æŸä¸€ç¯ä¸ç¨³å®šï¼Œå°±å¯èƒ½ä¼šå±‚å±‚çº§è”ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªé“¾è·¯éƒ½ä¸å¯ç”¨ã€‚å› æ­¤éœ€è¦å¯¹ä¸ç¨³å®šçš„<strong>å¼±ä¾èµ–æœåŠ¡è°ƒç”¨</strong>è¿›è¡Œç†”æ–­é™çº§ï¼Œæš‚æ—¶åˆ‡æ–­ä¸ç¨³å®šè°ƒç”¨ï¼Œé¿å…å±€éƒ¨ä¸ç¨³å®šå› ç´ å¯¼è‡´æ•´ä½“çš„é›ªå´©ã€‚</li><li><mark>ç†”æ–­é™çº§ä½œä¸ºä¿æŠ¤è‡ªèº«çš„æ‰‹æ®µï¼Œé€šå¸¸åœ¨å®¢æˆ·ç«¯ï¼ˆè°ƒç”¨ç«¯ï¼‰è¿›è¡Œé…ç½®ã€‚</mark></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="32-ç†”æ–­é™çº§è§„åˆ™è¯´æ˜">3.2 ç†”æ–­é™çº§è§„åˆ™è¯´æ˜<a class="hash-link" href="#32-ç†”æ–­é™çº§è§„åˆ™è¯´æ˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><font color="red">åŒä¸€ä¸ªèµ„æºå¯ä»¥åŒæ—¶æœ‰å¤šä¸ªé™çº§è§„åˆ™</font><p><strong>è§„åˆ™é‡è¦å±æ€§</strong></p><table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th><th>å¯é€‰å€¼</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><font color="red"><code>resource</code></font></td><td>èµ„æºåï¼Œå³è§„åˆ™çš„ä½œç”¨å¯¹è±¡</td><td></td><td></td></tr><tr><td><font color="red"><code>grade</code></font></td><td>ç†”æ–­ç­–ç•¥ï¼Œ</td><td>æ…¢è°ƒç”¨æ¯”ä¾‹<br>å¼‚å¸¸æ¯”ä¾‹<br>å¼‚å¸¸æ•°ç­–ç•¥</td><td>æ…¢è°ƒç”¨æ¯”ä¾‹</td></tr><tr><td><font color="red"><code>count</code></font></td><td>æ…¢è°ƒç”¨æ¯”ä¾‹æ¨¡å¼ä¸‹ä¸ºæ…¢è°ƒç”¨æœ€å¤§å“åº”æ—¶é•¿RTï¼ˆè¶…å‡ºè¯¥å€¼è®¡ä¸ºæ…¢è°ƒç”¨ï¼‰<br>å¼‚å¸¸æ¯”ä¾‹/å¼‚å¸¸æ•°æ¨¡å¼ä¸‹ä¸ºå¯¹åº”çš„é˜ˆå€¼</td><td></td><td></td></tr><tr><td><font color="red"><code>timeWindow</code></font></td><td>æ—¶é—´çª—å£æœŸï¼Œç†”æ–­æ—¶é•¿ï¼ˆå•ä½ä¸º sï¼‰</td><td></td><td></td></tr><tr><td><font color="red"><code>minRequestAmount</code></font></td><td>ç†”æ–­è§¦å‘çš„æœ€å°è¯·æ±‚æ•°ï¼Œ<font color="blue">è¯·æ±‚æ•°å°äºè¯¥å€¼æ—¶å³ä½¿å¼‚å¸¸æ¯”ç‡è¶…å‡ºé˜ˆå€¼ä¹Ÿä¸ä¼šç†”æ–­</font>  <!-- -->[1.7.0 å¼•å…¥]</td><td></td><td>5</td></tr><tr><td><font color="red"><code>statIntervalMs</code></font></td><td>ç»Ÿè®¡æ—¶é•¿ï¼ˆå•ä½ä¸º msï¼‰             <!-- -->[1.8.0 å¼•å…¥]</td><td></td><td>1000ms</td></tr><tr><td><font color="red"><code>slowRatioThreshold</code></font></td><td>æ…¢è°ƒç”¨æ¯”ä¾‹é˜ˆå€¼ï¼Œ<font color="green">ä»…æ…¢è°ƒç”¨æ¯”ä¾‹æ¨¡å¼æœ‰æ•ˆ</font> <!-- -->[1.8.0 å¼•å…¥]</td><td></td><td></td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_loeA" id="321-ç†”æ–­ç­–ç•¥">3.2.1 ç†”æ–­ç­–ç•¥<a class="hash-link" href="#321-ç†”æ–­ç­–ç•¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><h5 class="anchor anchorWithStickyNavbar_loeA" id="3211-æ…¢è°ƒç”¨æ¯”ä¾‹---slow_request_ratio">3.2.1.1 æ…¢è°ƒç”¨æ¯”ä¾‹ - SLOW_REQUEST_RATIO<a class="hash-link" href="#3211-æ…¢è°ƒç”¨æ¯”ä¾‹---slow_request_ratio" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><ul><li><font color="red">ä»Sentient 1.8 ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒæ–­è·¯å™¨çš„åŠå¼€çŠ¶æ€</font></li><li>é€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œ<mark>éœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ RTï¼ˆå³æœ€å¤§çš„å“åº”æ—¶é—´)</mark><ul><li><font color="red">è¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸ºæ…¢è°ƒç”¨</font></li></ul></li><li>å½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…è¯·æ±‚æ•°å¤§äºæœ€å°è¯·æ±‚æ•°ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…çš„è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­<ul><li>ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤åŠå¼€çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰<ul><li>è‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ç»“æŸç†”æ–­</li><li>è‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­</li></ul></li></ul></li></ul><h6 class="anchor anchorWithStickyNavbar_loeA" id="32111è§„åˆ™è®¾ç½®æ§åˆ¶å°">3.2.1.1.1è§„åˆ™è®¾ç½®ï¼ˆæ§åˆ¶å°ï¼‰<a class="hash-link" href="#32111è§„åˆ™è®¾ç½®æ§åˆ¶å°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><ul><li>åœ¨é»˜è®¤çš„ç»Ÿè®¡æ—¶é—´èŒƒå›´ï¼ˆ1sï¼‰å†…ï¼Œå¦‚æœè¯·æ±‚æ•°å¤§äº5ï¼Œä¸”æ…¢è°ƒç”¨çš„è¯·æ±‚(Rtæ—¶é—´å¤§äº10ms)å æ€»è¯·æ±‚æ•°çš„ 50%ï¼Œå°±å¯¹èµ„æºè¿›è¡Œç†”æ–­ï¼Œç†”æ–­æ—¶é—´ä¸º10s</li></ul><p><img loading="lazy" src="/assets/images/image-20201226134134343-c0055682fcfd3e07cb48a5b628608665.png" width="643" height="332" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="32112-è§„åˆ™è®¾ç½®ä»£ç ">3.2.1.1.2 è§„åˆ™è®¾ç½®ï¼ˆä»£ç ï¼‰<a class="hash-link" href="#32112-è§„åˆ™è®¾ç½®ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><ul><li>ç»Ÿè®¡10så†…çš„è¯·æ±‚æ•°æ®,å¦‚æœè¯·æ±‚æ•°è¶…è¿‡5ä¸ª,æ¯ä¸ªè¯·æ±‚ RT&gt;10ms,ä¸”è¿™æ ·çš„æ…¢è°ƒç”¨è¯·æ±‚å æ€»è¯·æ±‚çš„30%,å°±è¿›è¡ŒæœåŠ¡ç†”æ–­,ç†”æ–­æ—¶é—´ä¸º10s</li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"> * æ…¢è°ƒç”¨æ¯”ä¾‹</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"> *  ç»Ÿè®¡10så†…çš„è¯·æ±‚æ•°æ®,å¦‚æœè¯·æ±‚æ•°è¶…è¿‡5ä¸ª,æ¯ä¸ªè¯·æ±‚ RT&gt;10ms,ä¸”è¿™æ ·çš„æ…¢è°ƒç”¨è¯·æ±‚å æ€»è¯·æ±‚çš„30%,å°±è¿›è¡ŒæœåŠ¡ç†”æ–­,ç†”æ–­æ—¶é—´ä¸º10s</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">initSlowRequestRatio</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> degradeRules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// ç»‘å®šç‡èµ„æºå</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getSlowInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®ç†”æ–­ç­–ç•¥ RT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">DEGRADE_GRADE_RT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®ç»Ÿè®¡æ—¶é•¿ 10s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStatIntervalMs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">1000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®ç»Ÿè®¡æ—¶é—´èŒƒå›´å†…éœ€è¦æœ€å°‘é€šè¿‡è¯·æ±‚æ•°  5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setMinRequestAmount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®æ¯ä¸ªè¯·æ±‚æœ€å¤§å“åº”æ—¶é—´RT 10ms</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®æ…¢è°ƒç”¨çš„é˜ˆå€¼æ¯”ä¾‹ 0.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setSlowRatioThreshold</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0.3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®ç†”æ–­æ—¶é•¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setTimeWindow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">1000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_loeA" id="3212-å¼‚å¸¸æ¯”ä¾‹---error_ratio">3.2.1.2 å¼‚å¸¸æ¯”ä¾‹ - ERROR_RATIO<a class="hash-link" href="#3212-å¼‚å¸¸æ¯”ä¾‹---error_ratio" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><ul><li>å½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…è¯·æ±‚æ€»æ•°å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­</li></ul><h6 class="anchor anchorWithStickyNavbar_loeA" id="32121-è§„åˆ™è®¾ç½®æ§åˆ¶å°">3.2.1.2.1 è§„åˆ™è®¾ç½®ï¼ˆæ§åˆ¶å°ï¼‰<a class="hash-link" href="#32121-è§„åˆ™è®¾ç½®æ§åˆ¶å°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><ul><li>åœ¨é»˜è®¤çš„ç»Ÿè®¡æ—¶é—´èŒƒå›´ï¼ˆ1sï¼‰å†…ï¼Œå¦‚æœè¯·æ±‚æ•°å¤§äº5ï¼Œä¸”å¼‚å¸¸è¯·æ±‚æ•°å æ€»è¯·æ±‚æ•°çš„50%ï¼Œå°±æ¥ä¸‹æ¥1000så†…çš„è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­</li></ul><p><img loading="lazy" src="/assets/images/image-20201226144904768-43b5cc9bc7ff75d2253b807ed0f1bf8f.png" width="647" height="330" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="32122-è§„åˆ™è®¾ç½®ä»£ç ">3.2.1.2.2 è§„åˆ™è®¾ç½®ï¼ˆä»£ç ï¼‰<a class="hash-link" href="#32122-è§„åˆ™è®¾ç½®ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">initExceptionRatio</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> degradeRules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// ç»‘å®šç‡èµ„æºå</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getError&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®ç†”æ–­ç­–ç•¥ RT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">DEGRADE_GRADE_EXCEPTION_RATIO</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®å¼‚å¸¸æ¯”ä¾‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0.5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®ç†”æ–­æ—¶é•¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setTimeWindow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_loeA" id="3213-å¼‚å¸¸æ•°---error_count">3.2.1.3 å¼‚å¸¸æ•° - ERROR_COUNT<a class="hash-link" href="#3213-å¼‚å¸¸æ•°---error_count" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><ul><li>å½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­</li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="32131-è§„åˆ™è®¾ç½®æ§åˆ¶å°">3.2.1.3.1 è§„åˆ™è®¾ç½®ï¼ˆæ§åˆ¶å°ï¼‰<a class="hash-link" href="#32131-è§„åˆ™è®¾ç½®æ§åˆ¶å°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h5><p><img loading="lazy" src="/assets/images/image-20201226145132006-475be954563737d500b7cd8d5eed6367.png" width="664" height="339" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="32132-è§„åˆ™è®¾ç½®ä»£ç ">3.2.1.3.2 è§„åˆ™è®¾ç½®ï¼ˆä»£ç ï¼‰<a class="hash-link" href="#32132-è§„åˆ™è®¾ç½®ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h6><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">initExceptionCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> degradeRules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// ç»‘å®šç‡èµ„æºå</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getError&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®ç†”æ–­ç­–ç•¥ RT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">DEGRADE_GRADE_EXCEPTION_COUNT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®å¼‚å¸¸æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// è®¾ç½®ç†”æ–­æ—¶é•¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setTimeWindow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="4-å®šä¹‰èµ„æº---sentinelresource">4. å®šä¹‰èµ„æº - @SentinelResource<a class="hash-link" href="#4-å®šä¹‰èµ„æº---sentinelresource" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="41-sentinelresource-è¯´æ˜">4.1 @SentinelResource è¯´æ˜<a class="hash-link" href="#41-sentinelresource-è¯´æ˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><blockquote><p> ç±»ä¼¼äºHystrix çš„@HystrixCommand æ³¨è§£</p></blockquote><ul><li><font color="red"><code>@SentinelResource</code> ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›å¯é€‰çš„å¼‚å¸¸å¤„ç†å’Œ fallback é…ç½®é¡¹</font></li><li><p><code>@SentinelResource</code> æ³¨è§£åŒ…å«ä»¥ä¸‹å±æ€§</p><ul><li><p><code>value</code></p><ul><li>èµ„æºåç§° <!-- -->[å¿…éœ€é¡¹]</li></ul></li><li><p><code>entryType</code></p><ul><li>entry ç±»å‹ <!-- -->[å¯é€‰é¡¹]</li><li>é»˜è®¤ä¸º <code>EntryType.OUT</code></li></ul></li><li><p><code>blockHandler / blockHandlerClass</code></p><ul><li><code>blockHandler</code> å¯¹åº”å¤„ç† <code>BlockException</code> çš„å‡½æ•°åç§° <!-- -->[å¯é€‰é¡¹]<ul><li>å‡½æ•°æ˜¯ <code>public</code>ï¼Œè¿”å›ç±»å‹éœ€è¦ä¸åŸæ–¹æ³•ä¸€è‡´ï¼Œå‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…å¹¶ä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸º <code>BlockException</code> <ul><li>æ ¼å¼:  <code>public ä¸šåŠ¡æ–¹æ³•è¿”å›å€¼ç±»å‹ æ–¹æ³•å(ä¸šåŠ¡æ–¹æ³•å½¢å‚åˆ—è¡¨,BlockException exception)</code></li></ul></li><li><mark><strong>blockHandler å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­</strong></mark></li></ul></li><li>è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š <code>blockHandlerClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ <code>Class</code> å¯¹è±¡,<font color="red">æ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æ</font> </li></ul></li><li><p><code>fallback Â / Â fallbackClass</code></p><ul><li>fallback å‡½æ•°åç§°,ç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾› fallback å¤„ç†é€»è¾‘ <!-- -->[å¯é€‰é¡¹]</li><li><strong>fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸</strong> (é™¤äº† <code>exceptionsToIgnore</code> é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹)è¿›è¡Œå¤„ç†</li><li><strong>fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚</strong><ul><li>è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´</li><li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª <code>Throwable</code> ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>fallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­<ul><li>è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œå¯ä»¥æŒ‡å®š <code>fallbackClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æ</li></ul></li></ul></li></ul></li><li><p><code>defaultFallback</code></p><ul><li>é»˜è®¤çš„ fallback å‡½æ•°åç§° <!-- -->[å¯é€‰é¡¹ ä»1.6å¼€å§‹æ”¯æŒ]</li><li>é€šå¸¸ç”¨äºé€šç”¨çš„ fallback é€»è¾‘ï¼ˆå³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•ï¼‰</li><li><mark>ä» 1.8 ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒç±»çº§åˆ«é…ç½®</mark></li></ul></li><li><p><code>exceptionsToIgnore</code></p><ul><li>ç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿä¸ä¼šè¿›å…¥ fallback é€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡ºã€‚</li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="5-çƒ­ç‚¹å‚æ•°è§„åˆ™paramflowrule">5. çƒ­ç‚¹å‚æ•°è§„åˆ™(ParamFlowRule)<a class="hash-link" href="#5-çƒ­ç‚¹å‚æ•°è§„åˆ™paramflowrule" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="51-çƒ­ç‚¹å‚æ•°">5.1 çƒ­ç‚¹å‚æ•°<a class="hash-link" href="#51-çƒ­ç‚¹å‚æ•°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li><mark>çƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®</mark>ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚æ¯”å¦‚ï¼š<ul><li>å•†å“ ID ä¸ºçƒ­ç‚¹ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li><li>ç”¨æˆ· ID ä¸ºçƒ­ç‚¹ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li></ul></li><li><font color="red">çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ</font><ul><li>çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆ</li></ul></li><li><p>Sentinelåˆ©ç”¨<font color="red"> <code>LRUç­–ç•¥Â </code></font> ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§</p></li></ul><p><img loading="lazy" src="/assets/images/image-20201226151214076-0e51bc17d28913e782c5977d56652038.png" width="916" height="285" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="52-çƒ­ç‚¹å‚æ•°è§„åˆ™å±æ€§è¯´æ˜">5.2 çƒ­ç‚¹å‚æ•°è§„åˆ™å±æ€§è¯´æ˜<a class="hash-link" href="#52-çƒ­ç‚¹å‚æ•°è§„åˆ™å±æ€§è¯´æ˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li>çƒ­ç‚¹å‚æ•°è§„åˆ™ï¼ˆ<code>ParamFlowRule</code>ï¼‰ç±»ä¼¼äºæµé‡æ§åˆ¶è§„åˆ™ï¼ˆ<code>FlowRule</code>ï¼‰ï¼š</li></ul><table><thead><tr><th>å±æ€§</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><font color="red"><code>resource</code></font></td><td>èµ„æºå</td><td></td></tr><tr><td><font color="red"><code>count</code></font></td><td>é™æµé˜ˆå€¼</td><td></td></tr><tr><td><font color="red"><code>grade</code></font></td><td>é™æµæ¨¡å¼</td><td>QPS</td></tr><tr><td><font color="red"><code>durationInSec</code></font></td><td>ç»Ÿè®¡çª—å£æ—¶é—´é•¿åº¦ï¼ˆå•ä½ä¸ºç§’ï¼‰  <!-- -->[1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ]</td><td>1s</td></tr><tr><td><font color="red"><code>controlBehavior</code></font></td><td>æµæ§æ•ˆæœï¼ˆæ”¯æŒå¿«é€Ÿå¤±è´¥å’ŒåŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ï¼‰  <!-- -->[1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ]</td><td>å¿«é€Ÿå¤±è´¥</td></tr><tr><td><font color="red"><code>maxQueueingTimeMs</code></font></td><td>æœ€å¤§æ’é˜Ÿç­‰å¾…æ—¶é•¿ï¼ˆä»…åœ¨åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ç”Ÿæ•ˆ  <!-- -->[1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ]</td><td>0ms</td></tr><tr><td><font color="red"><code>paramIdx</code></font></td><td>çƒ­ç‚¹å‚æ•°çš„ç´¢å¼•ï¼Œå¯¹åº” <code>SphU.entry(xxx, args)</code> ä¸­çš„å‚æ•°ç´¢å¼•ä½ç½®</td><td></td></tr><tr><td><font color="red"><code>paramFlowItemList</code></font></td><td>å‚æ•°ä¾‹å¤–é¡¹ï¼Œå¯ä»¥é’ˆå¯¹æŒ‡å®šçš„å‚æ•°å€¼å•ç‹¬è®¾ç½®é™æµé˜ˆå€¼ï¼Œä¸å—å‰é¢ <code>count</code> é˜ˆå€¼çš„é™åˆ¶<br><mark>ä»…æ”¯æŒåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹</mark></td><td></td></tr><tr><td><font color="red"><code>clusterMode</code></font></td><td>æ˜¯å¦æ˜¯é›†ç¾¤å‚æ•°æµæ§è§„åˆ™</td><td>false</td></tr><tr><td><font color="red"><code>clusterConfig</code></font></td><td>é›†ç¾¤æµæ§ç›¸å…³é…ç½®</td><td></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_loeA" id="53-çƒ­ç‚¹å‚æ•°è§„åˆ™è®¾ç½®ä»£ç ">5.3 çƒ­ç‚¹å‚æ•°è§„åˆ™è®¾ç½®ï¼ˆä»£ç ï¼‰<a class="hash-link" href="#53-çƒ­ç‚¹å‚æ•°è§„åˆ™è®¾ç½®ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li><font color="red">æ“ä½œæ­¥éª¤</font><ol><li>é€šè¿‡ <code>@SentinelResource</code> æ³¨è§£å®šä¹‰èµ„æºï¼ŒåŒæ—¶æŒ‡å®šå¤±è´¥å¤„ç†å‡½æ•°</li><li>æ–°å»ºçƒ­ç‚¹å‚æ•°è§„åˆ™ï¼Œå¯¹èµ„æºçš„çƒ­ç‚¹å‚æ•°è¿›è¡Œé™åˆ¶ -&gt; è¯·æ±‚ä¸­åŒ…å«äº†çƒ­ç‚¹å‚æ•°ï¼Œå°±å¯¹è¯¥å‚æ•°è¿›è¡Œé™åˆ¶</li></ol></li></ul><p><strong>â‘ ã€ é€šè¿‡ @SentinelResource å®šä¹‰èµ„æº</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@GetMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/getHotKey&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@SentinelResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getHotKey&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  blockHandler </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;getHotKeyHandler&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain">  </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getHotKey</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@RequestParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">required </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> user1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                         </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@RequestParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user2&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">required </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> user2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> info</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getHotKeyHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> user1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> user2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">BlockException</span><span class="token plain"> exception</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">format</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;è‡ªå®šä¹‰å¼‚å¸¸ä¿¡æ¯,å¼‚å¸¸ç±»å‹:%s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">exception</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getClass</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>â‘¡ï¼Œ è®¾ç½®ä¸€ä¸ªçƒ­ç‚¹å‚æ•°è§„åˆ™</strong></p><p>å¦‚æœQPS ä¸­çƒ­ç‚¹å‚æ•°çš„æ•°é‡è¶…è¿‡3ï¼Œå°±å¯¹è¯¥è¯·æ±‚è¿›è¡Œé™åˆ¶</p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">initHotKeyRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">ParamFlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ParamFlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">ParamFlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ParamFlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getHotKey&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// çƒ­ç‚¹å‚æ•°è§„åˆ™ä»…æ”¯æŒ QPS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// çƒ­ç‚¹å‚æ•°è§„åˆ™çš„é™æµæ•ˆæœ -&gt; å¿«é€Ÿå¤±è´¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_DEFAULT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">//  çƒ­ç‚¹å‚æ•°è§„åˆ™çš„é˜ˆå€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// çƒ­ç‚¹å‚æ•°çš„ç´¢å¼• -&gt; å³ä¸šåŠ¡æ–¹æ³•å½¢å‚ä¸­æ‰€åœ¨çš„ç´¢å¼•ä½ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setParamIdx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">ParamFlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>â‘¢ã€ ç•Œé¢æµ‹è¯•</strong></p><p><img loading="lazy" src="/assets/images/image-20201226162312521-c31cd565a794af2b64564da7af364968.png" width="731" height="154" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="531-ä¸ºä¸åŒçš„çƒ­ç‚¹å‚æ•°å€¼è®¾ç½®ä¸åŒçš„é˜ˆå€¼">5.3.1 ä¸ºä¸åŒçš„çƒ­ç‚¹å‚æ•°å€¼è®¾ç½®ä¸åŒçš„é˜ˆå€¼<a class="hash-link" href="#531-ä¸ºä¸åŒçš„çƒ­ç‚¹å‚æ•°å€¼è®¾ç½®ä¸åŒçš„é˜ˆå€¼" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><mark>å¯¹çƒ­ç‚¹å‚æ•°ä¸åŒçš„å–å€¼è¿›è¡Œæ§åˆ¶</mark><p><img loading="lazy" src="/assets/images/image-20201226163750215-4361cabb1b773e1bc762e8b77f8c68bc.png" width="655" height="687" class="img_CujE"></p><hr><h2 class="anchor anchorWithStickyNavbar_loeA" id="6-ç³»ç»Ÿè§„åˆ™systemrule">6. ç³»ç»Ÿè§„åˆ™ï¼ˆSystemRuleï¼‰<a class="hash-link" href="#6-ç³»ç»Ÿè§„åˆ™systemrule" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ul><li>ç³»ç»Ÿè§„åˆ™ä»æ€»ä½“çš„åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡<ul><li>é€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="61-ç³»ç»Ÿè§„åˆ™å±æ€§è¯´æ˜">6.1 ç³»ç»Ÿè§„åˆ™å±æ€§è¯´æ˜<a class="hash-link" href="#61-ç³»ç»Ÿè§„åˆ™å±æ€§è¯´æ˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><table><thead><tr><th>Field</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><font color="red"><code>highestSystemLoad</code></font></td><td><code>load1</code> è§¦å‘å€¼ï¼Œç”¨äºè§¦å‘è‡ªé€‚åº”æ§åˆ¶é˜¶æ®µ</td><td>-1 (ä¸ç”Ÿæ•ˆ)</td></tr><tr><td><font color="red"><code>avgRt</code></font></td><td>æ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡å“åº”æ—¶é—´</td><td>-1 (ä¸ç”Ÿæ•ˆ)</td></tr><tr><td><font color="red"><code>maxThread</code></font></td><td>å…¥å£æµé‡çš„æœ€å¤§å¹¶å‘æ•°</td><td>-1 (ä¸ç”Ÿæ•ˆ)</td></tr><tr><td><font color="red"><code>qps</code></font></td><td>æ‰€æœ‰å…¥å£èµ„æºçš„ QPS</td><td>-1 (ä¸ç”Ÿæ•ˆ)</td></tr><tr><td><font color="red"><code>highestCpuUsage</code></font></td><td>å½“å‰ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡ï¼ˆ0.0-1.0ï¼‰</td><td>-1 (ä¸ç”Ÿæ•ˆ</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_loeA" id="611-è§„åˆ™è®¾ç½®æ§åˆ¶å°">6.1.1 è§„åˆ™è®¾ç½®ï¼ˆæ§åˆ¶å°ï¼‰<a class="hash-link" href="#611-è§„åˆ™è®¾ç½®æ§åˆ¶å°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><img loading="lazy" src="/assets/images/image-20201226165111707-aaaa1ee5391a27a63a7999bfd905f57a.png" width="656" height="242" class="img_CujE"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MagicalZhu/NoteLib/tree/main/docs/SpringCloud/Alibaba/æœåŠ¡å®¹é”™- Sentinel.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_N_05" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">æœ€å<!-- -->ç”± <b>YuLiang Zhu</b> <!-- -->äº <b><time datetime="2022-12-06T01:19:52.000Z">2022å¹´12æœˆ6æ—¥</time></b> <!-- -->æ›´æ–°</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡æ¡£åˆ†é¡µå¯¼èˆª"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/SpringCloud/Alibaba/Nacos"><div class="pagination-nav__sublabel">ä¸Šä¸€é¡µ</div><div class="pagination-nav__label">æœåŠ¡æ³¨å†Œä¸é…ç½®ä¸­å¿ƒ-Nacos</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><p class="content_nRws">Contents</p><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-sentinel" class="table-of-contents__link toc-highlight">1. Sentinel</a><ul><li><a href="#11-sentinelæ¦‚è¿°" class="table-of-contents__link toc-highlight">1.1 Sentinelæ¦‚è¿°</a></li><li><a href="#12-sentinel-åŸºæœ¬ç¯å¢ƒæ­å»º" class="table-of-contents__link toc-highlight">1.2 Sentinel åŸºæœ¬ç¯å¢ƒæ­å»º</a><ul><li><a href="#121-æ§åˆ¶å°æ­å»º" class="table-of-contents__link toc-highlight">1.2.1 æ§åˆ¶å°æ­å»º</a></li><li><a href="#122-sentinelå®¢æˆ·ç«¯nacosé›†ç¾¤sentinel" class="table-of-contents__link toc-highlight">1.2.2 Sentinelå®¢æˆ·ç«¯(Nacosé›†ç¾¤+Sentinel)</a></li></ul></li><li><a href="#13-sentinelå·¥ä½œæµç¨‹-è´£ä»»é“¾æ¨¡å¼" class="table-of-contents__link toc-highlight">1.3 Sentinelå·¥ä½œæµç¨‹ è´£ä»»é“¾æ¨¡å¼</a></li><li><a href="#14-sentinelè§„åˆ™" class="table-of-contents__link toc-highlight">1.4 Sentinelè§„åˆ™</a></li></ul></li><li><a href="#2-sentinelè§„åˆ™-æµæ§è§„åˆ™flowrule" class="table-of-contents__link toc-highlight">2. Sentinelè§„åˆ™-æµæ§è§„åˆ™(FlowRule)</a><ul><li><a href="#20-é™æµè§„åˆ™è¯´æ˜" class="table-of-contents__link toc-highlight">2.0 é™æµè§„åˆ™è¯´æ˜</a></li><li><a href="#21-é™æµé˜ˆå€¼ç»Ÿè®¡æ–¹å¼" class="table-of-contents__link toc-highlight">2.1 é™æµé˜ˆå€¼ç»Ÿè®¡æ–¹å¼</a><ul><li><a href="#211-åŸºäºå¹¶å‘çº¿ç¨‹æ•°æœåŠ¡ç«¯æœ€å¤šå…è®¸å¤šå°‘çº¿ç¨‹å¤„ç†è¯·æ±‚" class="table-of-contents__link toc-highlight">2.1.1 åŸºäºå¹¶å‘çº¿ç¨‹æ•°ï¼ˆæœåŠ¡ç«¯æœ€å¤šå…è®¸å¤šå°‘çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼‰</a></li><li><a href="#212-åŸºäºqpsæ¯ç§’æœ€å¤šå…è®¸å¤šå°‘è¯·æ±‚è¿›å…¥æœåŠ¡ç«¯å¤„ç†" class="table-of-contents__link toc-highlight">2.1.2 åŸºäºQPSï¼ˆæ¯ç§’æœ€å¤šå…è®¸å¤šå°‘è¯·æ±‚è¿›å…¥æœåŠ¡ç«¯å¤„ç†ï¼‰</a><ul><li><a href="#2121-é™æµæ•ˆæœ-å¿«é€Ÿå¤±è´¥é»˜è®¤" class="table-of-contents__link toc-highlight">2.1.2.1 é™æµæ•ˆæœ-å¿«é€Ÿå¤±è´¥ï¼ˆé»˜è®¤ï¼‰</a></li><li><a href="#2122-é™æµæ•ˆæœ-å†·å¯åŠ¨" class="table-of-contents__link toc-highlight">2.1.2.2 é™æµæ•ˆæœ-å†·å¯åŠ¨</a><ul><li><a href="#21221-è®¾ç½®è§„åˆ™æ§åˆ¶å°" class="table-of-contents__link toc-highlight">2.1.2.2.1 è®¾ç½®è§„åˆ™(æ§åˆ¶å°)</a></li><li><a href="#21222-è®¾ç½®è§„åˆ™ä»£ç " class="table-of-contents__link toc-highlight">2.1.2.2.2 è®¾ç½®è§„åˆ™(ä»£ç )</a></li></ul></li><li><a href="#2123-é™æµæ•ˆæœ-æ’é˜Ÿç­‰å¾…" class="table-of-contents__link toc-highlight">2.1.2.3 é™æµæ•ˆæœ-æ’é˜Ÿç­‰å¾…</a><ul><li><a href="#21231-è®¾ç½®è§„åˆ™æ§åˆ¶å°" class="table-of-contents__link toc-highlight">2.1.2.3.1 è®¾ç½®è§„åˆ™(æ§åˆ¶å°)</a></li><li><a href="#21232-è®¾ç½®è§„åˆ™ä»£ç " class="table-of-contents__link toc-highlight">2.1.2.3.2 è®¾ç½®è§„åˆ™(ä»£ç )</a></li></ul></li></ul></li></ul></li><li><a href="#22-é™æµæ¨¡å¼" class="table-of-contents__link toc-highlight">2.2 é™æµæ¨¡å¼</a><ul><li><a href="#221-é™æµæ¨¡å¼---ç›´æ¥-é™åˆ¶èµ„æºæœ¬èº«" class="table-of-contents__link toc-highlight">2.2.1 é™æµæ¨¡å¼ - ç›´æ¥ ï¼ˆé™åˆ¶èµ„æºæœ¬èº«ï¼‰</a><ul><li><a href="#2211-è®¾ç½®è§„åˆ™æ§åˆ¶å°" class="table-of-contents__link toc-highlight">2.2.1.1 è®¾ç½®è§„åˆ™(æ§åˆ¶å°)</a></li><li><a href="#2212-è®¾ç½®è§„åˆ™ä»£ç " class="table-of-contents__link toc-highlight">2.2.1.2 è®¾ç½®è§„åˆ™(ä»£ç )</a></li></ul></li><li><a href="#222-é™æµæ¨¡å¼---å…³è”-é™åˆ¶ä¸Šæ¸¸èµ„æº" class="table-of-contents__link toc-highlight">2.2.2 é™æµæ¨¡å¼ - å…³è” (é™åˆ¶ä¸Šæ¸¸èµ„æº)</a><ul><li><a href="#2221-è®¾ç½®è§„åˆ™æ§åˆ¶å°" class="table-of-contents__link toc-highlight">2.2.2.1 è®¾ç½®è§„åˆ™(æ§åˆ¶å°)</a></li><li><a href="#2222-è®¾ç½®è§„åˆ™ä»£ç " class="table-of-contents__link toc-highlight">2.2.2.2 è®¾ç½®è§„åˆ™(ä»£ç )</a></li></ul></li><li><a href="#223-é™æµæ¨¡å¼---é“¾è·¯" class="table-of-contents__link toc-highlight">2.2.3 é™æµæ¨¡å¼ - é“¾è·¯</a></li></ul></li></ul></li><li><a href="#3sentinelè§„åˆ™-ç†”æ–­é™çº§degraderule" class="table-of-contents__link toc-highlight">3.Sentinelè§„åˆ™-ç†”æ–­é™çº§(DegradeRule)</a><ul><li><a href="#31-ç†”æ–­é™çº§è¯´æ˜" class="table-of-contents__link toc-highlight">3.1 ç†”æ–­é™çº§è¯´æ˜</a></li><li><a href="#32-ç†”æ–­é™çº§è§„åˆ™è¯´æ˜" class="table-of-contents__link toc-highlight">3.2 ç†”æ–­é™çº§è§„åˆ™è¯´æ˜</a><ul><li><a href="#321-ç†”æ–­ç­–ç•¥" class="table-of-contents__link toc-highlight">3.2.1 ç†”æ–­ç­–ç•¥</a><ul><li><a href="#3211-æ…¢è°ƒç”¨æ¯”ä¾‹---slow_request_ratio" class="table-of-contents__link toc-highlight">3.2.1.1 æ…¢è°ƒç”¨æ¯”ä¾‹ - SLOW_REQUEST_RATIO</a><ul><li><a href="#32111è§„åˆ™è®¾ç½®æ§åˆ¶å°" class="table-of-contents__link toc-highlight">3.2.1.1.1è§„åˆ™è®¾ç½®ï¼ˆæ§åˆ¶å°ï¼‰</a></li><li><a href="#32112-è§„åˆ™è®¾ç½®ä»£ç " class="table-of-contents__link toc-highlight">3.2.1.1.2 è§„åˆ™è®¾ç½®ï¼ˆä»£ç ï¼‰</a></li></ul></li><li><a href="#3212-å¼‚å¸¸æ¯”ä¾‹---error_ratio" class="table-of-contents__link toc-highlight">3.2.1.2 å¼‚å¸¸æ¯”ä¾‹ - ERROR_RATIO</a><ul><li><a href="#32121-è§„åˆ™è®¾ç½®æ§åˆ¶å°" class="table-of-contents__link toc-highlight">3.2.1.2.1 è§„åˆ™è®¾ç½®ï¼ˆæ§åˆ¶å°ï¼‰</a></li><li><a href="#32122-è§„åˆ™è®¾ç½®ä»£ç " class="table-of-contents__link toc-highlight">3.2.1.2.2 è§„åˆ™è®¾ç½®ï¼ˆä»£ç ï¼‰</a></li></ul></li><li><a href="#3213-å¼‚å¸¸æ•°---error_count" class="table-of-contents__link toc-highlight">3.2.1.3 å¼‚å¸¸æ•° - ERROR_COUNT</a></li><li><a href="#32131-è§„åˆ™è®¾ç½®æ§åˆ¶å°" class="table-of-contents__link toc-highlight">3.2.1.3.1 è§„åˆ™è®¾ç½®ï¼ˆæ§åˆ¶å°ï¼‰</a><ul><li><a href="#32132-è§„åˆ™è®¾ç½®ä»£ç " class="table-of-contents__link toc-highlight">3.2.1.3.2 è§„åˆ™è®¾ç½®ï¼ˆä»£ç ï¼‰</a></li></ul></li></ul></li></ul></li></ul></li><li><a href="#4-å®šä¹‰èµ„æº---sentinelresource" class="table-of-contents__link toc-highlight">4. å®šä¹‰èµ„æº - @SentinelResource</a><ul><li><a href="#41-sentinelresource-è¯´æ˜" class="table-of-contents__link toc-highlight">4.1 @SentinelResource è¯´æ˜</a></li></ul></li><li><a href="#5-çƒ­ç‚¹å‚æ•°è§„åˆ™paramflowrule" class="table-of-contents__link toc-highlight">5. çƒ­ç‚¹å‚æ•°è§„åˆ™(ParamFlowRule)</a><ul><li><a href="#51-çƒ­ç‚¹å‚æ•°" class="table-of-contents__link toc-highlight">5.1 çƒ­ç‚¹å‚æ•°</a></li><li><a href="#52-çƒ­ç‚¹å‚æ•°è§„åˆ™å±æ€§è¯´æ˜" class="table-of-contents__link toc-highlight">5.2 çƒ­ç‚¹å‚æ•°è§„åˆ™å±æ€§è¯´æ˜</a></li><li><a href="#53-çƒ­ç‚¹å‚æ•°è§„åˆ™è®¾ç½®ä»£ç " class="table-of-contents__link toc-highlight">5.3 çƒ­ç‚¹å‚æ•°è§„åˆ™è®¾ç½®ï¼ˆä»£ç ï¼‰</a></li><li><a href="#531-ä¸ºä¸åŒçš„çƒ­ç‚¹å‚æ•°å€¼è®¾ç½®ä¸åŒçš„é˜ˆå€¼" class="table-of-contents__link toc-highlight">5.3.1 ä¸ºä¸åŒçš„çƒ­ç‚¹å‚æ•°å€¼è®¾ç½®ä¸åŒçš„é˜ˆå€¼</a></li></ul></li><li><a href="#6-ç³»ç»Ÿè§„åˆ™systemrule" class="table-of-contents__link toc-highlight">6. ç³»ç»Ÿè§„åˆ™ï¼ˆSystemRuleï¼‰</a><ul><li><a href="#61-ç³»ç»Ÿè§„åˆ™å±æ€§è¯´æ˜" class="table-of-contents__link toc-highlight">6.1 ç³»ç»Ÿè§„åˆ™å±æ€§è¯´æ˜</a><ul><li><a href="#611-è§„åˆ™è®¾ç½®æ§åˆ¶å°" class="table-of-contents__link toc-highlight">6.1.1 è§„åˆ™è®¾ç½®ï¼ˆæ§åˆ¶å°ï¼‰</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">å‰ç«¯é“¾æ¥</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://v3.cn.vuejs.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">React<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://ts.xcatliu.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TypeScript<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://developer.mozilla.org/zh-CN/docs/Web" target="_blank" rel="noopener noreferrer" class="footer__link-item">MDN<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">åç«¯é“¾æ¥</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spring<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">JVM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">ç¤¾åŒº</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">æ˜é‡‘<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.infoq.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">InfoQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">æ–‡æ¡£æ„å»º</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://typoraio.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Typora<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 huakucha. Built With Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf86732a.js"></script>
<script src="/assets/js/main.98457ee6.js"></script>
</body>
</html>