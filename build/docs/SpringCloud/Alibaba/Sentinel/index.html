<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-SpringCloud/Alibaba/Sentinel">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">服务容错-Sentinel | 花裤衩Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" name="twitter:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" property="og:url" content="https://huakucha.com/docs/SpringCloud/Alibaba/Sentinel"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="服务容错-Sentinel | 花裤衩Wiki"><meta data-rh="true" name="description" content="1. Sentinel"><meta data-rh="true" property="og:description" content="1. Sentinel"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huakucha.com/docs/SpringCloud/Alibaba/Sentinel"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/SpringCloud/Alibaba/Sentinel" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/SpringCloud/Alibaba/Sentinel" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QZ9YPBGUYT-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="花裤衩Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="花裤衩Wiki Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="花裤衩Wiki JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="花裤衩Wiki" href="/opensearch.xml">

<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.font.im/css?family=Raleway:500,700&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.864d50a7.css">
<link rel="preload" href="/assets/js/runtime~main.bf86732a.js" as="script">
<link rel="preload" href="/assets/js/main.98457ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_D8pK">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="content_zf74 announcementBarContent_dpRF">🌟欢迎来到花裤衩的博客🌟</div><button type="button" aria-label="关闭" class="clean-btn close closeButton_ZdWa announcementBarClose_iXyO"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--light_PnYV"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--dark_eYgw"></div><b class="navbar__title text--truncate">花裤衩</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">基础知识🤖</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/currency">并发编程</a></li><li><a class="dropdown__link" href="/docs/networrk-basic">计算机网络</a></li><li><a class="dropdown__link" href="/docs/linuxCommand">Linux</a></li><li><a class="dropdown__link" href="/docs/dataStructure">数据结构与算法</a></li><li><a class="dropdown__link" href="/docs/leetCode">LeetCode</a></li><li><a class="dropdown__link" href="/docs/mysql">MySQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">后端框架👨‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/spring">Spring</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/springCloud">SpringCloud</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">方法论🚧</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/distribute/protol">分布式理论</a></li><li><a class="dropdown__link" href="/docs/distribute/basicTech">分布式技术点</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">中间件🚀</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/middleware/basicMiddleware">基础中间件</a></li><li><a class="dropdown__link" href="/docs/middleware/job">定时任务</a></li><li><a class="dropdown__link" href="/docs/middleware/cache">缓存</a></li><li><a class="dropdown__link" href="/docs/middleware/searchEngine">搜索引擎</a></li><li><a class="dropdown__link" href="/docs/middleware/messageQueue">消息队列</a></li><li><a class="dropdown__link" href="/docs/middleware/database">数据库</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">底层⛽️</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/JVM">JVM</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">前端技术👩‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/front/Vue">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其他工具👹</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Gradle">Gradle</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">物料中心👏</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/website/BE">后端产品</a></li><li><a class="dropdown__link" href="/website/COM">其他产品</a></li><li><a class="dropdown__link" href="/website/FE">前端产品</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.huakucha.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">关于<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/MagicalZhu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_MW0i colorModeToggle_x44X"><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SFTY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ekgs"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_H2mL"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_W2AM"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_ntye" type="button"></button><div class="docPage_qMb8"><aside class="theme-doc-sidebar-container docSidebarContainer_rpaz"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springCloud">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/微服务基础">微服务基础</a><button aria-label="打开/收起侧边栏菜单「微服务基础」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/微服务技术栈">微服务技术栈</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/springcloud-netflix">SpringCloud-Netflix</a><button aria-label="打开/收起侧边栏菜单「SpringCloud-Netflix」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/springcloud-alibaba">SpringCloud-Alibaba</a><button aria-label="打开/收起侧边栏菜单「SpringCloud-Alibaba」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Alibaba/Nacos">服务注册与配置中心-Nacos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/SpringCloud/Alibaba/Sentinel">服务容错-Sentinel</a></li></ul></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_JQG6"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Iseg"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SLhD"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/微服务基础"><span itemprop="name">微服务基础</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/springcloud-alibaba"><span itemprop="name">SpringCloud-Alibaba</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">服务容错-Sentinel</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_IbkY theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_p7nN">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>服务容错-Sentinel</h1></header><h2 class="anchor anchorWithStickyNavbar_loeA" id="1-sentinel">1. Sentinel<a class="hash-link" href="#1-sentinel" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="11-sentinel概述">1.1 Sentinel概述<a class="hash-link" href="#11-sentinel概述" title="标题的直接链接">​</a></h3><ul><li><p>Sentinel是<mark>分布式系统的流量防卫兵</mark>, 以流量为切入点，从<mark>流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性</mark></p></li><li><font color="red"><strong>常见的容错方案</strong></font><ul><li><code>超时</code></li><li><code>限流</code></li><li><code>仓壁模式</code>  <ul><li>一般可以通过 将一个服务放在线程池中 , 通过线程池将多个服务进行隔离</li></ul></li><li><code>断路器模式</code></li></ul></li><li><p>Sentinel可以处理哪些问题?</p><ul><li>服务雪崩</li><li>服务降级</li><li>服务熔断</li><li>服务限流	</li></ul></li><li><font color="red">Sentinel 具有以下特征</font><ul><li><mark>丰富的应用场景</mark></li></ul></li><li><p>比如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等</p><ul><li><mark>完备的实时监控</mark></li><li><p>可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</p></li></ul></li><li><mark>完善的 SPI 扩展点</mark><ul><li>提供简单易用、完善的 SPI 扩展接口，可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等</li></ul></li><li><font color="red">Sentinel分为两部分</font><ul><li>核心库（Java 客户端）<ul><li>不依赖任何框架/库，能够运行于所有 Java 运行时环境，同时对 Dubbo / Spring Cloud 等框架也有较好的支持。</li></ul></li><li>控制台（Dashboard）<ul><li>基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器。</li></ul></li></ul></li><li><mark>注意：Sentinel 控制台目前仅支持单机部署。</mark></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="12-sentinel-基本环境搭建">1.2 Sentinel 基本环境搭建<a class="hash-link" href="#12-sentinel-基本环境搭建" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_loeA" id="121-控制台搭建">1.2.1 控制台搭建<a class="hash-link" href="#121-控制台搭建" title="标题的直接链接">​</a></h4><ul><li><font color="red">Sentinel 控制台有哪些功能？</font><ol><li><code>查看机器列表以及健康情况</code><ul><li>收集 Sentinel 客户端发送的心跳包，用于判断机器是否在线</li></ul></li><li><code>监控 (单机和集群聚合)</code><ul><li>通过 Sentinel 客户端暴露的监控api，定期拉取并且聚合应用监控信息，最终可以实现秒级的实时监控。</li></ul></li><li><code>规则管理和推送</code><ul><li>统一管理推送规则</li></ul></li><li><code>鉴权</code></li></ol></li><li><font color="red">操作步骤？</font><ol><li><a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">下载控制台</a></li><li>启动控制台<ul><li><code>-Dserver.port=8080</code><ul><li>用于指定控制台端口为 <code>8080</code></li></ul></li><li><code>-Dcsp.sentinel.dashboard.server=consoleIp:port</code> <ul><li>指定控制台地址和端口</li></ul></li><li><code>-Dproject.name=xxx</code><ul><li>指定项目名称</li></ul></li><li><code>-Dcsp.sentinel.log.dir</code><ul><li>指定日志输出目录</li></ul></li><li><code>-Dcsp.sentinel.api.port=xxxx</code><ul><li>指定客户端监控 api 的端口,<mark>默认是 8719</mark></li></ul></li></ul></li></ol></li></ul><div class="language-bash codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-bash codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">java -Dserver.port</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">8080</span><span class="token plain"> -Dcsp.sentinel.dashboard.server</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">localhost:8080 -Dproject.name</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">sentinel-dashboard -jar  </span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问控制台 http://localhost:8080, 用户名密码默认是 <code>sentinel</code></p><p>  <strong>①、 启动Sentinel控制台</strong></p><div class="language-shell codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-shell codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain">java -Dserver.port</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token plain"> -Dcsp.sentinel.dashboard.server</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">localhost:8088 -Dproject.name</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">sentinel-dashboard -Dcsp.sentinel.log.dir</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">/Users/yoey/WorkSpace/Software/SpringCloud/sentinel/logs -jar sentinel-dashboard-1.8.0.jar</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  <strong>②、 访问Sentinel控制台</strong></p><p>  <img loading="lazy" alt="image-20201219122039928" src="/assets/images/image-20201219122039928-d26288bcc28501aa352e88c41b087987.png" width="1455" height="676" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="122-sentinel客户端nacos集群sentinel">1.2.2 Sentinel客户端(Nacos集群+Sentinel)<a class="hash-link" href="#122-sentinel客户端nacos集群sentinel" title="标题的直接链接">​</a></h4><ul><li><font color="red">操作步骤</font><ol><li>引入 Nacos 服务发现与配置中心的依赖</li><li>引入Sentinel的依赖 <code>spring-cloud-starter-alibaba-sentinel</code></li><li>修改配置文件，配置 Sentinel信息,并且暴露actuator 的监控端点<ul><li><code>spring.cloud.sentinel.transport.dashboard</code><ul><li>指定Sentinel 控制台的地址</li></ul></li><li><code>spring.cloud.sentinel.transport.port</code><ul><li>客户端监控 API 的端口</li></ul></li></ul></li></ol></li></ul><p><strong>①、 引入依赖</strong></p><div class="language-xml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-xml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">&lt;!--Sentinel--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-sentinel</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">&lt;!--Nacos 服务发现--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">&lt;!--Nacos配置中心--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">groupId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-config</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">artifactId</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&lt;/</span><span class="token tag" style="color:rgb(153, 76, 195)">dependency</span><span class="token tag punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>②、 修改配置文件</strong></p><div class="language-yml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token key atrule">spring</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">provider</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token number" style="color:rgb(170, 9, 130)">8007</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">profiles</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">active</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">nacos</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">ip</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> 172.24.230.126</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">provider</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">sentinel</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 使用nginx 搭建nacos 集群</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> 172.24.95.56</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 使用自定义的namespace id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> dev</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">coustom</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token number" style="color:rgb(170, 9, 130)">20201219</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> dev</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">coustom</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token number" style="color:rgb(170, 9, 130)">20201219</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> 172.24.95.56</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">prefix</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">provider</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token number" style="color:rgb(170, 9, 130)">8007</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">file-extension</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> yaml</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 配置 Sentinel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">transport</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">dashboard</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8719</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 暴露actuator端点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">management</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">endpoints</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">web</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">exposure</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">include</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&#x27;*&#x27;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>③、 请求服务，查看Sentinel 控制台</strong></p><p><img loading="lazy" alt="image-20201219154400132" src="/assets/images/image-20201219154400132-efef3dad80a479aae7835ed5d28420c1.png" width="1583" height="587" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="13-sentinel工作流程-责任链模式">1.3 Sentinel工作流程 <!-- -->[责任链模式]<a class="hash-link" href="#13-sentinel工作流程-责任链模式" title="标题的直接链接">​</a></h3><ul><li>在 Sentinel 里面，所有的资源都对应一个资源名称(<font color="red">resourceName</font> )，每次资源调用都会创建一个 Entry 对象<ul><li>Entry 可以通过对主流框架的适配自动创建，也可以通过注解的方式或调用 SphU API 显式创建</li><li>Entry 创建的时候，同时也会创建一系列功能插槽（slot chain），这些插槽有不同的职责，例如:<ul><li><code>NodeSelectorSlot</code><ul><li><font color="purple">建立树状结构(调用链路)</font></li><li>收集资源的路径，并将这些资源的调用路径，以树状结构存储起来，用于根据调用路径来限流降级；</li></ul></li><li><code>ClusterBuilderSlot</code><ul><li><font color="purple">根据资源保存统计簇点</font></li><li>存储资源的统计信息以及调用者信息，例如该资源的 RT, QPS, thread count 等等，这些信息将用作为多维度限流，降级的依据；</li></ul></li><li><code>StatisticSlot</code><ul><li><font color="purple">实时数据统计</font></li><li>记录、统计不同纬度的 runtime 指标监控信息；</li></ul></li><li><code>FlowSlot</code><ul><li><font color="purple">流量控制</font></li><li>则用于根据预设的限流规则以及前面 slot 统计的状态，来进行流量控制；</li></ul></li><li><code>DegradeSlot</code><ul><li><font color="purple">熔断降级</font></li><li>通过统计信息以及预设的规则，来做熔断降级；</li></ul></li><li><code>SystemSlot</code><ul><li><font color="purple">系统过载保护</font></li><li>通过系统的状态，例如 load1 等，来控制总的入口流量</li></ul></li><li><code>AuthoritySlot</code><ul><li>根据配置的黑白名单和调用来源信息，来做黑白名单控制；</li></ul></li></ul></li></ul></li></ul><p><strong>总体的框架:</strong></p><p><img loading="lazy" alt="image-20201219161355142" src="/assets/images/image-20201219161355142-58f3c968fe4ffeaab3df994a577fd1df.png" width="1065" height="680" class="img_CujE"></p><ul><li><mark>Sentinel 也支持自定义Slot 拓展</mark><ul><li>Sentinel 将 <code>ProcessorSlot</code> 作为 SPI 接口进行扩展，使得 Slot Chain 具备了扩展的能力。</li></ul></li></ul><p><img loading="lazy" alt="alt" src="/assets/images/image-20201220130706656-4ee057c0b619b603a5990fba5e578b75.png" width="880" height="269" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="14-sentinel规则">1.4 Sentinel规则<a class="hash-link" href="#14-sentinel规则" title="标题的直接链接">​</a></h3><ul><li><mark>Sentinel 的所有规则都可以在内存态中动态地查询及修改，修改之后立即生效。同时 Sentinel 也提供相关 API，来定制自己的规则策略</mark></li><li><font color="red">常见的规则种类</font><ul><li><code>流量控制</code></li><li><code>熔断降级</code></li><li><code>系统保护</code></li><li><code>来源访问控制</code></li><li><code>热点参数</code></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="2-sentinel规则-流控规则flowrule">2. Sentinel规则-流控规则(FlowRule)<a class="hash-link" href="#2-sentinel规则-流控规则flowrule" title="标题的直接链接">​</a></h2><ul><li><font color="red">流量控制</font><ul><li><mark>通过<font color="red">监控应用流量的 QPS 或并发线程数等指标</font>，当达到指定的阈值时对流量进行控制，以避免被瞬时的流量高峰冲垮，从而保障应用的高可用性</mark></li><li><code>FlowSlot</code> 会根据预设的规则(FlowRule)，结合 <code>NodeSelectorSlot</code>、<code>ClusterBuilderSlot</code>、<code>StatisticSlot</code> 统计出来的实时信息进行流量控制</li></ul></li></ul><p><img loading="lazy" alt="image-20201222193547149" src="/assets/images/image-20201222193547149-0724d0017217647be87b9d7f686b5762.png" width="1115" height="299" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="20-限流规则说明">2.0 限流规则说明<a class="hash-link" href="#20-限流规则说明" title="标题的直接链接">​</a></h3><ul><li><font color="red">同一个资源可以创建多条限流规则</font><ul><li><code>FlowSlot</code> 会对该资源的所有限流规则依次遍历，直到有规则触发限流或者所有规则遍历完毕</li></ul></li><li><p><strong>一条限流规则主要由下面几个因素组成，通过组合这些元素来实现不同的限流效果</strong>：</p></li></ul><table><thead><tr><th>Field</th><th>说明</th><th>可选值</th><th>默认值</th></tr></thead><tbody><tr><td><font color="red"><code>resource</code></font></td><td>资源名，即限流规则的作用对象</td><td></td><td>请求路径PATH</td></tr><tr><td><font color="red"><code>count</code></font></td><td>限流阈值</td><td></td><td></td></tr><tr><td><font color="red"><code>grade</code></font></td><td>限流阈值类型 <mark>(QPS 或并发线程数)</mark></td><td><font color="red"><code>0</code></font> : 并发线程模式   <font color="red"><code>1</code></font> : QPS模式</td><td>QPS 模式</td></tr><tr><td><font color="red"><code>limitApp</code></font></td><td>流量控制针对的调用来源</td><td></td><td>默认为 <font color="red"><code>default</code></font>，不区分调用来源</td></tr><tr><td><font color="red"><code>strategy</code></font></td><td>限流模式  (<font color="red">直接、链路、关联</font>)</td><td></td><td>根据资源本身（<font color="red">直接</font>）</td></tr><tr><td><font color="red"><code>controlBehavior</code></font></td><td>QPS限流效果,不支持按调用关系限流</td><td>直接拒绝、Warm Up、匀速排队</td><td>直接拒绝</td></tr><tr><td><font color="red"><code>clusterMode</code></font></td><td>是否集群限流</td><td></td><td>否</td></tr><tr><td><font color="red"><code>maxQueueingTimeMs</code></font></td><td>最大排队等待时长</td><td></td><td></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_loeA" id="21-限流阈值统计方式">2.1 限流阈值统计方式<a class="hash-link" href="#21-限流阈值统计方式" title="标题的直接链接">​</a></h3><ul><li><p>主要有两种阈值统计类型, <mark>其中线程数、QPS 值，都是由 <font color="red">StatisticSlot</font>实时统计获取的</mark> </p></li><li><font color="red">统计并发线程数 -&gt; FlowSlot.grade=0</font><ul><li>采用JMeter 等压测工具进行测试</li></ul></li><li><font color="red">统计QPS -&gt; FlowSlot.grade=1</font></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="211-基于并发线程数服务端最多允许多少线程处理请求">2.1.1 基于并发线程数（服务端最多允许多少线程处理请求）<a class="hash-link" href="#211-基于并发线程数服务端最多允许多少线程处理请求" title="标题的直接链接">​</a></h4><ul><li><font color="red">并发数控制用于保护业务线程池不被慢调用耗尽</font><ul><li>比如应用所依赖的下游应用由于某种原因导致服务不稳定、响应延迟增加，对于调用者来说，意味着吞吐量下降和更多的线程数占用，极端情况下甚至导致线程池耗尽</li></ul></li><li><p>Sentinel 并发控制不负责创建和管理线程池，而是简单统计当前请求上下文的线程数目（正在执行的调用数目）</p><ul><li>如果超出阈值，新的请求会被立即拒绝，效果类似于信号量隔离</li></ul></li><li><font color="red">线程并发数控制通常在调用端进行配置</font></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="212-基于qps每秒最多允许多少请求进入服务端处理">2.1.2 基于QPS（每秒最多允许多少请求进入服务端处理）<a class="hash-link" href="#212-基于qps每秒最多允许多少请求进入服务端处理" title="标题的直接链接">​</a></h4><ul><li>当 QPS 超过指定的阈值的时候，则采取措施进行限流,<mark>主要有下面三种限流行为</mark><ul><li><code>快速失败 (默认)</code></li><li><code>Warm Up -&gt; 预热/冷启动</code></li><li><code>排队等待</code></li></ul></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="2121-限流效果-快速失败默认">2.1.2.1 限流效果-快速失败（默认）<a class="hash-link" href="#2121-限流效果-快速失败默认" title="标题的直接链接">​</a></h5><ul><li><font color="red">RuleConstant.CONTROL_BEHAVIOR_DEFAULT</font></li><li>当QPS超过任意规则的阈值后，新的请求就会被立即拒绝，拒绝方式为抛出<code>FlowException</code></li><li>源码: <code>com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController</code></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="2122-限流效果-冷启动">2.1.2.2 限流效果-冷启动<a class="hash-link" href="#2122-限流效果-冷启动" title="标题的直接链接">​</a></h5><ul><li><font color="red">RuleConstant.CONTROL_BEHAVIOR_WARM_UP</font></li><li>让通过的流量缓慢增加，在一定时间内逐渐增加到阈值上限，给冷系统一个预热的时间，避免冷系统被压垮</li><li><font color="red">默认<code>冷加载因子</code>coldFactor为3，即请求QPS从threshold/3开始，经指定的预热时长逐渐升至设定的QPS阈值。</font></li><li>适用场景<ul><li>这个场景主要用于启动需要额外开销的场景，例如建立数据库连接等</li></ul></li><li>源码: <code>com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController</code></li></ul><h6 class="anchor anchorWithStickyNavbar_loeA" id="21221-设置规则控制台">2.1.2.2.1 设置规则(控制台)<a class="hash-link" href="#21221-设置规则控制台" title="标题的直接链接">​</a></h6><p>下图表示: 资源在前30s的QPS阈值为 20/3≈6,经过30s的系统预热后，QPS 阈值稳步的提升到 20</p><p><img loading="lazy" src="/assets/images/image-20201221095044809-a4416584a23e2494e07b5465440b12ae.png" width="657" height="511" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="21222-设置规则代码">2.1.2.2.2 设置规则(代码)<a class="hash-link" href="#21222-设置规则代码" title="标题的直接链接">​</a></h6><ul><li><font color="red">方法含义说明</font><ol><li><code>rule.setCount</code><ul><li>预热完成后，请求所达到的最终阈值</li></ul></li><li><code>rule.setWarmUpPeriodSec</code><ul><li>冷系统预热所需时间</li></ul></li></ol></li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* 基于QPS 冷启动限流</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">InitWarmUpQPSFlow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CollectionUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">isEmpty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rules</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Lists</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">newArrayList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 阈值类型-&gt; qps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStrategy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">STRATEGY_DIRECT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 限流效果-&gt;预热</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_WARM_UP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 预热后每秒允许通过20个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置需要5s 的预热时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setWarmUpPeriodSec</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">30</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_loeA" id="2123-限流效果-排队等待">2.1.2.3 限流效果-排队等待<a class="hash-link" href="#2123-限流效果-排队等待" title="标题的直接链接">​</a></h5><ul><li><p>说明</p><ul><li><font color="red">RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER</font></li><li>让请求以均匀的速度通过，对应的是漏桶算法 -&gt; 匀速排队模式暂时不支持 QPS &gt; 1000 的场景</li></ul></li><li><font color="red">中心思想</font><ul><li>以固定的间隔时间让请求通过，当请求到来的时候<ul><li>如果当前请求距离上个通过的请求通过的时间间隔不小于预设值，则让当前请求通过</li><li>否则，计算当前请求的预期通过时间<ul><li>如果该请求的预期通过时间小于规则预设的最大排队时长时间，则该请求会等待直到预设时间到来通过（排队等待处理）<ul><li><mark><font color="red">也就是将请求放在虚拟队列中！</font></mark></li></ul></li><li>若预期的通过时间超出最大排队时长，则直接拒接这个请求</li></ul></li></ul></li></ul></li><li><p>适用场景</p><ul><li>适合用于请求以突刺状来到，这个时候我们不希望一下子把所有的请求都通过，这样可能会把系统压垮；同时我们也期待系统以稳定的速度，逐步处理这些请求，以起到“削峰填谷”的效果，而不是拒绝所有请求</li></ul></li></ul><h6 class="anchor anchorWithStickyNavbar_loeA" id="21231-设置规则控制台">2.1.2.3.1 设置规则(控制台)<a class="hash-link" href="#21231-设置规则控制台" title="标题的直接链接">​</a></h6><p><img loading="lazy" src="/assets/images/image-20201221090343257-652833158d8c6d35d38f854ab6fb14fa.png" width="665" height="510" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="21232-设置规则代码">2.1.2.3.2 设置规则(代码)<a class="hash-link" href="#21232-设置规则代码" title="标题的直接链接">​</a></h6><ul><li><font color="red">方法含义说明</font><ol><li><code>rule.setCount</code><ul><li>此时表示每一秒允许通过的请求数，超过的请求会放在虚拟队列中进行等待</li><li>如果设置为10，那么每个请求平均间隔恒定为 <code>1000 / 10 = 100 ms</code></li></ul></li><li><code>rule.setMaxQueueingTimeMs</code><ul><li>虚拟队列中请求允许的最大等待时间 -&gt; 超时时间</li></ul></li></ol></li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* 基于QPS 排队等待限流</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">InitRateLimiterQPSFlow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CollectionUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">isEmpty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rules</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Lists</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">newArrayList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 阈值类型-&gt; qps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 每一秒匀速通过5个请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 限流模式 -&gt; 直接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStrategy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">STRATEGY_DIRECT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 限流效果-&gt;匀速排队</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_RATE_LIMITER</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 每一个请求的最长长排队等待时间: 20s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setMaxQueueingTimeMs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">20</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">1000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    控制台输出 :可以看到请求以每1s通过5个的速率通过</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    2020-12-21 09:10:42.028  WARN 1967 --- [nio-8007-exec-3] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:42.231  WARN 1967 --- [nio-8007-exec-4] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:42.429  WARN 1967 --- [nio-8007-exec-5] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:42.631  WARN 1967 --- [nio-8007-exec-6] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:42.825  WARN 1967 --- [nio-8007-exec-7] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.029  WARN 1967 --- [nio-8007-exec-8] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.431  WARN 1967 --- [nio-8007-exec-9] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.227  WARN 1967 --- [io-8007-exec-10] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.625  WARN 1967 --- [nio-8007-exec-1] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  2020-12-21 09:10:43.829  WARN 1967 --- [nio-8007-exec-2] c.y.controller.SentinelTestController    : request pass -&gt; getInfo</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="22-限流模式">2.2 限流模式<a class="hash-link" href="#22-限流模式" title="标题的直接链接">​</a></h3><ul><li><mark>适用基于QPS 和并发线程数的阈值类型</mark></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="221-限流模式---直接-限制资源本身">2.2.1 限流模式 - 直接 （限制资源本身）<a class="hash-link" href="#221-限流模式---直接-限制资源本身" title="标题的直接链接">​</a></h4><ul><li><font color="red">RuleConstant.STRATEGY_DIRECT</font></li><li>指定的资源到达限流阈值时，就对该资源进行限流</li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="2211-设置规则控制台">2.2.1.1 设置规则(控制台)<a class="hash-link" href="#2211-设置规则控制台" title="标题的直接链接">​</a></h5><p><img loading="lazy" src="/assets/images/image-20201220151904290-36abb2262677d313fbc31c4502dd4e3f.png" width="670" height="476" class="img_CujE"></p><h5 class="anchor anchorWithStickyNavbar_loeA" id="2212-设置规则代码">2.2.1.2 设置规则(代码)<a class="hash-link" href="#2212-设置规则代码" title="标题的直接链接">​</a></h5><ul><li><font color="red">操作步骤</font><ul><li>通过 <code>FlowRuleManager.loadRules(List&lt;FlowRule&gt; rules)</code> 方法加载流控规则</li></ul></li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowConfig</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">CommandLineRunner</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 指定资源名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">     </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 限流阈值类型-&gt; qps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 限流阈值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1d</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 限流模式 -&gt; 直接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStrategy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">STRATEGY_DIRECT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 限流行为-&gt;快速失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_DEFAULT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CollectionUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">isEmpty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            rules</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Lists</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">newArrayList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="222-限流模式---关联-限制上游资源">2.2.2 限流模式 - 关联 (限制上游资源)<a class="hash-link" href="#222-限流模式---关联-限制上游资源" title="标题的直接链接">​</a></h4><ul><li><font color="red">RuleConstant.STRATEGY_RELATE</font><ul><li>资源A本身一般不会设置阈值</li><li>当资源A的关联的资源B到达限流阈值时，就限流资源A</li></ul></li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="2221-设置规则控制台">2.2.2.1 设置规则(控制台)<a class="hash-link" href="#2221-设置规则控制台" title="标题的直接链接">​</a></h5><p><img loading="lazy" src="/assets/images/image-20201220164747762-aa16fe5e1b5f37e4109839b3091b1080.png" width="675" height="531" class="img_CujE"></p><h5 class="anchor anchorWithStickyNavbar_loeA" id="2222-设置规则代码">2.2.2.2 设置规则(代码)<a class="hash-link" href="#2222-设置规则代码" title="标题的直接链接">​</a></h5><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* 基于QPS  关联限流</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">InitRelateQPSFlow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">CollectionUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">isEmpty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rules</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Lists</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">newArrayList</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  * 资源A</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 限流模式 -&gt; 关联</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStrategy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">STRATEGY_RELATE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_DEFAULT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  * 资源B</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token plain"> relateRule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getInfo2&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setClusterMode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_DEFAULT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setRefResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">relateRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">FlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="223-限流模式---链路">2.2.3 限流模式 - 链路<a class="hash-link" href="#223-限流模式---链路" title="标题的直接链接">​</a></h4><ul><li><font color="red">RuleConstant.STRATEGY_CHAIN</font></li><li>只记录指定链路上的流量，如果到达阈值就限流</li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="3sentinel规则-熔断降级degraderule">3.Sentinel规则-熔断降级(DegradeRule)<a class="hash-link" href="#3sentinel规则-熔断降级degraderule" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="31-熔断降级说明">3.1 熔断降级说明<a class="hash-link" href="#31-熔断降级说明" title="标题的直接链接">​</a></h3><ol><li>除了流量控制之外，对调用链路中<code>不稳定的资源进行熔断降级</code>也是保障高可用的重要措施之一。</li><li>一个服务通常会调用其他的服务，依赖的服务的稳定性无法保证如果依赖的服务请求响应时间变长，那么调用服务的方法的响应时间也会变长，<font color="red">线程会堆积，最终可能耗尽业务自身的线程资源，服务变得不可用</font></li><li>微服务架构中有很多的服务组成，不同服务之间相互调用，组成复杂的调用链路。某个服务产生的问题在链路调用中会产生放大的效果。</li><li>复杂链路上的某一环不稳定，就可能会层层级联，最终导致整个链路都不可用。因此需要对不稳定的<strong>弱依赖服务调用</strong>进行熔断降级，暂时切断不稳定调用，避免局部不稳定因素导致整体的雪崩。</li><li><mark>熔断降级作为保护自身的手段，通常在客户端（调用端）进行配置。</mark></li></ol><h3 class="anchor anchorWithStickyNavbar_loeA" id="32-熔断降级规则说明">3.2 熔断降级规则说明<a class="hash-link" href="#32-熔断降级规则说明" title="标题的直接链接">​</a></h3><font color="red">同一个资源可以同时有多个降级规则</font><p><strong>规则重要属性</strong></p><table><thead><tr><th>字段</th><th>说明</th><th>可选值</th><th>默认值</th></tr></thead><tbody><tr><td><font color="red"><code>resource</code></font></td><td>资源名，即规则的作用对象</td><td></td><td></td></tr><tr><td><font color="red"><code>grade</code></font></td><td>熔断策略，</td><td>慢调用比例<br>异常比例<br>异常数策略</td><td>慢调用比例</td></tr><tr><td><font color="red"><code>count</code></font></td><td>慢调用比例模式下为慢调用最大响应时长RT（超出该值计为慢调用）<br>异常比例/异常数模式下为对应的阈值</td><td></td><td></td></tr><tr><td><font color="red"><code>timeWindow</code></font></td><td>时间窗口期，熔断时长（单位为 s）</td><td></td><td></td></tr><tr><td><font color="red"><code>minRequestAmount</code></font></td><td>熔断触发的最小请求数，<font color="blue">请求数小于该值时即使异常比率超出阈值也不会熔断</font>  <!-- -->[1.7.0 引入]</td><td></td><td>5</td></tr><tr><td><font color="red"><code>statIntervalMs</code></font></td><td>统计时长（单位为 ms）             <!-- -->[1.8.0 引入]</td><td></td><td>1000ms</td></tr><tr><td><font color="red"><code>slowRatioThreshold</code></font></td><td>慢调用比例阈值，<font color="green">仅慢调用比例模式有效</font> <!-- -->[1.8.0 引入]</td><td></td><td></td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_loeA" id="321-熔断策略">3.2.1 熔断策略<a class="hash-link" href="#321-熔断策略" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_loeA" id="3211-慢调用比例---slow_request_ratio">3.2.1.1 慢调用比例 - SLOW_REQUEST_RATIO<a class="hash-link" href="#3211-慢调用比例---slow_request_ratio" title="标题的直接链接">​</a></h5><ul><li><font color="red">从Sentient 1.8 版本开始，支持断路器的半开状态</font></li><li>选择以慢调用比例作为阈值，<mark>需要设置允许的慢调用 RT（即最大的响应时间)</mark><ul><li><font color="red">请求的响应时间大于该值则统计为慢调用</font></li></ul></li><li>当单位统计时长内请求数大于最小请求数，并且慢调用的比例大于阈值，则接下来的熔断时长内的请求会自动被熔断<ul><li>经过熔断时长后熔断器会进入探测恢复半开状态（HALF-OPEN 状态）<ul><li>若接下来的一个请求响应时间小于设置的慢调用 RT 则结束熔断</li><li>若大于设置的慢调用 RT 则会再次被熔断</li></ul></li></ul></li></ul><h6 class="anchor anchorWithStickyNavbar_loeA" id="32111规则设置控制台">3.2.1.1.1规则设置（控制台）<a class="hash-link" href="#32111规则设置控制台" title="标题的直接链接">​</a></h6><ul><li>在默认的统计时间范围（1s）内，如果请求数大于5，且慢调用的请求(Rt时间大于10ms)占总请求数的 50%，就对资源进行熔断，熔断时间为10s</li></ul><p><img loading="lazy" src="/assets/images/image-20201226134134343-c0055682fcfd3e07cb48a5b628608665.png" width="643" height="332" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="32112-规则设置代码">3.2.1.1.2 规则设置（代码）<a class="hash-link" href="#32112-规则设置代码" title="标题的直接链接">​</a></h6><ul><li>统计10s内的请求数据,如果请求数超过5个,每个请求 RT&gt;10ms,且这样的慢调用请求占总请求的30%,就进行服务熔断,熔断时间为10s</li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"> * 慢调用比例</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"> *  统计10s内的请求数据,如果请求数超过5个,每个请求 RT&gt;10ms,且这样的慢调用请求占总请求的30%,就进行服务熔断,熔断时间为10s</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">initSlowRequestRatio</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> degradeRules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 绑定率资源名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getSlowInfo&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置熔断策略 RT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">DEGRADE_GRADE_RT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置统计时长 10s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setStatIntervalMs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">1000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置统计时间范围内需要最少通过请求数  5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setMinRequestAmount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置每个请求最大响应时间RT 10ms</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置慢调用的阈值比例 0.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setSlowRatioThreshold</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0.3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置熔断时长</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setTimeWindow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token number" style="color:rgb(170, 9, 130)">1000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_loeA" id="3212-异常比例---error_ratio">3.2.1.2 异常比例 - ERROR_RATIO<a class="hash-link" href="#3212-异常比例---error_ratio" title="标题的直接链接">​</a></h5><ul><li>当单位统计时长内请求总数大于设置的最小请求数目，并且异常的比例大于阈值，则接下来的熔断时长内请求会自动被熔断</li></ul><h6 class="anchor anchorWithStickyNavbar_loeA" id="32121-规则设置控制台">3.2.1.2.1 规则设置（控制台）<a class="hash-link" href="#32121-规则设置控制台" title="标题的直接链接">​</a></h6><ul><li>在默认的统计时间范围（1s）内，如果请求数大于5，且异常请求数占总请求数的50%，就接下来1000s内的请求会自动被熔断</li></ul><p><img loading="lazy" src="/assets/images/image-20201226144904768-43b5cc9bc7ff75d2253b807ed0f1bf8f.png" width="647" height="330" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="32122-规则设置代码">3.2.1.2.2 规则设置（代码）<a class="hash-link" href="#32122-规则设置代码" title="标题的直接链接">​</a></h6><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">initExceptionRatio</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> degradeRules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 绑定率资源名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getError&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置熔断策略 RT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">DEGRADE_GRADE_EXCEPTION_RATIO</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置异常比例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0.5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置熔断时长</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setTimeWindow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_loeA" id="3213-异常数---error_count">3.2.1.3 异常数 - ERROR_COUNT<a class="hash-link" href="#3213-异常数---error_count" title="标题的直接链接">​</a></h5><ul><li>当单位统计时长内的异常数目超过阈值之后会自动进行熔断</li></ul><h5 class="anchor anchorWithStickyNavbar_loeA" id="32131-规则设置控制台">3.2.1.3.1 规则设置（控制台）<a class="hash-link" href="#32131-规则设置控制台" title="标题的直接链接">​</a></h5><p><img loading="lazy" src="/assets/images/image-20201226145132006-475be954563737d500b7cd8d5eed6367.png" width="664" height="339" class="img_CujE"></p><h6 class="anchor anchorWithStickyNavbar_loeA" id="32132-规则设置代码">3.2.1.3.2 规则设置（代码）<a class="hash-link" href="#32132-规则设置代码" title="标题的直接链接">​</a></h6><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">initExceptionCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> degradeRules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 绑定率资源名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getError&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置熔断策略 RT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">DEGRADE_GRADE_EXCEPTION_COUNT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置异常数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">5</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 设置熔断时长</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setTimeWindow</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">DegradeRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">degradeRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="4-定义资源---sentinelresource">4. 定义资源 - @SentinelResource<a class="hash-link" href="#4-定义资源---sentinelresource" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="41-sentinelresource-说明">4.1 @SentinelResource 说明<a class="hash-link" href="#41-sentinelresource-说明" title="标题的直接链接">​</a></h3><blockquote><p> 类似于Hystrix 的@HystrixCommand 注解</p></blockquote><ul><li><font color="red"><code>@SentinelResource</code> 用于定义资源，并提供可选的异常处理和 fallback 配置项</font></li><li><p><code>@SentinelResource</code> 注解包含以下属性</p><ul><li><p><code>value</code></p><ul><li>资源名称 <!-- -->[必需项]</li></ul></li><li><p><code>entryType</code></p><ul><li>entry 类型 <!-- -->[可选项]</li><li>默认为 <code>EntryType.OUT</code></li></ul></li><li><p><code>blockHandler / blockHandlerClass</code></p><ul><li><code>blockHandler</code> 对应处理 <code>BlockException</code> 的函数名称 <!-- -->[可选项]<ul><li>函数是 <code>public</code>，返回类型需要与原方法一致，参数类型需要和原方法相匹配并且最后加一个额外的参数，类型为 <code>BlockException</code> <ul><li>格式:  <code>public 业务方法返回值类型 方法名(业务方法形参列表,BlockException exception)</code></li></ul></li><li><mark><strong>blockHandler 函数默认需要和原方法在同一个类中</strong></mark></li></ul></li><li>若希望使用其他类的函数，则可以指定 <code>blockHandlerClass</code> 为对应的类的 <code>Class</code> 对象,<font color="red">注意对应的函数必需为 static 函数，否则无法解析</font> </li></ul></li><li><p><code>fallback  /  fallbackClass</code></p><ul><li>fallback 函数名称,用于在抛出异常的时候提供 fallback 处理逻辑 <!-- -->[可选项]</li><li><strong>fallback 函数可以针对所有类型的异常</strong> (除了 <code>exceptionsToIgnore</code> 里面排除掉的异常类型)进行处理</li><li><strong>fallback 函数签名和位置要求</strong><ul><li>返回值类型必须与原函数返回值类型一致</li><li>方法参数列表需要和原函数一致，或者可以额外多一个 <code>Throwable</code> 类型的参数用于接收对应的异常。</li><li>fallback 函数默认需要和原方法在同一个类中<ul><li>若希望使用其他类的函数，可以指定 <code>fallbackClass</code> 为对应的类的 <code>Class</code> 对象，注意对应的函数必需为 static 函数，否则无法解析</li></ul></li></ul></li></ul></li><li><p><code>defaultFallback</code></p><ul><li>默认的 fallback 函数名称 <!-- -->[可选项 从1.6开始支持]</li><li>通常用于通用的 fallback 逻辑（即可以用于很多服务或方法）</li><li><mark>从 1.8 版本开始，支持类级别配置</mark></li></ul></li><li><p><code>exceptionsToIgnore</code></p><ul><li>用于指定哪些异常被排除掉，不会计入异常统计中，也不会进入 fallback 逻辑中，而是会原样抛出。</li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="5-热点参数规则paramflowrule">5. 热点参数规则(ParamFlowRule)<a class="hash-link" href="#5-热点参数规则paramflowrule" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="51-热点参数">5.1 热点参数<a class="hash-link" href="#51-热点参数" title="标题的直接链接">​</a></h3><ul><li><mark>热点即经常访问的数据</mark>。很多时候我们希望统计某个热点数据中访问频次最高的 Top K 数据，并对其访问进行限制。比如：<ul><li>商品 ID 为热点，统计一段时间内最常购买的商品 ID 并进行限制</li><li>用户 ID 为热点，针对一段时间内频繁访问的用户 ID 进行限制</li></ul></li><li><font color="red">热点参数限流会统计传入参数中的热点参数，并根据配置的限流阈值与模式，对包含热点参数的资源调用进行限流</font><ul><li>热点参数限流可以看做是一种特殊的流量控制，仅对包含热点参数的资源调用生效</li></ul></li><li><p>Sentinel利用<font color="red"> <code>LRU策略 </code></font> 统计最近最常访问的热点参数，结合令牌桶算法来进行参数级别的流控</p></li></ul><p><img loading="lazy" src="/assets/images/image-20201226151214076-0e51bc17d28913e782c5977d56652038.png" width="916" height="285" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="52-热点参数规则属性说明">5.2 热点参数规则属性说明<a class="hash-link" href="#52-热点参数规则属性说明" title="标题的直接链接">​</a></h3><ul><li>热点参数规则（<code>ParamFlowRule</code>）类似于流量控制规则（<code>FlowRule</code>）：</li></ul><table><thead><tr><th>属性</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><font color="red"><code>resource</code></font></td><td>资源名</td><td></td></tr><tr><td><font color="red"><code>count</code></font></td><td>限流阈值</td><td></td></tr><tr><td><font color="red"><code>grade</code></font></td><td>限流模式</td><td>QPS</td></tr><tr><td><font color="red"><code>durationInSec</code></font></td><td>统计窗口时间长度（单位为秒）  <!-- -->[1.6.0 版本开始支持]</td><td>1s</td></tr><tr><td><font color="red"><code>controlBehavior</code></font></td><td>流控效果（支持快速失败和匀速排队模式）  <!-- -->[1.6.0 版本开始支持]</td><td>快速失败</td></tr><tr><td><font color="red"><code>maxQueueingTimeMs</code></font></td><td>最大排队等待时长（仅在匀速排队模式生效  <!-- -->[1.6.0 版本开始支持]</td><td>0ms</td></tr><tr><td><font color="red"><code>paramIdx</code></font></td><td>热点参数的索引，对应 <code>SphU.entry(xxx, args)</code> 中的参数索引位置</td><td></td></tr><tr><td><font color="red"><code>paramFlowItemList</code></font></td><td>参数例外项，可以针对指定的参数值单独设置限流阈值，不受前面 <code>count</code> 阈值的限制<br><mark>仅支持基本类型和字符串类型</mark></td><td></td></tr><tr><td><font color="red"><code>clusterMode</code></font></td><td>是否是集群参数流控规则</td><td>false</td></tr><tr><td><font color="red"><code>clusterConfig</code></font></td><td>集群流控相关配置</td><td></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_loeA" id="53-热点参数规则设置代码">5.3 热点参数规则设置（代码）<a class="hash-link" href="#53-热点参数规则设置代码" title="标题的直接链接">​</a></h3><ul><li><font color="red">操作步骤</font><ol><li>通过 <code>@SentinelResource</code> 注解定义资源，同时指定失败处理函数</li><li>新建热点参数规则，对资源的热点参数进行限制 -&gt; 请求中包含了热点参数，就对该参数进行限制</li></ol></li></ul><p><strong>①、 通过 @SentinelResource 定义资源</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@GetMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/getHotKey&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@SentinelResource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getHotKey&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                  blockHandler </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;getHotKeyHandler&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain">  </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getHotKey</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@RequestParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">required </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> user1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                         </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@RequestParam</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user2&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">required </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> user2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> info</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getHotKeyHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> user1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> user2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">BlockException</span><span class="token plain"> exception</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">format</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;自定义异常信息,异常类型:%s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">exception</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getClass</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>②， 设置一个热点参数规则</strong></p><p>如果QPS 中热点参数的数量超过3，就对该请求进行限制</p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">initHotKeyRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">List</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&lt;</span><span class="token generics class-name" style="color:rgb(17, 17, 17)">ParamFlowRule</span><span class="token generics punctuation" style="color:rgb(153, 76, 195)">&gt;</span><span class="token plain"> rules </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ParamFlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">ParamFlowRule</span><span class="token plain"> rule </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ParamFlowRule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/sentinelPayment/getHotKey&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 热点参数规则仅支持 QPS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setGrade</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">FLOW_GRADE_QPS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 热点参数规则的限流效果 -&gt; 快速失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setControlBehavior</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">RuleConstant</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">CONTROL_BEHAVIOR_DEFAULT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">//  热点参数规则的阈值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setCount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 热点参数的索引 -&gt; 即业务方法形参中所在的索引位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setParamIdx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rule</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token class-name" style="color:rgb(17, 17, 17)">ParamFlowRuleManager</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">loadRules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">rules</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>③、 界面测试</strong></p><p><img loading="lazy" src="/assets/images/image-20201226162312521-c31cd565a794af2b64564da7af364968.png" width="731" height="154" class="img_CujE"></p><h3 class="anchor anchorWithStickyNavbar_loeA" id="531-为不同的热点参数值设置不同的阈值">5.3.1 为不同的热点参数值设置不同的阈值<a class="hash-link" href="#531-为不同的热点参数值设置不同的阈值" title="标题的直接链接">​</a></h3><mark>对热点参数不同的取值进行控制</mark><p><img loading="lazy" src="/assets/images/image-20201226163750215-4361cabb1b773e1bc762e8b77f8c68bc.png" width="655" height="687" class="img_CujE"></p><hr><h2 class="anchor anchorWithStickyNavbar_loeA" id="6-系统规则systemrule">6. 系统规则（SystemRule）<a class="hash-link" href="#6-系统规则systemrule" title="标题的直接链接">​</a></h2><ul><li>系统规则从总体的应用入口流量进行控制，结合应用的 Load、CPU 使用率、总体平均 RT、入口 QPS 和并发线程数等几个维度的监控指标<ul><li>通过自适应的流控策略，让系统的入口流量和系统的负载达到一个平衡，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="61-系统规则属性说明">6.1 系统规则属性说明<a class="hash-link" href="#61-系统规则属性说明" title="标题的直接链接">​</a></h3><table><thead><tr><th>Field</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><font color="red"><code>highestSystemLoad</code></font></td><td><code>load1</code> 触发值，用于触发自适应控制阶段</td><td>-1 (不生效)</td></tr><tr><td><font color="red"><code>avgRt</code></font></td><td>所有入口流量的平均响应时间</td><td>-1 (不生效)</td></tr><tr><td><font color="red"><code>maxThread</code></font></td><td>入口流量的最大并发数</td><td>-1 (不生效)</td></tr><tr><td><font color="red"><code>qps</code></font></td><td>所有入口资源的 QPS</td><td>-1 (不生效)</td></tr><tr><td><font color="red"><code>highestCpuUsage</code></font></td><td>当前系统的 CPU 使用率（0.0-1.0）</td><td>-1 (不生效</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_loeA" id="611-规则设置控制台">6.1.1 规则设置（控制台）<a class="hash-link" href="#611-规则设置控制台" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="/assets/images/image-20201226165111707-aaaa1ee5391a27a63a7999bfd905f57a.png" width="656" height="242" class="img_CujE"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MagicalZhu/NoteLib/tree/main/docs/SpringCloud/Alibaba/服务容错- Sentinel.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_N_05" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">最后<!-- -->由 <b>YuLiang Zhu</b> <!-- -->于 <b><time datetime="2022-12-06T01:19:52.000Z">2022年12月6日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/SpringCloud/Alibaba/Nacos"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">服务注册与配置中心-Nacos</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><p class="content_nRws">Contents</p><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-sentinel" class="table-of-contents__link toc-highlight">1. Sentinel</a><ul><li><a href="#11-sentinel概述" class="table-of-contents__link toc-highlight">1.1 Sentinel概述</a></li><li><a href="#12-sentinel-基本环境搭建" class="table-of-contents__link toc-highlight">1.2 Sentinel 基本环境搭建</a><ul><li><a href="#121-控制台搭建" class="table-of-contents__link toc-highlight">1.2.1 控制台搭建</a></li><li><a href="#122-sentinel客户端nacos集群sentinel" class="table-of-contents__link toc-highlight">1.2.2 Sentinel客户端(Nacos集群+Sentinel)</a></li></ul></li><li><a href="#13-sentinel工作流程-责任链模式" class="table-of-contents__link toc-highlight">1.3 Sentinel工作流程 责任链模式</a></li><li><a href="#14-sentinel规则" class="table-of-contents__link toc-highlight">1.4 Sentinel规则</a></li></ul></li><li><a href="#2-sentinel规则-流控规则flowrule" class="table-of-contents__link toc-highlight">2. Sentinel规则-流控规则(FlowRule)</a><ul><li><a href="#20-限流规则说明" class="table-of-contents__link toc-highlight">2.0 限流规则说明</a></li><li><a href="#21-限流阈值统计方式" class="table-of-contents__link toc-highlight">2.1 限流阈值统计方式</a><ul><li><a href="#211-基于并发线程数服务端最多允许多少线程处理请求" class="table-of-contents__link toc-highlight">2.1.1 基于并发线程数（服务端最多允许多少线程处理请求）</a></li><li><a href="#212-基于qps每秒最多允许多少请求进入服务端处理" class="table-of-contents__link toc-highlight">2.1.2 基于QPS（每秒最多允许多少请求进入服务端处理）</a><ul><li><a href="#2121-限流效果-快速失败默认" class="table-of-contents__link toc-highlight">2.1.2.1 限流效果-快速失败（默认）</a></li><li><a href="#2122-限流效果-冷启动" class="table-of-contents__link toc-highlight">2.1.2.2 限流效果-冷启动</a><ul><li><a href="#21221-设置规则控制台" class="table-of-contents__link toc-highlight">2.1.2.2.1 设置规则(控制台)</a></li><li><a href="#21222-设置规则代码" class="table-of-contents__link toc-highlight">2.1.2.2.2 设置规则(代码)</a></li></ul></li><li><a href="#2123-限流效果-排队等待" class="table-of-contents__link toc-highlight">2.1.2.3 限流效果-排队等待</a><ul><li><a href="#21231-设置规则控制台" class="table-of-contents__link toc-highlight">2.1.2.3.1 设置规则(控制台)</a></li><li><a href="#21232-设置规则代码" class="table-of-contents__link toc-highlight">2.1.2.3.2 设置规则(代码)</a></li></ul></li></ul></li></ul></li><li><a href="#22-限流模式" class="table-of-contents__link toc-highlight">2.2 限流模式</a><ul><li><a href="#221-限流模式---直接-限制资源本身" class="table-of-contents__link toc-highlight">2.2.1 限流模式 - 直接 （限制资源本身）</a><ul><li><a href="#2211-设置规则控制台" class="table-of-contents__link toc-highlight">2.2.1.1 设置规则(控制台)</a></li><li><a href="#2212-设置规则代码" class="table-of-contents__link toc-highlight">2.2.1.2 设置规则(代码)</a></li></ul></li><li><a href="#222-限流模式---关联-限制上游资源" class="table-of-contents__link toc-highlight">2.2.2 限流模式 - 关联 (限制上游资源)</a><ul><li><a href="#2221-设置规则控制台" class="table-of-contents__link toc-highlight">2.2.2.1 设置规则(控制台)</a></li><li><a href="#2222-设置规则代码" class="table-of-contents__link toc-highlight">2.2.2.2 设置规则(代码)</a></li></ul></li><li><a href="#223-限流模式---链路" class="table-of-contents__link toc-highlight">2.2.3 限流模式 - 链路</a></li></ul></li></ul></li><li><a href="#3sentinel规则-熔断降级degraderule" class="table-of-contents__link toc-highlight">3.Sentinel规则-熔断降级(DegradeRule)</a><ul><li><a href="#31-熔断降级说明" class="table-of-contents__link toc-highlight">3.1 熔断降级说明</a></li><li><a href="#32-熔断降级规则说明" class="table-of-contents__link toc-highlight">3.2 熔断降级规则说明</a><ul><li><a href="#321-熔断策略" class="table-of-contents__link toc-highlight">3.2.1 熔断策略</a><ul><li><a href="#3211-慢调用比例---slow_request_ratio" class="table-of-contents__link toc-highlight">3.2.1.1 慢调用比例 - SLOW_REQUEST_RATIO</a><ul><li><a href="#32111规则设置控制台" class="table-of-contents__link toc-highlight">3.2.1.1.1规则设置（控制台）</a></li><li><a href="#32112-规则设置代码" class="table-of-contents__link toc-highlight">3.2.1.1.2 规则设置（代码）</a></li></ul></li><li><a href="#3212-异常比例---error_ratio" class="table-of-contents__link toc-highlight">3.2.1.2 异常比例 - ERROR_RATIO</a><ul><li><a href="#32121-规则设置控制台" class="table-of-contents__link toc-highlight">3.2.1.2.1 规则设置（控制台）</a></li><li><a href="#32122-规则设置代码" class="table-of-contents__link toc-highlight">3.2.1.2.2 规则设置（代码）</a></li></ul></li><li><a href="#3213-异常数---error_count" class="table-of-contents__link toc-highlight">3.2.1.3 异常数 - ERROR_COUNT</a></li><li><a href="#32131-规则设置控制台" class="table-of-contents__link toc-highlight">3.2.1.3.1 规则设置（控制台）</a><ul><li><a href="#32132-规则设置代码" class="table-of-contents__link toc-highlight">3.2.1.3.2 规则设置（代码）</a></li></ul></li></ul></li></ul></li></ul></li><li><a href="#4-定义资源---sentinelresource" class="table-of-contents__link toc-highlight">4. 定义资源 - @SentinelResource</a><ul><li><a href="#41-sentinelresource-说明" class="table-of-contents__link toc-highlight">4.1 @SentinelResource 说明</a></li></ul></li><li><a href="#5-热点参数规则paramflowrule" class="table-of-contents__link toc-highlight">5. 热点参数规则(ParamFlowRule)</a><ul><li><a href="#51-热点参数" class="table-of-contents__link toc-highlight">5.1 热点参数</a></li><li><a href="#52-热点参数规则属性说明" class="table-of-contents__link toc-highlight">5.2 热点参数规则属性说明</a></li><li><a href="#53-热点参数规则设置代码" class="table-of-contents__link toc-highlight">5.3 热点参数规则设置（代码）</a></li><li><a href="#531-为不同的热点参数值设置不同的阈值" class="table-of-contents__link toc-highlight">5.3.1 为不同的热点参数值设置不同的阈值</a></li></ul></li><li><a href="#6-系统规则systemrule" class="table-of-contents__link toc-highlight">6. 系统规则（SystemRule）</a><ul><li><a href="#61-系统规则属性说明" class="table-of-contents__link toc-highlight">6.1 系统规则属性说明</a><ul><li><a href="#611-规则设置控制台" class="table-of-contents__link toc-highlight">6.1.1 规则设置（控制台）</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">前端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://v3.cn.vuejs.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">React<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://ts.xcatliu.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TypeScript<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://developer.mozilla.org/zh-CN/docs/Web" target="_blank" rel="noopener noreferrer" class="footer__link-item">MDN<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">后端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spring<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">JVM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.infoq.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">InfoQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">文档构建</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://typoraio.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Typora<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 huakucha. Built With Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf86732a.js"></script>
<script src="/assets/js/main.98457ee6.js"></script>
</body>
</html>