<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-SpringCloud/Netflix/Hystrix">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">服务熔断-Hystrix | 花裤衩Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" name="twitter:image" content="https://huakucha.com/img/fav.png"><meta data-rh="true" property="og:url" content="https://huakucha.com/docs/SpringCloud/Netflix/Hystrix"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="服务熔断-Hystrix | 花裤衩Wiki"><meta data-rh="true" name="description" content="1.Hystrix 概述"><meta data-rh="true" property="og:description" content="1.Hystrix 概述"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://huakucha.com/docs/SpringCloud/Netflix/Hystrix"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/SpringCloud/Netflix/Hystrix" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://huakucha.com/docs/SpringCloud/Netflix/Hystrix" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QZ9YPBGUYT-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="花裤衩Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="花裤衩Wiki Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="花裤衩Wiki JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="花裤衩Wiki" href="/opensearch.xml">

<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.font.im/css?family=Raleway:500,700&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.864d50a7.css">
<link rel="preload" href="/assets/js/runtime~main.bf86732a.js" as="script">
<link rel="preload" href="/assets/js/main.98457ee6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_D8pK">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="content_zf74 announcementBarContent_dpRF">🌟欢迎来到花裤衩的博客🌟</div><button type="button" aria-label="关闭" class="clean-btn close closeButton_ZdWa announcementBarClose_iXyO"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--light_PnYV"><img src="/img/logo.svg" alt="花裤衩的博客" class="themedImage_Pn4p themedImage--dark_eYgw"></div><b class="navbar__title text--truncate">花裤衩</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">基础知识🤖</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/currency">并发编程</a></li><li><a class="dropdown__link" href="/docs/networrk-basic">计算机网络</a></li><li><a class="dropdown__link" href="/docs/linuxCommand">Linux</a></li><li><a class="dropdown__link" href="/docs/dataStructure">数据结构与算法</a></li><li><a class="dropdown__link" href="/docs/leetCode">LeetCode</a></li><li><a class="dropdown__link" href="/docs/mysql">MySQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">后端框架👨‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/spring">Spring</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/springCloud">SpringCloud</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">方法论🚧</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/distribute/protol">分布式理论</a></li><li><a class="dropdown__link" href="/docs/distribute/basicTech">分布式技术点</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">中间件🚀</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/middleware/basicMiddleware">基础中间件</a></li><li><a class="dropdown__link" href="/docs/middleware/job">定时任务</a></li><li><a class="dropdown__link" href="/docs/middleware/cache">缓存</a></li><li><a class="dropdown__link" href="/docs/middleware/searchEngine">搜索引擎</a></li><li><a class="dropdown__link" href="/docs/middleware/messageQueue">消息队列</a></li><li><a class="dropdown__link" href="/docs/middleware/database">数据库</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">底层⛽️</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/JVM">JVM</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">前端技术👩‍💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/front/Vue">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其他工具👹</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Gradle">Gradle</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">物料中心👏</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/website/BE">后端产品</a></li><li><a class="dropdown__link" href="/website/COM">其他产品</a></li><li><a class="dropdown__link" href="/website/FE">前端产品</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.huakucha.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">关于<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/MagicalZhu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_MW0i colorModeToggle_x44X"><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SFTY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ekgs"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_H2mL"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_W2AM"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_ntye" type="button"></button><div class="docPage_qMb8"><aside class="theme-doc-sidebar-container docSidebarContainer_rpaz"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_Y1UP menuWithAnnouncementBar_fPny"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/springCloud">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/微服务基础">微服务基础</a><button aria-label="打开/收起侧边栏菜单「微服务基础」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/微服务技术栈">微服务技术栈</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/springcloud-netflix">SpringCloud-Netflix</a><button aria-label="打开/收起侧边栏菜单「SpringCloud-Netflix」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Netflix/Eureka&amp;Consul">服务注册-Eureka&amp;Consul</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Netflix/Ribbon">服务调用-Ribbon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Netflix/OpenFeign">服务接口调用-OpenFeign</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/SpringCloud/Netflix/Hystrix">服务熔断-Hystrix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Netflix/GateWay">服务网关-GateWay</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Netflix/Config">服务配置中心-Config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Netflix/Bus">消息总线-Bus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Netflix/Stream">消息驱动-Stream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/SpringCloud/Netflix/Sleuth">链路追踪-Sleuth</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/springcloud-alibaba">SpringCloud-Alibaba</a><button aria-label="打开/收起侧边栏菜单「SpringCloud-Alibaba」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_JQG6"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Iseg"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SLhD"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/微服务基础"><span itemprop="name">微服务基础</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/springcloud-netflix"><span itemprop="name">SpringCloud-Netflix</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">服务熔断-Hystrix</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_IbkY theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_p7nN">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>服务熔断-Hystrix</h1></header><h2 class="anchor anchorWithStickyNavbar_loeA" id="1hystrix-概述">1.Hystrix 概述<a class="hash-link" href="#1hystrix-概述" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="11-分布式系统面临的问题">1.1 分布式系统面临的问题<a class="hash-link" href="#11-分布式系统面临的问题" title="标题的直接链接">​</a></h3><ul><li><p>复杂分布式体系结构中的应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免地失败</p></li><li><mark>扇出</mark><ul><li>当 服务A 调用 服务B，服务B又调服务C和其他微服务</li></ul></li><li><mark>服务雪崩</mark><ul><li>如果扇出的链路上某个服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系统资源，进而引起系统崩溃</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="12-hystrix-是什么">1.2 Hystrix 是什么？<a class="hash-link" href="#12-hystrix-是什么" title="标题的直接链接">​</a></h3><ul><li><p>Hystrix 是一个用于<code>处理分布式系统的延迟和容错</code>的开源库</p><ul><li>在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等</li><li>Hystrix能够保证在一个依赖出问题的情况下 , 不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性<ul><li><font color="blue">所谓 &quot;弹性&quot; , 简单说就是系统从困难中恢复的能力</font></li></ul></li></ul></li><li><mark><font color="red"><strong>使用AOP的方式处理服务调用异常！</strong></font></mark></li><li><p>“断路器” 本身是一种开关装置</p><ul><li><font color="red">当某个服务单元发生故障之后，通过断路器的故障监控，向调用方返回一个符合预期的、可处理的备选响应（FallBack）而不是长时间的等待或者抛出调用方无法处理的异常</font><ul><li>这样就保证了服务调用方的线程不会被长时间、不必要地占用，从而避免了故障在分布式系统中的蔓延，乃至雪崩</li></ul></li></ul></li><li><font color="blue"><strong>Hystrix 重要概念</strong></font><ul><li><mark>服务降级 (fallback)</mark><ul><li>服务降级一般放在客户端</li><li><font color="purple">降级一般是服务出现异常，无法返回正常的服务数据或者客户端出现异常，客户端自己准备一个本地的fallback回调，返回一个默认值</font></li><li><strong>哪些情况会触发降级</strong><ul><li>程序运行异常</li><li>服务超时</li><li>服务熔断触发服务降级</li><li>线程池/信号量打满也会导致服务降级 </li></ul></li></ul></li><li><mark>服务熔断 (break)</mark><ul><li><p>在服务端实现完成</p></li><li><font color="purple">一般是某个服务异常引起的，相当于“保险丝”，当某个异常条件被触发，直接熔断整个服务，不是等到此服务超时</font><ul><li>服务的降级-&gt;进而熔断-&gt;恢复调用链路</li></ul></li></ul></li><li><mark>服务限流(flowlimit)</mark><ul><li>秒杀高并发等操作，严禁一窝蜂的过来拥挤，一秒钟N个，有序进行</li></ul></li><li><mark>接近实时的监控</mark><ul><li>Hystrix Dashboard</li></ul></li><li><p>.....</p></li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="121-线程池打满导致服务需要降级示例">1.2.1 线程池打满导致服务需要降级示例<a class="hash-link" href="#121-线程池打满导致服务需要降级示例" title="标题的直接链接">​</a></h4><ul><li><font color="blue">示例说明： 微服务包含两个api，A接口瞬时响应，B接口等待三秒响应</font></li><li><font color="red">高并发测试</font><ul><li>2000个线程循环10次访问B 接口，然后再调用A接口，<font color="green">发现访问A接口需要耗费进一分钟</font></li></ul></li><li><font color="red">测试结果说明</font><ul><li><font color="blue">当web服务器的工作线程数被打满时候，没有其他多余的线程资源来处理请求</font>，此时就需要服务降级，给用户一个默认返回值</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="2服务熔断服务降级">2.服务熔断&amp;服务降级<a class="hash-link" href="#2服务熔断服务降级" title="标题的直接链接">​</a></h2><ul><li><font color="red">常见的注解和类</font><ul><li><p><code>@HystrixCommand</code></p><ul><li><p><strong>Hystrix命令</strong>, 基于AOP的方式<font color="red">HystrixCommandAspect</font> 处理该注解</p></li><li><font color="red"><em>注意： Hystrix命令会放在Hystrix的线程池中执行，这就起到了线程隔离的作用!</em></font></li><li><mark>常见的属性</mark><ul><li><code>defaultFallback</code><ul><li>默认的失败处理方法</li><li><font color="purple">失败处理方法应该在 hystrix命令 所在的类中定义，且方法是无参的!!!</font></li></ul></li><li><code>fallbackMethod</code><ul><li>指定失败处理方法</li><li><font color="purple">失败处理方法应该在 hystrix命令 所在的类中定义，且方法的形参应该具有与hystrix命令调用的方法一致</font></li></ul></li><li><code>HystrixProperty[] commandProperties() / HystrixProperty[] threadPoolProperties</code><ul><li>hystrix 命令参数以及线程池相关参数，比如超时的 <code>execution.isolation.thread.timeoutInMilliseconds</code></li><li>参数部分见 <font color="red">com.netflix.hystrix.HystrixCommandProperties</font> </li></ul></li><li><code>Class&lt;? extends Throwable&gt;[] ignoreExceptions()</code><ul><li>忽略的异常</li></ul></li><li><code>groupKey</code></li><li><code>commandKey</code><ul><li>Hystrix命令的键，默认是注解标注的方法名</li></ul></li></ul></li></ul></li><li><p><code>@DefaultProperties</code></p><ul><li><strong>Hystrix 默认配置</strong>，<font color="red">注解属性除了没有fallbackMethod,其他和@HystrixCommand 一致</font></li></ul></li><li><p><code>@EnableHystrix</code></p><ul><li><strong>启用Hystrix功能</strong></li></ul></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_loeA" id="21-服务降级--指定服务降级-">2.1 服务降级 【 指定服务降级 】<a class="hash-link" href="#21-服务降级--指定服务降级-" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_loeA" id="211-服务端降级-以及-设置hystrix命令的超时时间">2.1.1 服务端降级 以及 设置Hystrix命令的超时时间<a class="hash-link" href="#211-服务端降级-以及-设置hystrix命令的超时时间" title="标题的直接链接">​</a></h4><ul><li><font color="red">操作步骤</font><ol><li>引入 Hystrix 的依赖</li><li>在启动类上标注 <font color="red"><code>@EnableHystrix</code></font> 启用 hystrix</li><li>在业务类上标注 <font color="red"><code>@HystrixCommand</code></font>  配置hystrix命令<ul><li>通过 <code>fallback</code> 属性指定异常处理/回退方法</li></ul></li></ol></li></ul><p><strong>①、 启动类标注 @EnableHystrix</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@EnableDiscoveryClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@EnableHystrix</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HystrixConsulPaymentApplication8001</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">main</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">SpringApplication</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">HystrixConsulPaymentApplication8001</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>②、 在业务类中添加回退方法，并且用 @HystrixCommand 指定需要进行服务降级的方法</strong></p><ul><li>当Hystrix命令执行的时间超过设置的超时时间，就会抛出异常，同时调用 回退方法</li></ul><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* 访问超时</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* @param id</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">* @return</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixCommand</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  fallbackMethod </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;getPaymentOfTimeOut_fallBack&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  commandProperties </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixProperty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;fallback.enabled&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixProperty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;execution.timeout.enabled&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixProperty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;3000&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token class-name" style="color:rgb(17, 17, 17)">TimeUnit</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token constant" style="color:rgb(72, 118, 214)">SECONDS</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">sleep</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">4</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    e</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">printStackTrace</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;线程池:&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token class-name" style="color:rgb(17, 17, 17)">Thread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">currentThread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token string" style="color:rgb(72, 118, 214)">&quot; # getPaymentOfTimeOut,id:&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut_fallBack</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;id:&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain">id</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;,业务繁忙,请稍后再试~&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>③、 调用上述的方法，观察界面</strong></p><p><img loading="lazy" alt="image-20201205221013066" src="/assets/images/image-20201205221013066-69e38f28e89646b7a3428283f6bd51cc.png" width="707" height="289" class="img_CujE"></p><p>####2.1.2 客户端降级 【 一般都在这里处理 】</p><ul><li><font color="red">操作步骤</font><ol><li>引入 Hystrix 的依赖</li><li>在启动类上标注 <code>@EnableHystrix</code> 启用 hystrix</li><li>客户端整合了OpenFeign，需要配置 application.yml<ul><li><code>feign.hystrix.enabled</code> : 是否为feign 开启Hystrix</li><li><code>hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds</code> :设置Hystrix 最大超时时间</li></ul></li><li>在业务类上标注 <code>@HystrixCommand</code>  配置hystrix命令<ul><li>通过 <code>fallback</code> 属性指定异常处理/回退方法</li></ul></li></ol></li></ul><p><strong>application.yml</strong></p><div class="language-yml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">consumer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">feign</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">hyxtrix</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">order80</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">consul</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">service-name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">consumer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">feign</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">hyxtrix</span><span class="token punctuation" style="color:rgb(153, 76, 195)">-</span><span class="token plain">order</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">instance-id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">feign</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">default</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">connectTimeout</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">10000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">readTimeout</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">10000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">hystrix</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal"># 对Hystrix设置超时时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token key atrule">hystrix</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token key atrule">default</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token key atrule">execution</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token key atrule">isolation</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">          </span><span class="token key atrule">thread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><span class="token key atrule">timeoutInMilliseconds</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">30000</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="22-服务降级--全局服务降级-">2.2 服务降级 【 全局服务降级 】<a class="hash-link" href="#22-服务降级--全局服务降级-" title="标题的直接链接">​</a></h3><ul><li><strong>单一方法配置回退方法的不足之处</strong> <ol><li>每个业务方法都需要配置一个，导致代码膨胀，可维护性差 -&gt; <font color="blue">使用一个默认的回退方法</font> <ul><li><mark>当业务方法上也标注@HystrixCommand 注解并指定回退方法时，以业务方法上的为准!</mark></li></ul></li><li>回退方法需要写在业务方法中，与业务紧耦合</li></ol></li></ul><h4 class="anchor anchorWithStickyNavbar_loeA" id="221-使用-defaultproperties">2.2.1 使用 @DefaultProperties<a class="hash-link" href="#221-使用-defaultproperties" title="标题的直接链接">​</a></h4><ul><li><font color="red">操作步骤</font><p>1、在业务方法上标注 <code>@HystrixCommand</code>  注解,表示是一个Hystrix命令</p><p>2、在业务类中编写一个无参的回退方法</p><p>3、在业务类上标注 <code>@DefaultProperties</code> 注解，进行默认的配置</p></li></ul><p><strong>消费端的业务类</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Slf4j</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@RequestMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/order&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 配置默认的Hystrix命令属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@DefaultProperties</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        defaultFallback </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;getPaymentOfTimeOut_DefaultFallBack&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        commandProperties </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixProperty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;2000&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">OrderController</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PaymentHystrixConsulService</span><span class="token plain"> paymentService</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Value</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;${server.port}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> serverPort</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@GetMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/ok/{id}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfOk</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@PathVariable</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> paymentService</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfOk</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        log</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">warn</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;res:{},port:{}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">serverPort</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/*    </span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">            业务方法上仅需要标注 @Hystrix注解即可！</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">            @HystrixCommand(</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">            fallbackMethod = &quot;getPaymentOfTimeOut_fallBack&quot;,</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">            commandProperties = {</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;2000&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">            }</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">    )*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixCommand</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@GetMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/timeout/{id}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@PathVariable</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">  paymentService</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        log</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">warn</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;res:{},port:{}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">serverPort</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut_fallBack</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;线程池:&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token class-name" style="color:rgb(17, 17, 17)">Thread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">currentThread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token string" style="color:rgb(72, 118, 214)">&quot; # getPaymentOfTimeOut,id:&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain">id</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;,业务繁忙,请稍后再试~&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">     * 默认的回退方法是无参的</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">     * @return</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut_DefaultFallBack</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;线程池:&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token class-name" style="color:rgb(17, 17, 17)">Thread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">currentThread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token string" style="color:rgb(72, 118, 214)">&quot; # getPaymentOfTimeOut,业务繁忙,请稍后再试~&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_loeA" id="222-openfeign指定fallback一般用于处理服务端异常">2.2.2 OpenFeign指定fallback【一般用于处理服务端异常】<a class="hash-link" href="#222-openfeign指定fallback一般用于处理服务端异常" title="标题的直接链接">​</a></h4><ul><li><font color="red">OpenFeign 通过服务接口调用服务时，可以通过接口实现类的方式，为接口的方法指定一个fallback回退函数</font></li><li><font color="red">OpenFeign 指定了fallback 类，在业务方法上不用指定 <code>@HystrixCommand</code> 注解！</font><ul><li><font color="green">因为OpenFeign指定的回退函数作用范围是Service方法前后，而不是在业务方法整体上！</font></li></ul></li><li><font color="red">操作步骤</font><ol><li><font color="purple">创建一个类实现OpenFeign 的服务接口，并且所有接口实现方法中设置回退函数的逻辑</font></li><li>在 OpenFeign服务接口的 <code>@FeignClient</code>注解的<code>fallback</code>属性中指定实现类</li></ol></li></ul><p><strong>①、 创建OpenFeign 服务接口的实现类</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PaymentHystrixConsulFallback</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PaymentHystrixConsulService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfOk</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">format</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; PaymentHystrixConsulFallback:%s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;getPaymentOfOk&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">format</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; PaymentHystrixConsulFallback:%s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;getPaymentOfTimeOut&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>②、 @FeignClient 指定回退函数类</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@FeignClient</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;cloud-payment-service-hystrix-consul&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             path </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/payment&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 回退函数类</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">             fallback </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PaymentHystrixConsulFallback</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PaymentHystrixConsulService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@GetMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/getPaymentOfOk/{id}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfOk</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@PathVariable</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@GetMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/getPaymentOfTimeOut/{id}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@PathVariable</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>③、 业务方法不需要使用 @HystrixCommand</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Slf4j</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@RequestMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/order&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">OrderController</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">PaymentHystrixConsulService</span><span class="token plain"> paymentService</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Value</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;${server.port}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> serverPort</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@GetMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/ok/{id}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfOk</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@PathVariable</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> paymentService</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfOk</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        log</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">warn</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;res:{},port:{}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">serverPort</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@GetMapping</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/timeout/{id}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@PathVariable</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">//  paymentService.getPaymentOfTimeOut 方法带有回退函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain">  paymentService</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getPaymentOfTimeOut</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        log</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">warn</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;res:{},port:{}&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">serverPort</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_loeA" id="23-服务熔断">2.3 服务熔断<a class="hash-link" href="#23-服务熔断" title="标题的直接链接">​</a></h3><ul><li><font color="blue"><strong>熔断机制</strong></font><ul><li><font color="red">熔断机制是应对 &quot;服务雪崩&quot; 的一种 <strong>微服务链路保护机制</strong></font><ul><li>当扇出链路的某个微服务不可用或者响应超时，就会进行服务的降级，<strong>进而熔断该节点微服务的调用</strong>，快速返回&quot;错误&quot;的响应信息，<strong>当检测到该节点微服务调用响应正常后恢复调用链路</strong></li></ul></li><li><p>Hystrix会监控微服务间调用的状况,<font color="red">当失败的调用到一定阈值(默认是10秒内20次失败)，就会启动熔断机制</font> </p></li></ul></li><li><p><strong>熔断类型</strong></p><ul><li><font color="red">熔断打开</font> : 请求不再进行调用当前服务，内部设置时钟一般为MTTR(平均故障处理时间)，当打开时长达到所设时钟则进入熔断状态</li><li><font color="red">熔断关闭</font> : 熔断关闭不会对服务进行熔断</li><li><font color="red">熔断半开</font> : 部分请求根据规则调用当前服务，如果请求成功且符合规则则认为当前服务恢复正常，关闭熔断</li></ul></li><li><p><strong>断路器实现逻辑</strong></p></li></ul><p><img loading="lazy" src="/assets/images/image-20201206152532158-3c8bc5d6eef96b218eef0a63e9ecd909.png" width="465" height="396" class="img_CujE"></p><h4 class="anchor anchorWithStickyNavbar_loeA" id="231-服务熔断代码实现--circuitbreaker-">2.3.1 服务熔断代码实现 【 circuitBreaker 】<a class="hash-link" href="#231-服务熔断代码实现--circuitbreaker-" title="标题的直接链接">​</a></h4><ul><li><font color="red">@HystrixProperty 服务熔断相关属性</font><ul><li><code>circuitBreaker.enabled</code><ul><li>是否开启断路器功能</li></ul></li><li><code>circuitBreaker.requestVolumeThreshold</code><ul><li>请求阈值</li></ul></li><li><code>circuitBreaker.sleepWindowInMilliseconds</code><ul><li>时间窗口期</li></ul></li><li><code>circuitBreaker.errorThresholdPercentage</code><ul><li>在指定时间范围内失败率</li></ul></li></ul></li><li><font color="red">操作步骤</font><ul><li>在需要进行服务熔断的业务方法上标注 <font color="red"><code>@HystrixCommand</code></font> 注解，并且对服务熔断属性进行配置</li></ul></li></ul><p><strong>①、 对业务方法设置服务熔断</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">/**</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">     * ===============服务熔断================</span><br></span><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixCommand</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  fallbackMethod </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;paymentCircuitBreaker_fallBack&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  commandProperties </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixProperty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;circuitBreaker.enabled&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">                       </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 是否开启服务熔断</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixProperty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;circuitBreaker.requestVolumeThreshold&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;10&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">            </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 请求阈值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixProperty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;circuitBreaker.sleepWindowInMilliseconds&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;10000&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 时间窗口期</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@HystrixProperty</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">name</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;circuitBreaker.errorThresholdPercentage&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">value </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;60&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">           </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:normal">// 失败率</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">paymentCircuitBreaker</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">id</span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">RuntimeException</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;id不能为负数&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">format</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;线程%s\t调用成功,流水号%s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token class-name" style="color:rgb(17, 17, 17)">Thread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">currentThread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">IdUtil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">simpleUUID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">paymentCircuitBreaker_fallBack</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;[circuitBreaker_fallBack]线程池:&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token class-name" style="color:rgb(17, 17, 17)">Thread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">currentThread</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;getPaymentOfTimeOut,id:&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain">id</span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;,业务繁忙,请稍后再试~&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="3hystrix-dashboard">3.Hystrix DashBoard<a class="hash-link" href="#3hystrix-dashboard" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_loeA" id="31-搭建hystrix-dashboard">3.1 搭建Hystrix DashBoard<a class="hash-link" href="#31-搭建hystrix-dashboard" title="标题的直接链接">​</a></h3><ul><li><font color="red">什么是服务监控？</font><ul><li>除了隔离依赖服务的调用以外，Hystrix还提供了<font color="red">准实时的调用监控（Hystrix Dashboard）</font></li><li>Hystrix会持续地记录所有通过Hystrix发起的请求的执行信息，并以统计报表和图形的形式展示给用户<ul><li>包括每秒执行多少请求多少成功，多少失败等</li></ul></li><li>Netflix 通过hystrix-metrics-event-stream项目实现了对以上指标的监控<ul><li>Spring Cloud也提供了Hystrix Dashboard的整合，对监控内容转化成可视化界面。</li></ul></li></ul></li></ul><ul><li><font color="red">操作步骤</font><ol><li>新建 DashBorad的工程，引入 <code>Hystrix</code>、<code>Hystrix-DashBoard</code> 的依赖</li><li>application.yml 中配置服务端口</li><li>通过<code>@EnableHystrixDashboard</code>注解开启 Hystrix Dashboard 功能</li><li>启动新建的  dashboard 工程 ,  访问 <code>http://localhost:${server.port}/hystrix</code></li><li>在Provider 服务中注入 <code>HystrixMetricsStreamServlet</code></li><li>启动Provider 服务 , 访问 <code>http://localhost:Provider 服务对应的端口/hystrix.stream</code></li></ol></li></ul><p><strong>①、配置application.yml</strong></p><div class="language-yml codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">9001</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>②、启动类开启HystrixDashboard</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@EnableHystrixDashboard</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HystrixDashBoardApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">main</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">SpringApplication</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">HystrixDashBoardApplication</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>③、需要被监控的服务注入 HystrixMetricsStreamServlet</strong></p><div class="language-java codeBlockContainer_APcc theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#403f53"><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@EnableDiscoveryClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@EnableHystrix</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HystrixConsulPaymentApplication8001</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">main</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">String</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">SpringApplication</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token class-name" style="color:rgb(17, 17, 17)">HystrixConsulPaymentApplication8001</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token keyword" style="color:rgb(12, 150, 155)">class</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(153, 76, 195)">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ServletRegistrationBean</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">getServlet</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">HystrixMetricsStreamServlet</span><span class="token plain"> streamServlet </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">HystrixMetricsStreamServlet</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token class-name" style="color:rgb(17, 17, 17)">ServletRegistrationBean</span><span class="token plain"> servletRegistrationBean </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(17, 17, 17)">ServletRegistrationBean</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">streamServlet</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        servletRegistrationBean</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setLoadOnStartup</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        servletRegistrationBean</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">addUrlMappings</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/hystrix.stream&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        servletRegistrationBean</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:normal">setName</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;HystrixMetricsStreamServlet&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> servletRegistrationBean</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg class="copyButtonIcon_phi_" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_FfTR" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>④、 对指定的服务进行监控</strong></p><p><img loading="lazy" alt="image-20201206192320766" src="/assets/images/image-20201206192320766-33eb3c528cdb10e13cacd9e1b0a99752.png" width="1397" height="420" class="img_CujE"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/MagicalZhu/NoteLib/tree/main/docs/SpringCloud/Netflix/1.4服务熔断降级-Hystrix.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_N_05" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">最后<!-- -->由 <b>YuLiang Zhu</b> <!-- -->于 <b><time datetime="2022-12-06T01:19:52.000Z">2022年12月6日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/SpringCloud/Netflix/OpenFeign"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">服务接口调用-OpenFeign</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/SpringCloud/Netflix/GateWay"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">服务网关-GateWay</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><p class="content_nRws">Contents</p><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1hystrix-概述" class="table-of-contents__link toc-highlight">1.Hystrix 概述</a><ul><li><a href="#11-分布式系统面临的问题" class="table-of-contents__link toc-highlight">1.1 分布式系统面临的问题</a></li><li><a href="#12-hystrix-是什么" class="table-of-contents__link toc-highlight">1.2 Hystrix 是什么？</a><ul><li><a href="#121-线程池打满导致服务需要降级示例" class="table-of-contents__link toc-highlight">1.2.1 线程池打满导致服务需要降级示例</a></li></ul></li></ul></li><li><a href="#2服务熔断服务降级" class="table-of-contents__link toc-highlight">2.服务熔断&amp;服务降级</a><ul><li><a href="#21-服务降级--指定服务降级-" class="table-of-contents__link toc-highlight">2.1 服务降级 【 指定服务降级 】</a><ul><li><a href="#211-服务端降级-以及-设置hystrix命令的超时时间" class="table-of-contents__link toc-highlight">2.1.1 服务端降级 以及 设置Hystrix命令的超时时间</a></li></ul></li><li><a href="#22-服务降级--全局服务降级-" class="table-of-contents__link toc-highlight">2.2 服务降级 【 全局服务降级 】</a><ul><li><a href="#221-使用-defaultproperties" class="table-of-contents__link toc-highlight">2.2.1 使用 @DefaultProperties</a></li><li><a href="#222-openfeign指定fallback一般用于处理服务端异常" class="table-of-contents__link toc-highlight">2.2.2 OpenFeign指定fallback【一般用于处理服务端异常】</a></li></ul></li><li><a href="#23-服务熔断" class="table-of-contents__link toc-highlight">2.3 服务熔断</a><ul><li><a href="#231-服务熔断代码实现--circuitbreaker-" class="table-of-contents__link toc-highlight">2.3.1 服务熔断代码实现 【 circuitBreaker 】</a></li></ul></li></ul></li><li><a href="#3hystrix-dashboard" class="table-of-contents__link toc-highlight">3.Hystrix DashBoard</a><ul><li><a href="#31-搭建hystrix-dashboard" class="table-of-contents__link toc-highlight">3.1 搭建Hystrix DashBoard</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">前端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://v3.cn.vuejs.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">React<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://ts.xcatliu.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TypeScript<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://developer.mozilla.org/zh-CN/docs/Web" target="_blank" rel="noopener noreferrer" class="footer__link-item">MDN<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">后端链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spring<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kubernetes.io/zh/docs/home/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">JVM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.infoq.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">InfoQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">文档构建</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://typoraio.cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Typora<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_2l9O"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 huakucha. Built With Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf86732a.js"></script>
<script src="/assets/js/main.98457ee6.js"></script>
</body>
</html>