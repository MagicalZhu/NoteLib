"use strict";(self.webpackChunkhuakucha=self.webpackChunkhuakucha||[]).push([[1467],{37354:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>N,frontMatter:()=>i,metadata:()=>p,toc:()=>m});var n=a(87462),l=(a(67294),a(3905));a(61839);const i={id:"\u5176\u4ed6\u65e5\u5fd7",title:"\u5176\u4ed6\u65e5\u5fd7"},r=void 0,p={unversionedId:"Mysql/\u9ad8\u7ea7\u7279\u6027/\u5176\u4ed6\u65e5\u5fd7",id:"Mysql/\u9ad8\u7ea7\u7279\u6027/\u5176\u4ed6\u65e5\u5fd7",title:"\u5176\u4ed6\u65e5\u5fd7",description:"\u5728\u524d\u9762\u7684\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u4e2d,\u6211\u4eec\u9047\u5230\u4e86\u4e24\u79cd\u65e5\u5fd7: redo\u65e5\u5fd7\u3001undo\u65e5\u5fd7",source:"@site/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u5176\u4ed6\u65e5\u5fd7.md",sourceDirName:"Mysql/\u9ad8\u7ea7\u7279\u6027",slug:"/Mysql/\u9ad8\u7ea7\u7279\u6027/\u5176\u4ed6\u65e5\u5fd7",permalink:"/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u5176\u4ed6\u65e5\u5fd7",draft:!1,editUrl:"https://github.com/MagicalZhu/NoteLib/tree/main/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u5176\u4ed6\u65e5\u5fd7.md",tags:[],version:"current",lastUpdatedBy:"YuLiang Zhu",lastUpdatedAt:1670289592,formattedLastUpdatedAt:"2022\u5e7412\u67086\u65e5",frontMatter:{id:"\u5176\u4ed6\u65e5\u5fd7",title:"\u5176\u4ed6\u65e5\u5fd7"},sidebar:"mysqlSideBar",previous:{title:"\u8fd0\u7ef4",permalink:"/docs/category/\u8fd0\u7ef4"},next:{title:"\u4e3b\u4ece\u590d\u5236",permalink:"/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u4e3b\u4ece\u590d\u5236"}},o={},m=[{value:"MySQL \u65e5\u5fd7\u7c7b\u578b",id:"mysql-\u65e5\u5fd7\u7c7b\u578b",level:2},{value:"\u6162\u67e5\u8be2\u65e5\u5fd7",id:"\u6162\u67e5\u8be2\u65e5\u5fd7",level:2},{value:"\u901a\u7528\u67e5\u8be2\u65e5\u5fd7",id:"\u901a\u7528\u67e5\u8be2\u65e5\u5fd7",level:2},{value:"\u67e5\u770b\u53c2\u6570\u72b6\u6001",id:"\u67e5\u770b\u53c2\u6570\u72b6\u6001",level:3},{value:"\u53c2\u6570\u914d\u7f6e",id:"\u53c2\u6570\u914d\u7f6e",level:3},{value:"\u9519\u8bef\u65e5\u5fd7",id:"\u9519\u8bef\u65e5\u5fd7",level:2},{value:"\u67e5\u770b\u53c2\u6570\u72b6\u6001",id:"\u67e5\u770b\u53c2\u6570\u72b6\u6001-1",level:3},{value:"\u53c2\u6570\u914d\u7f6e",id:"\u53c2\u6570\u914d\u7f6e-1",level:3},{value:"\u4e8c\u8fdb\u5236\u65e5\u5fd7",id:"\u4e8c\u8fdb\u5236\u65e5\u5fd7",level:2},{value:"\u67e5\u770b\u53c2\u6570\u72b6\u6001",id:"\u67e5\u770b\u53c2\u6570\u72b6\u6001-2",level:3},{value:"\u53c2\u6570\u914d\u7f6e",id:"\u53c2\u6570\u914d\u7f6e-2",level:3},{value:"\u65e5\u5fd7\u683c\u5f0f",id:"\u65e5\u5fd7\u683c\u5f0f",level:3},{value:"statement",id:"statement",level:4},{value:"row",id:"row",level:4},{value:"mixed",id:"mixed",level:4},{value:"\u67e5\u770b\u65e5\u5fd7",id:"\u67e5\u770b\u65e5\u5fd7",level:3},{value:"\u65e5\u5fd7\u5217\u8868",id:"\u65e5\u5fd7\u5217\u8868",level:4},{value:"binlog \u5206\u6790\u5de5\u5177",id:"binlog-\u5206\u6790\u5de5\u5177",level:4},{value:"binlog \u4e8b\u4ef6",id:"binlog-\u4e8b\u4ef6",level:4},{value:"\u6062\u590d\u6570\u636e",id:"\u6062\u590d\u6570\u636e",level:3},{value:"\u5220\u9664\u65e5\u5fd7",id:"\u5220\u9664\u65e5\u5fd7",level:3},{value:"purge",id:"purge",level:4},{value:"reset \ud83d\udea7",id:"reset-",level:4},{value:"\u5176\u4ed6\u573a\u666f",id:"\u5176\u4ed6\u573a\u666f",level:3},{value:"\u5199\u5165\u673a\u5236",id:"\u5199\u5165\u673a\u5236",level:3},{value:"binlog \u4e0e redo log",id:"binlog-\u4e0e-redo-log",level:3},{value:"\u5185\u90e8 XA \u4e8b\u52a1",id:"\u5185\u90e8-xa-\u4e8b\u52a1",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:4},{value:"\u95ee\u9898",id:"\u95ee\u9898",level:4},{value:"\u4e24\u9636\u6bb5\u63d0\u4ea4(2PC)",id:"\u4e24\u9636\u6bb5\u63d0\u4ea42pc",level:4},{value:"\u4e2d\u7ee7\u65e5\u5fd7",id:"\u4e2d\u7ee7\u65e5\u5fd7",level:2},{value:"\u65e5\u5fd7\u7684\u901a\u7528\u64cd\u4f5c",id:"\u65e5\u5fd7\u7684\u901a\u7528\u64cd\u4f5c",level:2},{value:"\u5237\u65b0\u65e5\u5fd7",id:"\u5237\u65b0\u65e5\u5fd7",level:3}],k={toc:m};function N(e){let{components:t,...i}=e;return(0,l.kt)("wrapper",(0,n.Z)({},k,i,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5728\u524d\u9762\u7684\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u4e2d,\u6211\u4eec\u9047\u5230\u4e86\u4e24\u79cd\u65e5\u5fd7: ",(0,l.kt)("strong",{parentName:"p"},"redo\u65e5\u5fd7\u3001undo\u65e5\u5fd7")),(0,l.kt)("p",{parentName:"blockquote"},"\u5bf9\u4e8e\u7ebf\u4e0a\u7684\u6570\u636e\u5e93\u9047\u5230\u4e86\u5b95\u673a\u600e\u4e48\u529e?\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u6570\u636e\u5e93\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"\u9519\u8bef\u65e5\u5fd7"),"\u3002\u56e0\u4e3a\u65e5\u5fd7\u4e2d\u5305\u542b\u4e86\u9519\u8bef\u3001\u8b66\u544a\u7b49\u4fe1\u606f,\u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7\u65e5\u5fd7\u53d1\u73b0\u67d0\u4e2a SQL \u53d1\u751f\u4e86\u6b7b\u5faa\u73af\u5bfc\u81f4\u5185\u5b58\u4e0d\u8db3\u7b49"),(0,l.kt)("p",{parentName:"blockquote"},"\u9664\u4e86\u53d1\u73b0\u9519\u8bef,\u65e5\u5fd7\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"\u6570\u636e\u590d\u5236\u3001\u6570\u636e\u6062\u590d\u3001\u64cd\u4f5c\u5ba1\u8ba1\u4ee5\u53ca\u786e\u4fdd\u6570\u636e\u7684\u6c38\u4e45\u6027\u3001\u4e00\u81f4\u6027"),"\u7b49\u65b9\u9762,\u6709\u7740\u5f88\u91cd\u8981\u7684\u4f5c\u7528"),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/server-logs.html"},"MySQL8.0 \u65e5\u5fd7\u5b98\u7f51"))),(0,l.kt)("h2",{id:"mysql-\u65e5\u5fd7\u7c7b\u578b"},"MySQL \u65e5\u5fd7\u7c7b\u578b"),(0,l.kt)("p",null,"MySQL \u6709\u5f88\u591a\u7c7b\u578b\u7684\u65e5\u5fd7,\u6700\u5e38\u7528\u7684\u6709",(0,l.kt)("strong",{parentName:"p"},"\u4e8c\u8fdb\u5236\u65e5\u5fd7\u3001\u9519\u8bef\u65e5\u5fd7\u3001\u901a\u7528\u67e5\u8be2\u65e5\u5fd7\u3001\u6162\u67e5\u8be2\u65e5\u5fd7"),"\u3002MySQL8.0 \u53c8\u65b0\u52a0\u4e86\u4e24\u79cd\u65e5\u5fd7",(0,l.kt)("strong",{parentName:"p"},"\u4e2d\u7ee7\u65e5\u5fd7\u3001\u6570\u636e\u5b9a\u4e49\u8bed\u53e5\u65e5\u5fd7"),",\u5373:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u6162\u67e5\u8be2\u65e5\u5fd7 [slow query log]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8bb0\u5f55\u6240\u6709\u6267\u884c\u65f6\u95f4\u8d85\u8fc7 ",(0,l.kt)("em",{parentName:"strong"},"long_query_time")," \u7684\u6240\u6709\u67e5\u8be2,\u65b9\u4fbf\u6211\u4eec\u5bf9 SQL \u8bed\u53e5\u8fdb\u884c\u4f18\u5316")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u901a\u7528\u67e5\u8be2\u65e5\u5fd7 [general query log]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8bb0\u5f55\u6240\u6709\u8fde\u63a5\u7684\u8d77\u59cb\u65f6\u95f4\u548c\u7ec8\u6b62\u65f6\u95f4,\u4ee5\u53ca\u8fde\u63a5\u53d1\u9001\u7ed9\u6570\u636e\u5e93\u670d\u52a1\u5668\u7684\u6240\u6709\u6307\u4ee4")," "),(0,l.kt)("li",{parentName:"ul"},"\u5bf9\u6211\u4eec\u590d\u539f\u64cd\u4f5c\u7684\u5b9e\u9645\u573a\u666f\u3001\u53d1\u73b0\u95ee\u9898\uff0c\u751a\u81f3\u662f\u5bf9\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u5ba1\u8ba1\u90fd\u6709\u5f88\u5927\u7684\u5e2e\u52a9"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#%E9%80%9A%E7%94%A8%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"},"\u76f8\u5173\u4fe1\u606f")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u9519\u8bef\u65e5\u5fd7 [error log]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8bb0\u5f55MySQL\u670d\u52a1\u7684\u542f\u52a8\u3001\u8fd0\u884c\u6216\u505c\u6b62MySQL\u670d\u52a1\u65f6\u51fa\u73b0\u7684\u95ee\u9898")),(0,l.kt)("li",{parentName:"ul"},"\u65b9\u4fbf\u6211\u4eec\u4e86\u89e3\u670d\u52a1\u5668\u7684 \u72b6\u6001\uff0c\u4ece\u800c\u5bf9\u670d\u52a1\u5668\u8fdb\u884c\u7ef4\u62a4"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"},"\u76f8\u5173\u4fe1\u606f")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u4e8c\u8fdb\u5236\u65e5\u5fd7 [bin log]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8bb0\u5f55\u6240\u6709\u66f4\u6539\u6570\u636e\u7684\u8bed\u53e5")),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u7528\u4e8e\u4e3b\u4ece\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6570\u636e\u540c\u6b65,\u4ee5\u53ca\u670d\u52a1\u5668\u9047\u5230\u6545\u969c\u65f6\u6570\u636e\u7684\u65e0\u635f\u5931\u6062\u590d"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u4e2d\u7ee7\u65e5\u5fd7 [relay log]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"MySQL 8.0 \u65b0\u589e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u4ece\u670d\u52a1\u5668\u901a\u8fc7\u8bfb\u53d6\u4e2d\u7ee7\u65e5\u5fd7\u7684\u5185\u5bb9,\u6765\u540c\u6b65\u4e3b\u670d\u52a1\u5668\u4e0a\u7684\u64cd\u4f5c")),(0,l.kt)("li",{parentName:"ul"},"\u7528\u4e8e\u4e3b\u4ece\u670d\u52a1\u5668\u67b6\u6784\u4e2d,\u4ece\u670d\u52a1\u5668\u7528\u6765\u5b58\u653e\u4e3b\u670d\u52a1\u5668\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5185\u5bb9\u7684\u4e00\u4e2a\u4e2d\u95f4\u6587\u4ef6"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u6570\u636e\u5b9a\u4e49\u8bed\u53e5\u65e5\u5fd7"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8bb0\u5f55\u6570\u636e\u5b9a\u4e49\u8bed\u53e5\u6267\u884c\u7684\u5143\u6570\u636e\u64cd\u4f5c"))))),(0,l.kt)("p",null,"\u9664\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5916, \u5176\u4ed6\u65e5\u5fd7\u90fd\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"\u6587\u672c\u6587\u4ef6"),"\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b, \u6240\u6709\u65e5\u5fd7\u521b\u5efa\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"MySQL\u6570\u636e\u76ee\u5f55")," \u4e2d"),(0,l.kt)("admonition",{title:"\u65e5\u5fd7\u7684\u7f3a\u70b9",type:"caution"},(0,l.kt)("ol",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u65e5\u5fd7\u529f\u80fd\u4f1a\u964d\u4f4e\u6570\u636e\u5e93\u7684\u6027\u80fd")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u65e5\u5fd7\u4f1a\u5360\u7528\u5927\u91cf\u7684\u78c1\u76d8\u7a7a\u95f4")))),(0,l.kt)("h2",{id:"\u6162\u67e5\u8be2\u65e5\u5fd7"},"\u6162\u67e5\u8be2\u65e5\u5fd7"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"%E5%9F%BA%E6%9C%AC%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7#%E5%AE%9A%E4%BD%8D%E6%85%A2sql%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"},"\u6162\u67e5\u8be2\u65e5\u5fd7\u7684\u8be6\u7ec6\u4fe1\u606f")),(0,l.kt)("h2",{id:"\u901a\u7528\u67e5\u8be2\u65e5\u5fd7"},"\u901a\u7528\u67e5\u8be2\u65e5\u5fd7"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u901a\u7528\u67e5\u8be2\u65e5\u5fd7\u7528\u6765",(0,l.kt)("inlineCode",{parentName:"p"},"\u8bb0\u5f55\u7528\u6237\u7684\u6240\u6709\u64cd\u4f5c"),", \u5305\u62ec",(0,l.kt)("strong",{parentName:"p"},"\u542f\u52a8\u548c\u5173\u95edMySQL\u670d\u52a1\u3001\u6240\u6709\u7528\u6237\u7684\u8fde\u63a5\u5f00\u59cb\u65f6\u95f4\u548c\u622a\u6b62 \u65f6\u95f4\u3001\u53d1\u7ed9 MySQL \u6570\u636e\u5e93\u670d\u52a1\u5668\u7684\u6240\u6709 SQL \u6307\u4ee4\u7b49")),(0,l.kt)("p",{parentName:"blockquote"},"\u5f53\u6211\u4eec\u7684\u6570\u636e\u53d1\u751f\u5f02\u5e38\u65f6, ",(0,l.kt)("strong",{parentName:"p"},"\u67e5\u770b\u901a\u7528\u67e5\u8be2\u65e5\u5fd7, \u7136\u540e\u8fd8\u539f\u64cd\u4f5c\u65f6\u7684\u5177\u4f53\u573a\u666f")," ,\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u51c6\u786e\u5b9a\u4f4d\u95ee\u9898")),(0,l.kt)("h3",{id:"\u67e5\u770b\u53c2\u6570\u72b6\u6001"},"\u67e5\u770b\u53c2\u6570\u72b6\u6001"),(0,l.kt)("p",null,"\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u901a\u7528\u67e5\u8be2\u65e5\u5fd7\u529f\u80fd\u662f\u5426\u5f00\u542f:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"/*\n    \u901a\u7528\u67e5\u8be2\u65e5\u5fd7\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\n*/\nSHOW VARIABLES LIKE '%general%';\n")),(0,l.kt)("admonition",{title:"\u4f7f\u7528\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220918152910360",src:a(11750).Z,width:"1384",height:"362"}))),(0,l.kt)("h3",{id:"\u53c2\u6570\u914d\u7f6e"},"\u53c2\u6570\u914d\u7f6e"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u548c\u5927\u591a\u6570\u7684\u53d8\u91cf\u914d\u7f6e\u7c7b\u4f3c\u7684,\u4e5f\u6709\u4e24\u79cd\u65b9\u5f0f\u8fdb\u884c\u542f\u7528\u548c\u5173\u95ed:")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 (my.cnf | my.ini)")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u5728","[mysqld]","\u7ec4\u4e0b\u52a0\u5165",(0,l.kt)("em",{parentName:"strong"},"general_log"),"\u9009\u9879,\u5e76\u91cd\u542fMySQL\u670d\u52a1")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-ini",metastring:'title="my.cnf"',title:'"my.cnf"'},"[mysqld]\n\n# \u5f00\u542f\u6216\u8005\u5173\u95ed\u901a\u7528\u67e5\u8be2\u65e5\u5fd7\ngeneral_log=ON | OFF\n\n# \u8bbe\u7f6e\u65e5\u5fd7\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e (filename\u4e3a\u65e5\u5fd7\u6587\u4ef6\u540d)\ngeneral_log_file=path[filename]\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u5982\u679c\u4e0d\u6307\u5b9a\u76ee\u5f55\u548c\u6587\u4ef6\u540d, \u901a\u7528\u67e5\u8be2\u65e5\u5fd7\u5c06\u9ed8\u8ba4\u5b58\u50a8\u5728MySQL\u6570\u636e\u76ee\u5f55\u4e2d\u7684 hostname.log \u6587\u4ef6\u4e2d\uff0c hostname\u8868\u793a\u4e3b\u673a\u540d")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u4e34\u65f6\u65b9\u5f0f (SQL \u8bed\u53e5)")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"# \u5f00\u542f\u6216\u8005\u5173\u95ed\u901a\u7528\u67e5\u8be2\u65e5\u5fd7\nSET GLOBAL general_log=on | off; \n\n# \u8bbe\u7f6e\u65e5\u5fd7\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e\nSET GLOBAL general_log_file=\u2019path[/filename]\u2019; \n")),(0,l.kt)("admonition",{parentName:"li",title:"\u4f7f\u7528\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u5148\u5f00\u542f\u901a\u7528\u67e5\u8be2\u65e5\u5fd7(\u8fd9\u91cc\u91c7\u7528\u4e34\u65f6\u65b9\u5f0f), \u7136\u540e\u6267\u884c SQL \u8bed\u53e5,\u6700\u540e\u89c2\u5bdf\u901a\u7528\u67e5\u8be2\u65e5\u5fd7\u6587\u4ef6\u7684\u5185\u5bb9:"),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220918154706728",src:a(8116).Z,width:"2938",height:"1816"}))))),(0,l.kt)("h2",{id:"\u9519\u8bef\u65e5\u5fd7"},"\u9519\u8bef\u65e5\u5fd7"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u9519\u8bef\u65e5\u5fd7\u8bb0\u5f55\u4e86 MySQL \u670d\u52a1\u5668\u542f\u52a8\u3001\u505c\u6b62\u8fd0\u884c\u65f6\u95f4\u4ee5\u53ca\u7cfb\u7edf\u542f\u52a8\u3001\u8fd0\u884c\u548c\u505c\u6b62\u8fc7\u7a0b\u4e2d\u7684\u8bca\u65ad\u4fe1\u606f\u3002\u5305\u62ec\u9519\u8bef\u3001\u8b66\u544a\u548c\u63d0\u793a\u7b49")),(0,l.kt)("h3",{id:"\u67e5\u770b\u53c2\u6570\u72b6\u6001-1"},"\u67e5\u770b\u53c2\u6570\u72b6\u6001"),(0,l.kt)("p",null,"MySQL\u6570\u636e\u5e93\u4e2d\uff0c\u9519\u8bef\u65e5\u5fd7\u529f\u80fd\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"\u5f3a\u5236\u5f00\u542f")," \u7684\u3002\u800c\u4e14",(0,l.kt)("strong",{parentName:"p"},"\u9519\u8bef\u65e5\u5fd7\u65e0\u6cd5\u88ab\u7981\u6b62"),", \u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u9519\u8bef\u65e5\u5fd7\u7684\u53c2\u6570:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW VARIABLES LIKE '%log_err%';\n")),(0,l.kt)("admonition",{title:"\u4f7f\u7528\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220918162829410",src:a(64647).Z,width:"1532",height:"510"}))),(0,l.kt)("h3",{id:"\u53c2\u6570\u914d\u7f6e-1"},"\u53c2\u6570\u914d\u7f6e"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u9ed8\u8ba4\u60c5\u51b5\u4e0b,\u9519\u8bef\u65e5\u5fd7\u5b58\u50a8\u5728 MySQL \u7684\u6570\u636e\u6587\u4ef6\u5939\u4e0b,\u540d\u79f0\u9ed8\u8ba4\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"mysqld.log")," (Linux\u7cfb\u7edf)\u6216 ",(0,l.kt)("inlineCode",{parentName:"p"},"hostname.err")," (mac\u7cfb\u7edf)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u4fee\u6539\u9519\u8bef\u65e5\u5fd7\u7684\u8def\u5f84:")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-ini",metastring:'title="my.cnf"',title:'"my.cnf"'},"[mysqld]\n# path\u4e3a\u65e5\u5fd7\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u8def\u5f84\uff0cfilename\u4e3a\u65e5\u5fd7\u6587\u4ef6\u540d\nlog-error=path/[filename]\n")))),(0,l.kt)("admonition",{title:"\u4f7f\u7528\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220918170726560",src:a(81359).Z,width:"2546",height:"626"}))),(0,l.kt)("h2",{id:"\u4e8c\u8fdb\u5236\u65e5\u5fd7"},"\u4e8c\u8fdb\u5236\u65e5\u5fd7"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Binlog \u53ef\u4ee5\u8bf4\u662f MySQL \u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u65e5\u5fd7\u4e86,\u5728\u65e5\u5e38\u5f00\u53d1\u4e0e\u8fd0\u7ef4\u4e2d\u7ecf\u5e38\u4f1a\u7528\u5230")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"binlog"),"(binary log) \u4e5f\u5c31\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6"),",\u4e5f\u53eb\u505a",(0,l.kt)("inlineCode",{parentName:"p"},"\u53d8\u66f4\u65e5\u5fd7(update log)"),"\u3002\u5b83\u8bb0\u5f55\u4e86\u6570\u636e\u5e93\u4e2d\u6240\u6709\u6267\u884c\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"DDL\u3001DML \u7b49\u6570\u636e\u5e93\u66f4\u65b0\u8bed\u53e5"),",\u4f46\u662f\u4e0d\u5305\u542b\u6ca1\u6709\u4fee\u6539\u4efb\u4f55\u6570\u636e\u6570\u636e,\u6bd4\u5982",(0,l.kt)("em",{parentName:"p"},"select\u3001show\u2026"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"binlog \u4f1a\u4ee5",(0,l.kt)("inlineCode",{parentName:"p"},"\u4e8b\u4ef6\u5f62\u5f0f"),"\u8bb0\u5f55\u5e76\u4fdd\u5b58\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"\u4e8c\u8fdb\u5236\u6587\u4ef6"),"\u4e2d,\u901a\u8fc7 binlog \u53ef\u4ee5\u518d\u73b0\u6570\u636e\u66f4\u65b0\u64cd\u4f5c\u7684\u5168\u8fc7\u7a0b"),(0,l.kt)("admonition",{parentName:"li",title:"\u5c0f\u8d34\u58eb",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u5982\u679c\u8bb0\u5f55\u6240\u6709\u7684\u8bed\u53e5,\u90a3\u4e48\u9700\u8981\u4f7f\u7528",(0,l.kt)("strong",{parentName:"p"},"\u901a\u7528\u67e5\u8be2\u65e5\u5fd7")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"binlog\u7684\u4e3b\u8981\u4f7f\u7528\u573a\u666f")),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u6570\u636e\u6062\u590d"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c MySQL \u56e0\u4e3a\u610f\u5916\u800c\u505c\u6b62,\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("em",{parentName:"li"},"binlog")," \u67e5\u770b\u7528\u6237\u6267\u884c\u4e86\u54ea\u4e9b\u64cd\u4f5c,\u5bf9\u6570\u636e\u5e93\u670d\u52a1\u5668\u6587\u4ef6\u8fdb\u884c\u4e86\u54ea\u4e9b\u4fee\u6539,\u7136\u540e\u6839\u636e ",(0,l.kt)("em",{parentName:"li"},"binlog")," \u6587\u4ef6\u4e2d\u7684\u8bb0\u5f55\u6765\u6062\u590d MySQL \u670d\u52a1\u5668"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u6570\u636e\u590d\u5236"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"master \u4f1a\u628a\u5b83\u7684 ",(0,l.kt)("em",{parentName:"li"},"binlog")," \u4f20\u9012\u7ed9 slaves \u6765\u4fdd\u8bc1\u4e3b\u4ece\u6570\u636e\u5e93\u6570\u636e\u7684\u4e00\u81f4\u6027"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u8bf4",(0,l.kt)("strong",{parentName:"li"},"MySQL \u7684\u6570\u636e\u5907\u4efd,\u4e3b\u5907\u3001\u4e3b\u4e3b\u3001\u4e3b\u4ece\u90fd\u9700\u8981\u4f7f\u7528 ",(0,l.kt)("em",{parentName:"strong"},"binlog")," \u6765\u540c\u6b65\u6570\u636e,\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027"))))))),(0,l.kt)("h3",{id:"\u67e5\u770b\u53c2\u6570\u72b6\u6001-2"},"\u67e5\u770b\u53c2\u6570\u72b6\u6001"),(0,l.kt)("p",null,"MySQL \u4e2d\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u8bed\u53e5\u67e5\u770b ",(0,l.kt)("em",{parentName:"p"},"binlog")," \u7684\u53c2\u6570\u72b6\u6001 (\u9ed8\u8ba4 binLog \u529f\u80fd\u662f\u5f00\u542f\u7684):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW VARIABLES LIKE '%bin%';\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"binlog \u5e38\u89c1\u7684\u53c2\u6570\u8bf4\u660e")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"log_bin"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u662f\u5426\u5f00\u542f binlog,\u9ed8\u8ba4\u662f\u5f00\u542f\u7684"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"log_bin_basename"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"binlog \u7684\u65e5\u5fd7\u524d\u7f00"),(0,l.kt)("li",{parentName:"ul"},"binlog \u4e0d\u662f\u5355\u72ec\u7684\u4e00\u4e2a\u6587\u4ef6,\u4f1a\u88ab\u5206\u5272\u4e3a\u591a\u4e2a\u6587\u4ef6,\u6bd4\u5982 binlog00001\u3001binlog00002\u2026"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"log_bin_index"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"binlog \u7684\u7d22\u5f15\u6587\u4ef6"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"log_bin_trust_function_creators"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u662f\u5426\u4fe1\u4efb\u521b\u5efa\u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"\u56e0\u4e3a\u5728\u4e3b\u4ece\u590d\u5236\u7684\u65f6\u5019,\u51fd\u6570\u5728\u4e3b\u4ece\u673a\u6267\u884c\u7684\u65f6\u5019\u7ed3\u679c\u53ef\u80fd\u662f\u4e0d\u4e00\u6837\u7684,\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u673a\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"sql_log_bin"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u662f\u5426\u652f\u6301 SQL \u5199\u5165"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"binlog_expire_logs_seconds")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8bbe\u7f6e binlog \u6587\u4ef6\u7684\u6709\u6548\u671f,\u5355\u4f4d\u662f",(0,l.kt)("strong",{parentName:"li"},"\u79d2")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"max_binlog_size")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8bbe\u7f6e\u5355\u4e2a binlog \u6587\u4ef6\u7684\u6700\u5927\u503c"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"sync_binlog"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5237\u76d8\u7b56\u7565,\u7c7b\u4f3c\u4e8e",(0,l.kt)("a",{parentName:"li",href:"Redo%E6%97%A5%E5%BF%97#%E4%BA%8B%E5%8A%A1%E6%8F%90%E4%BA%A4%E6%97%B6%E7%9A%84%E5%88%B7%E7%9B%98fsync%E7%AD%96%E7%95%A5"},"redolog\u4e5f\u6709\u5237\u76d8\u7b56\u7565")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"binlog_format"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"},"binlog \u7684\u683c\u5f0f"))))),(0,l.kt)("admonition",{title:"\u4f7f\u7528\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220925094546455",src:a(32012).Z,width:"1726",height:"1830"}))),(0,l.kt)("h3",{id:"\u53c2\u6570\u914d\u7f6e-2"},"\u53c2\u6570\u914d\u7f6e"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u4fee\u6539MySQL \u914d\u7f6e\u6587\u4ef6 [my.ini\u3001my.cnf]")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-ini",metastring:'title="my.cnf"',title:'"my.cnf"'},"[mysqld]\n# binlog\u7684\u524d\u7f00\u540d\nlog-bin=my_binlog\nbinlog_expire_logs_seconds=600 \nmax_binlog_size=100M\n")),(0,l.kt)("admonition",{parentName:"li",title:"\u8bf4\u660e",type:"tip"},(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"log-bin")," \u53c2\u6570\u662f\u7528\u4ee5\u6765\u8bbe\u7f6e binlog \u7684\u524d\u7f00\u540d\u7684,",(0,l.kt)("strong",{parentName:"li"},"\u4e5f\u53ef\u4ee5\u52a0\u4e0a\u8def\u5f84"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6bd4\u5982 ",(0,l.kt)("em",{parentName:"li"},"/home/www/binlog/my_binlog"))))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u4e34\u65f6\u65b9\u5f0f [sql\u8bed\u53e5]")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4ec5\u652f\u6301 SESSION \u7ea7\u522b\nSET sql_log_bin=OFF\n")))),(0,l.kt)("h3",{id:"\u65e5\u5fd7\u683c\u5f0f"},"\u65e5\u5fd7\u683c\u5f0f"),(0,l.kt)("p",null,"binlog \u6709\u4e0b\u9762\u7684 3 \u79cd\u65e5\u5fd7\u683c\u5f0f:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"STATEMENT")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"ROW")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"MIXED"))),(0,l.kt)("h4",{id:"statement"},"statement"),(0,l.kt)("p",null,"Statement \u662f",(0,l.kt)("inlineCode",{parentName:"p"},"\u57fa\u4e8e SQL \u8bed\u53e5\u7684\u590d\u5236"),"(statement-based replication, \u7b80\u79f0 ",(0,l.kt)("inlineCode",{parentName:"p"},"SBR"),"),\u7279\u70b9\u662f",(0,l.kt)("strong",{parentName:"p"},"\u6bcf\u4e00\u6761\u4f1a\u4fee\u6539\u6570\u636e\u7684 sql \u8bed\u4f1a\u8bb0\u5f55\u5230 binlog"),", \u540c\u65f6\u8fd9\u79cd\u65e5\u5fd7\u683c\u5f0f\u662f",(0,l.kt)("strong",{parentName:"p"},"\u9ed8\u8ba4\u7684")," "),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"SBR \u7684\u4f18\u70b9:")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5386\u53f2\u60a0\u4e45,\u4e14\u6280\u672f\u6210\u719f"),(0,l.kt)("li",{parentName:"ol"},"\u4ec5\u8bb0\u5f55 SQL \u8bed\u53e5,\u800c\u4e0d\u9700\u8981\u8bb0\u5f55\u6bcf\u4e00\u884c\u7684\u53d8\u5316, \u51cf\u5c11\u4e86binlog\u65e5\u5fd7\u91cf,\u6240\u4ee5\u6587\u4ef6\u8f83\u5c0f"),(0,l.kt)("li",{parentName:"ol"},"binlog\u4e2d\u5305\u542b\u4e86\u6240\u6709\u6570\u636e\u5e93\u66f4\u6539\u4fe1\u606f,\u53ef\u4ee5\u636e\u6b64\u6765\u5ba1\u6838\u6570\u636e\u5e93\u7684\u5b89\u5168\u7b49\u60c5\u51b5"),(0,l.kt)("li",{parentName:"ol"},"binlog\u53ef\u4ee5\u7528\u4e8e\u5b9e\u65f6\u7684\u8fd8\u539f,\u800c\u4e0d\u4ec5\u4ec5\u7528\u4e8e\u590d\u5236"),(0,l.kt)("li",{parentName:"ol"},"\u4e3b\u4ece\u7248\u672c\u53ef\u4ee5\u4e0d\u4e00\u6837,\u4ece\u670d\u52a1\u5668\u7248\u672c\u53ef\u4ee5\u6bd4\u4e3b\u670d\u52a1\u5668\u7248\u672c\u9ad8")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"SBR \u7684\u7f3a\u70b9:")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4e0d\u662f\u6240\u6709\u7684UPDATE\u8bed\u53e5\u90fd\u80fd\u88ab\u590d\u5236, \u5c24\u5176\u662f\u5305\u542b\u4e0d\u786e\u5b9a\u64cd\u4f5c\u7684\u65f6\u5019"),(0,l.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u4ee5\u4e0b\u51fd\u6570\u7684\u8bed\u53e5\u4e5f\u65e0\u6cd5\u88ab\u590d\u5236: ",(0,l.kt)("em",{parentName:"li"},"LOAD_FILE()\u3001UUID()\u3001USER()\u3001FOUND_ROWS()\u3001SYSDATE()")," "),(0,l.kt)("li",{parentName:"ol"},"INSERT ... SELECT \u4f1a\u4ea7\u751f\u6bd4 ",(0,l.kt)("a",{parentName:"li",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#row"},"RBR")," \u66f4\u591a\u7684\u884c\u7ea7\u9501"),(0,l.kt)("li",{parentName:"ol"},"\u590d\u5236\u9700\u8981\u8fdb\u884c\u5168\u8868\u626b\u63cf(WHERE \u8bed\u53e5\u4e2d\u6ca1\u6709\u4f7f\u7528\u5230\u7d22\u5f15)\u7684 UPDATE \u65f6\uff0c\u9700\u8981\u6bd4 ",(0,l.kt)("a",{parentName:"li",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#row"},"RBR")," \u8bf7\u6c42\u66f4\u591a\u7684 \u884c\u7ea7\u9501"),(0,l.kt)("li",{parentName:"ol"},"\u5bf9\u4e8e\u6709 AUTO_INCREMENT \u5b57\u6bb5\u7684 InnoDB\u8868\u800c\u8a00\u770b, INSERT \u8bed\u53e5\u4f1a\u963b\u585e\u5176\u4ed6 INSERT \u8bed\u53e5 \u5bf9\u4e8e\u4e00\u4e9b\u590d\u6742\u7684\u8bed\u53e5\uff0c\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u7684\u8017\u8d44\u6e90\u60c5\u51b5\u4f1a\u66f4\u4e25\u91cd\uff0c\u800c ",(0,l.kt)("a",{parentName:"li",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#row"},"RBR \u6a21\u5f0f"),"\u4e0b\uff0c\u53ea\u4f1a\u5bf9\u90a3\u4e2a\u53d1\u751f\u53d8\u5316\u7684\u8bb0\u5f55\u4ea7\u751f\u5f71\u54cd"),(0,l.kt)("li",{parentName:"ol"},"\u6267\u884c\u590d\u6742\u8bed\u53e5\u5982\u679c\u51fa\u9519\u7684\u8bdd, \u4f1a\u6d88\u8017\u66f4\u591a\u8d44\u6e90"),(0,l.kt)("li",{parentName:"ol"},"\u6570\u636e\u8868\u5fc5\u987b\u51e0\u4e4e\u548c\u4e3b\u670d\u52a1\u5668\u4fdd\u6301\u4e00\u81f4\u624d\u884c\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u590d\u5236\u51fa\u9519")),(0,l.kt)("h4",{id:"row"},"row"),(0,l.kt)("p",null,"Row \u662f",(0,l.kt)("inlineCode",{parentName:"p"},"\u57fa\u4e8e\u884c\u7684\u590d\u5236"),"(row-based replication, \u7b80\u79f0",(0,l.kt)("inlineCode",{parentName:"p"},"RBR"),"),\u7279\u70b9\u662f",(0,l.kt)("strong",{parentName:"p"},"\u4e0d\u8bb0\u5f55\u6bcf\u6761sql\u8bed\u53e5\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f,\u4ec5\u8bb0\u5f55\u54ea\u6761\u6570\u636e\u88ab\u4fee\u6539\u4e86\u3001\u4fee\u6539\u6210\u4ec0\u4e48\u6837\u4e86")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"RBR \u7684\u4f18\u70b9:")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4efb\u4f55\u60c5\u51b5\u90fd\u53ef\u4ee5\u88ab\u590d\u5236,\u8fd9\u5bf9\u590d\u5236\u6765\u8bf4\u662f",(0,l.kt)("inlineCode",{parentName:"li"},"\u6700\u5b89\u5168\u53ef\u9760"),"\u7684",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6bd4\u5982:\u4e0d\u4f1a\u51fa\u73b0\u67d0\u4e9b\u7279\u5b9a\u60c5\u51b5\u4e0b\u7684",(0,l.kt)("strong",{parentName:"li"},"\u5b58\u50a8\u8fc7\u7a0b\u3001function\u3001trigger\u7684\u8c03\u7528\u548c\u89e6\u53d1\u65e0\u6cd5\u88ab\u6b63\u786e\u590d\u5236\u7684\u95ee\u9898")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u591a\u6570\u60c5\u51b5\u4e0b,\u4ece\u670d\u52a1\u5668\u4e0a\u7684\u8868\u5982\u679c\u6709\u4e3b\u952e\u7684\u8bdd,\u590d\u5236\u5c31\u4f1a\u5feb\u4e86\u5f88\u591a")),(0,l.kt)("li",{parentName:"ol"},"\u590d\u5236\u4ee5\u4e0b\u51e0\u79cd\u8bed\u53e5\u65f6\u7684\u884c\u9501\u66f4\u5c11",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"INSERT ... SELECT"),(0,l.kt)("li",{parentName:"ul"},"\u5305\u542b AUTO_INCREMENT \u5b57\u6bb5\u7684 INSERT"),(0,l.kt)("li",{parentName:"ul"},"\u6ca1\u6709\u9644\u5e26\u6761\u4ef6\u6216\u8005\u5e76\u6ca1\u6709\u4fee\u6539\u5f88\u591a\u8bb0\u5f55\u7684 UPDATE \u6216 DELETE \u8bed\u53e5"))),(0,l.kt)("li",{parentName:"ol"},"\u6267\u884c INSERT\u3001UPDATE\u3001DELETE \u8bed\u53e5\u65f6\u9501\u66f4\u5c11"),(0,l.kt)("li",{parentName:"ol"},"\u4ece\u670d\u52a1\u5668\u4e0a\u91c7\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"\u591a\u7ebf\u7a0b")," \u6765\u6267\u884c\u590d\u5236\u6210\u4e3a\u53ef\u80fd")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"RBR \u7684\u7f3a\u70b9:")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"binlog \u5927\u4e86\u5f88\u591a"),(0,l.kt)("li",{parentName:"ol"},"\u590d\u6742\u7684\u56de\u6eda\u65f6 binlog \u4e2d\u4f1a\u5305\u542b\u5927\u91cf\u7684\u6570\u636e"),(0,l.kt)("li",{parentName:"ol"},"\u4e3b\u670d\u52a1\u5668\u4e0a\u6267\u884c UPDATE \u8bed\u53e5\u65f6, \u6240\u6709\u53d1\u751f\u53d8\u5316\u7684\u8bb0\u5f55\u90fd\u4f1a\u5199\u5230 binlog \u4e2d, \u800c ",(0,l.kt)("a",{parentName:"li",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#statement"},"SBR"),"  \u53ea\u4f1a\u5199\u4e00 \u6b21,\u8fd9\u4f1a\u5bfc\u81f4\u9891\u7e41\u53d1\u751f binlog \u7684\u5e76\u53d1\u5199\u95ee\u9898"),(0,l.kt)("li",{parentName:"ol"},"\u65e0\u6cd5\u4ece binlog \u4e2d\u770b\u5230\u90fd\u590d\u5236\u4e86\u4e9b\u4ec0\u4e48\u8bed\u53e5")),(0,l.kt)("h4",{id:"mixed"},"mixed"),(0,l.kt)("p",null,"Mixed \u662f",(0,l.kt)("inlineCode",{parentName:"p"},"\u6df7\u5408\u6a21\u5f0f\u590d\u5236"),"(mixed-based replication, \u7b80\u79f0",(0,l.kt)("inlineCode",{parentName:"p"},"MBR"),"),\u5b9e\u9645\u4e0a\u5c31\u662fStatement\u4e0eRow\u7684\u7ed3\u5408"),(0,l.kt)("p",null,"\u5728Mixed\u6a21\u5f0f\u4e0b: ",(0,l.kt)("strong",{parentName:"p"},"\u4e00\u822c\u7684\u8bed\u53e5\u4fee\u6539\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"strong"},"statment"),"\u683c\u5f0f\u4fdd\u5b58binlog, \u800c\u4e00\u4e9b\u51fd\u6570\uff0cstatement\u65e0\u6cd5\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\u7684\u64cd\u4f5c\uff0c\u5219\u91c7\u7528",(0,l.kt)("inlineCode",{parentName:"strong"},"row"),"\u683c\u5f0f\u4fdd\u5b58binlog")),(0,l.kt)("p",null,"MySQL\u4f1a\u6839\u636e\u6267\u884c\u7684\u6bcf\u4e00\u6761\u5177\u4f53\u7684 sql \u8bed\u53e5\u6765\u533a\u5206\u5bf9\u5f85\u8bb0\u5f55\u7684\u65e5\u5fd7\u5f62\u5f0f, ",(0,l.kt)("strong",{parentName:"p"},"\u4e5f\u5c31\u662f\u5728Statement\u548cRow\u4e4b\u95f4\u9009\u62e9\u4e00\u79cd")),(0,l.kt)("h3",{id:"\u67e5\u770b\u65e5\u5fd7"},"\u67e5\u770b\u65e5\u5fd7"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"MySQL \u670d\u52a1\u6bcf\u6b21\u542f\u52a8\u65f6, \u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a binlog \u6587\u4ef6")),(0,l.kt)("h4",{id:"\u65e5\u5fd7\u5217\u8868"},"\u65e5\u5fd7\u5217\u8868"),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"show binary logs"),"\u547d\u4ee4\u67e5\u770b\u5f53\u524d\u5df2\u6709\u7684 binlog \u5217\u8868\u4fe1\u606f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show binary logs;\n+------------------+-----------+-----------+\n| Log_name         | File_size | Encrypted |\n+------------------+-----------+-----------+\n| my_binlog.000001 |       156 | No        |\n+------------------+-----------+-----------+\n1 row in set (0.00 sec)\n")),(0,l.kt)("h4",{id:"binlog-\u5206\u6790\u5de5\u5177"},"binlog \u5206\u6790\u5de5\u5177"),(0,l.kt)("p",null,"\u548c",(0,l.kt)("a",{parentName:"p",href:"%E5%9F%BA%E6%9C%AC%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7#%E6%85%A2%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"},"slow_query_log")," \u4e00\u6837,binlog\u4e5f\u6709\u81ea\u5df1\u7684\u89e3\u6790\u5de5\u5177: ",(0,l.kt)("strong",{parentName:"p"},"mysqlbinlog")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u57fa\u672c\u683c\u5f0f")," "),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mysqlbinlog [options] \u65e5\u5fd7\u8def\u5f84")," "))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u5e38\u7528\u8bed\u53e5")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"# \u53ef\u67e5\u770b\u53c2\u6570\u5e2e\u52a9\nmysqlbinlog --no-defaults --help\n# \u67e5\u770b\u6700\u540e100\u884c\nmysqlbinlog --no-defaults --base64-output=decode-rows -vv \u65e5\u5fd7\u540d |tail -100\n# \u6839\u636eposition\u67e5\u627e\nmysqlbinlog --no-defaults --base64-output=decode-rows -vv \u65e5\u5fd7\u540d |grep -A 20 'pos\u4f4d\u7f6e'\n")))),(0,l.kt)("admonition",{title:"\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"1.\u4f7f\u7528\u547d\u4ee4:  ",(0,l.kt)("em",{parentName:"strong"},"mysqlbinlog \u65e5\u5fd7\u8def\u5f84")," : \u53ef\u4ee5\u770b\u5230binlog \u540e\u9762\u7684\u5185\u5bb9\u90fd\u662f\u7ecf\u8fc7\u7f16\u7801\u540e\u7684,\u4f46\u662f\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a update \u8bed\u53e5\u542b\u6709\u4e0b\u9762\u7684\u51e0\u4e2a\u4e8b\u4ef6:")),(0,l.kt)("ol",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"Query \u4e8b\u4ef6"),": \u8d1f\u8d23\u5f00\u59cb\u4e00\u4e2a\u4e8b\u52a1(Begin)"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"Table_map \u4e8b\u4ef6")," : \u8d1f\u8d23\u6620\u5c04\u9700\u8981\u7684\u8868"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"Update_rows\u4e8b\u4ef6")," : \u8d1f\u8d23\u5199\u5165\u6570\u636e"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"Xid \u4e8b\u4ef6")," : \u8d1f\u8d23\u7ed3\u675f\u4e8b\u52a1")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220925124807444",src:a(89489).Z,width:"2584",height:"764"})),(0,l.kt)("br",null),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"2. \u6211\u4eec\u7528 base64 \u89e3\u7801\u7684\u65b9\u5f0f\u53bb\u89e3\u6790\u5f97\u5230\u4f2a SQL")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220925124945931",src:a(32525).Z,width:"2570",height:"1096"}))),(0,l.kt)("h4",{id:"binlog-\u4e8b\u4ef6"},"binlog \u4e8b\u4ef6"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7",(0,l.kt)("em",{parentName:"li"},"mysqlbinlog")," \u5f97\u5230\u7684\u65e5\u5fd7\u5185\u5bb9\u6bd4\u8f83\u591a,\u53ef\u4ee5\u6307\u5b9a\u67e5\u8be2 binlog \u7684 pos \u70b9"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u57fa\u672c\u683c\u5f0f"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"show binlog events [IN 'log_name'] [FROM pos] [LIMIT [offset,] row_count];"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"IN  logName")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u8981\u67e5\u8be2\u7684binlog\u6587\u4ef6\u540d(\u4e0d\u6307\u5b9a\u5c31\u662f\u7b2c\u4e00\u4e2abinlog\u6587\u4ef6) "))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"FROM pos"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5b9a\u4ece\u54ea\u4e2apos\u8d77\u59cb\u70b9\u5f00\u59cb\u67e5\u8d77(\u4e0d\u6307\u5b9a\u5c31\u662f\u4ece\u6574\u4e2a\u6587\u4ef6\u9996\u4e2apos\u70b9\u5f00\u59cb\u7b97)"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"LIMIT ","[offset]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u504f\u79fb\u91cf(\u4e0d\u6307\u5b9a\u5c31\u662f0)"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"row_count"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u67e5\u8be2\u603b\u6761\u6570(\u4e0d\u6307\u5b9a\u5c31\u662f\u6240\u6709\u884c)")))))))),(0,l.kt)("admonition",{title:"\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220925130030214",src:a(14490).Z,width:"2350",height:"766"})),(0,l.kt)("br",null),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220925130407516",src:a(37011).Z,width:"2528",height:"984"}))),(0,l.kt)("h3",{id:"\u6062\u590d\u6570\u636e"},"\u6062\u590d\u6570\u636e"),(0,l.kt)("p",null,"MySQL \u53ef\u4ee5\u901a\u8fc7",(0,l.kt)("em",{parentName:"p"},"mysqlbinlog")," \u6765\u6062\u590d\u6570\u636e,\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mysqlbinlog [option] \u65e5\u5fd7\u6587\u4ef6\u540d|mysql \u2013u\u7528\u6237 -p\u5bc6\u7801;"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"option \u53ef\u9009\u9879\u6709\u4e24\u5bf9\u91cd\u8981\u7684\u53c2\u6570",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"--start-date\u3001--stop-date")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u6062\u590d\u6570\u636e\u5e93\u7684\u8d77\u59cb\u65f6\u95f4\u70b9\u548c\u7ed3\u675f\u65f6\u95f4\u70b9"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"--start-position\u3001-- stop-position")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u6062\u590d\u6570\u636e\u7684\u5f00\u59cb\u4f4d\u7f6e\u548c\u7ed3\u675f\u4f4d\u7f6e"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"--database")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u5728\u54ea\u4e2a\u6570\u636e\u5e93\u6267\u884c\u6062\u590d\u64cd\u4f5c"))))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,(0,l.kt)("strong",null,"\u6ce8\u610f:"),"\u4f7f\u7528mysqlbinlog\u547d\u4ee4\u8fdb\u884c\u6062\u590d\u64cd\u4f5c\u65f6,\u5fc5\u987b\u662f\u7f16\u53f7\u5c0f\u7684\u5148\u6062\u590d"))),(0,l.kt)("admonition",{title:"\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"1. \u6211\u4eec\u5148\u67e5\u770b\u8868\u4e2d\u539f\u6709\u7684\u6570\u636e\u662f\u4ec0\u4e48")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> select * from account;\n+----+--------+------+\n| id | name   | sal  |\n+----+--------+------+\n|  1 | \u5f20\u4e09   |  200 |\n|  2 | \u674e\u56db   |  500 |\n|  3 | \u738b\u4e94   | 1000 |\n|  4 | \u8d75\u516d   | 1000 |\n+----+--------+------+\n4 rows in set (0.00 sec)\n")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"2.\u7136\u540e\u63d2\u5165\u4e00\u6761\u6570\u636e,\u518d\u5c06\u8be5\u6570\u636e\u5220\u9664")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> # \u63d2\u5165\u4e00\u6761\u6570\u636e\nmysql> insert into account values(5,'\u6d4b\u8bd5','100000')\n    -> ;\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> #\u5220\u9664\u65b0\u52a0\u7684\u6570\u636e\nmysql> delete from account where id=5;\nQuery OK, 1 row affected (0.08 sec)\n")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"3.\u67e5\u770b binlog \u7684\u8bb0\u5f55,\u53ef\u4ee5\u770b\u5230:")),(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"Pos [235, 456] \u533a\u95f4\u7684\u64cd\u4f5c\u5c31\u662f INSERT \u64cd\u4f5c\u5bf9\u5e94\u7684 binlog \u8bb0\u5f55"))),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> # \u67e5\u770b binlog\nmysql> show binary logs;\n+------------------+-----------+-----------+\n| Log_name         | File_size | Encrypted |\n+------------------+-----------+-----------+\n| my_binlog.000001 |       805 | No        |\n| my_binlog.000002 |       756 | No        |\n+------------------+-----------+-----------+\n2 rows in set (0.01 sec)\n\nmysql> # \u67e5\u770b\u6700\u65b0 binlog \u7684pos\nmysql> show binlog events in 'my_binlog.000002';\n+------------------+-----+----------------+-----------+-------------+--------------------------------------+\n| Log_name         | Pos | Event_type     | Server_id | End_log_pos | Info                                 |\n+------------------+-----+----------------+-----------+-------------+--------------------------------------+\n| my_binlog.000002 |   4 | Format_desc    |         1 |         125 | Server ver: 8.0.25, Binlog ver: 4    |\n| my_binlog.000002 | 125 | Previous_gtids |         1 |         156 |                                      |\n| my_binlog.000002 | 156 | Anonymous_Gtid |         1 |         235 | SET @@SESSION.GTID_NEXT= 'ANONYMOUS' |\n/* highlight-start */\n| my_binlog.000002 | 235 | Query          |         1 |         311 | BEGIN                                |\n| my_binlog.000002 | 311 | Table_map      |         1 |         374 | table_id: 91 (demo2.account)         |\n| my_binlog.000002 | 374 | Write_rows     |         1 |         425 | table_id: 91 flags: STMT_END_F       |\n| my_binlog.000002 | 425 | Xid            |         1 |         456 | COMMIT /* xid=30 */                  |\n| my_binlog.000002 | 456 | Anonymous_Gtid |         1 |         535 | SET @@SESSION.GTID_NEXT= 'ANONYMOUS' |\n/* highlight-end */\n| my_binlog.000002 | 535 | Query          |         1 |         611 | BEGIN                                |\n| my_binlog.000002 | 611 | Table_map      |         1 |         674 | table_id: 91 (demo2.account)         |\n| my_binlog.000002 | 674 | Delete_rows    |         1 |         725 | table_id: 91 flags: STMT_END_F       |\n| my_binlog.000002 | 725 | Xid            |         1 |         756 | COMMIT /* xid=31 */                  |\n+------------------+-----+----------------+-----------+-------------+--------------------------------------+\n12 rows in set (0.00 sec)\n\n")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"4.\u5229\u7528 mysqlbinlog \u6062\u590d\u6570\u636e")),(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u9700\u8981\u6ce8\u610f\u7684\u662f: \u4e00\u822c\u90fd\u9700\u8981\u6307\u5b9a\u6062\u590d pos\u4f4d\u7f6e\u6216\u8005\u65f6\u95f4\u8303\u56f4,\u5426\u5219\u53ef\u80fd\u4f1a\u5c06\u4e00\u4e9b\u8bef\u64cd\u4f5c\u7684 binlog \u8bb0\u5f55\u4e5f\u6267\u884c,\u5bfc\u81f4\u6062\u590d\u5931\u8d25"))),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"[root@localhost mysql]# mysqlbinlog --start-position=235 --stop-position=456 my_binlog.000002 |mysql -uroot -p   \nEnter password: \n[root@localhost mysql]# # \u8fd9\u91cc\u6062\u590d\u5b8c\u6210\n")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"5.\u67e5\u770b MySQL \u6570\u636e,\u53ef\u4ee5\u770b\u5230\u5220\u9664\u7684 ",(0,l.kt)("em",{parentName:"strong"},"id=5")," \u7684\u6570\u636e\u6062\u590d\u6210\u529f\u4e86")," "),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> select * from account;\n+----+--------+--------+\n| id | name   | sal    |\n+----+--------+--------+\n|  1 | \u5f20\u4e09   |    200 |\n|  2 | \u674e\u56db   |    500 |\n|  3 | \u738b\u4e94   |   1000 |\n|  4 | \u8d75\u516d   |   1000 |\n/* highlight-start */\n|  5 | \u6d4b\u8bd5   | 100000 |\n/* highlight-end */\n+----+--------+--------+\n5 rows in set (0.00 sec)\n"))),(0,l.kt)("h3",{id:"\u5220\u9664\u65e5\u5fd7"},"\u5220\u9664\u65e5\u5fd7"),(0,l.kt)("p",null,"MySQL \u7684 binlog \u6587\u4ef6\u53ef\u4ee5\u914d\u7f6e",(0,l.kt)("strong",{parentName:"p"},"\u81ea\u52a8\u5220\u9664"),", \u540c\u65f6 MySQL \u4e5f\u652f\u6301",(0,l.kt)("strong",{parentName:"p"},"\u5b89\u5168\u7684\u624b\u52a8\u5220\u9664")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"PURGE MASTER LOGS"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u53ea\u5220\u9664\u6307\u5b9a\u90e8\u5206 binlog \u6587\u4ef6"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"RESET MASTER"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5220\u9664\u6240\u6709\u7684 binlog \u6587\u4ef6")))),(0,l.kt)("h4",{id:"purge"},"purge"),(0,l.kt)("p",null,"\u53ef\u4ee5\u5220\u9664\u6307\u5b9a\u7684 binlog \u6587\u4ef6,\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"PURGE {MASTER | BINARY} LOGS TO \u2018\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u540d\u2019"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5220\u9664\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u4e4b\u524d\u7684 binlog, \u4f46\u662f",(0,l.kt)("mark",null,"\u4e0d\u5305\u542b\u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6")," "))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"}," PURGE {MASTER | BINARY} LOGS BEFORE \u2018\u6307\u5b9a\u65e5\u671f\u2019"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5220\u9664\u6307\u5b9a\u65f6\u95f4\u4e4b\u524d\u7684 binlog, \u4f46\u662f",(0,l.kt)("mark",null,"\u4e0d\u5305\u542b\u6307\u5b9a\u65f6\u95f4\u7684\u65e5\u5fd7\u6587\u4ef6")," ")))),(0,l.kt)("h4",{id:"reset-"},"reset \ud83d\udea7"),(0,l.kt)("p",null,"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"reset master")," \u8bed\u53e5\u4f1a\u6e05\u7a7a\u6240\u6709\u7684 binlog \u6587\u4ef6,\u5e76\u4e14 MySQL \u4f1a\u91cd\u65b0\u521b\u5efa binlog\u6587\u4ef6,",(0,l.kt)("strong",{parentName:"p"},"\u65b0\u7684\u65e5\u5fd7\u62d3\u5c55\u540d\u4e5f\u5c06\u4ece ",(0,l.kt)("em",{parentName:"strong"},".00001")," \u5f00\u59cb")),(0,l.kt)("h3",{id:"\u5176\u4ed6\u573a\u666f"},"\u5176\u4ed6\u573a\u666f"),(0,l.kt)("p",null,"\u901a\u8fc7\u6570\u636e\u5e93\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"\u5168\u91cf\u5907\u4efd")," \u548c binlog \u4e2d\u4fdd\u5b58\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"\u589e\u91cf\u4fe1\u606f")," , \u53ef\u4ee5\u5b8c\u6210\u6570\u636e\u5e93\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"\u65e0\u635f\u5931\u6062\u590d")," \u3002 \u4f46\u5982\u679c\u9047\u5230\u6570\u636e\u91cf\u5927\u3001\u6570\u636e\u5e93\u548c\u6570\u636e\u8868\u5f88\u591a(\u6bd4\u5982\u5206\u5e93\u5206\u8868\u7684\u5e94\u7528)\u7684\u573a\u666f, \u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\u8fdb\u884c\u6570\u636e\u6062\u590d, \u662f\u5f88\u6709\u6311\u6218\u6027\u7684, \u56e0\u4e3a",(0,l.kt)("strong",{parentName:"p"},"\u8d77\u6b62\u4f4d\u7f6e\u4e0d\u5bb9\u6613\u7ba1\u7406"),"\u3002"),(0,l.kt)("p",null,"\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b, \u4e00\u4e2a\u6709\u6548\u7684\u89e3\u51b3\u529e\u6cd5\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"\u914d\u7f6e\u4e3b\u4ece\u6570\u636e\u5e93\u670d\u52a1\u5668"),", \u751a\u81f3\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"\u4e00\u4e3b\u591a\u4ece")," \u7684\u67b6\u6784, ",(0,l.kt)("strong",{parentName:"p"},"\u628abinlog \u6587\u4ef6\u7684\u5185\u5bb9\u901a\u8fc7\u4e2d\u7ee7\u65e5\u5fd7, \u540c\u6b65\u5230\u4ece\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e2d"),", \u8fd9\u6837\u5c31\u53ef\u4ee5",(0,l.kt)("strong",{parentName:"p"},"\u6709\u6548\u907f\u514d\u6570\u636e\u5e93\u6545\u969c\u5bfc\u81f4\u7684\u6570\u636e\u5f02\u5e38\u7b49\u95ee\u9898")),(0,l.kt)("h3",{id:"\u5199\u5165\u673a\u5236"},"\u5199\u5165\u673a\u5236"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"binlog \u7684\u5199\u5165\u65f6\u673a\u5f88\u7b80\u5355,",(0,l.kt)("strong",{parentName:"li"},"\u5728\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d,\u5148\u628a\u65e5\u5fd7\u5199\u5230"),(0,l.kt)("inlineCode",{parentName:"li"},"binlog cache"),(0,l.kt)("strong",{parentName:"li"},",\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019,\u518d\u628a binlog cache \u5199\u5165\u5230 binlog \u6587\u4ef6\u4e2d\u3002"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7531\u4e8e\u4e00\u4e2a\u4e8b\u52a1\u7684 binlog \u65e0\u6cd5\u88ab\u62c6\u5f00,\u6240\u4ee5\u4e0d\u8bba\u8fd9\u4e2a\u4e8b\u52a1\u591a\u5927,\u90fd\u8981\u4fdd\u8bc1\u80fd\u4e00\u6b21\u6027\u7684\u5199\u5165,\u6240\u4ee5 MySQL \u4f1a\u7ed9",(0,l.kt)("strong",{parentName:"li"},"\u6bcf\u4e2a\u7ebf\u7a0b\u5206\u914d\u4e00\u5757\u5185\u5b58\u4f5c\u4e3a ",(0,l.kt)("em",{parentName:"strong"},"binlog cache"))))),(0,l.kt)("li",{parentName:"ul"},"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"binlog_cache_size")," \u53c2\u6570\u63a7\u5236\u5355\u4e2a\u7ebf\u7a0b ",(0,l.kt)("em",{parentName:"li"},"binlog cache")," \u5927\u5c0f\u3002\u5982\u679c\u8d85\u8fc7\u8fd9\u4e2a\u9608\u503c,\u5c31\u9700\u8981\u5c06\u6682\u5b58\u5230 ",(0,l.kt)("em",{parentName:"li"},"\u78c1\u76d8(Swap)"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"binlog \u5237\u76d8\u6d41\u7a0b:")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20220925145508941",src:a(47811).Z,width:"2162",height:"1518"})),(0,l.kt)("admonition",{title:"\u8bf4\u660e",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"binlog cache \u5199\u5165\u5230",(0,l.kt)("strong",{parentName:"p"},"page cache")," \u548c \u5237\u76d8",(0,l.kt)("strong",{parentName:"p"},"fsync")," \u7684\u65f6\u673a\u7531\u53c2\u6570 ",(0,l.kt)("inlineCode",{parentName:"p"},"sync_binlog")," \u63a7\u5236,\u9ed8\u8ba4\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"0")),(0,l.kt)("ol",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"sync_binlog = 0")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u53ea\u5199\u5165\u5230 ",(0,l.kt)("em",{parentName:"strong"},"page cache")," , \u5177\u4f53\u4ec0\u4e48\u65f6\u5019\u6267\u884c fsync\u5237\u76d8\u7531 OS \u51b3\u5b9a")," "),(0,l.kt)("li",{parentName:"ul"},"\u8fd9\u79cd\u65b9\u5f0f\u867d\u7136\u6027\u80fd\u5f97\u5230\u63d0\u5347\uff0c\u4f46\u662f\u673a\u5668\u5b95\u673a\uff0cpage cache\u91cc\u9762\u7684 binglog \u4f1a\u4e22\u5931"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"sync_binlog = 1")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u4f1a\u6267\u884c\u5237\u76d8 ",(0,l.kt)("em",{parentName:"strong"},"fsync")),", \u5c31\u548c redo\u65e5\u5fd7\u5237\u76d8\u6d41\u7a0b\u4e00\u6837"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"sync_binlog = N [N>1]")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u5c06 binlog cache \u5199\u5165\u5230 page cache\u4e2d, \u4f46\u7d2f\u79ef\u4e86N\u4e2a",(0,l.kt)("inlineCode",{parentName:"strong"},"\u4e8b\u52a1"),"\u540e\u624d\u5237\u76d8 fsync")," "),(0,l.kt)("li",{parentName:"ul"},"\u5728\u51fa\u73b0IO\u74f6\u9888\u7684\u573a\u666f\u91cc, \u53ef\u4ee5\u5c06 sync_binlog \u8bbe\u7f6e\u6210\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u503c\u6765\u63d0\u5347\u6027\u80fd\u3002\u4f46\u5982\u679c\u673a\u5668\u5b95\u673a,\u4f1a\u4e22\u5931\u6700\u8fd1N\u4e2a\u4e8b\u52a1\u7684 binlog"))))),(0,l.kt)("h3",{id:"binlog-\u4e0e-redo-log"},"binlog \u4e0e redo log"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"redo log")," \u5b83\u662f",(0,l.kt)("inlineCode",{parentName:"li"},"\u7269\u7406\u65e5\u5fd7"),", \u8bb0\u5f55\u5185\u5bb9\u662f",(0,l.kt)("strong",{parentName:"li"},"\u5728\u67d0\u4e2a\u6570\u636e\u9875\u4e0a\u505a\u4e86\u4ec0\u4e48\u4fee\u6539"),", \u5c5e\u4e8e InnoDB ",(0,l.kt)("inlineCode",{parentName:"li"},"\u5b58\u50a8\u5f15\u64ce\u5c42"),"\u4ea7\u751f\u7684"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"binlog"),"\u662f ",(0,l.kt)("inlineCode",{parentName:"li"},"\u903b\u8f91\u65e5\u5fd7"),", \u8bb0\u5f55\u5185\u5bb9\u662f\u8bed\u53e5\u7684\u539f\u59cb\u903b\u8f91, \u7c7b\u4f3c\u4e8e",(0,l.kt)("strong",{parentName:"li"},"\u7ed9 ID=2 \u8fd9\u4e00\u884c\u7684 c \u5b57\u6bb5\u52a0 1"),",  \u5c5e\u4e8eMySQL ",(0,l.kt)("inlineCode",{parentName:"li"},"Server \u5c42")),(0,l.kt)("li",{parentName:"ul"},"\u867d\u7136\u4e24\u8005\u90fd\u4fdd\u8bc1\u4e86\u6301\u4e45\u5316,\u4f46\u662f",(0,l.kt)("strong",{parentName:"li"},"\u4fa7\u91cd\u70b9\u4e0d\u540c"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"redo log \u8ba9 InnoDB \u5b58\u50a8\u5f15\u64ce\u6709\u4e86\u5d29\u6e83\u6062\u590d\u7684\u80fd\u529b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"binlog \u4fdd\u8bc1\u4e86MySQL \u96c6\u7fa4\u67b6\u6784\u4e0b\u7684\u6570\u636e\u4e00\u81f4\u6027"))))),(0,l.kt)("h3",{id:"\u5185\u90e8-xa-\u4e8b\u52a1"},"\u5185\u90e8 XA \u4e8b\u52a1"),(0,l.kt)("h4",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u6700\u5e38\u89c1\u7684\u5185\u90e8 XA \u4e8b\u52a1\u5b58\u5728\u4e8e binlog \u4e0e InnoDB \u5b58\u50a8\u5f15\u64ce\u4e4b\u95f4")),(0,l.kt)("p",null,"\u5728\u6267\u884c\u66f4\u65b0\u8bed\u53e5\u65f6, \u4f1a\u8bb0\u5f55 ",(0,l.kt)("em",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"em"},"redo log"))," \u4e0e ",(0,l.kt)("em",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"em"},"binlog"))," \u4e24\u5757\u65e5\u5fd7, ",(0,l.kt)("strong",{parentName:"p"},"\u4ee5\u57fa\u672c\u7684\u4e8b\u52a1\u4e3a\u5355\u4f4d"),", ",(0,l.kt)("strong",{parentName:"p"},"redo log\u5728\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b \u4e2d\u53ef\u4ee5\u4e0d\u65ad\u5199\u5165\uff0c\u800cbinlog\u53ea\u6709\u5728\u63d0\u4ea4\u4e8b\u52a1\u65f6\u624d\u5199\u5165"),", \u6240\u4ee5redo log \u4e0e binlog \u7684",(0,l.kt)("strong",{parentName:"p"},"\u5199\u5165\u65f6\u673a\u4e0d\u4e00\u6837")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20220925152622210",src:a(64476).Z,width:"1394",height:"1440"})),(0,l.kt)("h4",{id:"\u95ee\u9898"},"\u95ee\u9898"),(0,l.kt)("p",null,"\u5728\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019,\u5148\u5199 binlog, \u518d\u5199InnoDB \u5b58\u50a8\u5f15\u64ce\u7684 redo\u65e5\u5fd7,\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u4e5f\u9700\u8981\u662f\u539f\u5b50\u7684,\u5373",(0,l.kt)("inlineCode",{parentName:"p"},"binlog \u548c redo\u65e5\u5fd7\u5fc5\u987b\u540c\u65f6\u5199\u5165")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5982\u679cbinlog \u5148\u5199\u4e86,\u800c\u5728\u5199\u5165 redo \u65e5\u5fd7\u7684\u65f6\u5019\u53d1\u751f\u4e86\u5b95\u673a,\u90a3\u4e48 slave \u5c31\u53ef\u80fd\u4f1a\u6536\u5230 master \u4f20\u8fc7\u53bb\u7684 binlog \u5e76\u6267\u884c,\u7136\u540e master \u6ca1\u6709 redo \u65e5\u5fd7,\u6240\u4ee5\u65e0\u6cd5\u6062\u590d"),(0,l.kt)("li",{parentName:"ul"},"\u4e0a\u9762\u7684\u64cd\u4f5c\u5c31\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u673a\u7684\u6570\u636e\u4e0d\u4e00\u81f4")),(0,l.kt)("p",null,"\u6bd4\u5982\u4e0b\u9762\u4e2d,\u4e8b\u52a1\u63d0\u4ea4\u65f6\u5b9e\u73b0\u6267\u884c\u5b8c 1\u30012 \u6b65\u540e, slave \u4e2d\u7684\u6570\u636e\u66f4\u65b0\u5230\u4e86\u72b6\u6001 ",(0,l.kt)("inlineCode",{parentName:"p"},"S1"),",  \u5047\u5982MySQL \u670d\u52a1\u5668\u5b95\u673a\u4e86,\u6b64\u65f6",(0,l.kt)("strong",{parentName:"p"},"redo \u65e5\u5fd7\u6ca1\u6709\u6765\u5f97\u53ca\u5237\u76d8"),",\u90a3\u4e48\u5f53 master \u4e3b\u673a\u6062\u590d\u4e4b\u540e,\u7531\u4e8e\u6ca1\u6709\u5bf9\u5e94\u7684 redo \u65e5\u5fd7,\u6240\u4ee5\u65e0\u6cd5\u5c06 master \u4e2d\u7684\u6570\u636e\u72b6\u6001\u66f4\u65b0\u5230\u4e0e slave \u4e00\u6837\u7684 S1,\u4e5f\u5c31\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"\u6570\u636e\u4e0d\u4e00\u81f4")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20221002150845930",src:a(5341).Z,width:"1300",height:"800"})),(0,l.kt)("h4",{id:"\u4e24\u9636\u6bb5\u63d0\u4ea42pc"},"\u4e24\u9636\u6bb5\u63d0\u4ea4(2PC)"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e24\u9636\u6bb5\u63d0\u4ea4\u5c31\u662f\u5c06 redo \u65e5\u5fd7\u7684\u5199\u5165\u62c6\u5206\u6210\u4e24\u4e2a\u6b65\u9aa4",(0,l.kt)("inlineCode",{parentName:"li"},"prepare\u3001commit")," ",(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"\u5f53\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019, \u4f1a\u5c06",(0,l.kt)("inlineCode",{parentName:"li"},"\u4e8b\u52a1 id"),"\u5199\u5165 redo \u65e5\u5fd7\u3002\u6b64\u65f6InnoDB \u4f1a\u7ed9 redo \u65e5\u5fd7\u505a\u4e00\u4e2a ",(0,l.kt)("em",{parentName:"li"},"prepare")," \u64cd\u4f5c,\u5904\u4e8e",(0,l.kt)("em",{parentName:"li"},"prepare")," \u9636\u6bb5"),(0,l.kt)("li",{parentName:"ol"},"server \u5c42\u7684\u6267\u884c\u5668 ",(0,l.kt)("inlineCode",{parentName:"li"},"\u5199\u5165 binlog"),",\u540c\u65f6\u4e5f\u4f1a\u5c06",(0,l.kt)("inlineCode",{parentName:"li"},"\u4e8b\u52a1 id"),"\u5199\u5165"),(0,l.kt)("li",{parentName:"ol"},"InnoDB \u7ed9 redo \u65e5\u5fd7\u505a ",(0,l.kt)("em",{parentName:"li"},"commit")," \u64cd\u4f5c"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u6570\u636e\u5e93\u91cd\u542f\u4e4b\u540e\u53ea\u8981\u5224\u65ad redo \u65e5\u5fd7\u7684"),(0,l.kt)("inlineCode",{parentName:"li"},"\u4e8b\u52a1 id")," ",(0,l.kt)("strong",{parentName:"li"},"\u662f\u5426\u6709\u5bf9\u5e94\u7684 binlog \u5373\u53ef")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u4e24\u9636\u6bb5\u63d0\u4ea4, \u5176\u5b9e\u662f\u4e3a\u4e86\u4fdd\u8bc1 redo log \u548c binlog \u7684\u903b\u8f91\u4e00\u81f4\u6027"))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20220925161753802",src:a(32009).Z,width:"1896",height:"1434"})),(0,l.kt)("h2",{id:"\u4e2d\u7ee7\u65e5\u5fd7"},"\u4e2d\u7ee7\u65e5\u5fd7"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u4e2d\u7ee7\u65e5\u5fd7\u53ea\u5728 ",(0,l.kt)("em",{parentName:"strong"},"master-slave"),"\u67b6\u6784\u7684\u4ece\u670d\u52a1\u5668\u4e0a\u5b58\u5728"),"\u3002slave \u4e3a\u4e86\u4e0emaster \u4fdd\u6301\u4e00\u81f4, \u8981\u4ecemaster \u670d\u52a1\u5668\u4e0a\u8bfb\u53d6binlog, \u5e76\u4e14\u628a\u8bfb\u53d6\u5230\u7684\u4fe1\u606f\u5199\u5165",(0,l.kt)("inlineCode",{parentName:"p"},"\u672c\u5730\u65e5\u5fd7\u6587\u4ef6"),"\u4e2d\uff0c\u8fd9\u4e2aslave \u670d\u52a1\u5668\u7684\u672c\u5730\u65e5\u5fd7\u6587\u4ef6\u5c31\u53eb",(0,l.kt)("inlineCode",{parentName:"p"},"\u4e2d\u7ee7\u65e5\u5fd7(relay log)"),"\u3002"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7136\u540e, slave \u670d\u52a1\u5668\u8bfb\u53d6\u4e2d\u7ee7\u65e5\u5fd7, \u5e76\u6839\u636e\u4e2d\u7ee7\u65e5\u5fd7\u7684\u5185\u5bb9\u5bf9 slave \u670d\u52a1\u5668\u7684\u6570\u636e\u8fdb\u884c\u66f4\u65b0,\u5b8c\u6210\u4e3b\u4ece\u670d\u52a1\u5668\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"\u6570\u636e\u540c\u6b65")," "))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u642d\u5efa\u597d\u4e3b\u4ece\u670d\u52a1\u5668\u4e4b\u540e, ",(0,l.kt)("strong",{parentName:"p"},"\u4e2d\u7ee7\u65e5\u5fd7\u9ed8\u8ba4\u4f1a\u4fdd\u5b58\u5728 slave\u670d\u52a1\u5668\u7684\u6570\u636e\u76ee\u5f55\u4e0b")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6587\u4ef6\u540d\u7684\u683c\u5f0f\u662f ",(0,l.kt)("inlineCode",{parentName:"li"},"slave\u670d\u52a1\u5668\u540d-relay-bin.\u5e8f\u53f7")),(0,l.kt)("li",{parentName:"ul"},"\u4e2d\u7ee7\u65e5\u5fd7\u8fd8\u6709\u4e00\u4e2a\u7d22\u5f15\u6587\u4ef6: ",(0,l.kt)("inlineCode",{parentName:"li"},"slave\u670d\u52a1\u5668\u540d-relay-bin.index"),", \u7528\u6765\u5b9a\u4f4d\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u4e2d\u7ee7\u65e5\u5fd7"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u4e2d\u7ee7\u65e5\u5fd7\u4e0e\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u683c\u5f0f\u76f8\u540c\uff0c\u53ef\u4ee5\u7528",(0,l.kt)("inlineCode",{parentName:"strong"},"mysqlbinlog"),"\u5de5\u5177\u8fdb\u884c\u67e5\u770b")))),(0,l.kt)("h2",{id:"\u65e5\u5fd7\u7684\u901a\u7528\u64cd\u4f5c"},"\u65e5\u5fd7\u7684\u901a\u7528\u64cd\u4f5c"),(0,l.kt)("h3",{id:"\u5237\u65b0\u65e5\u5fd7"},"\u5237\u65b0\u65e5\u5fd7"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u5237\u65b0\u65e5\u5fd7:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysqladmin -uroot -p flush-logs\n\n# \u6216\u8005\u5728 MySQL \u63a7\u5236\u53f0\nmysql> flush logs\n")))}N.isMDXComponent=!0},11750:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220918152910360-4a1fac7ebe3e97b10fe112c535ab98d8.png"},8116:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220918154706728-40411e232716220684340272a5ca850a.png"},64647:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220918162829410-42fa363ed6abbec7be2dc57487b44449.png"},81359:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220918170726560-70ca0d1fd6db7b0a1dd70a89189b208d.png"},32012:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220925094546455-a68612c3e02b8cc2843ccee1d6783764.png"},89489:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220925124807444-2af72943a93ca5aa1f618b9ad6e9e057.png"},32525:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220925124945931-8752c1348ad160941ef647b8bb8367be.png"},14490:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220925130030214-38ec3a7d1cdcab7b48c9de2ee066da59.png"},37011:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220925130407516-9e14ad5fdfb4bdf1d49edf0abaf6b2f1.png"},47811:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220925145508941-78808de60c8da60af5bde390a5626aff.png"},64476:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220925152622210-80a9989a82592ff03ebaa10a56afd975.png"},32009:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220925161753802-936af230680d37436a1d38acd09ce8d8.png"},5341:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20221002150845930-049573dc1d3f43f311c055cb1a03039f.png"}}]);