"use strict";(self.webpackChunkhuakucha=self.webpackChunkhuakucha||[]).push([[5931],{17545:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>k,frontMatter:()=>i,metadata:()=>r,toc:()=>m});var t=a(87462),l=(a(67294),a(3905));a(61839);const i={id:"\u4e3b\u4ece\u590d\u5236",title:"\u4e3b\u4ece\u590d\u5236"},s=void 0,r={unversionedId:"Mysql/\u9ad8\u7ea7\u7279\u6027/\u4e3b\u4ece\u590d\u5236",id:"Mysql/\u9ad8\u7ea7\u7279\u6027/\u4e3b\u4ece\u590d\u5236",title:"\u4e3b\u4ece\u590d\u5236",description:"\u5f15\u5165",source:"@site/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u4e3b\u4ece\u590d\u5236.md",sourceDirName:"Mysql/\u9ad8\u7ea7\u7279\u6027",slug:"/Mysql/\u9ad8\u7ea7\u7279\u6027/\u4e3b\u4ece\u590d\u5236",permalink:"/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u4e3b\u4ece\u590d\u5236",draft:!1,editUrl:"https://github.com/MagicalZhu/NoteLib/tree/main/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u4e3b\u4ece\u590d\u5236.md",tags:[],version:"current",lastUpdatedBy:"YuLiang Zhu",lastUpdatedAt:1670289592,formattedLastUpdatedAt:"2022\u5e7412\u67086\u65e5",frontMatter:{id:"\u4e3b\u4ece\u590d\u5236",title:"\u4e3b\u4ece\u590d\u5236"},sidebar:"mysqlSideBar",previous:{title:"\u5176\u4ed6\u65e5\u5fd7",permalink:"/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u5176\u4ed6\u65e5\u5fd7"},next:{title:"MySQL\u53c2\u6570\u4e0e\u547d\u4ee4",permalink:"/docs/Mysql/MySQL\u53c2\u6570\u4e0e\u547d\u4ee4"}},o={},m=[{value:"\u5f15\u5165",id:"\u5f15\u5165",level:2},{value:"\u4e3b\u4ece\u590d\u5236\u7684\u4f5c\u7528",id:"\u4e3b\u4ece\u590d\u5236\u7684\u4f5c\u7528",level:2},{value:"\u4e3b\u4ece\u6982\u8ff0",id:"\u4e3b\u4ece\u6982\u8ff0",level:2},{value:"\u4e09\u4e2a\u7ebf\u7a0b",id:"\u4e09\u4e2a\u7ebf\u7a0b",level:3},{value:"\u590d\u5236\u4e09\u4e2a\u6b65\u9aa4",id:"\u590d\u5236\u4e09\u4e2a\u6b65\u9aa4",level:3},{value:"\u57fa\u672c\u539f\u5219",id:"\u57fa\u672c\u539f\u5219",level:3},{value:"\u4e00\u4e3b\u591a\u4ece",id:"\u4e00\u4e3b\u591a\u4ece",level:2},{value:"\u642d\u5efa\u6b65\u9aa4",id:"\u642d\u5efa\u6b65\u9aa4",level:3},{value:"1.\u914d\u7f6e master \u7684\u914d\u7f6e\u6587\u4ef6",id:"1\u914d\u7f6e-master-\u7684\u914d\u7f6e\u6587\u4ef6",level:4},{value:"2.\u914d\u7f6e slave \u914d\u7f6e\u6587\u4ef6",id:"2\u914d\u7f6e-slave-\u914d\u7f6e\u6587\u4ef6",level:4},{value:"3.master \u5efa\u7acb\u8d26\u6237\u5e76\u4e14\u6388\u6743",id:"3master-\u5efa\u7acb\u8d26\u6237\u5e76\u4e14\u6388\u6743",level:4},{value:"4. \u67e5\u770b master \u72b6\u6001",id:"4-\u67e5\u770b-master-\u72b6\u6001",level:4},{value:"5. slave \u914d\u7f6e\u8fde\u63a5\u7684 master\u7684\u4fe1\u606f",id:"5-slave-\u914d\u7f6e\u8fde\u63a5\u7684-master\u7684\u4fe1\u606f",level:4},{value:"6. \u6267\u884c\u4e3b\u4ece\u540c\u6b65\u7684\u76f8\u5173\u547d\u4ee4",id:"6-\u6267\u884c\u4e3b\u4ece\u540c\u6b65\u7684\u76f8\u5173\u547d\u4ee4",level:4},{value:"\u642d\u5efa\u793a\u4f8b",id:"\u642d\u5efa\u793a\u4f8b",level:3},{value:"\u540c\u6b65\u6570\u636e\u4e00\u81f4\u6027",id:"\u540c\u6b65\u6570\u636e\u4e00\u81f4\u6027",level:2},{value:"\u4e3b\u4ece\u5ef6\u8fdf\u95ee\u9898",id:"\u4e3b\u4ece\u5ef6\u8fdf\u95ee\u9898",level:3}],p={toc:m};function k(e){let{components:n,...i}=e;return(0,l.kt)("wrapper",(0,t.Z)({},p,i,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u5f15\u5165"},"\u5f15\u5165"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"}," \u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d,\u901a\u5e38\u4f1a\u5f15\u5165",(0,l.kt)("em",{parentName:"p"},"Redis")," \u4f5c\u4e3a\u7f13\u5b58\u4e2d\u95f4\u4ef6\u4e0e MySQL \u4e00\u8d77\u4f7f\u7528,\u5f53\u6709\u8bf7\u6c42\u8fc7\u6765\u7684\u65f6\u5019,\u9996\u5148\u4f1a\u53bb",(0,l.kt)("em",{parentName:"p"},"Redis"),"\u4e2d\u68c0\u67e5\u662f\u5426\u6709\u7f13\u5b58\u6570\u636e"),(0,l.kt)("ul",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u6709\u7684\u8bdd,\u76f4\u63a5\u53d6\u51fa\u4f7f\u7528"),(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u6ca1\u6709\u7684\u8bdd,\u518d\u53bb\u8bbf\u95ee\u6570\u636e\u5e93")),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("img",{alt:"image-20220925170133788",src:a(53119).Z,width:"1096",height:"1092"}))),(0,l.kt)("p",null,"\u4e00\u822c\u5e94\u7528\u5bf9\u6570\u636e\u5e93\u800c\u8a00\u90fd\u662f",(0,l.kt)("strong",{parentName:"p"},"\u8bfb\u591a\u5199\u5c11"),",\u4e5f\u5c31\u8bf4\u5bf9\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\u7684\u538b\u529b\u6bd4\u8f83\u5927, \u90a3\u4e48\u6709\u4e00\u4e2a\u601d\u8def\u5c31\u662f\u91c7\u7528\u6570\u636e\u5e93\u96c6\u7fa4\u7684\u65b9\u6848\uff0c\u505a",(0,l.kt)("inlineCode",{parentName:"p"},"\u4e3b\u4ece\u67b6\u6784"),", \u8fdb\u884c ",(0,l.kt)("inlineCode",{parentName:"p"},"\u8bfb\u5199\u5206\u79bb")," , \u8fd9\u6837\u540c\u6837\u53ef\u4ee5\u63d0\u5347\u6570\u636e\u5e93\u7684\u5e76\u53d1\u5904\u7406\u80fd\u529b\u3002\u4f46\u5e76\u4e0d\u662f\u6240\u6709\u7684\u5e94\u7528\u90fd\u9700\u8981\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e3b\u4ece\u67b6\u6784\u7684\u8bbe\u7f6e\uff0c\u6bd5\u7adf\u8bbe\u7f6e\u67b6\u6784\u672c\u8eab\u662f\u6709\u6210\u672c\u7684\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u6211\u4eec\u7684\u76ee\u7684\u5728\u4e8e\u63d0\u5347\u6570\u636e\u5e93\u9ad8\u5e76\u53d1\u8bbf\u95ee\u7684\u6548\u7387:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u90a3\u4e48\u9996\u5148\u8003\u8651\u7684\u662f\u5982\u4f55 ",(0,l.kt)("inlineCode",{parentName:"li"},"\u4f18\u5316SQL\u548c\u7d22\u5f15"),", \u8fd9\u79cd\u65b9\u5f0f\u7b80\u5355\u6709\u6548"),(0,l.kt)("li",{parentName:"ul"},"\u5176\u6b21\u624d\u662f\u91c7\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"\u7f13\u5b58\u7b56\u7565"),", \u6bd4\u5982\u5c06\u70ed\u70b9\u6570\u636e\u4fdd\u5b58\u5728 Redis \u4e2d,\u63d0\u5347\u8bfb\u53d6\u7684\u6548\u7387,"),(0,l.kt)("li",{parentName:"ul"},"\u6700\u540e\u624d\u662f\u5bf9\u6570\u636e\u5e93\u91c7\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"\u4e3b\u4ece\u67b6\u6784"),",\u8fdb\u884c\u8bfb\u5199\u5206\u79bb")),(0,l.kt)("h2",{id:"\u4e3b\u4ece\u590d\u5236\u7684\u4f5c\u7528"},"\u4e3b\u4ece\u590d\u5236\u7684\u4f5c\u7528"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4e3b\u4ece\u540c\u6b65\u8bbe\u8ba1\u4e0d\u4ec5\u53ef\u4ee5\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u541e\u5410\u91cf"),",\u8fd8\u6709\u4ee5\u4e0b 3 \u4e2a\u65b9\u9762\u7684\u4f5c\u7528:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u8bfb\u5199\u5206\u79bb")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"master \u8d1f\u8d23\u5199\u5165\u6570\u636e,slave \u8d1f\u8d23\u8bfb\u53d6\u6570\u636e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5f53master \u66f4\u65b0\u66f4\u65b0\u540e,\u4f1a\u81ea\u52a8\u7684\u5c06\u6570\u636e\u901a\u8fc7binlog \u65b9\u5f0f\u590d\u5236\u5230slave \u4e2d,\u800c\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019,\u4f1a\u4ece slave \u4e2d\u8fdb\u884c\u8bfb\u53d6")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5728\u8bfb\u591a\u5199\u5c11\u7684\u60c5\u51b5\u4e0b,\u91c7\u7528\u8bfb\u5199\u5206\u79bb\u7684\u65b9\u5f0f\u53ef\u4ee5\u63d0\u9ad8\u5e76\u53d1\u8bbf\u95ee\u6027\u80fd\u3002\u540c\u65f6,\u8fd8\u53ef\u4ee5\u5bf9\u670d\u52a1\u5668\u8fdb\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"\u8d1f\u8f7d\u5747\u8861"),",\u8ba9\u4e0d\u540c\u7684\u8bf7\u6c42\u6309\u7b56\u7565\u5206\u53d1\u5230\u4e0d\u540c\u7684 slave \u670d\u52a1\u5668\u4e0a"))))),(0,l.kt)("p",null,"   ",(0,l.kt)("img",{alt:"image-20220925171005140",src:a(49110).Z,width:"1390",height:"908"})),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u6570\u636e\u5907\u4efd"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u5b9e\u73b0\u9ad8\u53ef\u7528(HA)")))),(0,l.kt)("h2",{id:"\u4e3b\u4ece\u6982\u8ff0"},"\u4e3b\u4ece\u6982\u8ff0"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"slave \u4ece master \u8bfb\u53d6 binlog \u6765\u8fdb\u884c\u6570\u636e\u540c\u6b65")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20220925220316220",src:a(75494).Z,width:"1646",height:"706"})),(0,l.kt)("h3",{id:"\u4e09\u4e2a\u7ebf\u7a0b"},"\u4e09\u4e2a\u7ebf\u7a0b"),(0,l.kt)("p",null,"\u5b9e\u9645\u4e0a\u4e3b\u4ece\u540c\u6b65\u7684\u539f\u7406\u5c31\u662f\u57fa\u4e8e ",(0,l.kt)("em",{parentName:"p"},"binlog")," \u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684\u3002\u5728\u4e3b\u4ece\u590d\u5236\u8fc7\u7a0b\u4e2d, \u4f1a\u57fa\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"3 \u4e2a\u7ebf\u7a0b")," \u6765\u64cd\u4f5c (",(0,l.kt)("strong",{parentName:"p"},"\u4e00\u4e2a\u4e3b\u5e93\u7ebf\u7a0b\uff0c\u4e24\u4e2a\u4ece\u5e93\u7ebf\u7a0b"),")"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u4e8c\u8fdb\u5236\u65e5\u5fd7\u8f6c\u50a8\u7ebf\u7a0b [Binlog dump thread]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u4e3b\u5e93\u7ebf\u7a0b")," "),(0,l.kt)("li",{parentName:"ul"},"\u5f53\u4ece\u5e93\u7ebf\u7a0b\u8fde\u63a5\u7684\u65f6\u5019, \u4e3b\u5e93\u53ef\u4ee5\u5c06 binlog \u53d1\u9001\u7ed9\u4ece\u5e93"),(0,l.kt)("li",{parentName:"ul"},"\u5f53\u4e3b\u5e93\u8bfb\u53d6\u4e8b\u4ef6(Event)\u7684\u65f6\u5019, \u4f1a\u5728 binlog \u4e0a \u52a0\u9501, \u8bfb\u53d6\u5b8c\u6210\u4e4b\u540e\uff0c\u518d\u5c06\u9501\u91ca\u653e\u6389"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"slave\u7684 IO \u7ebf\u7a0b"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f1a\u8fde\u63a5\u5230 master, \u5411 master \u53d1\u9001\u8bf7\u6c42\u66f4\u65b0 binlog\u3002\u8fd9\u65f6 slave \u7684I/O\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u8bfb\u53d6\u5230\u4e3b\u5e93\u7684 ",(0,l.kt)("strong",{parentName:"li"},"\u4e8c\u8fdb\u5236\u65e5\u5fd7\u8f6c\u50a8\u7ebf\u7a0b"),"\u53d1\u9001\u7684 binlog \u66f4\u65b0\u90e8\u5206, ",(0,l.kt)("strong",{parentName:"li"},"\u5e76\u4e14\u62f7\u8d1d\u5230\u672c\u5730\u7684\u4e2d\u7ee7\u65e5\u5fd7 (Relay log)")," "))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"slave\u7684 SQL \u7ebf\u7a0b"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f1a\u8bfb\u53d6slave \u4e2d\u7684\u4e2d\u7ee7\u65e5\u5fd7(relay log), \u5e76\u4e14\u6267\u884c\u65e5\u5fd7\u4e2d\u7684\u4e8b\u4ef6, ",(0,l.kt)("strong",{parentName:"li"},"\u5c06\u4ece\u5e93\u4e2d\u7684\u6570\u636e\u4e0e\u4e3b\u5e93\u4fdd\u6301\u540c\u6b65"))))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20220925222104712",src:a(32446).Z,width:"2002",height:"664"})),(0,l.kt)("admonition",{title:"\u8bf4\u660e",type:"tip"},(0,l.kt)("ol",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ol"},"\u4e0d\u662f\u6240\u6709\u7248\u672c\u7684 MySQL \u90fd\u9ed8\u8ba4\u5f00\u542f binlog,\u5728\u8fdb\u884c\u4e3b\u4ece\u540c\u6b65\u7684\u65f6\u5019,\u9700\u8981\u786e\u8ba4MySQL ",(0,l.kt)("strong",{parentName:"li"},"\u662f\u5426\u5f00\u542f\u7684 binlog \u529f\u80fd")),(0,l.kt)("li",{parentName:"ol"},"\u9664\u975e\u7279\u6b8a\u6307\u5b9a,\u9ed8\u8ba4\u60c5\u51b5\u4e0b slave \u4f1a\u6267\u884c master \u4e2d\u6240\u6709\u4fdd\u5b58\u7684\u6240\u6709\u4e8b\u4ef6\u3002",(0,l.kt)("strong",{parentName:"li"},"\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e,\u8ba9 slave \u6267\u884c\u6307\u5b9a\u7684\u4e8b\u4ef6")))),(0,l.kt)("h3",{id:"\u590d\u5236\u4e09\u4e2a\u6b65\u9aa4"},"\u590d\u5236\u4e09\u4e2a\u6b65\u9aa4"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"master \u5c06\u5199\u64cd\u4f5c\u8bb0\u5f55\u5230 binlog \u6587\u4ef6\u4e2d,\u8fd9\u4e9b\u64cd\u4f5c\u8bb0\u5f55\u6211\u4eec\u79f0\u4e4b\u4e3a ",(0,l.kt)("a",{parentName:"li",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#binlog-%E4%BA%8B%E4%BB%B6"},"binlog \u4e8b\u4ef6(",(0,l.kt)("em",{parentName:"a"},"binlog events"),")")),(0,l.kt)("li",{parentName:"ol"},"slave \u5c06 master \u7684 ",(0,l.kt)("em",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"em"},"binlog events"))," \u62f7\u8d1d\u5230\u5b83\u7684\u4e2d\u7ee7\u65e5\u5fd7 ",(0,l.kt)("inlineCode",{parentName:"li"}," relay log"),"\u4e2d"),(0,l.kt)("li",{parentName:"ol"},"slave \u91cd\u505a\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u7684\u4e8b\u4ef6,\u5c06\u6539\u53d8\u5e94\u7528\u5230\u81ea\u5df1\u7684\u6570\u636e\u5e93\u4e2d\u3002MySQL \u590d\u5236\u662f",(0,l.kt)("strong",{parentName:"li"},"\u5f02\u6b65\u7684\u4e14\u4e32\u884c\u5316")," \u7684\uff0c\u800c\u4e14\u91cd\u542f\u540e\u4ece",(0,l.kt)("inlineCode",{parentName:"li"},"\u63a5\u5165\u70b9")," \u5f00\u59cb\u590d\u5236")),(0,l.kt)("admonition",{title:"\u590d\u5236\u7684\u95ee\u9898",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u4e3b\u4ece\u590d\u5236\u7684\u4e00\u4e2a\u5f88\u96be\u5ffd\u7565\u7684\u95ee\u9898\u5c31\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"\u5ef6\u8fdf")),(0,l.kt)("p",{parentName:"admonition"},"\u5047\u8bbe master \u5c06 binlog \u4f20\u9012\u7ed9 slave \u5e76\u4e14\u6267\u884c\u6570\u636e\u540c\u6b65\u64cd\u4f5cOp1,\u8fd9\u4e2a\u9700\u8981 500ms,\u5728\u6b64\u671f\u95f4\u7528\u6237\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e86\u66f4\u65b0\u64cd\u4f5c,\u8fd9\u4e2a\u64cd\u4f5c\u5e76\u4e0d\u4f1a\u5199\u5165\u5230\u4e0a\u4e00\u6b21Op1 \u7684 binlog \u4e2d,\u4e5f\u5c31\u662f\u6b64\u65f6 slave \u4e2d\u6ca1\u6709\u8be5\u7528\u6237\u7684\u66f4\u65b0\u8bb0\u5f55,\u6b64\u65f6\u7528\u6237\u7acb\u5373\u4ece slave \u4e2d\u67e5\u8be2\u6570\u636e,\u67e5\u8be2\u51fa\u7684\u6570\u636e\u5c31\u548c master \u4e0d\u4e00\u81f4\u4e86")),(0,l.kt)("h3",{id:"\u57fa\u672c\u539f\u5219"},"\u57fa\u672c\u539f\u5219"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6bcf\u4e2a ",(0,l.kt)("em",{parentName:"li"},"Slave")," \u53ea\u6709\u4e00\u4e2a",(0,l.kt)("em",{parentName:"li"},"Master")),(0,l.kt)("li",{parentName:"ol"},"\u6bcf\u4e2a",(0,l.kt)("em",{parentName:"li"},"Slave")," \u53ea\u80fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u670d\u52a1\u5668 ID (\u552f\u4e00\u7684\u8eab\u4efd id)"),(0,l.kt)("li",{parentName:"ol"},"\u6bcf\u4e2a",(0,l.kt)("em",{parentName:"li"},"Master")," \u53ef\u4ee5\u6709\u591a\u4e2a ",(0,l.kt)("em",{parentName:"li"},"Slave"))),(0,l.kt)("h2",{id:"\u4e00\u4e3b\u591a\u4ece"},"\u4e00\u4e3b\u591a\u4ece"),(0,l.kt)("h3",{id:"\u642d\u5efa\u6b65\u9aa4"},"\u642d\u5efa\u6b65\u9aa4"),(0,l.kt)("h4",{id:"1\u914d\u7f6e-master-\u7684\u914d\u7f6e\u6587\u4ef6"},"1.\u914d\u7f6e master \u7684\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("p",null,"\u8fd9\u91cc\u7684\u53ef\u9009\u53c2\u6570",(0,l.kt)("a",{parentName:"p",href:"%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97#%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"},"binlog_format")," \u6709\u4e09\u79cd\u53ef\u9009\u53c2\u6570: ",(0,l.kt)("inlineCode",{parentName:"p"},"STATEMENT\t\u3001ROW\u3001MIXED")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini",metastring:'title="my.cnf"',title:'"my.cnf"'},"[mysqld]\n# \u5fc5\u987b\u7684\n# \u4e3b\u670d\u52a1\u5668\u552f\u4e00ID\nserver-id = 1\n# \u542f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7,\u6307\u540d\u8def\u5f84\u3002\u6bd4\u5982:\u81ea\u5df1\u672c\u5730\u7684\u8def\u5f84/log/mysqlbin \nlog-bin = my_binlog\n\n# \u53ef\u9009\u7684\n\n# 0(\u9ed8\u8ba4)\u8868\u793a\u8bfb\u5199(\u4e3b\u673a)\uff0c1\u8868\u793a\u53ea\u8bfb(\u4ece\u673a) \nread-only=0\n\n# \u8bbe\u7f6e\u65e5\u5fd7\u6587\u4ef6\u4fdd\u7559\u7684\u65f6\u957f\uff0c\u5355\u4f4d\u662f\u79d2 \nbinlog_expire_logs_seconds=6000\n\n# \u63a7\u5236\u5355\u4e2a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5927\u5c0f\u3002\u6b64\u53c2\u6570\u7684\u6700\u5927\u548c\u9ed8\u8ba4\u503c\u662f1GB\nmax_binlog_size=200M\n\n# \u8bbe\u7f6e\u4e0d\u8981\u590d\u5236\u7684\u6570\u636e\u5e93 \nbinlog-ignore-db=test\n\n# \u8bbe\u7f6e\u9700\u8981\u590d\u5236\u7684\u6570\u636e\u5e93,\u9ed8\u8ba4\u5168\u90e8\u8bb0\u5f55\u3002\u6bd4\u5982:binlog-do-db=atguigu_master_slave \nbinlog-do-db=copyDB\n\n# \u8bbe\u7f6ebinlog\u683c\u5f0f \nbinlog_format=STATEMENT\n")),(0,l.kt)("h4",{id:"2\u914d\u7f6e-slave-\u914d\u7f6e\u6587\u4ef6"},"2.\u914d\u7f6e slave \u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ini",metastring:'title="my.cnf"',title:'"my.cnf"'},"[mysqld]\n# \u5fc5\u987b\u7684\n# \u4ece\u670d\u52a1\u5668\u552f\u4e00ID\nserver-id = 2\n\n# \u53ef\u9009\u7684\n# \u4e2d\u7ee7\u65e5\u5fd7\u524d\u7f00\nrelay-log=mysql-relay\n")),(0,l.kt)("h4",{id:"3master-\u5efa\u7acb\u8d26\u6237\u5e76\u4e14\u6388\u6743"},"3.master \u5efa\u7acb\u8d26\u6237\u5e76\u4e14\u6388\u6743"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"# mysql 5.5\u30015.7\n\n# \u5728\u4e3b\u673aMySQL\u91cc\u6267\u884c\u6388\u6743\u4e3b\u4ece\u590d\u5236\u7684\u547d\u4ee4\nGRANT REPLICATION SLAVE ON *.* TO 'slave1'@'\u4ece\u673a\u5668\u6570\u636e\u5e93IP' IDENTIFIED BY 'password';\n\n\n# mysql8\n\n# 1.\u521b\u5efa\u7528\u6237\nCREATE USER 'slave1'@'%' IDENTIFIED BY 'password';\n# 2.\u5206\u914d\u6743\u9650\nGRANT REPLICATION SLAVE ON *.* TO 'slave1'@'%';\n# \u8fd9\u91cc\u5fc5\u987b\u8981\u6267\u884c,\u5426\u5219\u4f1a\u62a5\u9519\nALTER USER 'slave1'@'%' IDENTIFIED WITH mysql_native_password BY 'password';\nflush privileges;\n\n")),(0,l.kt)("h4",{id:"4-\u67e5\u770b-master-\u72b6\u6001"},"4. \u67e5\u770b master \u72b6\u6001"),(0,l.kt)("p",null,"\u8fd9\u91cc,\u6211\u4eec\u4e00\u5b9a\u8981\u67e5\u770b\u72b6\u6001,\u5e76\u4e14\u8bb0\u5f55\u72b6\u6001\u4e2d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"File\u3001Position"),"\u503c,\u5728\u4e0b\u4e00\u6b65\u4e2d\u6709\u7528"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW MASTER STATUS;\n")),(0,l.kt)("h4",{id:"5-slave-\u914d\u7f6e\u8fde\u63a5\u7684-master\u7684\u4fe1\u606f"},"5. slave \u914d\u7f6e\u8fde\u63a5\u7684 master\u7684\u4fe1\u606f"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"MASTER_LOG_FILE\u3001MASTER_LOG_POS \u53c2\u6570\u5c31\u662f\u4e3a\u4e86\u786e\u5b9a",(0,l.kt)("strong",{parentName:"p"},"\u4ece\u54ea\u4e2a\u7684 binlog \u7684\u54ea\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u590d\u5236"),"(binlog \u6570\u636e\u6062\u590d)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CHANGE MASTER TO\nMASTER_HOST='\u4e3b\u673a\u7684IP\u5730\u5740',\nMASTER_USER='\u4e3b\u673a\u7528\u6237\u540d(\u7b2c 3 \u6b65\u4e2d\u521b\u5efa\u7684\u7528\u6237\u540d)',\nMASTER_PASSWORD='\u4e3b\u673a\u7528\u6237\u540d(\u7b2c 3 \u6b65\u4e2d\u521b\u5efa\u7684\u7528\u6237\u5bc6\u7801)',\nMASTER_LOG_FILE='mysql-bin.\u5177\u4f53\u6570\u5b57', # \u7b2c 4 \u6b65\u4e2d\u7684 file \u503c\nMASTER_LOG_POS=\u5177\u4f53\u503c; # \u7b2c 4 \u6b65\u4e2d\u7684 position \u503c\n")),(0,l.kt)("h4",{id:"6-\u6267\u884c\u4e3b\u4ece\u540c\u6b65\u7684\u76f8\u5173\u547d\u4ee4"},"6. \u6267\u884c\u4e3b\u4ece\u540c\u6b65\u7684\u76f8\u5173\u547d\u4ee4"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"# \u542f\u52a8slave\u540c\u6b65\nSTART SLAVE;\n \n# \u505c\u6b62slave\u540c\u6b65\nSTOP SLAVE;\n\n# \u91cd\u7f6eslave\u540c\u6b65, \u5220\u9664 Slave \u6570\u636e\u5e93\u7684relaylog\u65e5\u5fd7\u6587\u4ef6\uff0c\u5e76\u91cd\u65b0\u542f\u7528\u65b0\u7684relaylog\u6587\u4ef6\nRESET SLAVE;\n\n#\u5220\u9664Master\u4e2d\u6240\u6709\u7684binglog\u6587\u4ef6\uff0c\u5e76\u5c06\u65e5\u5fd7\u7d22\u5f15\u6587\u4ef6\u6e05\u7a7a\uff0c\u91cd\u65b0\u5f00\u59cb\u6240\u6709\u65b0\u7684\u65e5\u5fd7\u6587\u4ef6(\u614e\u7528)\nRESET MASTER;\n\n# \u67e5\u770bslave\u72b6\u6001\nSHOW SLAVE STATUS;\n")),(0,l.kt)("h3",{id:"\u642d\u5efa\u793a\u4f8b"},"\u642d\u5efa\u793a\u4f8b"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u4f7f\u7528\u4e00\u4e3b\u4e00\u4ece\u8fdb\u884c\u6f14\u793a,\u4e00\u4e3b\u591a\u4ece\u5c31\u662f\u591a\u4e2a\u4ece\u673a\u914d\u7f6e master \u7684\u8fde\u63a5\u4fe1\u606f\u8fdb\u884c\u540c\u6b65")),(0,l.kt)("admonition",{title:"ONE-ONE \u793a\u4f8b",type:"info"},(0,l.kt)("ol",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fee\u6539\u914d\u7f6e\u4e3b\u673a\u4e0e\u4ece\u673a\u7684\u914d\u7f6e\u6587\u4ef6")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u770b\u6570\u636e\u5e93\u7684\u4fe1\u606f"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> # \u67e5\u770b\u6570\u636e\u5e93\u4fe1\u606f(master)\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| atguigu1           |\n| demo2              |\n| demo3              |\n| indexDemo          |\n| information_schema |\n| mysql              |\n| performance_schema |\n| slaveDB            |\n| sys                |\n| tmp                |\n+--------------------+\n10 rows in set (0.00 sec)\n\nmysql> # \u67e5\u770b\u6570\u636e\u5e93\u4fe1\u606f(slave)\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| atguigu1           |\n| demo2              |\n| demo3              |\n| indexDemo          |\n| information_schema |\n| mysql              |\n| performance_schema |\n| slaveDB            |\n| sys                |\n| tmp                |\n+--------------------+\n10 rows in set (0.00 sec)\n")))),(0,l.kt)("ol",{parentName:"admonition",start:3},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5728\u4e3b\u673a\u4e2d\u521b\u5efa\u4e00\u4e2a\u8d26\u6237\u7528\u4e8e\u4e3b\u4ece\u590d\u5236"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> # \u5728\u4e3b\u673a\u4e2d\u521b\u5efa\u4e00\u4e2a\u7528\u6237\u7528\u4e8e\u4e3b\u4ece\u590d\u5236\nmysql> create user 'slave1'@'%' identified by 'Zyl1994!';\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql> #\u4e3a\u7528\u6237\u5206\u914d replication \u6743\u9650\nmysql> grant replication slave on *.* to 'slave1'@'%';\nQuery OK, 0 rows affected (0.02 sec)\n\n/* highlight-start */\nmysql> # \u8fd9\u4e00\u6b65\u5f88\u91cd\u8981,MySQL8\u4e0b\u4e00\u5b9a\u8981\u6267\u884c\nmysql> ALTER USER 'slave1'@'%' IDENTIFIED WITH mysql_native_password BY 'Zyl1994!';\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> flush privileges;\nQuery OK, 0 rows affected (0.07 sec)\n/* highlight-end */\n\nmysql> # \u67e5\u770b\u4e3b\u673a master \u7684\u72b6\u6001,\u9700\u8981\u8bb0\u5f55\u4e0bFile\u3001Position\u7684\u503c\nmysql> show master status;\n+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| my_binlog.000007 |     2335 |              |                  |                   |\n+------------------+----------+--------------+------------------+-------------------+\n1 row in set (0.00 sec)\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5728\u4ece\u673a\u4e0a\u6307\u5b9a\u4e3b\u673a\u7684\u914d\u7f6e\u4fe1\u606f"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> # \u914d\u7f6e\u4e3b\u673a\u8fde\u63a5\u4fe1\u606f\nmysql> CHANGE MASTER TO\n    -> MASTER_HOST='10.230.1.153',\n    -> MASTER_USER='slave1',\n    -> MASTER_PASSWORD='Zyl1994!',\n    -> MASTER_LOG_FILE='my_binlog.000007',\n    -> MASTER_LOG_POS=2335;\nQuery OK, 0 rows affected, 8 warnings (0.37 sec)\n\nmysql> #\u542f\u52a8 slave\nmysql> start slave;\nQuery OK, 0 rows affected, 1 warning (0.00 sec)\n\nmysql> #\u67e5\u770b\u4ece\u673a\u72b6\u6001\nmysql> show slave status\\G;\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: 10.230.1.153\n                  Master_User: slave1\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: my_binlog.000007\n          Read_Master_Log_Pos: 2335\n               Relay_Log_File: localhost-relay-bin.000002\n                Relay_Log_Pos: 324\n        Relay_Master_Log_File: my_binlog.000007\n/*highlight-start*/        \n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n/*highlight-end*/      \n              Replicate_Do_DB: \n          Replicate_Ignore_DB: \n           Replicate_Do_Table: \n       Replicate_Ignore_Table: \n      Replicate_Wild_Do_Table: \n  Replicate_Wild_Ignore_Table: \n                   Last_Errno: 0\n                   Last_Error: \n                 Skip_Counter: 0\n          Exec_Master_Log_Pos: 2335\n              Relay_Log_Space: 537\n              Until_Condition: None\n               Until_Log_File: \n                Until_Log_Pos: 0\n           Master_SSL_Allowed: No\n           Master_SSL_CA_File: \n           Master_SSL_CA_Path: \n              Master_SSL_Cert: \n            Master_SSL_Cipher: \n               Master_SSL_Key: \n        Seconds_Behind_Master: 0\nMaster_SSL_Verify_Server_Cert: No\n                Last_IO_Errno: 0\n                Last_IO_Error: \n               Last_SQL_Errno: 0\n               Last_SQL_Error: \n  Replicate_Ignore_Server_Ids: \n             Master_Server_Id: 1\n                  Master_UUID: 11bfd5ee-be58-11ec-8468-000c29f93436\n             Master_Info_File: mysql.slave_master_info\n                    SQL_Delay: 0\n          SQL_Remaining_Delay: NULL\n      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates\n           Master_Retry_Count: 86400\n                  Master_Bind: \n      Last_IO_Error_Timestamp: \n     Last_SQL_Error_Timestamp: \n               Master_SSL_Crl: \n           Master_SSL_Crlpath: \n           Retrieved_Gtid_Set: \n            Executed_Gtid_Set: \n                Auto_Position: 0\n         Replicate_Rewrite_DB: \n                 Channel_Name: \n           Master_TLS_Version: \n       Master_public_key_path: \n        Get_master_public_key: 0\n            Network_Namespace: \n1 row in set, 1 warning (0.01 sec)\n\nERROR: \nNo query specified\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5728\u4e3b\u673a\u65b0\u5efa\u4e00\u4e2a\u6570\u636e\u5e93,\u67e5\u770b\u4ece\u673a\u662f\u5426\u540c\u6b65\u8fc7\u53bb"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"# \u4e3b\u673a master\nmysql> create database test_salve1;\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| atguigu1           |\n| demo2              |\n| demo3              |\n| indexDemo          |\n| information_schema |\n| mysql              |\n| performance_schema |\n| slaveDB            |\n| sys                |\n/*highlight-start*/   \n| test_salve1        |\n/*highlight-end*/   \n| tmp                |\n+--------------------+\n11 rows in set (0.00 sec)\n\n# \u4ece\u673a slave\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| atguigu1           |\n| demo2              |\n| demo3              |\n| indexDemo          |\n| information_schema |\n| mysql              |\n| performance_schema |\n| slaveDB            |\n| sys                |\n/*highlight-start*/   \n| test_salve1        |\n/*highlight-end*/   \n| tmp                |\n+--------------------+\n11 rows in set (0.00 sec)\n"))))),(0,l.kt)("h2",{id:"\u540c\u6b65\u6570\u636e\u4e00\u81f4\u6027"},"\u540c\u6b65\u6570\u636e\u4e00\u81f4\u6027"),(0,l.kt)("p",null,"\u4e3b\u4ece\u540c\u6b65\u7684\u8981\u6c42:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u8bfb\u5e93\u548c\u5199\u5e93\u7684\u6570\u636e\u4e00\u81f4(",(0,l.kt)("inlineCode",{parentName:"li"},"\u6700\u7ec8\u4e00\u81f4"),")"),(0,l.kt)("li",{parentName:"ol"},"\u5199\u6570\u636e\u5fc5\u987b\u5199\u5230\u5199\u5e93"),(0,l.kt)("li",{parentName:"ol"},"\u8bfb\u6570\u636e\u5fc5\u987b\u5230\u8bfb\u5e93(",(0,l.kt)("strong",{parentName:"li"},"\u4e0d\u4e00\u5b9a"),") ")),(0,l.kt)("h3",{id:"\u4e3b\u4ece\u5ef6\u8fdf\u95ee\u9898"},"\u4e3b\u4ece\u5ef6\u8fdf\u95ee\u9898"),(0,l.kt)("p",null,"\u8fdb\u884c\u4e3b\u4ece\u540c\u6b65\u7684\u5185\u5bb9\u662f binlog \u6587\u4ef6, \u5728\u8fdb\u884c ",(0,l.kt)("inlineCode",{parentName:"p"},"\u7f51\u7edc\u4f20\u8f93")," \u7684\u8fc7\u7a0b\u4e2d\u5c31\u4e00\u5b9a\u4f1a\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"\u5ef6\u8fdf"),"\u7684\u5b58\u5728 (\u6bd4\u5982 500ms), \u8fd9\u6837\u5c31\u53ef\u80fd\u9020\u6210\u7528\u6237\u5728\u4ece\u5e93\u4e0a\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u662f\u6700\u65b0\u7684\u6570\u636e, \u4e5f\u5c31\u662f",(0,l.kt)("strong",{parentName:"p"},"\u4e3b\u4ece\u540c\u6b65\u4e2d\u7684\u4e0d\u4e00\u81f4\u6027\u95ee\u9898")))}k.isMDXComponent=!0},53119:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/image-20220925170133788-e3cc28ff95959d80323d38ef0fd80780.png"},49110:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/image-20220925171005140-36499f60ffa298b4af5138f5506b56e7.png"},75494:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/image-20220925220316220-341ec93c531ef80f606ca917bc806dd4.png"},32446:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/image-20220925222104712-5f7d0c45c4551287b6d3294d50869347.png"}}]);