"use strict";(self.webpackChunkhuakucha=self.webpackChunkhuakucha||[]).push([[2352],{77058:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>r,default:()=>k,frontMatter:()=>i,metadata:()=>p,toc:()=>o});var a=n(87462),l=(n(67294),n(3905));n(61839);const i={id:"\u57fa\u672c\u5206\u6790\u5de5\u5177",title:"\u57fa\u672c\u5206\u6790\u5de5\u5177"},r=void 0,p={unversionedId:"Mysql/\u9ad8\u7ea7\u7279\u6027/\u57fa\u672c\u5206\u6790\u5de5\u5177",id:"Mysql/\u9ad8\u7ea7\u7279\u6027/\u57fa\u672c\u5206\u6790\u5de5\u5177",title:"\u57fa\u672c\u5206\u6790\u5de5\u5177",description:"\u5728\u6570\u636e\u5e93\u8c03\u4f18\u4e2d,\u6211\u4eec\u7684\u76ee\u6807\u662f\u54cd\u5e94\u65f6\u95f4\u5feb\u3001\u541e\u5410\u91cf\u5927,\u5229\u7528\u76d1\u6d4b\u5de5\u5177\u548c\u65e5\u5fd7\u5206\u6790\u53ef\u4ee5\u5e2e\u6211\u4eec\u5feb\u901f\u7684\u627e\u5230\u8c03\u4f18\u7684\u601d\u8def\u548c\u65b9\u5f0f,\u6bd4\u5982\u6162\u67e5\u8be2\u65e5\u5fd7(slowquerylog)\u3001\u6267\u884c\u8ba1\u5212\u5206\u6790(explain)...",source:"@site/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u6027\u80fd\u5206\u6790\u57fa\u672c\u5de5\u5177.md",sourceDirName:"Mysql/\u9ad8\u7ea7\u7279\u6027",slug:"/Mysql/\u9ad8\u7ea7\u7279\u6027/\u57fa\u672c\u5206\u6790\u5de5\u5177",permalink:"/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u57fa\u672c\u5206\u6790\u5de5\u5177",draft:!1,editUrl:"https://github.com/MagicalZhu/NoteLib/tree/main/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u6027\u80fd\u5206\u6790\u57fa\u672c\u5de5\u5177.md",tags:[],version:"current",lastUpdatedBy:"YuLiang Zhu",lastUpdatedAt:1670289592,formattedLastUpdatedAt:"2022\u5e7412\u67086\u65e5",frontMatter:{id:"\u57fa\u672c\u5206\u6790\u5de5\u5177",title:"\u57fa\u672c\u5206\u6790\u5de5\u5177"},sidebar:"mysqlSideBar",previous:{title:"\u6027\u80fd\u5206\u6790\u5de5\u5177",permalink:"/docs/category/\u6027\u80fd\u5206\u6790\u5de5\u5177"},next:{title:"\u6267\u884c\u8ba1\u5212\u5206\u6790",permalink:"/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/Explain"}},m={},o=[{value:"\u6570\u636e\u5e93\u7684\u4f18\u5316\u6b65\u9aa4",id:"\u6570\u636e\u5e93\u7684\u4f18\u5316\u6b65\u9aa4",level:2},{value:"\u67e5\u770b\u7cfb\u7edf\u6027\u80fd\u53c2\u6570",id:"\u67e5\u770b\u7cfb\u7edf\u6027\u80fd\u53c2\u6570",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:3},{value:"SQL\u67e5\u8be2\u6210\u672c(last_query_cost)",id:"sql\u67e5\u8be2\u6210\u672clast_query_cost",level:3},{value:"\u5c0f\u7ed3\u8bf4\u660e",id:"\u5c0f\u7ed3\u8bf4\u660e",level:3},{value:"\u5b9a\u4f4d\u6162SQL(\u6162\u67e5\u8be2\u65e5\u5fd7)",id:"\u5b9a\u4f4d\u6162sql\u6162\u67e5\u8be2\u65e5\u5fd7",level:2},{value:"\u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u53c2\u6570",id:"\u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u53c2\u6570",level:3},{value:"\u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7(\u4e34\u65f6)",id:"\u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7\u4e34\u65f6",level:3},{value:"\u67e5\u770b\u6162\u67e5\u8be2\u6570\u91cf",id:"\u67e5\u770b\u6162\u67e5\u8be2\u6570\u91cf",level:3},{value:"\u6162\u65e5\u5fd7\u5206\u6790\u5de5\u5177",id:"\u6162\u65e5\u5fd7\u5206\u6790\u5de5\u5177",level:3},{value:"\u5173\u95ed\u6162\u67e5\u8be2\u65e5\u5fd7",id:"\u5173\u95ed\u6162\u67e5\u8be2\u65e5\u5fd7",level:3},{value:"\u91cd\u7f6e\u6162\u67e5\u8be2\u65e5\u5fd7",id:"\u91cd\u7f6e\u6162\u67e5\u8be2\u65e5\u5fd7",level:3},{value:"\u67e5\u770b SQL \u6267\u884c\u6210\u672c",id:"\u67e5\u770b-sql-\u6267\u884c\u6210\u672c",level:2},{value:"\u5f00\u542f profiling",id:"\u5f00\u542f-profiling",level:3},{value:"\u67e5\u770b profiles",id:"\u67e5\u770b-profiles",level:3},{value:"<strong>\u67e5\u770b</strong>profile",id:"\u67e5\u770bprofile",level:3},{value:"\u5c0f\u7ed3\u8bf4\u660e",id:"\u5c0f\u7ed3\u8bf4\u660e-1",level:3}],s={toc:o};function k(e){let{components:t,...i}=e;return(0,l.kt)("wrapper",(0,a.Z)({},s,i,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\u5728\u6570\u636e\u5e93\u8c03\u4f18\u4e2d,\u6211\u4eec\u7684\u76ee\u6807\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"\u54cd\u5e94\u65f6\u95f4\u5feb\u3001\u541e\u5410\u91cf\u5927"),",\u5229\u7528\u76d1\u6d4b\u5de5\u5177\u548c\u65e5\u5fd7\u5206\u6790\u53ef\u4ee5\u5e2e\u6211\u4eec\u5feb\u901f\u7684\u627e\u5230\u8c03\u4f18\u7684\u601d\u8def\u548c\u65b9\u5f0f,\u6bd4\u5982",(0,l.kt)("inlineCode",{parentName:"p"},"\u6162\u67e5\u8be2\u65e5\u5fd7(slow_query_log)\u3001\u6267\u884c\u8ba1\u5212\u5206\u6790(explain)...")),(0,l.kt)("h2",{id:"\u6570\u636e\u5e93\u7684\u4f18\u5316\u6b65\u9aa4"},"\u6570\u636e\u5e93\u7684\u4f18\u5316\u6b65\u9aa4"),(0,l.kt)("p",null,"\u5f53\u6211\u4eec\u9047\u5230\u6570\u636e\u5e93\u8c03\u4f18\u95ee\u9898\u7684\u65f6\u5019\uff0c\u8be5\u5982\u4f55\u601d\u8003\u5462?\u8fd9\u91cc\u628a\u601d\u8003\u7684\u6d41\u7a0b\u6574\u7406\u6210\u4e0b\u9762\u8fd9\u5f20\u56fe"),(0,l.kt)("p",null,"\u6574\u4e2a\u6d41\u7a0b\u5212\u5206\u6210\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"\u89c2\u5bdf(Show status)"),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"\u884c\u52a8(Action)"),"\u4e24\u4e2a\u90e8\u5206\u3002",(0,l.kt)("strong",{parentName:"p"},"\u5b57\u6bcdS\u7684\u90e8\u5206\u4ee3\u8868\u89c2\u5bdf(\u4f1a\u4f7f\u7528\u76f8\u5e94\u7684\u5206\u6790\u5de5\u5177)\uff0c\u5b57\u6bcd A \u4ee3\u8868\u7684\u90e8\u5206\u662f\u884c\u52a8(\u5bf9\u5e94\u5206\u6790\u53ef\u4ee5\u91c7\u53d6\u7684\u884c\u52a8)")),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},(0,l.kt)("img",{alt:"image-20220731105832978",src:n(66166).Z,width:"2264",height:"2166"}))),(0,l.kt)("h2",{id:"\u67e5\u770b\u7cfb\u7edf\u6027\u80fd\u53c2\u6570"},"\u67e5\u770b\u7cfb\u7edf\u6027\u80fd\u53c2\u6570"),(0,l.kt)("h3",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5728 MySQL,\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"SHOW STATUS"),"\u8bed\u53e5\u67e5\u770b\u4e00\u4e9b MySQL \u6570\u636e\u5e93\u670d\u52a1\u5668\u7684",(0,l.kt)("inlineCode",{parentName:"li"},"\u6027\u80fd\u53c2\u6570\u3001\u6267\u884c\u9891\u7387")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8bed\u6cd5\u683c\u5f0f"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"SHOW [GLOBAL | SESSION] STATUS LIKE '\u53c2\u6570'")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528",(0,l.kt)("strong",null,"\u6162\u67e5\u8be2\u6b21\u6570"),"\u53c2\u6570,\u7ed3\u5408\u6162\u67e5\u8be2\u65e5\u5fd7\u627e\u51fa\u6162\u67e5\u8be2\u8bed\u53e5,\u7136\u540e\u9488\u5bf9\u6162\u67e5\u8be2\u8bed\u53e5\u8fdb\u884c",(0,l.kt)("strong",null,"\u8868\u7ed3\u6784\u4f18\u5316"),"\u6216\u8005",(0,l.kt)("strong",null,"\u67e5\u8be2\u8bed\u53e5\u4f18\u5316")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5e38\u7528\u7684\u53c2\u6570\u5217\u8868")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570\u540d"),(0,l.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Connections")),(0,l.kt)("td",{parentName:"tr",align:null},"\u8fde\u63a5MySQL\u670d\u52a1\u5668\u7684\u6b21\u6570")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Uptime")),(0,l.kt)("td",{parentName:"tr",align:null},"MySQL\u670d\u52a1\u5668\u7684\u4e0a\u7ebf\u65f6\u95f4,\u5355\u4f4d",(0,l.kt)("strong",{parentName:"td"},"\u79d2"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Slow_queries")),(0,l.kt)("td",{parentName:"tr",align:null},"\u6162\u67e5\u8be2\u7684\u6b21\u6570")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Innodb_rows_read")),(0,l.kt)("td",{parentName:"tr",align:null},"Select\u67e5\u8be2\u8fd4\u56de\u7684\u884c\u6570")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Innodb_rows_inserted")),(0,l.kt)("td",{parentName:"tr",align:null},"\u6267\u884cINSERT\u64cd\u4f5c\u63d2\u5165\u7684\u884c\u6570")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Innodb_rows_updated")),(0,l.kt)("td",{parentName:"tr",align:null},"\u6267\u884cUPDATE\u64cd\u4f5c\u66f4\u65b0\u7684\u884c\u6570")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Innodb_rows_deleted")),(0,l.kt)("td",{parentName:"tr",align:null},"\u6267\u884cDELETE\u64cd\u4f5c\u5220\u9664\u7684\u884c\u6570")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Com_select")),(0,l.kt)("td",{parentName:"tr",align:null},"\u67e5\u8be2\u64cd\u4f5c\u7684\u6b21\u6570")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Com_insert")),(0,l.kt)("td",{parentName:"tr",align:null},"\u63d2\u5165\u64cd\u4f5c\u7684\u6b21\u6570\u3002",(0,l.kt)("strong",{parentName:"td"},"\u5bf9\u4e8e\u6279\u91cf\u63d2\u5165\u7684 INSERT \u64cd\u4f5c\uff0c\u53ea\u7d2f\u52a0\u4e00\u6b21"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Com_update")),(0,l.kt)("td",{parentName:"tr",align:null},"\u66f4\u65b0\u64cd\u4f5c\u7684\u6b21\u6570")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"Com_delete")),(0,l.kt)("td",{parentName:"tr",align:null},"\u5220\u9664\u64cd\u4f5c\u7684\u6b21\u6570")))),(0,l.kt)("admonition",{title:"\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"1.\u67e5\u770b MySQL \u670d\u52a1\u5668\u8fde\u63a5\u6b21\u6570")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show status like 'Connections';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| Connections   | 11    |\n+---------------+-------+\n")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"2. \u67e5\u770bMySQL \u670d\u52a1\u5668\u4e0a\u7ebf\u65f6\u95f4")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u65f6\u95f4\u7684\u5355\u4f4d\u662f s\nmysql> show status like 'Uptime';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| Uptime        | 11945 |\n+---------------+-------+\n")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"3.\u67e5\u770bCRUD \u7684\u884c\u6570")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show status like 'innodb_rows_%';\n+----------------------+-------+\n| Variable_name        | Value |\n+----------------------+-------+\n| Innodb_rows_deleted  | 0     |\n| Innodb_rows_inserted | 0     |\n| Innodb_rows_read     | 0     |\n| Innodb_rows_updated  | 0     |\n+----------------------+-------+\n\nmysql> select * from course;        \n+-----+-----------+-------------+\n| id  | course_id | course_name |\n+-----+-----------+-------------+\n|   1 |     10073 | jNmVQs      |\n|   2 |     10035 | JuUoLL      |\n|  98 |     10035 | YQkAXl      |\n/*..............................*/\n|  99 |     10022 | zOuFVM      |\n| 100 |     10094 | yDxAkA      |\n+-----+-----------+-------------+\n100 rows in set (0.00 sec)\n\nmysql> show status like 'innodb_rows_%';\n+----------------------+-------+\n| Variable_name        | Value |\n+----------------------+-------+\n| Innodb_rows_deleted  | 0     |\n| Innodb_rows_inserted | 0     |\n| Innodb_rows_read     | 100   |\n| Innodb_rows_updated  | 0     |\n+----------------------+-------+\n4 rows in set (0.00 sec)\n"))),(0,l.kt)("h3",{id:"sql\u67e5\u8be2\u6210\u672clast_query_cost"},"SQL\u67e5\u8be2\u6210\u672c(last_query_cost)"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"}," \u4e00\u6761SQL \u67e5\u8be2\u8bed\u53e5\u5728\u6267\u884c\u524d\u9700\u8981\u786e\u5b9a\u4e00\u4e2a",(0,l.kt)("strong",{parentName:"p"},"\u6267\u884c\u8ba1\u5212"),",\u5982\u679c\u5b58\u5728\u591a\u79cd\u6267\u884c\u8ba1\u5212, \u90a3\u4e48MySQL \u4f1a\u8ba1\u7b97\u6bcf\u4e2a\u6267\u884c\u8ba1\u5212\u6240\u9700\u8981\u7684\u6210\u672c, \u6700\u540e\u4ece\u4e2d\u9009\u62e9",(0,l.kt)("strong",{parentName:"p"},"\u6210\u672c\u6700\u5c0f"),"\u7684\u4e00\u4e2a\u4f5c\u4e3a\u6700\u7ec8\u6267\u884c\u7684\u6267\u884c\u8ba1\u5212")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u60f3\u67e5\u770b\u67d0\u6761 SQL \u8bed\u53e5\u7684\u6267\u884c\u6210\u672c,",(0,l.kt)("strong",{parentName:"p"},"\u53ef\u4ee5\u5728\u6267\u884c\u5b8c\u8fd9\u4e2a SQL \u8bed\u53e5\u4e4b\u540e,\u901a\u8fc7\u67e5\u770b",(0,l.kt)("inlineCode",{parentName:"strong"},"\u5f53\u524d\u4f1a\u8bdd"),"\u4e2d\u7684\u6027\u80fd\u53c2\u6570 ",(0,l.kt)("inlineCode",{parentName:"strong"},"last_query_cost"),"\u7684\u53d8\u91cf\u503c\u6765\u5f97\u5230\u6267\u884c\u6210\u672c "),"\u3002SQL \u67e5\u8be2\u6210\u672c\u901a\u5e38\u4e5f\u662f\u6211\u4eec",(0,l.kt)("strong",{parentName:"p"},"\u8bc4\u4ef7\u4e00\u4e2a\u67e5\u8be2\u7684\u6267\u884c\u6548\u7387\u7684\u5e38\u7528\u6307\u6807"),", \u8fd9\u4e2a\u67e5\u8be2\u6210\u672c\u5bf9\u5e94\u7684\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"SQL \u8bed\u53e5\u6240\u9700\u8981\u8bfb\u53d6\u7684\u9875\u7684\u6570\u91cf"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u5728\u5bf9\u4e8e\u6bd4\u8f83\u5f00\u9500\u662f\u975e\u5e38\u6709\u7528\u7684\uff0c\u7279\u522b\u662f\u6211\u4eec\u6709\u597d\u51e0\u79cd\u67e5\u8be2\u65b9\u5f0f\u53ef\u9009\u7684\u65f6\u5019,\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f")))),(0,l.kt)("admonition",{title:"\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"\u67e5\u8be2student_info \u4e2d\u6307\u5b9a student_id \u7684\u5b66\u751f\u4fe1\u606f,\u89c2\u5bdf\u662f\u5426\u6709\u7d22\u5f15\u7684\u533a\u522b")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6ca1\u6709\u4e3a student_id\u52a0\u4e0a\u7d22\u5f15,\u8017\u65f6 0.24s\nmysql> select * from  student_info where student_id=1234;    \n+--------+------------+--------+-----------+----------+---------------------+\n| id     | student_id | name   | course_id | class_id | create_time         |\n+--------+------------+--------+-----------+----------+---------------------+\n| 505843 |       1234 | OTdMwX |     10025 |    10150 | 2022-07-17 16:35:45 |\n+--------+------------+--------+-----------+----------+---------------------+\n1 row in set (0.24 sec)\n\n-- \u8fd9\u91cc\u52a0\u8f7d\u4e86 100489 \u4e2a\u6570\u636e\u9875\nmysql> show status like 'last_query_cost';\n+-----------------+---------------+\n| Variable_name   | Value         |\n+-----------------+---------------+\n| Last_query_cost | 100488.649000 |\n+-----------------+---------------+\n1 row in set (0.00 sec)\n\n-- \u4e3a student_id\u52a0\u4e0a\u7d22\u5f15\nmysql> create index idx_sid on student_info (student_id);\nQuery OK, 0 rows affected (2.71 sec)\nRecords: 0  Duplicates: 0  Warnings: 0\n\nmysql> select * from  student_info where student_id=1234;\n+--------+------------+--------+-----------+----------+---------------------+\n| id     | student_id | name   | course_id | class_id | create_time         |\n+--------+------------+--------+-----------+----------+---------------------+\n| 505843 |       1234 | OTdMwX |     10025 |    10150 | 2022-07-17 16:35:45 |\n+--------+------------+--------+-----------+----------+---------------------+\n1 row in set (0.00 sec)\n\n-- \u8fd9\u91cc\u52a0\u8f7d\u4e86 1 \u4e2a\u6570\u636e\u9875\nmysql> show status like 'last_query_cost';\n+-----------------+----------+\n| Variable_name   | Value    |\n+-----------------+----------+\n| Last_query_cost | 0.349000 |\n+-----------------+----------+\n1 row in set (0.00 sec)\n")),(0,l.kt)("mark",null,"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u52a0\u4e0a\u7d22\u5f15\u540e,SQL \u67e5\u8be2\u6210\u672c\u5f88\u4f4e,\u76f8\u5dee\u4e86\u6570\u5341\u4e07\u4e2a\u6570\u91cf\u7ea7\u3002\u4f46\u662f\u5728\u67e5\u8be2\u65f6\u95f4\u4e0a\u5e76\u6ca1\u6709\u8fd9\u4e2a\u6570\u91cf\u7ea7\u7684\u4f53\u73b0"),(0,l.kt)("p",{parentName:"admonition"},"\u5b9e\u9645\u4e0a\u8fd9\u4e24\u4e2a ",(0,l.kt)("strong",{parentName:"p"},"SQL \u67e5\u8be2\u7684\u65f6\u95f4\u57fa\u672c\u4e0a\u76f8\u5dee\u76f8\u5bf9\u4e0d\u5927"),"\uff0c \u5c31\u662f\u56e0\u4e3a\u91c7\u7528\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"\u987a\u5e8f\u8bfb\u53d6"),"\u7684\u65b9\u5f0f\u5c06\u9875\u9762\u4e00\u6b21\u6027\u52a0\u8f7d\u5230\u7f13\u51b2\u6c60\u4e2d\uff0c\u7136\u540e\u518d\u8fdb\u884c\u67e5\u627e\u3002\u867d\u7136 ",(0,l.kt)("inlineCode",{parentName:"p"},"last_query_cost\u589e\u52a0\u4e86\u4e0d\u5c11 "),"\uff0c\u4f46\u662f\u901a\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"\u7f13\u51b2\u6c60"),"\u7684\u673a\u5236\uff0c\u5e76 ",(0,l.kt)("strong",{parentName:"p"},"\u6ca1\u6709\u589e\u52a0\u591a\u5c11\u67e5\u8be2\u65f6\u95f4")," ")),(0,l.kt)("h3",{id:"\u5c0f\u7ed3\u8bf4\u660e"},"\u5c0f\u7ed3\u8bf4\u660e"),(0,l.kt)("p",null,"SQL \u67e5\u8be2\u662f\u4e00\u4e2a\u52a8\u6001\u7684\u8fc7\u7a0b,\u4ece\u9875\u52a0\u8f7d\u7684\u89d2\u5ea6\u4e0a\u8bf4,\u53ef\u4ee5\u6709\u4e24\u70b9\u7ed3\u8bba:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u4f4d\u7f6e\u51b3\u5b9a\u6548\u7387"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u9875\u5c31\u5728\u6570\u636e\u5e93",(0,l.kt)("inlineCode",{parentName:"li"},"\u7f13\u51b2\u6c60"),",\u90a3\u4e48\u6548\u7387\u662f\u6700\u597d\u7684,\u5426\u5219\u8fd8\u9700\u8981\u4ece",(0,l.kt)("inlineCode",{parentName:"li"},"\u5185\u5b58"),"\u6216\u8005",(0,l.kt)("inlineCode",{parentName:"li"},"\u78c1\u76d8"),"\u4e2d\u8fdb\u884c\u8bfb\u53d6"),(0,l.kt)("li",{parentName:"ul"},"\u5f53\u7136\u4e86,\u5bf9\u4e8e\u5355\u4e2a\u9875\u6765\u8bf4,\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u80af\u5b9a\u6bd4\u4ece\u78c1\u76d8\u8bfb\u53d6\u6548\u7387\u9ad8\u5f97\u591a"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\u6279\u91cf\u51b3\u5b9a\u6548\u7387"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u6211\u4eec\u4ece\u78c1\u76d8\u4e2d\u5bf9\u5355\u4e00\u9875\u8fdb\u884c\u968f\u673a\u8bfb\u53d6,\u90a3\u4e48\u6548\u7387\u662f\u5f88\u4f4e\u7684,\u5dee\u4e0d\u591a 10ms\u3002\u800c\u91c7\u7528\u987a\u5e8f\u8bfb\u53d6\u7684\u65b9\u5f0f,\u6279\u91cf\u5bf9\u9875\u8fdb\u884c\u8bfb\u53d6,\u5e73\u5747\u6bcf\u9875\u7684\u8bfb\u53d6\u6548\u7387\u4f1a\u63d0\u5347\u5f88\u591a,\u751a\u81f3\u8981\u5feb\u4e8e\u5355\u4e2a\u9875\u9762\u5728\u5185\u5b58\u4e2d\u7684\u968f\u673a\u8bfb\u53d6")))),(0,l.kt)("p",null,"\u6240\u4ee5\u8bf4,\u9047\u5230 IO \u4e0d\u7528\u62c5\u5fc3,\u5982\u679c\u65b9\u6cd5\u5bf9\u7684\u8bdd,\u6548\u7387\u4e5f\u662f\u5f88\u9ad8\u7684\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6211\u4eec\u9996\u5148\u9700\u8981\u8003\u8651\u6570\u636e\u5b58\u653e\u7684\u4f4d\u7f6e,\u5982\u679c\u662f\u7ecf\u5e38\u4f7f\u7528\u7684\u6570\u636e\u5c31\u8981\u5c3d\u91cf\u653e\u5728"),(0,l.kt)("inlineCode",{parentName:"p"},"\u7f13\u51b2\u6c60"),(0,l.kt)("strong",{parentName:"p"},"\u4e2d,\u7136\u540e\u53ef\u4ee5\u5145\u5206\u5229\u7528\u78c1\u76d8\u7684\u541e\u5410\u80fd\u529b,\u4e00\u6b21\u6027\u6279\u91cf\u8bfb\u53d6\u6570\u636e,\u8fd9\u6837\u5355\u4e2a\u9875\u7684\u8bfb\u53d6\u6548\u7387\u5c31\u5f97\u5230\u4e86\u63d0\u5347")),(0,l.kt)("h2",{id:"\u5b9a\u4f4d\u6162sql\u6162\u67e5\u8be2\u65e5\u5fd7"},"\u5b9a\u4f4d\u6162SQL(\u6162\u67e5\u8be2\u65e5\u5fd7)"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"MySQL \u7684\u6162\u67e5\u8be2\u65e5\u5fd7,\u7528\u4e8e\u8bb0\u5f55 MySQL \u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"\u54cd\u5e94\u65f6\u95f4\u8d85\u8fc7\u9608\u503c"),"\u7684\u8bed\u53e5,\u5177\u4f53\u6307\u8fd0\u884c\u65f6\u95f4\u8d85\u8fc7",(0,l.kt)("inlineCode",{parentName:"p"},"long_query_time"),"\u503c\u7684 SQL,\u5c31\u4f1a\u88ab\u8bb0\u5f55\u5230\u6162\u67e5\u8be2\u65e5\u5fd7\u4e2d\u3002"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"long_query_time")," \u7684\u9ed8\u8ba4\u503c\u662f",(0,l.kt)("inlineCode",{parentName:"li"},"10"),",\u610f\u601d\u662f\u6267\u884c 10s\u4ee5\u4e0a\u7684\u8bed\u53e5,\u5c31\u662f\u4e00\u4e2a\u6162 SQL"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6162\u67e5\u8be2\u65e5\u5fd7\u4e3b\u8981\u4f5c\u7528\u662f,\u5e2e\u52a9\u53d1\u73b0\u90a3\u4e9b\u6267\u884c\u65f6\u95f4\u7279\u522b\u957f\u7684 SQL \u67e5\u8be2,\u5e76\u4e14\u9488\u5bf9\u8fd9\u4e9b SQL \u8bed\u53e5\u8fdb\u884c\u4f18\u5316\u3002\u5f53\u6211\u4eec\u7684\u6570\u636e\u5e93\u53d1\u751f\u963b\u585e\u3001\u8fd0\u884c\u53d8\u6162\u7684\u65f6\u5019,\u53ef\u4ee5\u68c0\u67e5\u4e00\u4e9b\u6162\u67e5\u8be2\u65e5\u5fd7,\u627e\u51fa\u90a3\u4e9b\u6162\u67e5\u8be2")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u9ed8\u8ba4\u60c5\u51b5\u4e0b,MySQL \u6570\u636e\u5e93",(0,l.kt)("inlineCode",{parentName:"strong"},"\u6ca1\u6709\u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7"),",\u9700\u8981\u624b\u52a8\u7684\u8bbe\u7f6e\u8fd9\u4e2a\u53c2\u6570"),",",(0,l.kt)("inlineCode",{parentName:"p"},"\u5982\u679c\u4e0d\u662f\u8c03\u4f18\u9700\u8981\u7684\u8bdd,\u4e00\u822c\u4e0d\u5efa\u8bae\u542f\u52a8\u8fd9\u4e2a\u53c2\u6570"),",\u56e0\u4e3a\u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7\u672c\u8eab\u4f1a\u6709\u4e00\u4e9b\u6027\u80fd\u7684\u5f71\u54cd")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u6162\u67e5\u8be2\u652f\u6301\u5c06\u65e5\u5fd7\u8bb0\u5f55\u5199\u5165\u5230\u6587\u4ef6\u4e2d"))),(0,l.kt)("admonition",{title:"\u8865\u5145",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u5b9e\u9645\u4e0a,",(0,l.kt)("strong",{parentName:"p"},"\u63a7\u5236\u6162\u67e5\u8be2\u65e5\u5fd7\u7684\u8fd8\u6709\u4e00\u4e2a\u7cfb\u7edf\u53d8\u91cf:"),(0,l.kt)("inlineCode",{parentName:"p"},"min_examined_row_limit"),", \u8fd9\u4e2a\u53d8\u91cf\u7684\u610f\u601d\u662f,\u67e5\u8be2",(0,l.kt)("inlineCode",{parentName:"p"},"\u626b\u63cf\u8fc7\u7684\u6700\u5c11\u8bb0\u5f55\u6570")),(0,l.kt)("p",{parentName:"admonition"},"\u8fd9\u4e2a\u53d8\u91cf\u548c\u67e5\u8be2\u65f6\u95f4(long_query_time),\u5171\u540c\u7ec4\u6210\u4e86\u5224\u65ad\u4e00\u4e2a\u67e5\u8be2\u662f\u5426\u662f\u6162\u67e5\u8be2\u7684\u6761\u4ef6,\u5373",(0,l.kt)("strong",{parentName:"p"},"\u67e5\u8be2\u626b\u63cf\u7684\u8bb0\u5f55\u6570\u5927\u4e8e\u7b49\u4e8emin_examined_row_limit,\u4e14\u67e5\u8be2\u6267\u884c\u65f6\u95f4\u8d85\u8fc7 long_query_time \u7684 SQL \u67e5\u8be2\u5c31\u662f\u6162\u67e5\u8be2")),(0,l.kt)("mark",null,"min_examined_row_limit \u7684\u9ed8\u8ba4\u503c\u662f 0")," ",(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show variables like '%min_examined_row_limit%';   \n+------------------------+-------+\n| Variable_name          | Value |\n+------------------------+-------+\n| min_examined_row_limit | 0     |\n+------------------------+-------+\n1 row in set (0.00 sec)\n"))),(0,l.kt)("h3",{id:"\u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u53c2\u6570"},"\u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u53c2\u6570"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u67e5\u770bslow_query_log \u53c2\u6570")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u67e5\u770b slow_query_log \u53c2\u6570\nshow variables like '%slow_query_log%'\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u67e5\u770b long_query_time \u53c2\u6570")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u67e5\u770b long_query_time \u53c2\u6570\u503c\nshow variables like '%long_query_time%'\n")))),(0,l.kt)("admonition",{title:"\u6f14\u793a\u793a\u4f8b",type:"info"},(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> show variables like '%long_query_time%';\n+-----------------+-----------+\n| Variable_name   | Value     |\n+-----------------+-----------+\n| long_query_time | 10.000000 |\n+-----------------+-----------+\n1 row in set (0.00 sec)\n\nmysql> show variables like '%long_query_log%';\nEmpty set (0.00 sec)\n\nmysql> show variables like '%slow_query_log%';    \n+---------------------+-----------------------------------+\n| Variable_name       | Value                             |\n+---------------------+-----------------------------------+\n| slow_query_log      | OFF                               |\n| slow_query_log_file | /var/lib/mysql/localhost-slow.log |\n+---------------------+-----------------------------------+\n2 rows in set (0.00 sec)\n"))),(0,l.kt)("h3",{id:"\u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7\u4e34\u65f6"},"\u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7(\u4e34\u65f6)"),(0,l.kt)("p",null,"\u5206\u4e3a\u4ee5\u4e0b\u4e24\u4e2a\u6b65\u9aa4:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u5f00\u542f slow_query_log \u53c2\u6570")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SET GLOBAL slow_query_log='ON';\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u4fee\u6539 long_query_time \u9608\u503c")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u8bbe\u7f6e long_query_time \u503c,\u8fd9\u91cc\u8bbe\u7f6e\u4e3a 1s\nSET long_query_time=1;\n")))),(0,l.kt)("h3",{id:"\u67e5\u770b\u6162\u67e5\u8be2\u6570\u91cf"},"\u67e5\u770b\u6162\u67e5\u8be2\u6570\u91cf"),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u67e5\u8be2\u5f53\u524d\u7cfb\u7edf\u4e2d\u6709\u591a\u5c11\u6761\u6ee1\u67e5\u8be2\u8bb0\u5f55"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW STATUS LIKE '%slow_queries%';\n")),(0,l.kt)("admonition",{title:"\u6f14\u793a\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"1.\u51c6\u5907\u6570\u636e")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u51c6\u5907\u7684\u8868\nCREATE TABLE `student` (\n  `id` INT(11) NOT NULL AUTO_INCREMENT, `stuno` INT NOT NULL ,\n  `name` VARCHAR(20) DEFAULT NULL,\n  `age` INT(3) DEFAULT NULL,\n  `classId` INT(11) DEFAULT NULL, PRIMARY KEY (`id`)\n) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;\n\n\n-- \u51c6\u5907\u7684\u5b58\u50a8\u8fc7\u7a0b,\u5176\u4ed6\u4e24\u4e2a\u5b58\u50a8\u8fc7\u7a0b\u518d\u524d\u4e00\u7ae0\u8282\nCREATE PROCEDURE insert_stu1( START INT , max_num INT ) \nBEGIN\n    DECLARE i INT DEFAULT 0;\n    SET autocommit = 0; #\u8bbe\u7f6e\u624b\u52a8\u63d0\u4ea4\u4e8b\u52a1\n    REPEAT #\u5faa\u73af\n    SET i=i+1; #\u8d4b\u503c\n    INSERT INTO student (stuno, NAME ,age ,classId ) VALUES\n    ((START+i),rand_string(6),rand_num(10,100),rand_num(10,1000)); \n    UNTIL i = max_num\n    END REPEAT;\n    COMMIT; #\u63d0\u4ea4\u4e8b\u52a1\nEND\n\n-- \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b\nCALL insert_stu1(100001,4000000)\n")),(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"2.\u6267\u884c\u4e00\u6bb5\u8017\u65f6\u957f\u7684 SQL,\u5e76\u67e5\u770b\u662f\u5426\u88ab\u6162\u67e5\u8be2\u8bb0\u5f55")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6267\u884c SQL \u8bed\u53e5\u4e4b\u524d\u770b\u5230\u6ca1\u6709\u6162\u67e5\u8be2\u8bb0\u5f55\nmysql> show status like '%slow_queries%';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| Slow_queries  | 0     |\n+---------------+-------+\n1 row in set (0.00 sec)\n\n\n-- \u6267\u884c\u4e00\u6bb5\u8017\u65f6\u957f\u7684 SQL \u8bed\u53e5\nmysql> SELECT * FROM student WHERE stuno = 3455655;\n+---------+---------+--------+------+---------+\n| id      | stuno   | name   | age  | classId |\n+---------+---------+--------+------+---------+\n| 5503915 | 3455655 | bHfJQl |   69 |     584 |\n+---------+---------+--------+------+---------+\n1 row in set (1.00 sec)\n\n-- \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\u8bb0\u5f55\u4e86\u4e00\u6761\u6162\u67e5\u8be2\nmysql> show status like '%slow_queries%';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| Slow_queries  | 1     |\n+---------------+-------+\n1 row in set (0.00 sec)\n\n"))),(0,l.kt)("h3",{id:"\u6162\u65e5\u5fd7\u5206\u6790\u5de5\u5177"},"\u6162\u65e5\u5fd7\u5206\u6790\u5de5\u5177"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5982\u679c\u8981\u624b\u5de5\u5206\u6790\u65e5\u5fd7\uff0c\u67e5\u627e\u3001\u5206\u6790SQL\uff0c\u663e\u7136\u662f\u4e2a\u4f53\u529b\u6d3b\uff0cMySQL\u63d0\u4f9b\u4e86\u65e5\u5fd7\u5206\u6790\u5de5\u5177",(0,l.kt)("inlineCode",{parentName:"p"},"mysqldumpslow"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"mysqldumpslow [ OPTS... ] [ LOGS... ]")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"OPT \u53ef\u9009\u53c2\u6570",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-a"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u4e0d\u5c06\u6570\u5b57\u62bd\u8c61\u6210N\uff0c\u5b57\u7b26\u4e32\u62bd\u8c61\u6210S")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-s"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8868\u793a\u6309\u7167\u4f55\u79cd\u65b9\u5f0f\u6392\u5e8f"),",\u6709\u4ee5\u4e0b\u53ef\u9009\u503c",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"c"),": \u8bbf\u95ee\u6b21\u6570 "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"l"),": \u9501\u5b9a\u65f6\u95f4 "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"r"),": \u8fd4\u56de\u8bb0\u5f55 "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"t"),": \u67e5\u8be2\u65f6\u95f4 "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"al"),":\u5e73\u5747\u9501\u5b9a\u65f6\u95f4  "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"ar"),":\u5e73\u5747\u8fd4\u56de\u8bb0\u5f55\u6570  "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"at"),":\u5e73\u5747\u67e5\u8be2\u65f6\u95f4 (\u9ed8\u8ba4\u65b9\u5f0f)  "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"ac"),":\u5e73\u5747\u67e5\u8be2\u6b21\u6570"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-t"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8fd4\u56de\u524d\u9762\u591a\u5c11\u6761\u7684\u6570\u636e")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-g"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u540e\u8fb9\u642d\u914d\u4e00\u4e2a\u6b63\u5219\u5339\u914d\u6a21\u5f0f\uff0c\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u7684")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u8fd9\u91cc\u65e5\u5fd7\u8def\u5f84\u53ef\u4ee5\u901a\u8fc7 \u53c2\u6570 slow_query_log_file \u770b\u5230")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u5de5\u4f5c\u5e38\u7528\u53c2\u8003")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},'#\u5f97\u5230\u8fd4\u56de\u8bb0\u5f55\u96c6\u6700\u591a\u768410\u4e2aSQL\nmysqldumpslow -s r -t 10 logPath\n\n#\u5f97\u5230\u8bbf\u95ee\u6b21\u6570\u6700\u591a\u768410\u4e2aSQL\nmysqldumpslow -s c -t 10 logPath\n\n#\u5f97\u5230\u6309\u7167\u65f6\u95f4\u6392\u5e8f\u7684\u524d10\u6761\u91cc\u9762\u542b\u6709\u5de6\u8fde\u63a5\u7684\u67e5\u8be2\u8bed\u53e5\nmysqldumpslow -s t -t 10 -g "left join"logPath\n\n#\u53e6\u5916\u5efa\u8bae\u5728\u4f7f\u7528\u8fd9\u4e9b\u547d\u4ee4\u65f6\u7ed3\u5408 | \u548cmore \u4f7f\u7528 \uff0c\u5426\u5219\u6709\u53ef\u80fd\u51fa\u73b0\u7206\u5c4f\u60c5\u51b5 \nmysqldumpslow -s r -t 10 logPath | more\n')))),(0,l.kt)("admonition",{title:"\u793a\u4f8b",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220731144045768",src:n(23209).Z,width:"2502",height:"666"}))),(0,l.kt)("h3",{id:"\u5173\u95ed\u6162\u67e5\u8be2\u65e5\u5fd7"},"\u5173\u95ed\u6162\u67e5\u8be2\u65e5\u5fd7"),(0,l.kt)("p",null,"\u5173\u95ed MySQL \u670d\u52a1\u5668\u7684\u6162\u67e5\u8be2\u65e5\u5fd7\u529f\u80fd\u6709\u4e24\u79cd\u65b9\u6cd5:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u4fee\u6539 MySQL\u914d\u7f6e\u6587\u4ef6(\u6c38\u4e45\u7684)")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-ini"},"[mysqld]\n# slow_query_log=OFF\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u8bed\u53e5\u4fee\u6539(\u4e34\u65f6\u7684)")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SET GLOBAL slow_query_log=off;\n")))),(0,l.kt)("h3",{id:"\u91cd\u7f6e\u6162\u67e5\u8be2\u65e5\u5fd7"},"\u91cd\u7f6e\u6162\u67e5\u8be2\u65e5\u5fd7"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u8bed\u6cd5\u683c\u5f0f",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mysqladmin -uroot -p flush-logs slow"))))),(0,l.kt)("h2",{id:"\u67e5\u770b-sql-\u6267\u884c\u6210\u672c"},"\u67e5\u770b SQL \u6267\u884c\u6210\u672c"),(0,l.kt)("h3",{id:"\u5f00\u542f-profiling"},"\u5f00\u542f profiling"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u786e\u8ba4",(0,l.kt)("inlineCode",{parentName:"p"},"profiling")," \u662f\u5426\u5f00\u542f, ",(0,l.kt)("strong",{parentName:"p"},"profiling = 0 | OFF"),"  \u8868\u793a\u5173\u95ed"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select @@profiling;\nshow variables like 'profiling';\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5f00\u542f ",(0,l.kt)("inlineCode",{parentName:"p"},"profiling")," "),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"# \u5f00\u542f Session \u7ea7\u522b\u7684 profiling\nset  profiling = 1\n")))),(0,l.kt)("h3",{id:"\u67e5\u770b-profiles"},"\u67e5\u770b profiles"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u67e5\u770b\u5f53\u524d\u4f1a\u8bdd\u4ea7\u751f\u7684\u6240\u6709 profiles")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u57fa\u672c\u8bed\u6cd5"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"show profiles;\n")),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{alt:"image-20220731150806898",src:n(11993).Z,width:"1634",height:"378"})))),(0,l.kt)("h3",{id:"\u67e5\u770bprofile"},(0,l.kt)("strong",{parentName:"h3"},"\u67e5\u770b"),"profile"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u57fa\u672c\u8bed\u6cd5"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"show profile [type [, type] ... ]\n[FOR QUERY query_id]      \n[LIMIT row_count [OFFSET offset]]\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u547d\u4ee4\u53c2\u6570\u8bf4\u660e"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"type"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ALL"),"  : \u663e\u793a\u6240\u6709\u7684\u5f00\u9500\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"BLOCK IO ")," : \u663e\u793a\u5757IO\u76f8\u5173\u5f00\u9500"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CONTEXT SWITCHES")," : \u4e0a\u4e0b\u6587\u5207\u6362\u76f8\u5173\u5f00\u9500"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CPU")," : \u663e\u793aCPU\u76f8\u5173\u5f00\u9500\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"IPC")," : \u663e\u793a\u53d1\u9001\u548c\u63a5\u6536\u76f8\u5173\u5f00\u9500\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"MEMORY")," \uff1a \u663e\u793a\u5185\u5b58\u76f8\u5173\u5f00\u9500\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PAGE FAULTS ")," : \u663e\u793a\u9875\u9762\u9519\u8bef\u76f8\u5173\u5f00\u9500\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"SOURCE")," : \u663e\u793a\u548cSource_function\uff0cSource_file\uff0cSource_line\u76f8\u5173\u7684\u5f00\u9500\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"SWAPS")," : \u663e\u793a\u4ea4\u6362\u6b21\u6570\u76f8\u5173\u5f00\u9500\u7684\u4fe1\u606f"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"query_id"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u4e0d\u6307\u5b9a\uff0c\u53ea\u662f\u663e\u793a\u6700\u8fd1\u6267\u884c\u7684\u8bed\u53e5\uff0c\u5982\u679c\u6307\u5b9a\u4f1a\u663e\u793a\u8bed\u53e5\u7684 profile"),(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"show profiles;")," \u5f97\u5230 query_id")))),(0,l.kt)("admonition",{parentName:"li",title:"\u4f7f\u7528 show profile",type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("img",{alt:"image-20220731150728543",src:n(76703).Z,width:"1090",height:"1078"}))))),(0,l.kt)("h3",{id:"\u5c0f\u7ed3\u8bf4\u660e-1"},"\u5c0f\u7ed3\u8bf4\u660e"),(0,l.kt)("p",null,"\u65e5\u5e38\u5f00\u53d1\u9700\u8981\u6ce8\u610f:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"converting HEAP ti MyISAM"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7ed3\u679c\u5185\u5b58\u592a\u5927,\u5185\u5b58\u4e0d\u591f,\u6570\u636e\u5411\u78c1\u76d8\u4e0a\u642c"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"creating tmp table"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4e34\u65f6\u8868,\u5148\u62f7\u8d1d\u6570\u636e\u5230\u4e34\u65f6\u8868,\u7528\u5b8c\u518d\u5220\u9664\u4e34\u65f6\u8868"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"copying to tmp table on disk"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u628a\u5185\u5b58\u4e2d\u4e34\u65f6\u8868\u590d\u5236\u5230\u78c1\u76d8\u4e0a\u270b"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"locked"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5982\u679c\u5728 show_profile\u8bca\u65ad\u7ed3\u679c\u4e2d\u51fa\u73b0\u4e86\u4e0a\u8ff0 4 \u6761\u4e2d\u7684\u4efb\u610f\u4e00\u6761,\u5219 sql \u9700\u8981\u4f18\u5316")),(0,l.kt)("admonition",{title:"\u6ce8\u610f",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"SHOW PROFILE \u547d\u4ee4\u5c06\u88ab\u5f03\u7528,\u53ef\u4ee5\u4ece ",(0,l.kt)("inlineCode",{parentName:"p"},"information_schema")," \u4e2d\u7684 profiling \u6570\u636e\u8868\u4e2d\u8fdb\u884c\u67e5\u770b")))}k.isMDXComponent=!0},66166:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20220731105832978-a85f99dc0bf8344b100c208eb92af269.png"},23209:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20220731144045768-71346687fc37ab921172efd7618fc0f0.png"},76703:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20220731150728543-d86a3dad2dcc692feac36af3f42c1bba.png"},11993:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20220731150806898-b63f78223e19cb34933af58e83a8216c.png"}}]);