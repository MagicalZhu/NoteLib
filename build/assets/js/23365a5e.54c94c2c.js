"use strict";(self.webpackChunkhuakucha=self.webpackChunkhuakucha||[]).push([[6277],{33967:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>p,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));n(61839);const l={id:"Bus",title:"\u6d88\u606f\u603b\u7ebf-Bus"},i=void 0,p={unversionedId:"SpringCloud/Netflix/Bus",id:"SpringCloud/Netflix/Bus",title:"\u6d88\u606f\u603b\u7ebf-Bus",description:"1. SpringCloud Bus\u6d88\u606f\u603b\u7ebf",source:"@site/docs/SpringCloud/Netflix/1.7\u6d88\u606f\u603b\u7ebf-Bus.md",sourceDirName:"SpringCloud/Netflix",slug:"/SpringCloud/Netflix/Bus",permalink:"/docs/SpringCloud/Netflix/Bus",draft:!1,editUrl:"https://github.com/MagicalZhu/NoteLib/tree/main/docs/SpringCloud/Netflix/1.7\u6d88\u606f\u603b\u7ebf-Bus.md",tags:[],version:"current",lastUpdatedBy:"YuLiang Zhu",lastUpdatedAt:1670289592,formattedLastUpdatedAt:"2022\u5e7412\u67086\u65e5",frontMatter:{id:"Bus",title:"\u6d88\u606f\u603b\u7ebf-Bus"},sidebar:"springCloudSideBar",previous:{title:"\u670d\u52a1\u914d\u7f6e\u4e2d\u5fc3-Config",permalink:"/docs/SpringCloud/Netflix/Config"},next:{title:"\u6d88\u606f\u9a71\u52a8-Stream",permalink:"/docs/SpringCloud/Netflix/Stream"}},o={},s=[{value:"1. SpringCloud Bus\u6d88\u606f\u603b\u7ebf",id:"1-springcloud-bus\u6d88\u606f\u603b\u7ebf",level:2},{value:"1.1 \u6d88\u606f\u603b\u7ebf\u6982\u8ff0",id:"11-\u6d88\u606f\u603b\u7ebf\u6982\u8ff0",level:3},{value:"1.2 \u52a8\u6001\u5237\u65b0\u5168\u5c40\u5e7f\u64ad",id:"12-\u52a8\u6001\u5237\u65b0\u5168\u5c40\u5e7f\u64ad",level:3},{value:"1.2.1 \u8bbe\u8ba1\u601d\u8def",id:"121-\u8bbe\u8ba1\u601d\u8def",level:4},{value:"1.2.1.1 <strong>\u601d\u8def1 \u7684\u67b6\u6784\u8bbe\u8ba1 \u3010 \u53d1\u9001\u7ed9 \u67d0\u4e2a\u5fae\u670d\u52a1 \u3011</strong>",id:"1211-\u601d\u8def1-\u7684\u67b6\u6784\u8bbe\u8ba1--\u53d1\u9001\u7ed9-\u67d0\u4e2a\u5fae\u670d\u52a1-",level:5},{value:"1.2.1.2 <strong>\u601d\u8def2 \u7684\u67b6\u6784\u8bbe\u8ba1 \u3010 \u53d1\u9001\u7ed9ConfigServer \u3011\u2764\ufe0f</strong>",id:"1212-\u601d\u8def2-\u7684\u67b6\u6784\u8bbe\u8ba1--\u53d1\u9001\u7ed9configserver-\ufe0f",level:5},{value:"1.2.2 \u4ee3\u7801\u5b9e\u73b0",id:"122-\u4ee3\u7801\u5b9e\u73b0",level:4},{value:"1.3 \u52a8\u6001\u5237\u65b0\u5b9a\u70b9\u901a\u77e5 \u3010 \u5237\u65b0\u90e8\u5206\u670d\u52a1 \u3011",id:"13-\u52a8\u6001\u5237\u65b0\u5b9a\u70b9\u901a\u77e5--\u5237\u65b0\u90e8\u5206\u670d\u52a1-",level:3}],u={toc:s};function d(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"1-springcloud-bus\u6d88\u606f\u603b\u7ebf"},"1. SpringCloud Bus\u6d88\u606f\u603b\u7ebf"),(0,r.kt)("h3",{id:"11-\u6d88\u606f\u603b\u7ebf\u6982\u8ff0"},"1.1 \u6d88\u606f\u603b\u7ebf\u6982\u8ff0"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u76ee\u524d\u5fae\u670d\u52a1\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("font",{color:"green"},"Config\u914d\u7f6e\u4e2d\u5fc3\u7684\u914d\u7f6e\u6587\u4ef6\u66f4\u65b0\u540e\uff0c\u9700\u8981\u624b\u52a8\u8c03\u7528 refresh\u7aef\u70b9\u670d\u52a1\uff0c\u5ba2\u6237\u7aef\u624d\u80fd\u83b7\u53d6\u5230\u6700\u65b0\u7684\u914d\u7f6e\u6587\u4ef6")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("font",{color:"red"},"SpringCloud Bus \u662f\u4ec0\u4e48\uff1f"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("font",{color:"red"},"Bus\u914d\u5408Config \u53ef\u4ee5\u5b9e\u73b0 \u914d\u7f6e\u7684\u52a8\u6001\u5237\u65b0"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("mark",null,"\u5206\u5e03\u5f0f\u81ea\u52a8\u5237\u65b0\u914d\u7f6e\u529f\u80fd"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"\xa0\u5728SpringCloud Server\u7aef\u53d1\u9001\u6d88\u606f ,\u6240\u6709\u8ba2\u9605\u4e86\u6d88\u606f\u7684\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u5411Git\u8fdc\u7a0b\u4ed3\u5e93\u53d1\u9001 refresh \u8bf7\u6c42,\u4ece\u800c\u5b9e\u73b0\u5b9e\u65f6\u5237\u65b0"),"\xa0"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"SpringCloud Bus  \u63d0\u4f9b\u4e86",(0,r.kt)("inlineCode",{parentName:"p"},"/bus-refresh")," \u7aef\u70b9 ,Config Server \u53ef\u4ee5\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"p"},"POST")," \u8bf7\u6c42\u8fd9\u4e2a\u63a5\u53e3,\u4ece\u800c\u5237\u65b0\u5fae\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("font",{color:"red"},"Bus \u80fd\u5e72\u4ec0\u4e48\uff1f"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u7ba1\u7406\u548c\u4f20\u9012\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e4b\u95f4\u7684\u6d88\u606f ","[ \u6d88\u606f\u4e2d\u95f4\u4ef6 ]"),(0,r.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u7528\u4e8e\u5e7f\u64ad\u72b6\u6001\u66f4\u6539\u3001\u4e8b\u4ef6\u6d88\u606f\u63a8\u9001\u7b49\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5fae\u670d\u52a1\u95f4\u6d88\u606f\u7684\u901a\u9053"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Spring Cloud Bus\u652f\u6301\u4e24\u79cd\u6d88\u606f\u4ee3\u7406: ",(0,r.kt)("inlineCode",{parentName:"p"},"RabbitMQ\u3001Kafka")))),(0,r.kt)("h3",{id:"12-\u52a8\u6001\u5237\u65b0\u5168\u5c40\u5e7f\u64ad"},"1.2 \u52a8\u6001\u5237\u65b0\u5168\u5c40\u5e7f\u64ad"),(0,r.kt)("h4",{id:"121-\u8bbe\u8ba1\u601d\u8def"},"1.2.1 \u8bbe\u8ba1\u601d\u8def"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u601d\u8def1\uff1a \u5229\u7528\u6d88\u606f\u603b\u7ebf\u89e6\u53d1\u4e00\u4e2a\u5ba2\u6237\u7aef/bus/refresh,\u800c\u5237\u65b0\u6240\u6709\u5ba2\u6237\u7aef\u7684\u914d\u7f6e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("font",{color:"red"},"\u601d\u8def2\uff1a \u5229\u7528\u6d88\u606f\u603b\u7ebf\u89e6\u53d1\u4e00\u4e2a\u670d\u52a1\u7aefConfigServer\u7684/bus/refresh\u7aef\u70b9,\u800c\u5237\u65b0\u6240\u6709\u5ba2\u6237\u7aef\u7684\u914d\u7f6e"))),(0,r.kt)("h5",{id:"1211-\u601d\u8def1-\u7684\u67b6\u6784\u8bbe\u8ba1--\u53d1\u9001\u7ed9-\u67d0\u4e2a\u5fae\u670d\u52a1-"},"1.2.1.1 ",(0,r.kt)("strong",{parentName:"h5"},"\u601d\u8def1 \u7684\u67b6\u6784\u8bbe\u8ba1 \u3010 \u53d1\u9001\u7ed9 \u67d0\u4e2a\u5fae\u670d\u52a1 \u3011")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(65493).Z,width:"949",height:"571"})),(0,r.kt)("h5",{id:"1212-\u601d\u8def2-\u7684\u67b6\u6784\u8bbe\u8ba1--\u53d1\u9001\u7ed9configserver-\ufe0f"},"1.2.1.2 ",(0,r.kt)("strong",{parentName:"h5"},"\u601d\u8def2 \u7684\u67b6\u6784\u8bbe\u8ba1 \u3010 \u53d1\u9001\u7ed9ConfigServer \u3011\u2764\ufe0f")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(46258).Z,width:"945",height:"664"})),(0,r.kt)("h4",{id:"122-\u4ee3\u7801\u5b9e\u73b0"},"1.2.2 \u4ee3\u7801\u5b9e\u73b0"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("font",{color:"red"},"\u64cd\u4f5c\u6b65\u9aa4"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u4e3a\u6240\u6709\u7684\u670d\u52a1\u6dfb\u52a0 RabbitMQ\u6d88\u606f\u603b\u7ebf\u7684\u4f9d\u8d56 ",(0,r.kt)("inlineCode",{parentName:"p"},"spring-cloud-starter-bus-amqp"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u4e3a\u6bcf\u4e2a\u670d\u52a1\u914d\u7f6erabbitmq \u7684\u8fde\u63a5\u4fe1\u606f"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"host\u3001port\u3001username\u3001password"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("font",{color:"red"},"Bus \u9ed8\u8ba4\u4f1a\u5728RabbitMQ\u4e2d\u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("code",null,"springCloudBus"),"\xa0\u7684\u4ea4\u6362\u673a,\u6bcf\u4e2a\u914d\u7f6e\u4e86bus \u7684\u670d\u52a1\uff0c\u90fd\u4f1a\u5728\u4e0a\u8ff0\u7684\u4ea4\u6362\u673a\u4e0a\u7ed1\u5b9a\u4e00\u4e2a\u961f\u5217")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Bus\u603b\u7ebf\u66b4\u9732\u7684\u5237\u65b0\u5168\u90e8\u670d\u52a1\u914d\u7f6e\u4fe1\u606f\u7684\u7aef\u70b9\u662f",(0,r.kt)("inlineCode",{parentName:"p"},"/bus-refresh"),",\u5728 config-server\u7684actuator web\u7aef\u70b9\u4e2d\u66b4\u9732\u8be5\u7aef\u70b9")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u4fee\u6539\u5b8cGithub \u914d\u7f6e\u4e2d\u5fc3\u4ed3\u5e93\u7684\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u5411 config-server \u7684 \u5237\u65b0\u7aef\u70b9\u53d1\u9001post\u8bf7\u6c42"))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u2460\u3001 \u6dfb\u52a0bus-amqp \u7684\u4f9d\u8d56")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>org.springframework.cloud</groupId>\n  <artifactId>spring-cloud-starter-bus-amqp</artifactId>\n</dependency>\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u2461\u3001\u4fee\u6539application.yml, \u914d\u7f6eRabbitMQ\u7684\u8fde\u63a5\u4fe1\u606f ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'server:\n  port: 3344\nspring:\n  application:\n    name: cloud-config-center-3344\n  cloud:\n    consul:\n      host: localhost\n      port: 8500\n      discovery:\n        service-name: cloud-config-center\n        instance-id: ${spring.application.name}\n    config:\n      server:\n        git:\n          uri: https://github.com/MagicalZhu/config-repo.git\n          default-label: main\n          search-paths:\n            - config-repo\n          basedir: /Users/yoey/WorkSpace/Code/SpringCloudDemo/config-repo\n# \u914d\u7f6eRabbitMQ\n  rabbitmq:\n    host: 172.24.95.56\n    port: 5672\n    username: guest\n    password: guest\n    virtual-host: /\nmanagement:\n  endpoints:\n    web:\n      base-path: /actuator\n      exposure:\n        include: "bus-refresh"\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u2462\u3001\u542f\u52a8\u5404\u4e2a\u670d\u52a1\u540e\uff0c\u67e5\u770bRabbitMQ\u7ba1\u63a7\u53f0 ")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(12547).Z,width:"767",height:"811"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u2463\u3001\u5411 config-server \u53d1\u9001 /bus-refresh \u8bf7\u6c42\uff0c\u5237\u65b0\u670d\u52a1\u914d\u7f6e\u4fe1\u606f ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'\u279c  ~ curl -X POST "http://localhost:3344/actuator/bus-refresh"\n')),(0,r.kt)("h3",{id:"13-\u52a8\u6001\u5237\u65b0\u5b9a\u70b9\u901a\u77e5--\u5237\u65b0\u90e8\u5206\u670d\u52a1-"},"1.3 \u52a8\u6001\u5237\u65b0\u5b9a\u70b9\u901a\u77e5 \u3010 \u5237\u65b0\u90e8\u5206\u670d\u52a1 \u3011"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"SpringCloud Bus\u9664\u4e86\u63d0\u4f9b\u5237\u65b0\u5168\u90e8\u670d\u52a1\u4fe1\u606f\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"/bus-refresh")," \u7aef\u70b9\u4e4b\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"/bus-refresh/{destination}")," \u7684\u7aef\u70b9\u5237\u65b0\u6307\u5b9a\u7684\u670d\u52a1\u4fe1\u606f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("font",{color:"red"},"\u64cd\u4f5c\u6b65\u9aa4"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u597d\u4fe1\u606f\u540e\uff0c\u5411config-server\u914d\u7f6e\u4e2d\u5fc3\u53d1\u9001 ",(0,r.kt)("inlineCode",{parentName:"li"},"/bus-refresh/{destination}"),"  post\u8bf7\u6c42",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"destination")," : \u76ee\u6807\u670d\u52a1\u7684\u540d\u79f0",(0,r.kt)("strong",{parentName:"li"},"(spring.application.name)\uff1aport"))))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5411 config-server \u53d1\u9001 /bus-refresh/destination \u8bf7\u6c42\uff0c\u5237\u65b0\u670d\u52a1\u914d\u7f6e\u4fe1\u606f ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'\u279c  ~ curl -X POST "http://localhost:3344/actuator/bus-refresh/cloud-config-client-3355:3355"\n')))}d.isMDXComponent=!0},65493:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20201212201837323-030593877415bfacb022e36c84f87ebd.png"},46258:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20201212202219623-4034e638322f21abcc82cab5b5ff11e7.png"},12547:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20201212213924792-4c23b2f72806522dcd1f7c45611ab74a.png"}}]);