"use strict";(self.webpackChunkhuakucha=self.webpackChunkhuakucha||[]).push([[797],{58808:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var a=n(87462),l=(n(67294),n(3905));n(61839);const r={id:"\u7ebf\u7a0b\u534f\u4f5c",title:"\u7ebf\u7a0b\u534f\u4f5c"},i=void 0,o={unversionedId:"\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/\u7ebf\u7a0b\u534f\u4f5c",id:"\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/\u7ebf\u7a0b\u534f\u4f5c",title:"\u7ebf\u7a0b\u534f\u4f5c",description:"\u6982\u8ff0",source:"@site/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/3.7\u5e76\u53d1\u5de5\u5177\u7c7b-\u7ebf\u7a0b\u534f\u4f5c.md",sourceDirName:"\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236",slug:"/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/\u7ebf\u7a0b\u534f\u4f5c",permalink:"/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/\u7ebf\u7a0b\u534f\u4f5c",draft:!1,editUrl:"https://github.com/MagicalZhu/NoteLib/tree/main/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/3.7\u5e76\u53d1\u5de5\u5177\u7c7b-\u7ebf\u7a0b\u534f\u4f5c.md",tags:[],version:"current",lastUpdatedBy:"YuLiang Zhu",lastUpdatedAt:1670289592,formattedLastUpdatedAt:"2022\u5e7412\u67086\u65e5",frontMatter:{id:"\u7ebf\u7a0b\u534f\u4f5c",title:"\u7ebf\u7a0b\u534f\u4f5c"},sidebar:"basicSideBar",previous:{title:"\u5e76\u53d1\u5bb9\u5668",permalink:"/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/\u5e76\u53d1\u96c6\u5408\u4e0e\u963b\u585e\u961f\u5217"},next:{title:"AQS(\u961f\u5217\u540c\u6b65\u5668)",permalink:"/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/AQS"}},u={},p=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"CountDownLatch\u3010\u5012\u8ba1\u65f6\u3011",id:"countdownlatch\u5012\u8ba1\u65f6",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-1",level:3},{value:"\u5e38\u89c1\u7684\u65b9\u6cd5",id:"\u5e38\u89c1\u7684\u65b9\u6cd5",level:3},{value:"\u793a\u4f8b1",id:"\u793a\u4f8b1",level:3},{value:"\u793a\u4f8b2",id:"\u793a\u4f8b2",level:3},{value:"\u793a\u4f8b3",id:"\u793a\u4f8b3",level:3},{value:"Semaphore\u3010\u9650\u6d41\u5668\u3011",id:"semaphore\u9650\u6d41\u5668",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-2",level:3},{value:"\u5e38\u89c1\u7684\u65b9\u6cd5",id:"\u5e38\u89c1\u7684\u65b9\u6cd5-1",level:3},{value:"\u793a\u4f8b1",id:"\u793a\u4f8b1-1",level:3},{value:"Condition\u3010\u6267\u884c\u6761\u4ef6\u5bf9\u8c61\u3011",id:"condition\u6267\u884c\u6761\u4ef6\u5bf9\u8c61",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-3",level:3},{value:"\u57fa\u672c\u793a\u4f8b",id:"\u57fa\u672c\u793a\u4f8b",level:3},{value:"\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u793a\u4f8b",id:"\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u793a\u4f8b",level:3},{value:"CyclicBarrier\u3010\u7ec4\u961f\u7a81\u7834\u3011",id:"cyclicbarrier\u7ec4\u961f\u7a81\u7834",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-4",level:3},{value:"\u5e38\u89c1\u7684\u65b9\u6cd5",id:"\u5e38\u89c1\u7684\u65b9\u6cd5-2",level:3},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:3}],m={toc:p};function c(e){let{components:t,...r}=e;return(0,l.kt)("wrapper",(0,a.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u63a7\u5236\u5e76\u53d1\u6d41\u7a0b\u662f\u4ec0\u4e48")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u6ca1\u6709\u5e76\u53d1\u6d41\u7a0b\u7684\u63a7\u5236\uff0c\u7ebf\u7a0b\u7684\u6267\u884c\u901a\u8fc7\u7ebf\u7a0b\u8c03\u5ea6\u5668\u6765\u63a7\u5236\u3002\u6709\u4e9b\u9700\u6c42\u9700\u8981\u63a7\u5236\u7ebf\u7a0b\u7684\u6267\u884c\u987a\u5e8f\u6216\u8005\u7ebf\u7a0b\u6267\u884c\u6570\u91cf\u7b49\uff0c\u5c31\u9700\u8981\u901a\u8fc7\u63a7\u5236\u5e76\u53d1\u6d41\u7a0b\u7684\u5de5\u5177\u7c7b"),(0,l.kt)("li",{parentName:"ul"},"\u5373\u63a7\u5236\u5e76\u53d1\u6d41\u7a0b\u7684\u5de5\u5177\u7c7b\u5c31\u662f",(0,l.kt)("font",{color:"red"},"\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u66f4\u5bb9\u6613\u7684\u8ba9\u7ebf\u7a0b\u4e4b\u95f4\u8fdb\u884c\u5408\u4f5c"),"\uff0c\u6bd4\u5982\u7ebf\u7a0bA\u7b49\u5f85\u7ebf\u7a0bB\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u518d\u6267\u884c"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u5e38\u89c1\u7684\u63a7\u5236\u5e76\u53d1\u6d41\u7a0b\u7684\u5de5\u5177\u7c7b")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"Semaphore")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4fe1\u53f7\u91cf,\u901a\u8fc7\u63a7\u5236 \u201c\u8bb8\u53ef\u8bc1\u201d\u7684\u6570\u91cf\uff0c\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u4e4b\u95f4\u7684\u914d\u5408"),(0,l.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u53ea\u6709\u5728\u62ff\u5230\u201c\u8bb8\u53ef\u8bc1\u201d\u540e\u624d\u53ef\u4ee5\u7ee7\u7eed\u8fd0\u884c\u3002\u76f8\u6bd4\u5176\u4ed6\u7684\u540c\u6b65\u5668\u6765\u8bf4\u66f4\u52a0\u7684\u7075\u6d3b"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"CyclicBarrier")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5faa\u73af\u6805\u680f\u3002\u7ebf\u7a0b\u4f1a\u7b49\u5f85,\u76f4\u5230\u8db3\u591f\u591a\u7684\u7ebf\u7a0b\u8fbe\u5230\u4e86\u4e8b\u5148\u9884\u5b9a\u7684\u6570\u91cf\uff0c\u624d\u4f1a\u6267\u884c\u4e0b\u4e00\u6b65\u7684\u52a8\u4f5c"),(0,l.kt)("li",{parentName:"ul"},"\u9002\u7528\u4e8e\u7ebf\u7a0b\u4e4b\u95f4\u76f8\u4e92\u7b49\u5f85\u5904\u7406\u7ed3\u679c\u5c31\u7eea\u7684\u573a\u666f"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"CountDownLatch")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u51cf\u5c11\u8ba1\u6570\u3002\u548cCyclicBarrier\u7c7b\u4f3c\uff0c\u6570\u91cf\u9012\u51cf\u52300\u7684\u65f6\u5019\u6267\u884c\u4e0b\u4e00\u6b65"),(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u53ef\u91cd\u590d\u4f7f\u7528"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"Condition")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6761\u4ef6\u5bf9\u8c61,\u53ef\u4ee5\u63a7\u5236\u7ebf\u7a0b\u7684",(0,l.kt)("strong",{parentName:"li"},"\u7b49\u5f85"),"\u4e0e",(0,l.kt)("strong",{parentName:"li"},"\u5524\u9192")),(0,l.kt)("li",{parentName:"ul"},"\u662f ",(0,l.kt)("em",{parentName:"li"},"Object.wait()"),"\u7684\u5347\u7ea7\u7248\uff0c\u4e00\u4e2aLock\u53ef\u4ee5\u6709\u591a\u4e2aCondition"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"Exchanger")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8ba9\u4e24\u4e2a\u7ebf\u7a0b\u5728\u5408\u9002\u7684\u65f6\u5019\u4ea4\u6362\u5bf9\u8c61"),(0,l.kt)("li",{parentName:"ul"},"\u9002\u7528\u4e8e: \u5f53\u4e24\u4e2a\u7ebf\u7a0b\u5de5\u4f5c\u5728\u540c\u4e00\u4e2a\u7c7b\u7684\u4e0d\u540c\u5b9e\u4f8b\u4e0a\u65f6\u7528\u4e8e\u4ea4\u6362\u6570\u636e")))))),(0,l.kt)("h2",{id:"countdownlatch\u5012\u8ba1\u65f6"},"CountDownLatch\u3010\u5012\u8ba1\u65f6\u3011"),(0,l.kt)("h3",{id:"\u6982\u8ff0-1"},"\u6982\u8ff0"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("font",{color:"red"},"\u5141\u8bb8\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u5b8c\u6210\u64cd\u4f5c"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"CountDownLatch\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u8ba1\u6570\u5668,\u7136\u540e\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"countDown()")," \u6765\u8fdb\u884c\u51cf 1 \u7684\u64cd\u4f5c,\u5f53",(0,l.kt)("inlineCode",{parentName:"li"},"await()"),"\u7b49\u5f85\u8ba1\u6570\u5668",(0,l.kt)("inlineCode",{parentName:"li"},"\u5c0f\u4e8e\u7b49\u4e8e0"),"\u540e\u7ee7\u7eed\u6267\u884c await()\u4e4b\u540e\u7684\u8bed\u53e5"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"CountDownLatch \u4e3b\u8981\u6709\u4e24\u4e2a\u65b9\u6cd5"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5f53\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u7ebf\u7a0b\u8c03\u7528await() \u65b9\u6cd5\u65f6\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u4f1a\u963b\u585e"),(0,l.kt)("li",{parentName:"ul"},"\u5176\u5b83\u7ebf\u7a0b\u8c03\u7528 countDown() \u65b9\u6cd5\u4f1a\u5c06\u8ba1\u6570\u5668\u51cf 1, ",(0,l.kt)("font",{color:"red"},"\u4f46\u662f\u8c03\u7528 countDown() \u7684\u7ebf\u7a0b\u4e0d\u4f1a\u963b\u585e"),"\u3002\u5f53\u8ba1\u6570\u5668\u7684\u503c \u5c0f\u4e8e\u7b49\u4e8e0 \u65f6\uff0c\u56e0 await() \u963b\u585e\u7684\u7ebf\u7a0b\u4f1a\u88ab\u5524\u9192\uff0c\u7ee7\u7eed\u6267\u884c"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("font",{color:"red"},"\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528 CountDown() \u5bf9 \u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528 await()\u540e\u7684\u64cd\u4f5c\u662f\u5185\u5b58\u53ef\u89c1\u7684")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("mark",null,"\u6ce8\u610f"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"CountDownLatch \u65e0\u6cd5\u91cd\u7528\uff0c\u5982\u679c\u9700\u7528\u91cd\u65b0\u8ba1\u6570\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 CyclicBarrier \u6216\u8005\u521b\u5efa\u65b0\u7684CountDownLatch"),(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u591a\u4e2a\u7ebf\u7a0b")))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(34142).Z,width:"617",height:"458"})),(0,l.kt)("h3",{id:"\u5e38\u89c1\u7684\u65b9\u6cd5"},"\u5e38\u89c1\u7684\u65b9\u6cd5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CountDownLatch(int count)"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4ec5\u6709\u4e00\u4e2a\u6784\u9020\u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"\u6784\u9020\u4e00\u4e2a\u7528\u7ed9\u5b9a\u8ba1\u6570\u521d\u59cb\u5316\u7684 CountDownLatch"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"await([long time,TimeUnit unit])"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u5f53\u524d\u7ebf\u7a0b\u5728\u9501\u5b58\u5668\u5012\u8ba1\u6570\u81f30\u4e4b\u524d\u4e00\u76f4\u7b49\u5f85\uff0c\u9664\u975e\u7ebf\u7a0b\u88ab\u4e2d\u65ad\u6216\u8d85\u51fa\u4e86\u6307\u5b9a\u7684\u7b49\u5f85\u65f6\u95f4"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"countDown()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u9012\u51cf\u9501\u5b58\u5668\u7684\u8ba1\u6570",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u8ba1\u6570\u5c0f\u4e8e\u7b49\u4e8e0\uff0c\u5219\u91ca\u653e\u6240\u6709\u7b49\u5f85\u7684\u7ebf\u7a0b"),(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u5f53\u524d\u8ba1\u6570\u5927\u4e8e0\uff0c\u5219\u4e0d\u53d1\u751f\u4efb\u4f55\u64cd\u4f5c"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"getCount()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u5f53\u524d\u8ba1\u6570")))),(0,l.kt)("h3",{id:"\u793a\u4f8b1"},"\u793a\u4f8b1"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u90fd\u6267\u884c\u5b8c\u6210\u540e\uff0c\u518d\u7ee7\u7eed\u6267\u884c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u591a\u4e2a\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u540e\u518d\u7ee7\u7eed\u8fd0\u884c</b>\n *\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class CountDownLatchDemo1 {\n    public static void main(String[] args) throws InterruptedException {\n        CountDownLatch latch = new CountDownLatch(5);\n        ThreadPoolExecutor executor = new ThreadPoolExecutor(5, 5, 60L, TimeUnit.SECONDS, new ArrayBlockingQueue<>(20));\n        // \u7ebf\u7a0b\u6c60\u542f\u52a8\u7684\u65f6\u5019\u5c31\u521b\u5efa\u6838\u5fc3\u7ebf\u7a0b\n        executor.prestartAllCoreThreads();\n        new Thread(() -> {\n            try {\n                System.out.printf("\u7ebf\u7a0b[%s]\u5f00\u59cb\u6267\u884c\u4efb\u52a1,\u9700\u8981\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\\r\\n",Thread.currentThread().getName());\n                latch.await();\n                System.out.printf("\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210,\u7ebf\u7a0b[%s]\u7ee7\u7eed\u6267\u884c\\r\\n",Thread.currentThread().getName());\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        },"ThreadMain").start();\n        // \u63d0\u4ea4\u4e94\u4e2a\u4efb\u52a1\u7ed9\u7ebf\u7a0b\n        for (int i = 1; i <= 5; i++) {\n            executor.execute(() -> {\n                try {\n                    Long waitTime = (long)(Math.random()*1000);\n                    System.out.printf("\u7ebf\u7a0b[%s]\u5f00\u59cb\u6267\u884c\u4efb\u52a1...\u9700\u8981\u7b49\u5f85%s\u6beb\u79d2\\r\\n",Thread.currentThread().getName(),waitTime);\n                    TimeUnit.MILLISECONDS.sleep(waitTime);\n                    latch.countDown();\n                    System.out.printf("\u7ebf\u7a0b[%s]\u7ed3\u675f\u6267\u884c\u4efb\u52a1,latch\u8ba1\u6570\u8fd8\u5269\u4f59:%d\\r\\n",Thread.currentThread().getName(),latch.getCount());\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n        executor.shutdown();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(35031).Z,width:"531",height:"276"})),(0,l.kt)("h3",{id:"\u793a\u4f8b2"},"\u793a\u4f8b2"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u67d0\u4e2a\u7ebf\u7a0b\u90fd\u6267\u884c\u5b8c\u6210\u540e\uff0c\u518d\u7ee7\u7eed\u6267\u884c -> \u6bd4\u5982\u8bf4\u6a21\u62df\u538b\u6d4b\uff0c\u5c31\u9700\u8981\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u4e00\u4e2a\u6267\u884c\u7684\u4fe1\u53f7")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u4e00\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\u4fe1\u53f7</b>\n *\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class CountDownLatchDemo2 {\n    public static void main(String[] args) throws InterruptedException {\n        // \u53ea\u9700\u8981\u4e00\u4e2a\u5c31\u53ef\u4ee5\n        CountDownLatch latch = new CountDownLatch(1);\n        ThreadPoolExecutor executor = new ThreadPoolExecutor(5, 5, 60L, TimeUnit.SECONDS, new ArrayBlockingQueue<>(20));\n        // \u7ebf\u7a0b\u6c60\u542f\u52a8\u7684\u65f6\u5019\u5c31\u521b\u5efa\u6838\u5fc3\u7ebf\u7a0b\n        executor.prestartAllCoreThreads();\n\n        // \u63d0\u4ea4\u4e94\u4e2a\u4efb\u52a1\u7ed9\u7ebf\u7a0b\n        for (int i = 1; i <= 4; i++) {\n            executor.execute(() -> {\n                try {\n                    System.out.printf("\u7ebf\u7a0b[%s]\u51c6\u5907\u6267\u884c\u4efb\u52a1\\r\\n",Thread.currentThread().getName());\n                    latch.await();\n                    System.out.printf("\u7ebf\u7a0b[%s]\u5f00\u59cb\u6267\u884c\u4efb\u52a1\\r\\n",Thread.currentThread().getName());\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n        System.out.println("5s \u540e\u7ebf\u7a0b\u6c60\u4e2d\u7684\u4efb\u52a1\u5f00\u59cb\u8fd0\u884c");\n        TimeUnit.SECONDS.sleep(5);\n        System.out.println("\u5f00\u59cb\u6267\u884c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u4efb\u52a1");\n        latch.countDown();\n        executor.shutdown();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(4736).Z,width:"497",height:"271"})),(0,l.kt)("h3",{id:"\u793a\u4f8b3"},"\u793a\u4f8b3"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u67d0\u4e2a\u7ebf\u7a0b\u90fd\u6267\u884c\u5b8c\u6210\u540e\u518d\u7ee7\u7eed\u6267\u884c,\u6700\u540e\u6267\u884c\u7ed3\u675f\u540e\u6709\u6536\u5c3e\u5de5\u4f5c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u4e00\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\u4fe1\u53f7</b>\n *\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class CountDownLatchDemo3 {\n    public static void main(String[] args) throws InterruptedException {\n        // \u5f00\u59cb\u53ea\u9700\u8981\u4e00\u4e2a\u5c31\u53ef\u4ee5\n        CountDownLatch startLatch = new CountDownLatch(1);\n        // \u7b49\u5f85\u5176\u4ed6\u6240\u6709\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u518d\u6267\u884c\u540e\u7eed\u52a8\u4f5c\n        CountDownLatch endtLatch = new CountDownLatch(5);\n        ThreadPoolExecutor executor = new ThreadPoolExecutor(5, 5, 60L, TimeUnit.SECONDS, new ArrayBlockingQueue<>(20));\n        // \u7ebf\u7a0b\u6c60\u542f\u52a8\u7684\u65f6\u5019\u5c31\u521b\u5efa\u6838\u5fc3\u7ebf\u7a0b\n        executor.prestartAllCoreThreads();\n\n        // \u63d0\u4ea4\u4e94\u4e2a\u4efb\u52a1\u7ed9\u7ebf\u7a0b\n        for (int i = 1; i <= 5; i++) {\n            executor.execute(() -> {\n                try {\n                    System.out.printf("\u7ebf\u7a0b[%s]\u51c6\u5907\u6267\u884c\u4efb\u52a1\\r\\n",Thread.currentThread().getName());\n                    startLatch.await();\n                    Long waitTime = (long)(Math.random()*2000);\n                    System.out.printf("\u7ebf\u7a0b[%s]\u5f00\u59cb\u6267\u884c\u4efb\u52a1...\u9700\u8981\u7b49\u5f85%s\u6beb\u79d2\\r\\n",Thread.currentThread().getName(),waitTime);\n                    TimeUnit.MILLISECONDS.sleep(waitTime);\n                    endtLatch.countDown();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n        System.out.println("5s \u540e\u7ebf\u7a0b\u6c60\u4e2d\u7684\u4efb\u52a1\u5f00\u59cb\u8fd0\u884c");\n        TimeUnit.SECONDS.sleep(5);\n        System.out.println("\u5f00\u59cb\u6267\u884c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u4efb\u52a1...");\n        startLatch.countDown();\n        System.out.println("\u5f00\u59cb\u7b49\u5f85\u7ebf\u7a0b\u6c60\u4e2d\u6240\u6709\u7684\u4efb\u52a1\u6267\u884c\u5b8c\u6210...");\n        endtLatch.await();\n        System.out.println("\u7ebf\u7a0b\u6c60\u4e2d\u6240\u6709\u7684\u4efb\u52a1\u6267\u884c\u5b8c\u6210,\u8fdb\u884c\u6e05\u7406\u5de5\u4f5c...");\n        executor.shutdown();\n    }\n}\n')),(0,l.kt)("h2",{id:"semaphore\u9650\u6d41\u5668"},"Semaphore\u3010\u9650\u6d41\u5668\u3011"),(0,l.kt)("h3",{id:"\u6982\u8ff0-2"},"\u6982\u8ff0"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("font",{color:"red"},"\u7528\u4e8e\u63a7\u5236\u540c\u65f6\u8bbf\u95ee\u7279\u5b9a\u8d44\u6e90\u7684\u7ebf\u7a0b\u6570\u91cf"),",\u901a\u8fc7\u534f\u8c03\u5404\u4e2a\u7ebf\u7a0b,\u4ee5\u4fdd\u8bc1\u5408\u7406\u7684\u4f7f\u7528\u516c\u5171\u8d44\u6e90\u3002",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Semaphore \u53ef\u4ee5\u505a ",(0,l.kt)("inlineCode",{parentName:"li"},"\u6d41\u91cf\u63a7\u5236"),"\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u94fe\u63a5"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fe1\u53f7\u91cf\u7684\u4f5c\u7528\u662f",(0,l.kt)("font",{color:"red"},"\u7ef4\u62a4\u4e00\u4e2a\u201c\u8bb8\u53ef\u8bc1\u201d\u7684\u8ba1\u6570"),",\u5f53\u4fe1\u53f7\u91cf\u62e5\u6709\u7684\u8bb8\u53ef\u8bc1\u6570\u91cf\u4e3a0\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u7ebf\u7a0b\u5fc5\u987b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u91ca\u653e\u4e86\u8bb8\u53ef\u8bc1"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u53ef\u4ee5\u201c\u83b7\u53d6\u8bb8\u53ef\u8bc1\u201d\uff0c\u90a3\u4e48\u4fe1\u53f7\u91cf\u5269\u4f59\u7684\u8bb8\u53ef\u8bc1\u5c31\u51cf1"),(0,l.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u53ef\u4ee5\u201c\u91ca\u653e\u8bb8\u53ef\u8bc1\u201d,\u90a3\u4e48\u4fe1\u53f7\u91cf\u5269\u4f59\u7684\u8bb8\u53ef\u8bc1\u5c31\u52a01"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u57fa\u672c\u4f7f\u7528\u65b9\u5f0f")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316 Semaphore \u5e76\u6307\u5b9a\u8bb8\u53ef\u8bc1\u7684\u6570\u91cf"),(0,l.kt)("li",{parentName:"ul"},"\u5728\u9700\u8981\u8bb8\u53ef\u8bc1\u7684\u4ee3\u7801\u524d\u52a0\u4e0a ",(0,l.kt)("inlineCode",{parentName:"li"},"acquire() / acquireUninterruptibly()")),(0,l.kt)("li",{parentName:"ul"},"\u5728\u4efb\u52a1\u6267\u884c\u7ed3\u675f\u540e, \u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"release()")," \u91ca\u653e\u8bb8\u53ef\u8bc1"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("mark",null,"\u6ce8\u610f"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u83b7\u53d6\u548c\u91ca\u653e \u8bb8\u53ef\u8bc1\u7684\u65f6\u5019\u53ef\u4ee5\u6307\u5b9a\u6570\u91cf\uff0c\u6240\u4ee5",(0,l.kt)("font",{color:"red"},"\u83b7\u53d6\u548c\u91ca\u653e\u8bb8\u53ef\u8bc1\u7684\u6570\u91cf\u5fc5\u987b\u4e00\u81f4"),"\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u7684\u5361\u6b7b"),(0,l.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316\u4fe1\u53f7\u91cf\u7684\u65f6\u5019\u9700\u8981\u8bbe\u7f6e\u516c\u5e73\u6027(\u9ed8\u8ba4\u662ffalse\u7684\u975e\u516c\u5e73), \u6709\u65f6\u5019\u53ef\u80fd\u8bbe\u7f6e\u4e3a\u516c\u5e73true\u66f4\u52a0\u7684\u5408\u7406"),(0,l.kt)("li",{parentName:"ul"},"\u4fe1\u53f7\u91cf\u9664\u4e86",(0,l.kt)("font",{color:"red"},"\u63a7\u5236\u4e34\u754c\u533a\u6700\u591a\u6709N\u4e2a\u7ebf\u7a0b"),"\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u4f5c\u7528\u5c31\u662f",(0,l.kt)("font",{color:"red"},"\u6761\u4ef6\u7b49\u5f85"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6bd4\u5982\u7ebf\u7a0bA\u9700\u8981\u5728\u7ebf\u7a0bB\u540e\u6267\u884c\uff0c\u90a3\u4e48\u5c31\u662f\u6307\u5b9a\u4fe1\u53f7\u91cf\u7684\u8bb8\u53ef\u8bc1\u6570\u91cf\u4e3a1\uff0c\u7ebf\u7a0bB\u83b7\u53d6\u5230\u8bb8\u53ef\u8bc1\u540e\uff0c\u7ebf\u7a0bA\u8c03\u7528 acquire()\u4f1a\u88ab\u963b\u585e\uff0c\u7136\u540e\u7ebf\u7a0bB\u901a\u8fc7 release\u91ca\u653e\u8bb8\u53ef\u8bc1\uff0c\u8fd9\u65f6\u7ebf\u7a0bA\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5f80\u4e0b\u8d70")))))),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(42991).Z,width:"995",height:"339"})),(0,l.kt)("h3",{id:"\u5e38\u89c1\u7684\u65b9\u6cd5-1"},"\u5e38\u89c1\u7684\u65b9\u6cd5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"Semaphore(int permits, boolean fair)")," -> \u521b\u5efa\u5177\u6709\u7ed9\u5b9a\u7684\u8bb8\u53ef\u6570\u548c\u7ed9\u5b9a\u7684\u516c\u5e73\u8bbe\u7f6e\u7684 Semaphore"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"permits"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u521d\u59cb\u7684\u53ef\u7528\u8bb8\u53ef\u6570\u76ee\u3002\u6b64\u503c\u53ef\u80fd\u4e3a\u8d1f\u6570\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5fc5\u987b\u5728\u6388\u4e88\u4efb\u4f55\u83b7\u53d6\u524d\u8fdb\u884c\u91ca\u653e\u3002"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fair"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u6b64\u4fe1\u53f7\u91cf\u4fdd\u8bc1\u5728\u4e89\u7528\u65f6\u6309\u5148\u8fdb\u5148\u51fa\u7684\u987a\u5e8f\u6388\u4e88\u8bb8\u53ef\uff0c\u5219\u4e3a true\uff1b\u5426\u5219\u4e3a false\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u901a\u5e38\u5e94\u8be5\u5c06\u7528\u4e8e\u63a7\u5236\u8d44\u6e90\u8bbf\u95ee\u7684\u4fe1\u53f7\u91cf\u521d\u59cb\u5316\u4e3a\u516c\u5e73\u7684\uff0c\u4ee5\u786e\u4fdd\u6240\u6709\u7ebf\u7a0b\u90fd\u53ef\u8bbf\u95ee\u8d44\u6e90\u3002\u4e3a\u5176\u4ed6\u7684\u79cd\u7c7b\u7684\u540c\u6b65\u63a7\u5236\u4f7f\u7528\u4fe1\u53f7\u91cf\u65f6\uff0c\u975e\u516c\u5e73\u6392\u5e8f\u7684\u541e\u5410\u91cf\u4f18\u52bf\u901a\u5e38\u8981\u6bd4\u516c\u5e73\u8003\u8651\u66f4\u4e3a\u91cd\u8981 ")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"acquire(int permits)")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4ece\u6b64\u4fe1\u53f7\u91cf\u83b7\u53d6\u7ed9\u5b9a\u6570\u76ee\u7684\u8bb8\u53ef\uff0c\u5728\u63d0\u4f9b\u8fd9\u4e9b\u8bb8\u53ef\u524d\u4e00\u76f4\u5c06\u7ebf\u7a0b\u963b\u585e,\u5426\u5219\u7ebf\u7a0b\u88ab\u4e2d\u65ad"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"acquireUninterruptibly(int permits)")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4ece\u6b64\u4fe1\u53f7\u91cf\u83b7\u53d6\u7ed9\u5b9a\u6570\u76ee\u7684\u8bb8\u53ef\uff0c\u5728\u63d0\u4f9b\u8fd9\u4e9b\u8bb8\u53ef\u524d\u4e00\u76f4\u5c06\u7ebf\u7a0b\u963b\u585e"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"release(int permits)")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u91ca\u653e\u7ed9\u5b9a\u6570\u76ee\u7684\u8bb8\u53ef\uff0c\u5c06\u5176\u8fd4\u56de\u5230\u4fe1\u53f7\u91cf"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"availablePermits()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u6b64\u4fe1\u53f7\u91cf\u4e2d\u5f53\u524d\u53ef\u7528\u7684\u8bb8\u53ef\u6570"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"drainPermits()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u83b7\u53d6\u5e76\u8fd4\u56de\u7acb\u5373\u53ef\u7528\u7684\u6240\u6709\u8bb8\u53ef"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"getQueuedThreads() #Collection<Thread>")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u4e00\u4e2a collection\uff0c\u5305\u542b\u53ef\u80fd\u7b49\u5f85\u83b7\u53d6\u7684\u7ebf\u7a0b"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\tgetQueueLength()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u6b63\u5728\u7b49\u5f85\u83b7\u53d6\u7684\u7ebf\u7a0b\u7684\u4f30\u8ba1\u6570\u76ee"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"hasQueuedThreads()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u67e5\u8be2\u662f\u5426\u6709\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\u83b7\u53d6")))),(0,l.kt)("h3",{id:"\u793a\u4f8b1-1"},"\u793a\u4f8b1"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u9650\u5236\u4e00\u6b21\u53ea\u80fd\u6709\u5c11\u6570\u7684\u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c\u4efb\u52a1")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>\u9650\u5236\u4e00\u6b21\u53ea\u80fd\u6709\u5c11\u6570\u7684\u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c\u4efb\u52a1</b>\n *\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class SemaphoreDemo1 {\n    public static void main(String[] args) {\n        Semaphore semaphore = new Semaphore(3,true);\n\n        ThreadPoolExecutor executor = new ThreadPoolExecutor(10, 10, 60L, TimeUnit.SECONDS, new ArrayBlockingQueue<>(20));\n        // \u7ebf\u7a0b\u6c60\u542f\u52a8\u7684\u65f6\u5019\u5c31\u521b\u5efa\u6838\u5fc3\u7ebf\u7a0b\n        executor.prestartAllCoreThreads();\n\n        for (int i = 1; i <= 10; i++) {\n            executor.execute(() -> {\n                try {\n                    System.out.printf("\u7ebf\u7a0b[%s]\u5c1d\u8bd5\u83b7\u53d6\u8bb8\u53ef\u8bc1,Semaphore\u4e2d\u5269\u4f59%d\u4e2a\\r\\n",Thread.currentThread().getName(), semaphore.availablePermits());\n                    semaphore.acquire();\n                    System.out.printf("\u7ebf\u7a0b[%s]\u83b7\u53d6\u5230\u4e86\u8bb8\u53ef\u8bc1\\r\\n",Thread.currentThread().getName());\n                    TimeUnit.SECONDS.sleep(1);\n                    semaphore.release();\n                    System.out.printf("\u7ebf\u7a0b[%s]\u91ca\u653e\u4e86\u8bb8\u53ef\u8bc1\\r\\n",Thread.currentThread().getName());\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n    }\n}\n\n')),(0,l.kt)("h2",{id:"condition\u6267\u884c\u6761\u4ef6\u5bf9\u8c61"},"Condition\u3010\u6267\u884c\u6761\u4ef6\u5bf9\u8c61\u3011"),(0,l.kt)("h3",{id:"\u6982\u8ff0-3"},"\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4efb\u610f\u4e00\u4e2ajava\u5bf9\u8c61\u90fd\u6709\u4e00\u7ec4\u76d1\u89c6\u5668\u65b9\u6cd5(\u5b9a\u4e49\u5728Object\u4e0a),\u4e3b\u8981\u5305\u62ec wait()/notify()\u65b9\u6cd5\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u4e0esynchronized\u53ef\u4ee5\u5b9e\u73b0\u7b49\u5f85/\u901a\u77e5\u673a\u5236",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f46\u662f\u5185\u7f6e\u9501\u53ea\u80fd\u5173\u8054\u4e00\u4e2a\u6761\u4ef6\u5bf9\u8c61,\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u7ecf\u5e38\u4f1a\u9700\u8981\u7ed1\u5b9a\u591a\u4e2a\u6761\u4ef6\u5bf9\u8c61,\u56e0\u6b64\u5185\u7f6e\u9501\u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"Condition\u63a5\u53e3\u4e5f\u63d0\u4f9b\u4e86\u7c7b\u4f3c\u4e8eObject\u7684\u76d1\u89c6\u5668\u65b9\u6cd5, \u4e0eLock\u914d\u5408\u53ef\u4ee5\u5b9e\u73b0\u7b49\u5f85/\u901a\u77e5\u6a21\u5f0f"),",\u4f46\u662f\u4e00\u4e2aLock\u5bf9\u8c61\u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2aCondition\u6761\u4ef6\u5bf9\u8c61\u3002\u540c\u65f6Condition\u6bd4\u5185\u7f6e\u7684\u6761\u4ef6\u5bf9\u8c61\u63d0\u4f9b\u4e86\u66f4\u52a0\u4e30\u5bcc\u7684\u529f\u80fd"),(0,l.kt)("li",{parentName:"ul"},"Condition\u7684\u4f5c\u7528",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5f53\u7ebf\u7a0b1\u9700\u8981\u7b49\u5f85\u67d0\u4e2a\u6761\u4ef6\u7684\u65f6\u5019,\u5c31\u53bb\u6267\u884c",(0,l.kt)("inlineCode",{parentName:"li"},"condition.await()"),"\u65b9\u6cd5\uff0c\u4e00\u65e6\u6267\u884c\u4e86await()\u540e\u7ebf\u7a0b\u5c31\u4f1a\u8fdb\u5165\u963b\u585e\u72b6\u6001"),(0,l.kt)("li",{parentName:"ul"},"\u7136\u540e\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u5b8c\u4efb\u52a1\u540e\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"condition.signal()"),"\u65b9\u6cd5,\u7136\u540ejvm\u4f1a\u4ece\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\u4e2d\u627e\u5230\u7b49\u5f85\u8be5condition\u7684\u7ebf\u7a0b,\u5f53\u7ebf\u7a0b1\u6536\u5230\u53ef\u6267\u884c\u7684\u4fe1\u53f7\u65f6\uff0c\u5b83\u7684\u7ebf\u7a0b\u72b6\u6001\u53c8\u4f1a\u53d8\u6210 Runnable \u53ef\u6267\u884c\u72b6\u6001"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Condition\u6ce8\u610f\u70b9"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8c03\u7528await\u65b9\u6cd5\u65f6\u4f1a\u81ea\u52a8\u91ca\u653e\u6301\u6709\u7684Lock\u9501(\u5373",(0,l.kt)("font",{color:"red"},"\u8c03\u7528await\u65b9\u6cd5\u5fc5\u987b\u6301\u6709\u9501")," )"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"signal\u4e0esignalAll"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"signalAll \u4f1a\u5524\u8d77\u6240\u6709\u7684\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"signal\u662f\u516c\u5e73\u7684\uff0c\u53ea\u4f1a\u5524\u8d77\u7b49\u5f85\u65f6\u95f4\u6700\u957f\u7684\u7ebf\u7a0b"))))),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(48606).Z,width:"826",height:"536"})),(0,l.kt)("h3",{id:"\u57fa\u672c\u793a\u4f8b"},"\u57fa\u672c\u793a\u4f8b"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Condition\u7684\u7b80\u5355\u7528\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>Condition\u7684\u57fa\u672c\u7528\u6cd5</b>\n *\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class ConditionDemo1 {\n    static ReentrantLock lock = new ReentrantLock();\n    static Condition condition = lock.newCondition();\n\n    public static void main(String[] args) throws InterruptedException {\n        new  Thread(() -> {\n            try {\n                // \u6dfb\u52a0\u7b49\u5f85\u65f6\u95f4\u4fdd\u8bc1 signal\u5728await\u4e4b\u540e\u6267\u884c\n                TimeUnit.SECONDS.sleep(1);\n                lock.lock();\n                System.out.println("\u5524\u9192\u5176\u4ed6\u7ebf\u7a0b");\n                condition.signal();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                lock.unlock();\n            }\n        }).start();\n        new Thread(() -> {\n            try {\n                lock.lock();\n                System.out.println("\u6761\u4ef6\u4e0d\u6ee1\u8db3,\u5f00\u59cbawait\u7b49\u5f85");\n                condition.await();\n                System.out.println("\u6761\u4ef6\u6ee1\u8db3,\u5f00\u59cb\u6267\u884c\u4efb\u52a1");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                lock.unlock();\n            }\n            System.out.println("");\n        }).start();\n    }\n}\n\n')),(0,l.kt)("h3",{id:"\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u793a\u4f8b"},"\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u793a\u4f8b"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5f53\u5b58\u50a8\u961f\u5217\u4e2d\u6709\u6570\u636e,\u901a\u77e5\u6d88\u8d39\u8005\u6d88\u8d39\u6570\u636e\u3002\u5f53\u5b58\u50a8\u6ca1\u6709\u6570\u636e\uff0c\u901a\u77e5\u751f\u4ea7\u8005\u751f\u4ea7\u6570\u636e\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u5f0f</b>\n *\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class ConditionDemo3 {\n    // \u5b9a\u4e49\u961f\u5217\u957f\u5ea6\n    private static final int queueSize = 20;\n    // \u5b58\u50a8\u961f\u5217\n    private static ArrayBlockingQueue<Integer> store = new ArrayBlockingQueue<>(queueSize);\n\n    private static ReentrantLock lock = new ReentrantLock();\n    // \u751f\u4ea7\u7684\u6761\u4ef6\n    private static Condition produce = lock.newCondition();\n    // \u6d88\u8d39\u7684\u6761\u4ef6\n    private static Condition consume = lock.newCondition();\n\n    // \u6d88\u8d39\u8005\n    static class Consumer implements Runnable{\n        @SneakyThrows\n        @Override\n        public void run() {\n            for (;;) {\n                try {\n                    lock.lock();\n                    while(store.size() == 0) {\n                        System.out.println(Thread.currentThread().getName()+":\u961f\u5217\u6ca1\u6709\u6570\u636e,\u7b49\u5f85");\n                        consume.await();\n                    }\n                    Integer res = store.take();\n                    produce.signal();\n                    System.out.println(Thread.currentThread().getName()+"\u83b7\u53d6\u5230\u4e86\u961f\u5217\u7684\u6570\u636e:"+res);\n                }finally {\n                    lock.unlock();\n                }\n            }\n        }\n    }\n    // \u751f\u4ea7\u8005\n    static class Producer implements Runnable{\n\n        @SneakyThrows\n        @Override\n        public void run() {\n            for (;;) {\n                try {\n                    lock.lock();\n                    while(store.size() == queueSize) {\n                        System.out.println("\u961f\u5217\u6570\u636e\u6ee1\u4e86,\u7b49\u5f85\u6d88\u8d39");\n                        produce.await();\n                    }\n                    store.put((int) (Math.random()*1000));\n                    consume.signalAll();\n                    System.out.println("\u5411\u961f\u5217\u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e,\u5269\u4f59\u7a7a\u95f4:"+(queueSize-store.size()));\n                }finally {\n                    lock.unlock();\n                }\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        Producer producer = new Producer();\n        Consumer consumer1 = new Consumer();\n        Consumer consumer2 = new Consumer();\n\n        new Thread(producer).start();\n        new Thread(consumer1,"consumer1").start();\n        new Thread(consumer2,"consumer2").start();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(6218).Z,width:"431",height:"607"})),(0,l.kt)("h2",{id:"cyclicbarrier\u7ec4\u961f\u7a81\u7834"},"CyclicBarrier\u3010\u7ec4\u961f\u7a81\u7834\u3011"),(0,l.kt)("h3",{id:"\u6982\u8ff0-4"},"\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5141\u8bb8\u4e00\u7ec4\u7ebf\u7a0b\u4e92\u76f8\u7b49\u5f85\uff0c\u76f4\u5230\u6240\u6709\u7ebf\u7a0b\u90fd\u5230\u8fbe\u516c\u5171\u6805\u680f\u70b9 (\u540c\u6b65\u70b9)\uff0c\u5c4f\u969c\u624d\u4f1a\u6253\u5f00\uff0c\u6240\u6709\u88ab\u5c4f\u969c\u62e6\u622a\u7684\u7ebf\u7a0b\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\xa0"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5c4f\u969c\u6253\u5f00\u540e\u4f1a\u901a\u8fc7notify\u901a\u77e5\u7684\u65b9\u5f0f\u5524\u9192\u7b49\u5f85\u7684\u7ebf\u7a0b\u7ee7\u7eed\u540e\u7eed\u7684\u5904\u7406"),(0,l.kt)("li",{parentName:"ul"},"\u5728\u6d89\u53ca\u4e00\u7ec4\u56fa\u5b9a\u5927\u5c0f\u7684\u7ebf\u7a0b\u7684\u7a0b\u5e8f\u4e2d\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u5fc5\u987b\u4e0d\u65f6\u5730\u4e92\u76f8\u7b49\u5f85\u3002\u56e0\u4e3aCylinderBarrier \u5728\u91ca\u653e\u7b49\u5f85\u7ebf\u7a0b\u540e\u53ef\u4ee5\u91cd\u7528\uff0c\u6240\u4ee5\u79f0\u5b83\u4e3a ",(0,l.kt)("strong",{parentName:"li"},"\u5faa\u73af\u7684barrier")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u7279\u70b9")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u652f\u6301\u4e00\u4e2a\u53ef\u9009\u7684 Runnable \u547d\u4ee4\uff0c\u5728\u4e00\u7ec4\u7ebf\u7a0b\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u7ebf\u7a0b\u5230\u8fbe\u4e4b\u540e\uff08\u4f46\u5728\u91ca\u653e\u6240\u6709\u7ebf\u7a0b\u4e4b\u524d\uff0c\u6b64\u65f6\u6240\u6709\u7ebf\u7a0b\u8fd8\u5904\u4e8eawait\u72b6\u6001\uff09\uff0c\u8be5\u547d\u4ee4\u53ea\u5728\u6bcf\u4e2a\u5c4f\u969c\u70b9\u8fd0\u884c\u4e00\u6b21")),(0,l.kt)("li",{parentName:"ul"},"\u76f8\u5bf9\u4e8eCountDownLatch\u662f\u53ef\u91cd\u7f6e\u7684"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u9002\u5408\u573a\u666f"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5f53\u6709\u5927\u91cf\u7684\u7ebf\u7a0b\u9700\u8981\u76f8\u4e92\u914d\u5408\uff0c\u5e76\u4e14\u5728\u6700\u540e\u9700\u8981",(0,l.kt)("strong",{parentName:"li"},"\u7edf\u4e00\u6c47\u603b"),"\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528 CyclicBarrier"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"CountDownLatch \u4e0e CyclicBarrier")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4f5c\u7528\u4e0d\u4e00\u6837"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"CyclicBarrier\u662f\u7b49\u5f85\u56fa\u5b9a\u6570\u91cf\u7ebf\u7a0b\u5230\u8fbe\u540e\uff0c\u4e00\u8d77\u7a81\u7834\u5c4f\u969c ->",(0,l.kt)("font",{color:"red"},"\u7528\u4e8e\u7ebf\u7a0b")),(0,l.kt)("li",{parentName:"ul"},"CountDownLatch\u662f\u5012\u8ba1\u65f6\uff0c\u53ea\u8981countDown\u5230\u4e0d\u5927\u4e8e0\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5f80\u4e0b\u8d70 -> ",(0,l.kt)("font",{color:"red"},"\u7528\u4e8e\u4e8b\u4ef6")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u53ef\u91cd\u7528\u6027\u4e0d\u4e00\u6837"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"CyclicBarrier \u662f\u53ef\u91cd\u7528\u7684\uff0c\u800cCountDownLatch\u65e0\u6cd5\u91cd\u7528")))))),(0,l.kt)("h3",{id:"\u5e38\u89c1\u7684\u65b9\u6cd5-2"},"\u5e38\u89c1\u7684\u65b9\u6cd5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"CyclicBarrier(int parties, [Runnable barrierAction])"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"parties:  \u5728\u542f\u52a8 barrier \u524d\u5fc5\u987b\u8c03\u7528 await() \u7684\u7ebf\u7a0b\u6570"),(0,l.kt)("li",{parentName:"ul"},"barrierAction: \u5728\u542f\u52a8 barrier \u65f6\u6267\u884c\u7684\u547d\u4ee4\uff1b\u5982\u679c\u4e0d\u6267\u884c\u4efb\u4f55\u64cd\u4f5c\uff0c\u5219\u8be5\u53c2\u6570\u4e3a null"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"await([long timeout, TimeUnit unit])"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5728\u6240\u6709\u53c2\u4e0e\u8005\u90fd\u5df2\u7ecf\u5728\u6b64\u5c4f\u969c\u4e0a\u8c03\u7528 await() \u65b9\u6cd5\u4e4b\u524d\u5c06\u4e00\u76f4\u7b49\u5f85,\u6216\u8005\u8d85\u51fa\u4e86\u6307\u5b9a\u7684\u7b49\u5f85\u65f6\u95f4"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"getNumberWaiting()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u5f53\u524d\u5728\u5c4f\u969c\u5904\u7b49\u5f85\u7684\u53c2\u4e0e\u8005\u6570\u76ee"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"getParties()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u8981\u6c42\u542f\u52a8\u6b64 barrier \u7684\u53c2\u4e0e\u8005\u6570\u76ee"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"isBroken()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u67e5\u8be2\u6b64\u5c4f\u969c\u662f\u5426\u5904\u4e8e\u635f\u574f\u72b6\u6001"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"reset()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5c06\u5c4f\u969c\u91cd\u7f6e\u4e3a\u5176\u521d\u59cb\u72b6\u6001 -> \u4e00\u6279\u7ebf\u7a0b\u5904\u7406\u5b8c\u6210\u4e4b\u540e\uff0c\u6253\u5f00\u5c4f\u969c\u3002\u7136\u540e\u53e6\u5916\u4e00\u6279\u7ebf\u7a0b\u5904\u7406\u5b8c\u6210\u4e4b\u540e\uff0c\u6253\u5f00\u5c4f\u969c\uff0c\u5f80\u590d\u5faa\u73af")))),(0,l.kt)("h3",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u6ee1\u8db3\u4e86\u7a81\u7834\u5faa\u73af\u6805\u680f\u9700\u8981\u7684\u7ebf\u7a0b\u6570\u540e\uff0c\u5148\u6267\u884c\u7a81\u7834\u5c4f\u969c\u524d\u7684\u6700\u540e\u5904\u7406\u52a8\u4f5c(\u6b64\u65f6\u7ebf\u7a0b\u8fd8\u5728await\u7b49\u5f85),\u6267\u884c\u5b8c\u4e86\u4e4b\u540e\u6bcf\u4e2a\u7ebf\u7a0b\u518d\u6267\u884cawait\u540e\u9762\u7684\u65b9\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class CyclicBarrierDemo1 {\n    private static final Logger log = LoggerFactory.getLogger(CyclicBarrierDemo1.class);\n    private static CyclicBarrier BARRIER;\n    // \u7a81\u7834\u5faa\u73af\u6805\u680f\u9700\u8981\u7684\u7ebf\u7a0b\u6570\n    private static final Integer THREAD_COUNT = 5;\n    // \u7a81\u7834\u5c4f\u969c\u524d\u7684\u6700\u540e\u5904\u7406\u52a8\u4f5c\u662f\u4ec0\u4e48\n    private static final Runnable finalAction = () -> {\n        log.info("\u6240\u6709\u7684\u7ebf\u7a0b\u7684\u4efb\u52a1\u90fd\u5df2\u7ecf\u5904\u7406\u5b8c\u6210,\u5f00\u59cb\u91cd\u7f6e\u5c4f\u969c");\n        log.info("\u76ee\u524d\u8fd8\u6709{}\u4e2a\u7ebf\u7a0b\u5728\u5c4f\u969c\u524d\u7b49\u5f85",BARRIER.getNumberWaiting());\n    };\n    static {\n        BARRIER= new CyclicBarrier(THREAD_COUNT, finalAction);\n    }\n\n    public static void main(String[] args) {\n        ThreadPoolExecutor executor = new ThreadPoolExecutor(\n                5,\n                5,\n                60L, TimeUnit.SECONDS,\n                new ArrayBlockingQueue<>(20));\n        // \u7ebf\u7a0b\u6c60\u542f\u52a8\u7684\u65f6\u5019\u5c31\u521b\u5efa\u6838\u5fc3\u7ebf\u7a0b\n        executor.prestartAllCoreThreads();\n        for (int i = 1; i <= 20; i++) {\n            executor.execute(() -> {\n                try {\n                    log.warn("\u7ebf\u7a0b[{}]\u5f00\u59cb\u6267\u884c\u4efb\u52a1",Thread.currentThread().getId());\n                    TimeUnit.MILLISECONDS.sleep((long)(Math.random()*1000));\n                    BARRIER.await();\n                    log.warn("\u7ebf\u7a0b[{}]\u6267\u884c\u5b8c\u6210",Thread.currentThread().getId());\n                } catch (InterruptedException | BrokenBarrierException e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n    }\n\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(9618).Z,width:"1082",height:"415"})))}c.isMDXComponent=!0},34142:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211120140749553-c9632d7986a6f0c513e96c6dedd79caa.png"},35031:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211120144130403-6ac48d51713d7ca382f18447711f71e9.png"},4736:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211120145423237-b56d64bd9cd765b2d0073e1313a23793.png"},42991:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211120153248833-90d9998c290de65733be426b16b0e024.png"},48606:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211121191515796-9762dc2cf90c866911a7e4e9bebbc4d2.png"},6218:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211123211828206-d9a5e72fe2f9ce56389a5d04143b5419.png"},9618:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211124200052989-9fddcad7b567f0d2117c60c7645908c2.png"}}]);