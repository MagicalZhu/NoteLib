"use strict";(self.webpackChunkhuakucha=self.webpackChunkhuakucha||[]).push([[8493],{42359:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>m,default:()=>N,frontMatter:()=>r,metadata:()=>l,toc:()=>k});var n=a(87462),i=(a(67294),a(3905));a(61839);const r={id:"MVCC",title:"\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236"},m=void 0,l={unversionedId:"Mysql/\u9ad8\u7ea7\u7279\u6027/MVCC",id:"Mysql/\u9ad8\u7ea7\u7279\u6027/MVCC",title:"\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236",description:"\u4e3a\u4e86\u4fdd\u8bc1\u5e76\u53d1\u4e8b\u52a1\u4e0b,\u89e3\u51b3\u8bfb-\u5199\u64cd\u4f5c\u4e0b\u7684\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u7684\u5e76\u53d1\u95ee\u9898,MySQL \u7684 InnoDB \u53ef\u4ee5\u52a0\u9501,\u540c\u65f6\u4e5f\u5f15\u5165\u4e86 MVCC(Multiversion Concurrency Control)\u6765\u63d0\u5347\u5e76\u53d1\u6027\u80fd, \u4e5f\u5c31\u662f\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\u3002",source:"@site/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/MVCC.md",sourceDirName:"Mysql/\u9ad8\u7ea7\u7279\u6027",slug:"/Mysql/\u9ad8\u7ea7\u7279\u6027/MVCC",permalink:"/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/MVCC",draft:!1,editUrl:"https://github.com/MagicalZhu/NoteLib/tree/main/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/MVCC.md",tags:[],version:"current",lastUpdatedBy:"YuLiang Zhu",lastUpdatedAt:1670289592,formattedLastUpdatedAt:"2022\u5e7412\u67086\u65e5",frontMatter:{id:"MVCC",title:"\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236"},sidebar:"mysqlSideBar",previous:{title:"\u9501\u673a\u5236",permalink:"/docs/Mysql/\u9ad8\u7ea7\u7279\u6027/\u9501"},next:{title:"\u8fd0\u7ef4",permalink:"/docs/category/\u8fd0\u7ef4"}},p={},k=[{value:"\u4ec0\u4e48\u662f MVCC",id:"\u4ec0\u4e48\u662f-mvcc",level:2},{value:"\u5feb\u7167\u8bfb\u4e0e\u5f53\u524d\u8bfb",id:"\u5feb\u7167\u8bfb\u4e0e\u5f53\u524d\u8bfb",level:2},{value:"\u5feb\u7167\u8bfb",id:"\u5feb\u7167\u8bfb",level:3},{value:"\u5f53\u524d\u8bfb",id:"\u5f53\u524d\u8bfb",level:3},{value:"\u9694\u79bb\u7ea7\u522b\u4e0e MVCC",id:"\u9694\u79bb\u7ea7\u522b\u4e0e-mvcc",level:2},{value:"MySQL \u9694\u79bb\u7ea7\u522b",id:"mysql-\u9694\u79bb\u7ea7\u522b",level:3},{value:"\u9690\u85cf\u5b57\u6bb5\u4e0e Undo\u65e5\u5fd7\u7248\u672c\u94fe",id:"\u9690\u85cf\u5b57\u6bb5\u4e0e-undo\u65e5\u5fd7\u7248\u672c\u94fe",level:3},{value:"ReadView",id:"readview",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:4},{value:"\u8bbe\u8ba1\u601d\u8def",id:"\u8bbe\u8ba1\u601d\u8def",level:3},{value:"ReadView \u89c4\u5219",id:"readview-\u89c4\u5219",level:3},{value:"MVCC\u6574\u4f53\u64cd\u4f5c\u6d41\u7a0b",id:"mvcc\u6574\u4f53\u64cd\u4f5c\u6d41\u7a0b",level:3},{value:"ReadView \u751f\u6210\u65f6\u673a",id:"readview-\u751f\u6210\u65f6\u673a",level:3},{value:"Read Committed",id:"read-committed",level:4},{value:"Repeatable Read",id:"repeatable-read",level:4},{value:"\u89e3\u51b3\u5e7b\u8bfb",id:"\u89e3\u51b3\u5e7b\u8bfb",level:3}],o={toc:k};function N(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},o,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u4e3a\u4e86\u4fdd\u8bc1\u5e76\u53d1\u4e8b\u52a1\u4e0b,\u89e3\u51b3\u8bfb-\u5199\u64cd\u4f5c\u4e0b\u7684\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u7684\u5e76\u53d1\u95ee\u9898,MySQL \u7684 InnoDB \u53ef\u4ee5\u52a0\u9501,\u540c\u65f6\u4e5f\u5f15\u5165\u4e86 MVCC(Multiversion Concurrency Control)\u6765\u63d0\u5347\u5e76\u53d1\u6027\u80fd, \u4e5f\u5c31\u662f\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\u3002"),(0,i.kt)("p",{parentName:"blockquote"},"MVCC \u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8e",(0,i.kt)("strong",{parentName:"p"},"\u9690\u85cf\u5b57\u6bb5\u3001Undo \u65e5\u5fd7\u548c ReadView"))),(0,i.kt)("h2",{id:"\u4ec0\u4e48\u662f-mvcc"},"\u4ec0\u4e48\u662f MVCC"),(0,i.kt)("p",null,"MVCC \u662f\u901a\u8fc7 ",(0,i.kt)("strong",{parentName:"p"},"\u7ba1\u7406\u6570\u636e\u884c\u7684\u591a\u4e2a\u7248\u7406\u6765\u5b9e\u73b0\u6570\u636e\u5e93\u7684\u5e76\u53d1\u63a7\u5236"),", \u5229\u7528 MVCC \u53ef\u4ee5\u4fdd\u8bc1\u5728 InnoDB \u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e0b\u6267\u884c ",(0,i.kt)("strong",{parentName:"p"},"\u4e00\u81f4\u6027\u8bfb"),"\u64cd\u4f5c\u3002"),(0,i.kt)("p",null,"\u4e5f\u5c31\u662f\u8bf4: ",(0,i.kt)("strong",{parentName:"p"},"\u4e3a\u4e86\u67e5\u8be2\u4e00\u4e9b\u6b63\u5728\u88ab\u53e6\u4e00\u4e2a\u4e8b\u52a1\u66f4\u65b0\u7684\u884c, \u5e76\u4e14\u53ef\u4ee5\u770b\u5230\u5b83\u4eec\u88ab\u66f4\u65b0\u4e4b\u524d\u7684\u503c\uff0c\u8fd9\u6837\u5728\u505a\u67e5\u8be2\u7684\u65f6\u5019\u5c31\u4e0d\u7528\u7b49\u5f85\u53e6\u4e00\u4e2a\u4e8b\u52a1\u91ca\u653e\u9501")),(0,i.kt)("admonition",{title:"\u62d3\u5c55\u8bf4\u660e",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"MVCC \u6ca1\u6709\u6b63\u5f0f\u7684\u6807\u51c6,\u6240\u4ee5\u5728\u4e0d\u540c\u7684 DBMS \u4e0a\u4e5f\u6709\u4e0d\u540c\u7684\u5b9e\u73b0,\u4e5f\u4e0d\u662f\u666e\u901a\u4f7f\u7528\u7684"),(0,i.kt)("p",{parentName:"admonition"},"MVCC\u7684\u4e24\u79cd\u4e0d\u540c\u5b9e\u73b0\u65b9\u5f0f:"),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u5c06\u6570\u636e\u8bb0\u5f55\u7684\u591a\u4e2a\u7248\u672c\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u4e2d,\u5f53\u8fd9\u4e9b\u4e0d\u540c\u7248\u672c\u6570\u636e\u4e0d\u518d\u9700\u8981\u65f6,\u5783\u573e\u6536\u96c6\u5668\u56de\u6536\u8fd9\u4e9b\u8bb0\u5f55"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u8fd9\u4e2a\u65b9\u5f0f\u88abPostgreSQL\u548cFirebird/Interbase\u91c7\u7528"),(0,i.kt)("li",{parentName:"ul"},"Sql Server\u4f7f\u7528\u7684\u7c7b\u4f3c\u673a\u5236, \u4e0d\u540c\u7684\u662f\u65e7\u7248\u672c\u6570\u636e\u4e0d\u662f\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u4e2d, \u800c\u662f\u4fdd\u5b58\u5728\u4e0d\u540c\u4e8e\u4e3b\u6570\u636e\u5e93\u7684\u53e6\u5916\u4e00\u4e2a\u6570\u636e\u5e93",(0,i.kt)("em",{parentName:"li"},"tempdb"),"\u4e2d"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u53ea\u5728\u6570\u636e\u5e93\u4fdd\u5b58\u6700\u65b0\u7248\u672c\u7684\u6570\u636e\uff0c\u4f46\u662f\u4f1a\u5728\u4f7f\u7528undo\u65f6\u52a8\u6001\u91cd\u6784\u65e7\u7248\u672c\u6570\u636e"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u8fd9\u79cd\u65b9\u5f0f\u88abOracle\u548cMySQL/InnoDB\u4f7f\u7528"))))),(0,i.kt)("h2",{id:"\u5feb\u7167\u8bfb\u4e0e\u5f53\u524d\u8bfb"},"\u5feb\u7167\u8bfb\u4e0e\u5f53\u524d\u8bfb"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u5feb\u7167\u8bfb")," ",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"MVCC\u5728 MySQL InnoDB\u4e2d\u7684\u5b9e\u73b0\u4e3b\u8981\u662f",(0,i.kt)("strong",{parentName:"li"},"\u4e3a\u4e86\u63d0\u9ad8\u6570\u636e\u5e93\u5e76\u53d1\u6027\u80fd"),"\uff0c\u7528\u66f4\u597d\u7684\u65b9\u5f0f\u53bb\u5904\u7406",(0,i.kt)("inlineCode",{parentName:"li"},"\u8bfb-\u5199\u51b2\u7a81"),"\uff0c\u505a\u5230\u5373\u4f7f\u6709\u8bfb\u5199\u51b2\u7a81\u65f6\uff0c\u4e5f\u80fd\u505a\u5230\u4e0d\u52a0\u9501\uff0c\u975e\u963b\u585e\u5e76\u53d1\u8bfb\uff0c\u800c\u8fd9\u4e2a\u8bfb\u6307\u7684\u5c31\u662f",(0,i.kt)("inlineCode",{parentName:"li"},"\u5feb\u7167\u8bfb"),",\u800c\u975e\u5f53\u524d\u8bfb "))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u5f53\u524d\u8bfb")," ",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u5b9e\u9645\u4e0a\u662f\u4e00\u79cd\u52a0\u9501\u7684\u64cd\u4f5c,\u662f\u60b2\u89c2\u9501\u7684\u5b9e\u73b0"),"\u3002\u800cMVCC\u672c\u8d28\u662f\u91c7\u7528\u4e50\u89c2\u9501\u601d\u60f3\u7684\u4e00\u79cd\u65b9\u5f0f")))),(0,i.kt)("h3",{id:"\u5feb\u7167\u8bfb"},"\u5feb\u7167\u8bfb"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e5f\u53eb\u505a",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e00\u81f4\u6027\u8bfb"),",\u8bfb\u53d6\u7684\u662f",(0,i.kt)("inlineCode",{parentName:"p"},"\u5feb\u7167\u6570\u636e"),",\u800c\u4e0d\u662f\u5f53\u524d\u7684\u6570\u636e\u3002",(0,i.kt)("strong",{parentName:"p"},"\u4e0d\u52a0\u9501\u7684\u7b80\u5355\u7684 Select \u90fd\u5c5e\u4e8e\u5feb\u7167\u8bfb, \u5373\u4e0d\u52a0\u9501\u7684\u975e\u963b\u585e\u8bfb")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6bd4\u5982:\nselect * from player where ...\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e4b\u6240\u4ee5\u4f7f\u7528\u5feb\u7167\u8bfb,\u662f\u4e3a\u4e86\u63d0\u9ad8\u5e76\u53d1\u6027\u80fd\u3002\u5feb\u7167\u8bfb\u662f",(0,i.kt)("strong",{parentName:"p"},"\u57fa\u4e8e MVCC")," \u7684,\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86",(0,i.kt)("strong",{parentName:"p"},"\u52a0\u9501\u7684\u64cd\u4f5c"),",\u964d\u4f4e\u7684\u5f00\u9500")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u7531\u4e8e\u662f\u591a\u7248\u672c,\u90a3\u4e48\u5feb\u7167\u8bfb\u53ef\u80fd\u8bfb\u5230\u7684\u4e0d\u4e00\u5b9a\u662f\u6700\u65b0\u7684\u6570\u636e,\u800c\u662f\u5386\u53f2\u6570\u636e")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u80fd\u591f\u4f7f\u7528\u5feb\u7167\u8bfb\u7684\u57fa\u672c\u6761\u4ef6\u662f: \u9694\u79bb\u7ea7\u522b\u4e0d\u662f\u4e32\u884c\u5316,\u4e32\u884c\u5316\u7684\u5feb\u7167\u8bfb\u4f1a\u9000\u5316\u4e3a\u5f53\u524d\u8bfb")))),(0,i.kt)("h3",{id:"\u5f53\u524d\u8bfb"},"\u5f53\u524d\u8bfb"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5f53\u524d\u8bfb\u8bfb\u53d6\u7684\u662f\u8bb0\u5f55\u662f\u6700\u65b0\u7248\u672c(\u6700\u65b0\u6570\u636e,\u800c\u4e0d\u662f\u5386\u53f2\u7248\u672c\u6570\u636e),",(0,i.kt)("strong",{parentName:"p"},"\u8bfb\u53d6\u7684\u65f6\u5019\u8fd8\u9700\u8981\u4fdd\u8bc1\u5176\u4ed6\u5e76\u53d1\u7684\u4e8b\u52a1\u4e0d\u80fd\u4fee\u6539\u5f53\u524d\u7684\u8bb0\u5f55,\u6240\u4ee5\u4f1a\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u9501"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u52a0\u9501\u7684 SELECT\u3001\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\u90fd\u4f1a\u8fdb\u884c\u5f53\u524d\u8bfb"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6bd4\u5982:\n\n# S\u9501\nselect * from player lock in share mode;  \n\n# X \u9501\nselect * from player for update;\ninsert into player(...) values ...;\ndelete from player where ...;\nupdate player set ...;\n\n")))),(0,i.kt)("h2",{id:"\u9694\u79bb\u7ea7\u522b\u4e0e-mvcc"},"\u9694\u79bb\u7ea7\u522b\u4e0e MVCC"),(0,i.kt)("h3",{id:"mysql-\u9694\u79bb\u7ea7\u522b"},"MySQL \u9694\u79bb\u7ea7\u522b"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("img",{alt:"image-20220912122311625",src:a(49500).Z,width:"1996",height:"1036"})),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"blockquote"},"\u6211\u4eec\u77e5\u9053,SQL\u6709\u56db\u79cd\u9694\u79bb\u7ea7\u522b:",(0,i.kt)("em",{parentName:"p"},"Read Uncommitted\u3001Read Committed\u3001Repeatable Read\u3001Serializable"),",\u5206\u522b\u80fd\u5904\u7406\u56db\u79cd\u4e8b\u52a1\u5e76\u53d1\u95ee\u9898:",(0,i.kt)("em",{parentName:"p"},"\u810f\u5199\u3001\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb"))),(0,i.kt)("p",null,"\u5728 MySQL \u4e2d,\u9ed8\u8ba4\u7684\u9694\u79bb\u7ea7\u522b\u662f",(0,i.kt)("inlineCode",{parentName:"p"},"repeatable read [\u53ef\u91cd\u590d\u8bfb]"),", \u53ef\u4ee5\u89e3\u51b3",(0,i.kt)("strong",{parentName:"p"},"\u810f\u8bfb\u548c\u4e0d\u53ef\u91cd\u590d\u8bfb"),"\u7684\u95ee\u9898\u3002\u4eceSQL \u6807\u51c6\u4e0a\u6765\u8bf4,\u8be5\u9694\u79bb\u7ea7\u522b\u65e0\u6cd5\u5904\u7406",(0,i.kt)("inlineCode",{parentName:"p"},"\u5e7b\u8bfb"),"\u7684\u95ee\u9898,\u5982\u679c\u9700\u8981\u5904\u7406\u5e7b\u8bfb\u7684\u95ee\u9898,\u9700\u8981\u63d0\u9ad8\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b,\u4e5f\u5c31\u662f\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"serializable [\u4e32\u884c\u5316]"),"\u7684\u9694\u79bb\u7ea7\u522b,\u4f46\u662f",(0,i.kt)("strong",{parentName:"p"},"\u4f1a\u964d\u4f4e\u4e8b\u52a1\u7684\u5e76\u53d1\u80fd\u529b")),(0,i.kt)("p",null,"MySQL \u4e2d InnoDB \u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"MVCC \u673a\u5236"),"\u53ef\u4ee5\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e0d\u52a0\u9501"),"(\u4e0d\u4f7f\u7528\u60b2\u89c2\u9501)\u7684\u60c5\u51b5\u4e0b,\u800c\u662f\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e50\u89c2\u9501"),"\u7684\u65b9\u5f0f\u89e3\u51b3",(0,i.kt)("strong",{parentName:"p"},"\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u7684\u95ee\u9898"),", MVCC \u5728\u5927\u591a\u6570\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4ee3\u66ff\u52a0\u9501\u7684\u65b9\u5f0f,\u4ece\u800c\u964d\u4f4e\u52a0\u9501\u5e26\u6765\u7684\u7cfb\u7edf\u5f00\u9500"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"image-20220912122952956",src:a(94520).Z,width:"2260",height:"804"})),(0,i.kt)("h3",{id:"\u9690\u85cf\u5b57\u6bb5\u4e0e-undo\u65e5\u5fd7\u7248\u672c\u94fe"},"\u9690\u85cf\u5b57\u6bb5\u4e0e Undo\u65e5\u5fd7\u7248\u672c\u94fe"),(0,i.kt)("p",null,"\u6211\u4eec\u77e5\u9053 InnoDB \u6bcf\u4e2a\u6570\u636e\u9875\u7684",(0,i.kt)("strong",{parentName:"p"},"\u805a\u7c07\u7d22\u5f15"),"\u7684\u8bb0\u5f55\u4e2d\u4e00\u5b9a\u5305\u542b\u4e0b\u9762",(0,i.kt)("a",{parentName:"p",href:"InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84#%E8%AE%B0%E5%BD%95%E7%9A%84%E7%9C%9F%E5%AE%9E%E6%95%B0%E6%8D%AE"},"\u4e24\u4e2a\u9690\u85cf\u5b57\u6bb5:ROW_TRX_ID\u3001ROW_ROLL_PTR")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"row_trx_id")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u6700\u8fd1\u4e00\u6b21\u66f4\u65b0\u8be5\u8bb0\u5f55\u7684\u4e8b\u52a1 ID"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e00\u4e2a\u4e8b\u52a1\u6bcf\u6b21\u5bf9\u67d0\u6761\u805a\u7c07\u7d22\u5f15\u7684\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\u65f6,\u90fd\u4f1a\u5c06\u8be5\u4e8b\u52a1\u7684 \u4e8b\u52a1ID \u8d4b\u503c\u7ed9 ",(0,i.kt)("em",{parentName:"p"},"row_trx_id"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"row_roll_ptr")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u56de\u6eda\u6307\u9488"),",\u901a\u8fc7\u56de\u6eda\u6307\u9488\u53ef\u4ee5\u5c06\u591a\u4e2a undo \u65e5\u5fd7\u4ee5\u94fe\u8868\u7684\u65b9\u5f0f\u8fde\u63a5\u8d77\u6765"),(0,i.kt)("li",{parentName:"ul"},"\u6bcf\u6b21\u5bf9\u67d0\u6761\u805a\u7c07\u7d22\u5f15\u7684\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\u65f6,\u90fd\u4f1a\u628a\u5c31\u5f97\u7248\u672c\u5199\u5165\u5230 undo \u65e5\u5fd7\u4e2d, \u8fd9\u4e2a\u9690\u85cf\u5217\u5c31\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a",(0,i.kt)("strong",{parentName:"li"},"\u6307\u9488"),",\u901a\u8fc7\u5b83\u53ef\u4ee5",(0,i.kt)("strong",{parentName:"li"},"\u627e\u5230\u8be5\u8bb0\u5f55\u4fee\u6539\u524d\u7684\u503c"))))),(0,i.kt)("admonition",{title:"\u7248\u672c\u94fe\u793a\u4f8b",type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u5047\u8bbe\u6211\u4eec\u6709\u8868 hero,\u91cc\u9762\u7684\u6570\u636e\u5982\u4e0b:")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT * FROM hero;\n+--------+--------+---------+\n| number | name   | country |\n+--------+--------+---------+\n|      1 | \u5218\u5907   | \u8700      |\n+--------+--------+---------+\n1 row in set (0.07 sec)\n")),(0,i.kt)("p",{parentName:"admonition"},"\u5047\u8bbe\u9700\u8981\u63d2\u5165\u4e00\u6761\u65b0\u7684\u8bb0\u5f55,\u4e14\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e8b\u52a1id"),"\u4e3a",(0,i.kt)("inlineCode",{parentName:"p"},"80"),"\uff0c\u90a3\u4e48\u6b64\u523b\u8be5\u6761\u8bb0\u5f55\u7684\u793a\u610f\u56fe\u5982\u4e0b\u6240\u793a\uff1a"),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{alt:"image-20220912131522458",src:a(18349).Z,width:"1286",height:"490"})),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},"\u5047\u8bbe\u4e4b\u540e\u4e24\u4e2a",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e8b\u52a1id"),"\u5206\u522b\u4e3a",(0,i.kt)("inlineCode",{parentName:"p"},"100"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"200"),"\u7684\u4e8b\u52a1\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c",(0,i.kt)("inlineCode",{parentName:"p"},"UPDATE"),"\u64cd\u4f5c\uff0c\u64cd\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a\n",(0,i.kt)("img",{alt:"image-20220912132809438",src:a(28797).Z,width:"2220",height:"722"})),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},"\u6bcf\u6b21\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6539\u52a8,\u90fd\u4f1a\u8bb0\u5f55\u4e00\u6761",(0,i.kt)("inlineCode",{parentName:"p"},"undo\u65e5\u5fd7"),"\uff0c\u6bcf\u6761",(0,i.kt)("inlineCode",{parentName:"p"},"undo\u65e5\u5fd7"),"\u4e5f\u90fd\u6709\u4e00\u4e2a",(0,i.kt)("inlineCode",{parentName:"p"},"roll_pointer"),"\u5c5e\u6027\uff08",(0,i.kt)("inlineCode",{parentName:"p"},"INSERT"),"\u64cd\u4f5c\u5bf9\u5e94\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"undo\u65e5\u5fd7"),"\u6ca1\u6709\u8be5\u5c5e\u6027\uff0c\u56e0\u4e3a\u8be5\u8bb0\u5f55\u5e76\u6ca1\u6709\u66f4\u65e9\u7684\u7248\u672c\uff09\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e9b",(0,i.kt)("inlineCode",{parentName:"p"},"undo\u65e5\u5fd7"),"\u90fd\u8fde\u8d77\u6765\uff0c\u4e32\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u6240\u4ee5\u73b0\u5728\u7684\u60c5\u51b5\u5c31\u50cf\u4e0b\u56fe\u4e00\u6837\uff1a"),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{alt:"image-20220912133744003",src:a(53955).Z,width:"2042",height:"1104"})),(0,i.kt)("br",null),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"\u5bf9\u8be5\u8bb0\u5f55\u6bcf\u6b21\u66f4\u65b0\u540e\uff0c\u90fd\u4f1a\u5c06\u65e7\u503c\u653e\u5230\u4e00\u6761",(0,i.kt)("inlineCode",{parentName:"li"},"undo\u65e5\u5fd7"),"\u4e2d\uff0c\u5c31\u7b97\u662f\u8be5\u8bb0\u5f55\u7684\u4e00\u4e2a\u65e7\u7248\u672c\uff0c\u968f\u7740\u66f4\u65b0\u6b21\u6570\u7684\u589e\u591a\uff0c\u6240\u6709\u7684\u7248\u672c\u90fd\u4f1a\u88ab",(0,i.kt)("inlineCode",{parentName:"li"},"roll_pointer"),"\u5c5e\u6027\u8fde\u63a5\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u94fe\u8868\u79f0\u4e4b\u4e3a",(0,i.kt)("inlineCode",{parentName:"li"},"\u7248\u672c\u94fe"),"\uff0c\u7248\u672c\u94fe\u7684\u5934\u8282\u70b9\u5c31\u662f\u5f53\u524d\u8bb0\u5f55\u6700\u65b0\u7684\u503c"),(0,i.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a\u7248\u672c\u4e2d\u8fd8\u5305\u542b\u751f\u6210\u8be5\u7248\u672c\u65f6\u5bf9\u5e94\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"\u4e8b\u52a1id"))),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u8bf4\u660e")),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u5b9e\u9645\u4e0a insert undo \u53ea\u5728\u4e8b\u52a1\u56de\u6eda\u65f6\u8d77\u4f5c\u7528")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5f53\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0c\u8be5\u7c7b\u578b\u7684 undo \u65e5\u5fd7\u5c31\u6ca1\u7528\u4e86\uff0c\u5b83\u5360\u7528\u7684 Undo Log Segment \u4e5f\u4f1a\u88ab\u7cfb\u7edf\u56de\u6536")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e5f\u5c31\u662f\u8be5 undo \u65e5\u5fd7\u5360\u7528\u7684 Undo \u9875\u9762\u94fe\u8868\u8981\u4e48\u88ab\u91cd\u7528\uff0c\u8981\u4e48\u88ab\u91ca\u653e")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u4e0d\u80fd\u5728\u4e24\u4e2a\u4e8b\u52a1\u4e2d\u4ea4\u53c9\u7684\u66f4\u65b0\u540c\u4e00\u6761\u8bb0\u5f55,\u56e0\u4e3a X \u9501\u7684\u5b58\u5728"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("mark",null,"update\u4ea7\u751f\u7684 undo\u65e5\u5fd7\u4e2d\u53ea\u4f1a\u8bb0\u5f55\u4e00\u4e9b\u7d22\u5f15\u5217\u4ee5\u53ca\u88ab\u66f4\u65b0\u7684\u5217\u7684\u4fe1\u606f,\u800c\u4e0d\u662f\u6240\u6709\u5217\u7684\u4fe1\u606f\u3002"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u6bd4\u5982\u5bf9\u4e8e",(0,i.kt)("strong",{parentName:"li"},"trx_id=80"),"\u7684\u7248\u672c\u8bb0\u5f55\u6765\u8bf4,\u662f\u6ca1\u6709 country \u5217\u7684\u4fe1\u606f\u7684"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u5982\u679c\u67d0\u4e2a\u5217\u7684\u4fe1\u606f\u4e0d\u5b58\u5728\u4e8e undo\u65e5\u5fd7\u4e2d,\u90a3\u4e48\u8bf4\u660e\u8be5\u7248\u672c\u7684\u8be5\u5217\u4fe1\u606f\u4e0e\u4e0a\u4e00\u4e2a\u7248\u672c\u662f\u4e00\u81f4\u7684"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u6240\u4ee5,\u5982\u679c\u67d0\u6761\u8bb0\u5f55\u7684\u67d0\u4e2a\u5217\u4ece\u672a\u88ab\u66f4\u65b0\u8fc7,\u90a3\u4e48\u8be5\u5217\u7684\u503c\u5c31\u662f\u805a\u7c07\u7d22\u5f15\u4e2d\u8be5\u8bb0\u5f55\u5bf9\u5e94\u7684\u503c"))))))),(0,i.kt)("h2",{id:"readview"},"ReadView"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5728 MVCC \u673a\u5236\u4e2d,\u591a\u4e2a\u4e8b\u52a1\u5bf9\u540c\u4e00\u4e2a\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u5c31\u4f1a\u4ea7\u751f\u591a\u4e2a\u5386\u53f2\u5feb\u7167,\u8fd9\u4e9b\u5386\u53f2\u5feb\u7167\u4fdd\u5b58\u5728 Undo\u65e5\u5fd7\u4e2d\u3002\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u9700\u8981\u67e5\u8be2\u8fd9\u884c\u8bb0\u5f55,\u90a3\u4e48\u9700\u8981\u8bfb\u53d6\u54ea\u4e2a\u7248\u672c\u7684\u884c\u8bb0\u5f55\u5462?\u8fd9\u4e2a\u5c31\u9700\u8981\u4f7f\u7528 ReadView")),(0,i.kt)("h4",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"ReadView \u5c31\u662f",(0,i.kt)("strong",{parentName:"p"},"\u4e00\u4e2a\u4e8b\u52a1\u5728 MVCC \u673a\u5236\u4e0b\u8fdb\u884c",(0,i.kt)("a",{parentName:"strong",href:"MVCC#%E5%BF%AB%E7%85%A7%E8%AF%BB"},(0,i.kt)("inlineCode",{parentName:"a"},"\u5feb\u7167\u8bfb\u64cd\u4f5c")),"\u4ea7\u751f\u7684",(0,i.kt)("inlineCode",{parentName:"strong"},"\u8bfb\u8bd5\u56fe")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u5f53\u4e8b\u52a1\u542f\u52a8\u65f6,\u4f1a\u81ea\u52a8\u7684\u751f\u6210\u6570\u636e\u5e93\u7cfb\u7edf\u5f53\u524d\u7684\u5feb\u7167, \u800c InnoDB \u4e3a\u201c\u5b58\u50a8\u201d\u6bcf\u4e2a\u4e8b\u52a1\u6784\u9020\u4e86\u4e00\u4e2a",(0,i.kt)("inlineCode",{parentName:"strong"},"\u6570\u7ec4"),",\u7528\u4e8e\u8bb0\u5f55\u5e76\u4e14\u7ef4\u62a4\u7cfb\u7edf\u5f53\u524d",(0,i.kt)("inlineCode",{parentName:"strong"},"\u6d3b\u8dc3\u4e8b\u52a1\u7684 ID"))),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u6d3b\u8dc3\u4e8b\u52a1:\u542f\u52a8\u4e86\u4f46\u662f\u6ca1\u6709\u63d0\u4ea4\u7684\u4e8b\u52a1"))))),(0,i.kt)("h3",{id:"\u8bbe\u8ba1\u601d\u8def"},"\u8bbe\u8ba1\u601d\u8def"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"read uncommitted")," \u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1, \u7531\u4e8e\u53ef\u4ee5\u8bfb\u5230\u672a\u63d0\u4ea4\u4e8b\u52a1\u4fee\u6539\u8fc7\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5",(0,i.kt)("strong",{parentName:"p"},"\u76f4\u63a5\u8bfb\u53d6\u8bb0\u5f55\u7684\u6700\u65b0\u7248\u672c"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"serializable")," \u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\uff0cInnoDB \u89c4\u5b9a\u4f7f\u7528",(0,i.kt)("strong",{parentName:"p"},"\u52a0\u9501"),"\u7684\u65b9\u5f0f\u6765\u8bbf\u95ee\u8bb0\u5f55")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"read committed")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"repeatable read")," \u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1, \u90fd",(0,i.kt)("strong",{parentName:"p"},"\u5fc5\u987b\u4fdd\u8bc1\u8bfb\u5230\u5df2\u7ecf\u63d0\u4ea4\u4e86\u7684 \u4e8b\u52a1\u4fee\u6539 \u8fc7\u7684\u8bb0\u5f55")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5047\u5982\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5df2\u7ecf\u4fee\u6539\u4e86\u8bb0\u5f55\u4f46\u662f\u5c1a\u672a\u63d0\u4ea4\uff0c\u662f\u4e0d\u80fd\u76f4\u63a5\u8bfb\u53d6\u6700\u65b0\u7248\u672c\u7684\u8bb0\u5f55\u7684\uff0c",(0,i.kt)("strong",{parentName:"li"},"\u6838\u5fc3\u95ee\u9898\u5c31\u662f\u9700\u8981\u5224\u65ad\u4e00\u4e0b\u7248\u672c\u94fe\u4e2d\u7684\u54ea\u4e2a\u7248\u672c\u662f\u5f53\u524d\u4e8b\u52a1\u53ef\u89c1\u7684\uff0c\u8fd9\u662fReadView\u8981\u89e3\u51b3\u7684\u4e3b\u8981\u95ee\u9898"))))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"ReadView\u4e2d\u5305\u542b 4 \u4e2a\u91cd\u8981\u7684\u90e8\u5206,\u5206\u522b\u662f:")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"m_ids")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u8868\u793a\u5728\u751f\u6210 ReadView \u65f6, \u5f53\u524d\u7cfb\u7edf\u4e2d\u6240\u6709\u6d3b\u8dc3\u7684\u8bfb\u5199\u4e8b\u52a1\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"\u4e8b\u52a1id"),"\u5217\u8868"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"min_trx_id")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u521b\u5efa ReadView \u65f6,\u5f53\u524d\u7cfb\u7edf\u4e2d\u6240\u6709\u6d3b\u8dc3\u7684\u8bfb\u5199\u4e8b\u52a1\u4e2d\u6700\u5c0f\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"\u4e8b\u52a1id"),"\uff0c\u4e5f\u5c31\u662f",(0,i.kt)("inlineCode",{parentName:"li"},"m_ids"),"\u4e2d\u7684\u6700\u5c0f\u503c"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c ",(0,i.kt)("em",{parentName:"li"},"m_ids")," \u4e3a\u7a7a,\u5219\u4e3a ",(0,i.kt)("strong",{parentName:"li"},"max_trx_id")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"max_trx_id")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u521b\u5efa ReadView \u65f6, \u7cfb\u7edf\u4e2d\u5e94\u8be5\u5206\u914d\u7ed9",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e0b\u4e00\u4e2a\u4e8b\u52a1\u7684id"),"\u503c"),(0,i.kt)("admonition",{parentName:"li",title:"max_trx_id\u8bf4\u660e",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"max_trx_id\u5e76\u4e0d\u662f m_ids \u4e2d\u7684\u6700\u5927\u503c, \u4e8b\u52a1id\u662f\u9012\u589e\u5206\u914d\u7684")),(0,i.kt)("p",{parentName:"admonition"},"\u6bd4\u65b9\u8bf4\u73b0\u5728\u6709id\u4e3a1\uff0c2\uff0c3\u8fd9\u4e09\u4e2a\u4e8b\u52a1, \u4e4b\u540eid\u4e3a3\u7684\u4e8b\u52a1\u63d0\u4ea4\u4e86\u3002\u90a3\u4e48\u4e00\u4e2a\u65b0\u7684\u8bfb\u4e8b\u52a1\u5728\u751f\u6210ReadView\u65f6\uff0ctrx_ids \u5c31\u5305\u62ec1\u548c2\uff0cmin_trx_id=1\uff0cmax_trx_id = 4"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"creator_trx_id")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u521b\u5efa\u8be5 ReadView \u7684\u4e8b\u52a1\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e8b\u52a1id")),(0,i.kt)("admonition",{parentName:"li",title:"\u8bf4\u660e",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"\u53ea\u6709\u5728\u5bf9\u8868\u4e2d\u7684\u8bb0\u5f55\u505a\u6539\u52a8\u65f6\uff08\u6267\u884cINSERT\u3001DELETE\u3001UPDATE\u8fd9\u4e9b\u8bed\u53e5\u65f6\uff09\u624d\u4f1a\u4e3a\u4e8b\u52a1\u5206\u914d\u4e8b\u52a1id\uff0c\u5426\u5219\u5728\u4e00\u4e2a\u53ea\u8bfb\u4e8b\u52a1\u4e2d\u7684\u4e8b\u52a1id\u503c\u90fd\u9ed8\u8ba4\u4e3a0")))))),(0,i.kt)("h3",{id:"readview-\u89c4\u5219"},"ReadView \u89c4\u5219"),(0,i.kt)("p",null,"\u6709\u4e86 ",(0,i.kt)("em",{parentName:"p"},"ReadView"),"\uff0c\u8fd9\u6837\u5728\u8bbf\u95ee\u67d0\u6761\u8bb0\u5f55\u65f6,\u53ea\u9700\u8981\u6309\u7167\u4e0b\u8fb9\u7684\u6b65\u9aa4",(0,i.kt)("strong",{parentName:"p"},"\u5224\u65ad\u8bb0\u5f55\u7684\u67d0\u4e2a\u7248\u672c\u662f\u5426\u53ef\u89c1"),"\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u88ab\u8bbf\u95ee\u7248\u672c\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"trx_id")," ",(0,i.kt)("strong",{parentName:"li"},"="),"  ",(0,i.kt)("em",{parentName:"li"},"ReadView")," \u4e2d\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"creator_trx_id"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u5f53\u524d\u4e8b\u52a1\u5728\u8bbf\u95ee\u5b83\u81ea\u5df1\u4fee\u6539\u8fc7\u7684\u8bb0\u5f55,\u6240\u4ee5\u8be5\u7248\u672c\u53ef\u4ee5\u88ab\u5f53\u524d\u4e8b\u52a1\u8bbf\u95ee")))),(0,i.kt)("li",{parentName:"ol"},"\u88ab\u8bbf\u95ee\u7248\u672c\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"trx_id")," ",(0,i.kt)("strong",{parentName:"li"},"<"),"  ",(0,i.kt)("em",{parentName:"li"},"ReadView")," \u4e2d\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"min_trx_id"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u751f\u6210\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u5728\u5f53\u524d\u4e8b\u52a1\u521b\u5efa ",(0,i.kt)("em",{parentName:"strong"},"ReadView")," \u524d\u5df2\u7ecf\u63d0\u4ea4\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u53ef\u4ee5\u88ab\u5f53\u524d\u4e8b\u52a1\u8bbf\u95ee")))),(0,i.kt)("li",{parentName:"ol"},"\u88ab\u8bbf\u95ee\u7248\u672c\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"trx_id")," ",(0,i.kt)("strong",{parentName:"li"},">="),"  ",(0,i.kt)("em",{parentName:"li"},"ReadView")," \u4e2d\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"max_trx_id"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u751f\u6210\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u5728\u5f53\u524d\u4e8b\u52a1\u751f\u6210 ",(0,i.kt)("em",{parentName:"strong"},"ReadView")," \u540e\u624d\u5f00\u542f\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u4e0d\u53ef\u4ee5\u88ab\u5f53\u524d\u4e8b\u52a1\u8bbf\u95ee")))),(0,i.kt)("li",{parentName:"ol"},"\u88ab\u8bbf\u95ee\u7248\u672c\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"trx_id"),"  \u5728  ",(0,i.kt)("em",{parentName:"li"},"ReadView"),"  ",(0,i.kt)("inlineCode",{parentName:"li"},"(min_trx_id, max_trx_id)"),"\u4e4b\u95f4",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u9700\u8981\u5224\u65ad\u4e00\u4e0b",(0,i.kt)("inlineCode",{parentName:"li"},"trx_id"),"\u5c5e\u6027\u503c\u662f\u4e0d\u662f\u5728",(0,i.kt)("inlineCode",{parentName:"li"},"m_ids"),"\u5217\u8868\u4e2d",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u5728,  \u8bf4\u660e\u521b\u5efa ",(0,i.kt)("em",{parentName:"li"},"ReadView")," \u65f6\u751f\u6210\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u8fd8\u662f\u6d3b\u8dc3\u7684\uff0c\u8be5\u7248\u672c\u4e0d\u53ef\u4ee5\u88ab\u8bbf\u95ee"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u4e0d\u5728, \u8bf4\u660e\u521b\u5efa ",(0,i.kt)("em",{parentName:"li"},"ReadView")," \u65f6\u751f\u6210\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u5df2\u7ecf\u88ab\u63d0\u4ea4\uff0c\u8be5\u7248\u672c\u53ef\u4ee5\u88ab\u8bbf\u95ee")))))),(0,i.kt)("h3",{id:"mvcc\u6574\u4f53\u64cd\u4f5c\u6d41\u7a0b"},"MVCC\u6574\u4f53\u64cd\u4f5c\u6d41\u7a0b"),(0,i.kt)("p",null,"\u5f53\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019,\u7cfb\u7edf\u5229\u7528 MVCC \u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u627e\u5230\u5b83:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u9996\u5148\u83b7\u53d6\u4e8b\u52a1\u81ea\u5df1\u7684",(0,i.kt)("strong",{parentName:"li"},"\u4e8b\u52a1 ID")),(0,i.kt)("li",{parentName:"ol"},"\u83b7\u53d6 ReadView"),(0,i.kt)("li",{parentName:"ol"},"\u67e5\u8be2\u5f97\u5230\u7684\u6570\u636e, \u7136\u540e\u4e0e ReadView \u4e2d\u7684\u4e8b\u52a1\u7248\u672c\u53f7\u8fdb\u884c\u6bd4\u8f83"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c\u4e0d\u7b26\u5408 ReadView \u89c4\u5219, \u5c31\u9700\u8981\u4ece Undo Log \u4e2d\u83b7\u53d6\u5386\u53f2\u5feb\u7167"),(0,i.kt)("li",{parentName:"ol"},"\u6700\u540e\u8fd4\u56de\u7b26\u5408\u89c4\u5219\u7684\u6570\u636e")),(0,i.kt)("admonition",{title:"\u6ce8\u610f",type:"caution"},(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u5982\u679c\u67d0\u4e2a\u7248\u672c\u7684\u6570\u636e\u5bf9\u5f53\u524d\u4e8b\u52a1\u4e0d\u53ef\u89c1\u7684\u8bdd\uff0c\u90a3\u5c31\u987a\u7740\u7248\u672c\u94fe\u627e\u5230\u4e0b\u4e00\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u7ee7\u7eed\u6309\u7167\u4e0a\u8fb9\u7684\u6b65\u9aa4\u5224\u65ad\u53ef\u89c1\u6027\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u7248\u672c\u94fe\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u7248\u672c")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u5982\u679c\u6700\u540e\u4e00\u4e2a\u7248\u672c\u4e5f\u4e0d\u53ef\u89c1\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u610f\u5473\u7740\u8be5\u6761\u8bb0\u5f55\u5bf9\u8be5\u4e8b\u52a1\u5b8c\u5168\u4e0d\u53ef\u89c1\uff0c\u67e5\u8be2\u7ed3\u679c\u5c31\u4e0d\u5305\u542b\u8be5\u8bb0\u5f55")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"InnoDB \u4e2d, MVCC \u662f\u901a\u8fc7 Undo\u65e5\u5fd7 + ReadView \u8fdb\u884c\u6570\u636e\u8bfb\u53d6\u3002Undo\u65e5\u5fd7\u4fdd\u5b58\u4e86\u5386\u53f2\u5feb\u7167,\u800c ReadView \u5219\u5e2e\u52a9\u5224\u65ad\u5f53\u524d\u7248\u672c\u7684\u6570\u636e\u662f\u5426\u53ef\u89c1")))),(0,i.kt)("h3",{id:"readview-\u751f\u6210\u65f6\u673a"},"ReadView \u751f\u6210\u65f6\u673a"),(0,i.kt)("p",null,"\u5728 MySQL \u4e2d, ",(0,i.kt)("em",{parentName:"p"},"READ COMMITTED"),"  \u548c ",(0,i.kt)("em",{parentName:"p"},"REPEATABLE READ")," \u9694\u79bb\u7ea7\u522b\u7684\u7684\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u533a\u522b\u5c31\u662f\u5b83\u4eec\u751f\u6210 ReadView \u7684\u65f6\u673a\u4e0d\u540c\u3002\u4ee5\u8868",(0,i.kt)("inlineCode",{parentName:"p"},"hero"),"\u4e3a\u4f8b\u6765\uff0c\u5047\u8bbe\u73b0\u5728\u8868",(0,i.kt)("inlineCode",{parentName:"p"},"hero"),"\u4e2d\u53ea\u6709\u4e00\u6761\u7531",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e8b\u52a1id"),"\u4e3a",(0,i.kt)("inlineCode",{parentName:"p"},"80"),"\u7684\u4e8b\u52a1\u63d2\u5165\u7684\u4e00\u6761\u8bb0\u5f55\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT * FROM hero;\n+--------+--------+---------+\n| number | name   | country |\n+--------+--------+---------+\n|      1 | \u5218\u5907    | \u8700      |\n+--------+--------+---------+\n1 row in set (0.07 sec)\n")),(0,i.kt)("h4",{id:"read-committed"},"Read Committed"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Read Committed \u9694\u79bb\u7ea7\u522b ",(0,i.kt)("inlineCode",{parentName:"li"},"\u5728\u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u524d\u90fd\u521b\u5efa\u4e00\u4e2a ReadView"))),(0,i.kt)("admonition",{title:"\u793a\u4f8b\u8bf4\u660e",type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u5047\u8bbe\u5f53\u524d\u7cfb\u7edf\u7684\u4e2d\u6709\u4e24\u4e2a\u4e8b\u52a1(T1\u3001T2)\u6b63\u5728\u6267\u884c,\u5b83\u4eec\u7684 \u4e8b\u52a1id \u5206\u522b\u662f:trx_100,trx_200:")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="T1: trx_100"',title:'"T1:','trx_100"':!0},"-- \u4e8b\u52a1\u5e76\u6ca1\u6709\u63d0\u4ea4\nBEGIN;\n\nUPDATE hero SET name = '\u5173\u7fbd' WHERE number = 1;\nUPDATE hero SET name = '\u5f20\u98de' WHERE number = 1;\n")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="T2: trx_200"',title:'"T2:','trx_200"':!0},"-- \u4e8b\u52a1\u5e76\u6ca1\u6709\u63d0\u4ea4\nBEGIN;\n\n# \u66f4\u65b0\u4e86\u4e00\u4e9b\u522b\u7684\u8868\u7684\u8bb0\u5f55\n...\n")),(0,i.kt)("mark",null,(0,i.kt)("strong",null,"\u6ce8\u610f:"),"\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d,\u53ea\u6709\u5728\u7b2c\u4e00\u6b21\u771f\u6b63\u4fee\u6539\u8bb0\u5f55\u65f6\uff08\u6bd4\u5982\u4f7f\u7528INSERT\u3001DELETE\u3001UPDATE),\u624d\u4f1a\u88ab\u5206\u914d\u4e00\u4e2a\u5355\u72ec\u7684\u4e8b\u52a1id\uff0c\u8fd9\u4e2a\u4e8b\u52a1id\u662f\u9012\u589e\u7684\u3002\u6240\u4ee5\u5728 T2 \u4e2d\u66f4\u65b0\u4e00\u4e9b\u522b\u7684\u8868\u7684\u8bb0\u5f55,\u76ee\u7684\u662f\u8ba9\u5b83\u5206\u914d\u4e8b\u52a1id\u3002"),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},"\u90a3\u4e48\u6b64\u65f6\u7ecf\u8fc7\u4e8b\u52a1 T1 \u4e2d\u7684\u4e24\u6b21 ",(0,i.kt)("em",{parentName:"p"},"update")," \u4e4b\u540e, number=1 \u7684\u8bb0\u5f55\u5bf9\u5e94\u7684\u7248\u672c\u94fe\u5982\u4e0b:"),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{alt:"image1",src:a(70362).Z,width:"1274",height:"385"})),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},"\u5047\u8bbe\u73b0\u5728\u6709\u4e00\u4e2a\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"READ COMMITTED")," \u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1(trx_0)\u5f00\u59cb\u6267\u884c:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4f7f\u7528READ COMMITTED\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\nBEGIN;\n\n-- SELECT1: \u7531\u4e8eT1\u3001T2 \u672a\u63d0\u4ea4,\u6240\u4ee5\u5f97\u5230\u7684\u5217name\u7684\u503c\u4e3a'\u5218\u5907'\nSELECT * FROM hero WHERE number = 1; \n")),(0,i.kt)("p",{parentName:"admonition"},"\u4e0a\u9762\u7684\u8fd9\u4e2a ",(0,i.kt)("strong",{parentName:"p"},"SELECT1")," \u7684\u6267\u884c\u8fc7\u7a0b\u5982\u4e0b:"),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u9996\u5148\u5728\u6267\u884c Select \u8bed\u53e5(\u4f7f\u7528\u5feb\u7167\u8bfb)\u7684\u65f6\u5019\u4f1a\u521b\u5efa\u4e00\u4e2a ",(0,i.kt)("em",{parentName:"p"},"ReadView")," , \u8be5 readview \u7684\u5c5e\u6027\u5982\u4e0b:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"m_ids"),": ","[100, 200]"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"min_trx_id"),": 100"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"max_trx_id"),": 201"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"creator_trx_id"),": 0"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u7136\u540e\u4f1a",(0,i.kt)("strong",{parentName:"p"},"\u4ece\u7248\u672c\u94fe\u4e2d\u6311\u9009\u53ef\u89c1\u7684\u8bb0\u5f55"),", \u4ece\u4e0a\u9762\u7684\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230,\u6700\u65b0\u7248\u672c\u7684 name='\u5f20\u98de', \u8be5\u7248\u672c\u7684 trx_id=100, ",(0,i.kt)("strong",{parentName:"p"},"\u5728m_ids\u5217\u8868\u5185\uff0c\u6240\u4ee5\u4e0d\u7b26\u5408\u53ef\u89c1\u6027\u8981\u6c42,\u6240\u4ee5\u6839\u636eroll_pointer\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684 name='\u5173\u7fbd', \u8be5\u7248\u672c\u7684 trx_id=100\u3002\u4e5f\u5728m_ids\u5217\u8868\u5185\uff0c\u6240\u4ee5\u4e5f\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u7ee7\u7eed\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c\u3002")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684\u5217name\u7684\u5185\u5bb9\u662f'\u5218\u5907'\uff0c\u8be5\u7248\u672c\u7684 trx_id=80\uff0c",(0,i.kt)("strong",{parentName:"p"},"\u5c0f\u4e8e ReadView \u4e2d\u7684 min_trx_id(100)"),"\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7248\u672c\u662f\u7b26\u5408\u8981\u6c42\u7684\u3002")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u6700\u540e\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u7248\u672c\u5c31\u662f\u6ee1\u8db3\u7248\u672c\u53ef\u89c1\u7684\u7b2c 4 \u6b65\u4e2d\u7684\u8bb0\u5f55 "))),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u5047\u8bbe\u63d0\u4ea4\u4e8b\u52a1 T1,\u5e76\u4e14\u4e8b\u52a1 T2 \u5bf9 hero \u8868\u8fdb\u884c\u66f4\u65b0")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="T1\u3001T2"',title:'"T1\u3001T2"'},"-- T1(trx_100):\u6700\u540e\u63d0\u4ea4\u4e86\u4e8b\u52a1\nBEGIN;\n\nUPDATE hero SET name = '\u5173\u7fbd' WHERE number = 1;\nUPDATE hero SET name = '\u5f20\u98de' WHERE number = 1;\n\nCOMMIT;\n\n-- T2(trx_200): \u4e8b\u52a1\u6700\u540e\u6ca1\u6709\u63d0\u4ea4\n\n# Transaction 200\nBEGIN;\n\n-- \u66f4\u65b0\u4e86\u4e00\u4e9b\u522b\u7684\u8868\u7684\u8bb0\u5f55\n...\n\nUPDATE hero SET name = '\u8d75\u4e91' WHERE number = 1;\nUPDATE hero SET name = '\u8bf8\u845b\u4eae' WHERE number = 1;\n")),(0,i.kt)("p",{parentName:"admonition"},"\u6b64\u65f6, hero \u8868\u4e2d number=1 \u7684\u8bb0\u5f55\u7684\u7248\u672c\u8fde\u53d8\u6210\u4e86\u4e0b\u9762\u7684\u5f62\u5f0f:"),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{alt:"image2",src:a(51941).Z,width:"1266",height:"601"})),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},"\u7136\u540e\u518d\u4f7f\u7528\u9694\u79bb\u7ea7\u522b\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"READ COMMITTED")," \u7684\u4e8b\u52a1(trx_0)\u4e2d\u7ee7\u7eed\u67e5\u627e\u8fd9\u4e2a number=1 \u7684\u8bb0\u5f55\uff0c\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4f7f\u7528READ COMMITTED\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\nBEGIN;\n\n-- SELECT1: \u7531\u4e8eT1\u3001T2 \u672a\u63d0\u4ea4,\u6240\u4ee5\u5f97\u5230\u7684\u5217name\u7684\u503c\u4e3a'\u5218\u5907'\nSELECT * FROM hero WHERE number = 1; \n\n-- SELECT2: \u7531\u4e8eT1\u63d0\u4ea4\u4e86,\u4f46\u662f T2 \u672a\u63d0\u4ea4,\u6240\u4ee5\u5f97\u5230\u7684\u5217 name \u7684\u503c\u4e3a'\u5f20\u98de'\nSELECT * FROM hero WHERE number = 1; \n")),(0,i.kt)("p",{parentName:"admonition"},"\u4e0a\u9762\u7684\u8fd9\u4e2a ",(0,i.kt)("strong",{parentName:"p"},"SELECT2")," \u7684\u6267\u884c\u8fc7\u7a0b\u5982\u4e0b:"),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u5728\u6267\u884c SELECT2 \u8bed\u53e5\u7684\u65f6\u5019,\u53c8\u4f1a",(0,i.kt)("inlineCode",{parentName:"p"},"\u5355\u72ec\u7684"),"\u521b\u5efa\u4e00\u4e2a ",(0,i.kt)("em",{parentName:"p"},"readview"),",\u8be5 readview \u7684\u5c5e\u6027\u5982\u4e0b:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"m_ids"),": ","[200]",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"trx_100 \u7684\u90a3\u4e2a\u4e8b\u52a1 T1 \u5df2\u7ecf\u63d0\u4ea4\u4e86, \u6240\u4ee5\u518d\u6b21\u751f\u6210\u5feb\u7167\u65f6\u5c31\u6ca1\u6709\u5b83\u4e86"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"min_trx_id"),": 200"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"max_trx_id"),": 201"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"creator_trx_id"),": 0"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u7136\u540e",(0,i.kt)("strong",{parentName:"p"},"\u4ece\u7248\u672c\u94fe\u4e2d\u6311\u9009\u53ef\u89c1\u7684\u8bb0\u5f55"),", \u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u6700\u65b0\u7248\u672c\u7684\u5217name='\u8bf8\u845b\u4eae',\u8be5\u7248\u672c\u7684 trx_id=200,",(0,i.kt)("strong",{parentName:"p"},"\u5728m_ids\u5217\u8868\u5185\uff0c\u6240\u4ee5\u4e0d\u7b26\u5408\u53ef\u89c1\u6027\u8981\u6c42,\u6839\u636eroll_pointer\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684\u5217name ='\u8d75\u4e91'\uff0c\u8be5\u7248\u672c\u7684 trx_id=200,\u4e5f\u5728m_ids\u5217\u8868\u5185\uff0c\u6240\u4ee5\u4e5f\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u7ee7\u7eed\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c\u3002")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684\u5217name\u7684\u5185\u5bb9\u662f'\u5f20\u98de'\uff0c\u8be5\u7248\u672c\u7684 trx_id = 100\uff0c",(0,i.kt)("strong",{parentName:"p"},"\u5c0f\u4e8e ReadView \u4e2d\u7684 min_trx_id(200)"),", \u6240\u4ee5\u8fd9\u4e2a\u7248\u672c\u662f\u7b26\u5408\u8981\u6c42\u7684")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u6700\u540e\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u7248\u672c\u5c31\u662f\u6ee1\u8db3\u7248\u672c\u53ef\u89c1\u7684\u7b2c 4 \u6b65\u4e2d\u7684\u8bb0\u5f55 "))),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u4ee5\u6b64\u7c7b\u63a8,\u5982\u679c\u4e4b\u540e\u4e8b\u52a1 T2(trx_200) \u7684\u8bb0\u5f55\u4e5f\u63d0\u4ea4\u4e86, \u518d\u6b21\u5728\u4f7f\u7528 ",(0,i.kt)("em",{parentName:"strong"},"READ COMMITTED")," \u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u4e2d\u67e5\u8be2\u8868 hero \u4e2d number=1 \u7684\u8bb0\u5f55\u65f6\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662f'\u8bf8\u845b\u4eae'\u4e86")),(0,i.kt)("mark",null,(0,i.kt)("strong",null,"\u603b\u7ed3\u4e00\u4e0b\u5c31\u662f:"),"\u4f7f\u7528 READ COMMITTED \u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u5728\u6bcf\u6b21\u67e5\u8be2\u5f00\u59cb\u65f6\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u72ec\u7acb\u7684 ReadView")),(0,i.kt)("h4",{id:"repeatable-read"},"Repeatable Read"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Repeatable Read \u9694\u79bb\u7ea7\u522b ",(0,i.kt)("inlineCode",{parentName:"li"},"\u5728\u7b2c\u4e00\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u4e00\u4e2a ReadView,\u4e4b\u540e\u7684\u67e5\u8be2\u5c31\u4e0d\u4f1a\u91cd\u590d\u521b\u5efa\u4e86"))),(0,i.kt)("admonition",{title:"\u793a\u4f8b\u8bf4\u660e",type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u5047\u8bbe\u5f53\u524d\u7cfb\u7edf\u7684\u4e2d\u6709\u4e24\u4e2a\u4e8b\u52a1(T1\u3001T2)\u6b63\u5728\u6267\u884c,\u5b83\u4eec\u7684 \u4e8b\u52a1id \u5206\u522b\u662f:trx_100,trx_200:")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="T1: trx_100"',title:'"T1:','trx_100"':!0},"-- \u4e8b\u52a1\u5e76\u6ca1\u6709\u63d0\u4ea4\nBEGIN;\n\nUPDATE hero SET name = '\u5173\u7fbd' WHERE number = 1;\nUPDATE hero SET name = '\u5f20\u98de' WHERE number = 1;\n\n")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="T2: trx_200"',title:'"T2:','trx_200"':!0},"-- \u4e8b\u52a1\u5e76\u6ca1\u6709\u63d0\u4ea4\nBEGIN;\n\n# \u66f4\u65b0\u4e86\u4e00\u4e9b\u522b\u7684\u8868\u7684\u8bb0\u5f55\n...\n\n")),(0,i.kt)("p",{parentName:"admonition"},"\u90a3\u4e48\u6b64\u65f6\u7ecf\u8fc7\u4e8b\u52a1 T1 \u4e2d\u7684\u4e24\u6b21 ",(0,i.kt)("inlineCode",{parentName:"p"},"UPDATE")," \u4e4b\u540e, number=1 \u7684\u8bb0\u5f55\u5bf9\u5e94\u7684\u7248\u672c\u94fe\u5982\u4e0b:"),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{alt:"image1",src:a(70362).Z,width:"1274",height:"385"})),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},"\u5047\u8bbe\u73b0\u5728\u6709\u4e00\u4e2a\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"REPEATABLE READ")," \u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1(trx_0)\u5f00\u59cb\u6267\u884c:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4f7f\u7528READ COMMITTED\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\nBEGIN;\n\n-- SELECT1: \u7531\u4e8eT1\u3001T2 \u672a\u63d0\u4ea4,\u5f97\u5230\u7684\u5217name\u7684\u503c\u4e3a'\u5218\u5907'\nSELECT * FROM hero WHERE number = 1; \n\n")),(0,i.kt)("p",{parentName:"admonition"},"\u4e0a\u9762\u7684\u8fd9\u4e2a ",(0,i.kt)("strong",{parentName:"p"},"SELECT1")," \u7684\u6267\u884c\u8fc7\u7a0b\u5982\u4e0b:"),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u9996\u5148\u5728\u6267\u884c Select \u8bed\u53e5(\u4f7f\u7528\u5feb\u7167\u8bfb)\u7684\u65f6\u5019\u4f1a\u521b\u5efa\u4e00\u4e2a ",(0,i.kt)("em",{parentName:"p"},"ReadView")," , \u8be5 readview \u7684\u5c5e\u6027\u5982\u4e0b:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"m_ids"),": ","[100, 200]"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"min_trx_id"),": 100"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"max_trx_id"),": 201"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"creator_trx_id"),": 0"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u7136\u540e\u4f1a",(0,i.kt)("strong",{parentName:"p"},"\u4ece\u7248\u672c\u94fe\u4e2d\u6311\u9009\u53ef\u89c1\u7684\u8bb0\u5f55"),", \u4ece\u4e0a\u9762\u7684\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230,\u6700\u65b0\u7248\u672c\u7684 name='\u5f20\u98de', \u8be5\u7248\u672c\u7684 trx_id=100, ",(0,i.kt)("strong",{parentName:"p"},"\u5728m_ids\u5217\u8868\u5185\uff0c\u6240\u4ee5\u4e0d\u7b26\u5408\u53ef\u89c1\u6027\u8981\u6c42,\u6240\u4ee5\u6839\u636eroll_pointer\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684 name='\u5173\u7fbd', \u8be5\u7248\u672c\u7684 trx_id=100\u3002\u4e5f\u5728m_ids\u5217\u8868\u5185\uff0c\u6240\u4ee5\u4e5f\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u7ee7\u7eed\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c\u3002")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684\u5217name\u7684\u5185\u5bb9\u662f'\u5218\u5907'\uff0c\u8be5\u7248\u672c\u7684 trx_id=80\uff0c",(0,i.kt)("strong",{parentName:"p"},"\u5c0f\u4e8e ReadView \u4e2d\u7684 min_trx_id(100)"),"\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7248\u672c\u662f\u7b26\u5408\u8981\u6c42\u7684\u3002")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u6700\u540e\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u7248\u672c\u5c31\u662f\u6ee1\u8db3\u7248\u672c\u53ef\u89c1\u7684\u7b2c 4 \u6b65\u4e2d\u7684\u8bb0\u5f55 "))),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u5047\u8bbe\u63d0\u4ea4\u4e8b\u52a1 T1,\u5e76\u4e14\u4e8b\u52a1 T2 \u5bf9 hero \u8868\u8fdb\u884c\u66f4\u65b0")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="T1\u3001T2"',title:'"T1\u3001T2"'},"-- T1(trx_100):\u6700\u540e\u63d0\u4ea4\u4e86\u4e8b\u52a1\nBEGIN;\n\nUPDATE hero SET name = '\u5173\u7fbd' WHERE number = 1;\nUPDATE hero SET name = '\u5f20\u98de' WHERE number = 1;\n\nCOMMIT;\n\n-- T2(trx_200): \u4e8b\u52a1\u6700\u540e\u6ca1\u6709\u63d0\u4ea4\n\n# Transaction 200\nBEGIN;\n\n-- \u66f4\u65b0\u4e86\u4e00\u4e9b\u522b\u7684\u8868\u7684\u8bb0\u5f55\n...\n\nUPDATE hero SET name = '\u8d75\u4e91' WHERE number = 1;\nUPDATE hero SET name = '\u8bf8\u845b\u4eae' WHERE number = 1;\n\n")),(0,i.kt)("p",{parentName:"admonition"},"\u6b64\u65f6, hero \u8868\u4e2d number=1 \u7684\u8bb0\u5f55\u7684\u7248\u672c\u94fe\u53d8\u6210\u4e86\u4e0b\u9762\u7684\u5f62\u5f0f:"),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{alt:"image2",src:a(51941).Z,width:"1266",height:"601"})),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},"\u7136\u540e\u518d\u4f7f\u7528\u9694\u79bb\u7ea7\u522b\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"REPEATABLE READ")," \u7684\u4e8b\u52a1(trx_0)\u4e2d\u7ee7\u7eed\u67e5\u627e\u8fd9\u4e2a number=1 \u7684\u8bb0\u5f55\uff0c\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4f7f\u7528READ COMMITTED\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\nBEGIN;\n\n-- SELECT1: \u7531\u4e8eT1\u3001T2 \u672a\u63d0\u4ea4,\u5f97\u5230\u7684\u5217name\u7684\u503c\u4e3a'\u5218\u5907'\nSELECT * FROM hero WHERE number = 1; \n\n-- SELECT2: \u7531\u4e8eT1\u63d0\u4ea4\u4e86,\u4f46\u662f T2 \u672a\u63d0\u4ea4,\u5f97\u5230\u7684\u5217 name \u7684\u503c\u8fd8\u662f'\u5218\u5907'\nSELECT * FROM hero WHERE number = 1; \n")),(0,i.kt)("p",{parentName:"admonition"},"\u4e0a\u9762\u7684\u8fd9\u4e2a ",(0,i.kt)("strong",{parentName:"p"},"SELECT2")," \u7684\u6267\u884c\u8fc7\u7a0b\u5982\u4e0b:"),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u56e0\u4e3a\u5f53\u524d\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"REPEATABLE READ"),",\u800c\u5728\u6267\u884c SELECT1 \u7684\u65f6\u5019\u5df2\u7ecf\u521b\u5efa\u4e86\u4e00\u4e2a ",(0,i.kt)("em",{parentName:"p"},"ReadView")," \u4e86,\u6240\u4ee5\u6b64\u65f6\u76f4\u63a5\u590d\u7528\u4e4b\u524d\u7684ReadView\u3002\u4e4b\u524d\u7684ReadView\u7684\u5c5e\u6027:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"m_ids"),": ","[100, 200]"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"min_trx_id"),": 100"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"max_trx_id"),": 201"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"creator_trx_id"),": 0"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u7136\u540e",(0,i.kt)("strong",{parentName:"p"},"\u4ece\u7248\u672c\u94fe\u4e2d\u6311\u9009\u53ef\u89c1\u7684\u8bb0\u5f55"),", \u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa: \u6700\u65b0\u7248\u672c\u7684\u5217 name='\u8bf8\u845b\u4eae',\u8be5\u7248\u672c\u7684 trx_id=200,\u5728m_ids\u5217\u8868\u5185,\u6240\u4ee5\u4e0d\u7b26\u5408\u53ef\u89c1\u6027\u8981\u6c42,\u6839\u636eroll_pointer\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c ")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684 name='\u8d75\u4e91',\u8be5\u7248\u672c\u7684 trx_id=200,\u4e5f\u5728m_ids\u5217\u8868\u5185,\u6240\u4ee5\u4e0d\u7b26\u5408\u53ef\u89c1\u6027\u8981\u6c42,\u7ee7\u7eed\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684 name='\u5f20\u98de',\u8be5\u7248\u672c\u7684 trx_id=100,\u4e5f\u5728m_ids\u5217\u8868\u5185,\u6240\u4ee5\u4e0d\u7b26\u5408\u53ef\u89c1\u6027\u8981\u6c42,\u7ee7\u7eed\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684 name='\u5173\u7fbd',\u8be5\u7248\u672c\u7684 trx_id=100,\u4e5f\u5728m_ids\u5217\u8868\u5185,\u6240\u4ee5\u4e0d\u7b26\u5408\u53ef\u89c1\u6027\u8981\u6c42,\u7ee7\u7eed\u8df3\u5230\u4e0b\u4e00\u4e2a\u7248\u672c")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u4e00\u4e2a\u7248\u672c\u7684 name='\u5173\u7fbd',\u8be5\u7248\u672c\u7684 trx_id=80, ",(0,i.kt)("strong",{parentName:"p"},"\u5c0f\u4e8e ReadView \u4e2d\u7684 min_trx_id(100)"),"\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7248\u672c\u662f\u7b26\u5408\u8981\u6c42\u7684\u3002")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u6700\u540e\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u7248\u672c\u5c31\u662f\u6ee1\u8db3\u7248\u672c\u53ef\u89c1\u7684\u7b2c 6 \u6b65\u4e2d\u7684\u8bb0\u5f55 "))),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u4e5f\u5c31\u662f\u8bf4\u4e24\u6b21SELECT\u67e5\u8be2\u5f97\u5230\u7684\u7ed3\u679c\u662f\u91cd\u590d\u7684, \u8bb0\u5f55\u7684\u5217 name='\u5218\u5907'\uff0c\u8fd9\u5c31\u662f\u53ef\u91cd\u590d\u8bfb\u7684\u542b\u4e49\u3002\u5982\u679c\u518d\u628a\u4e8b\u52a1id\u4e3a200\u7684\u8bb0\u5f55\u63d0\u4ea4\u4e86,\u7136\u540e\u518d\u5230\u521a\u624d\u4f7f\u7528 REPEATABLE READ \u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u4e2d\u7ee7\u7eed\u67e5\u627e\u8fd9\u4e2anumber\u4e3a1\u7684\u8bb0\u5f55,\u5f97\u5230\u7684\u7ed3\u679c\u8fd8\u662f'\u5218\u5907'")),(0,i.kt)("mark",null,(0,i.kt)("strong",null,"\u603b\u7ed3\u4e00\u4e0b\u5c31\u662f:"),"\u4f7f\u7528 REPEATABLE READ \u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u53ea\u6709\u7b2c\u4e00\u6b21\u4f1a\u521b\u5efa ReadView,\u540e\u9762\u7684\u67e5\u8be2\u90fd\u4f1a\u590d\u7528\u6700\u5f00\u59cb\u7684")),(0,i.kt)("h3",{id:"\u89e3\u51b3\u5e7b\u8bfb"},"\u89e3\u51b3\u5e7b\u8bfb"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"InnoDB \u5728",(0,i.kt)("em",{parentName:"li"},"Repeatable Read")," \u7684\u9694\u79bb\u7ea7\u522b\u4e0b,\u53ef\u4ee5\u89e3\u51b3\u5e7b\u8bfb\u95ee\u9898")),(0,i.kt)("admonition",{title:"\u793a\u4f8b\u8bf4\u660e",type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u8fd8\u662f\u4f7f\u7528 hero \u8868, \u4e14\u8868\u4e2d\u53ea\u6709\u4e00\u6761\u7531 \u4e8b\u52a1id=80 \u63d2\u5165\u7684\u8bb0\u5f55")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT * FROM hero;\n+--------+--------+---------+\n| number | name   | country |\n+--------+--------+---------+\n|      1 | \u5218\u5907    | \u8700      |\n+--------+--------+---------+\n1 row in set (0.07 sec)\n")),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u90a3\u4e48\u6b64\u65f6\u8868\u4e2d\u6240\u6709\u8bb0\u5f55\u7684\u7248\u672c\u94fe\u5982\u4e0b:")),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{alt:"image-20220918105146695",src:a(92623).Z,width:"1760",height:"296"})),(0,i.kt)("br",null),(0,i.kt)("blockquote",{parentName:"admonition"},(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"\u5047\u8bbe\u7cfb\u7edf\u4e2d\u6709\u4e24\u4e2a\u4e8b\u52a1(T1\u3001T2)\u6b63\u5728\u6267\u884c\u4e2d, \u5b83\u4eec\u7684 \u4e8b\u52a1id \u5206\u522b\u662f: trx_100\u3001trx_200"))),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 1: T1 \u5f00\u59cb\u7b2c\u4e00\u6b21\u67e5\u8be2,\u67e5\u8be2\u7684 SQL \u5982\u4e0b:")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:'language-sql\xa0title="T1:trx_100"'},"BEGIN;\nSELECT * FROM hero where number >= 1;\n")),(0,i.kt)("p",{parentName:"admonition"},"\u5f00\u59cb\u67e5\u8be2\u7684\u65f6\u5019,\u4e8b\u52a1 T1 \u4f1a\u521b\u5efa\u4e00\u4e2a ReadView,\u4e14\u8be5 ReadView \u5bf9\u5e94\u7684\u5c5e\u6027\u5982\u4e0b"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"m_ids"),": ","[100, 200]"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"min_trx_id"),": 100"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"max_trx_id"),": 201"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"creator_trx_id"),": 100")),(0,i.kt)("p",{parentName:"admonition"},"\u6b64\u65f6\u8868\u4e2d\u8bb0\u5f55\u53ea\u6709\u4e00\u4e2a ",(0,i.kt)("em",{parentName:"p"},"number=1")," \u7684,\u4e14",(0,i.kt)("em",{parentName:"p"},"trx_id=80"),", \u5c0f\u4e8e",(0,i.kt)("em",{parentName:"p"},"min_trx_id"),": 100, \u6240\u4ee5\u8fd9\u6761\u8bb0\u5f55\u7684\u8fd9\u4e2a\u7248\u672c\u5bf9\u4e8e\u4e8b\u52a1 T1 \u662f\u53ef\u89c1\u7684,\u90a3\u4e48",(0,i.kt)("strong",{parentName:"p"},"\u4e8b\u52a1 T1 \u7684\u7b2c\u4e00\u6b21\u67e5\u8be2,\u53ef\u4ee5\u8bfb\u53d6\u5230\u4e00\u6761\u8bb0\u5f55: number=1")),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 2: T2 \u5411hero \u8868\u4e2d\u63d2\u5165\u4e24\u6761\u6570\u636e,SQL \u8bed\u53e5\u5982\u4e0b")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="T2:trx_200"',title:'"T2:trx_200"'},"INSERT INTO hero VALUES(2, '\u5173\u7fbd', '\u8700')   ;\nINSERT INTO hero VALUES(3, '\u5f20\u98de', '\u8700')   ;\n")),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u90a3\u4e48\u6b64\u65f6\u8868\u4e2d\u6709\u4e09\u6761\u8bb0\u5f55,\u90a3\u4e48\u6b64\u65f6\u8868\u4e2d\u6240\u6709\u8bb0\u5f55\u7684\u7248\u672c\u94fe\u5982\u4e0b:")),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("img",{alt:"image-20220918111050768",src:a(85050).Z,width:"2164",height:"692"})),(0,i.kt)("br",null),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 2: T1 \u5f00\u59cb\u7b2c\u4e8c\u6b21\u67e5\u8be2,\u67e5\u8be2\u7684 SQL \u5982\u4e0b:")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql",metastring:'\xa0title="T1:trx_100"',"\xa0title":'"T1:trx_100"'},"BEGIN;\n-- \u7b2c\u4e00\u6b21\u67e5\u8be2\nSELECT * FROM hero where number >= 1;\n\n-- \u7b2c\u4e8c\u6b21\u67e5\u8be2\nSELECT * FROM hero where number >= 1;\n")),(0,i.kt)("p",{parentName:"admonition"},"\u5728 ",(0,i.kt)("em",{parentName:"p"},"Repeatable Read")," \u9694\u79bb\u7ea7\u522b\u4e0b\u8fdb\u884c\u7b2c\u4e8c\u6b21\u8bfb\u53d6\u6570\u636e,\u6b64\u65f6\u8fd8\u662f\u4f7f\u7528\u7b2c\u4e00\u6b21\u67e5\u8be2\u7684 ReadView,\u5373 ReadView \u7684\u5c5e\u6027\u5982\u4e0b:"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"m_ids"),": ","[100, 200]"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"min_trx_id"),": 100"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"max_trx_id"),": 201"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"creator_trx_id"),": 100")),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"\u4ece\u4e0a\u9762\u7684\u5206\u6790\u53ef\u4ee5\u770b\u5230: number=1 \u7684\u8bb0\u5f55\u662f\u53ef\u4ee5\u8bfb\u53d6\u5230"),",\u7136\u540e\u770b\u4e0b\u65b0\u63d2\u5165\u7684\u4e24\u6761\u8bb0\u5f55:"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"\u65b0\u63d2\u5165\u7684\u8bb0\u5f55\u7684 trx_id=200, \u5728 m_ids\u5217\u8868(100,200)\u4e2d,\u6240\u4ee5",(0,i.kt)("strong",{parentName:"li"},"\u8fd9\u4e24\u6761\u8bb0\u5f55\u7248\u672c\u5bf9\u4e8b\u52a1T1 \u662f\u4e0d\u53ef\u89c1\u7684"),", \u5373\u6700\u7ec8\u53ea\u80fd\u8bfb\u53d6\u5230\u4e00\u6761\u8bb0\u5f55: number=1")),(0,i.kt)("mark",null,"\u4ece\u4e0a\u9762\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u6765:InnoDB \u7684 Repeatable Read \u9694\u79bb\u7ea7\u522b\u4e0b,\u786e\u5b9e\u53ef\u4ee5\u89e3\u51b3\u5e7b\u8bfb\u95ee\u9898")," "))}N.isMDXComponent=!0},49500:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220912122311625-a622c4381d365c4fc2be8fe405c4c145.png"},94520:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220912122952956-94abce72128210769239bbfa6232d682.png"},18349:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220912131522458-440f89ce101e4e4e8767997f3c77f505.png"},28797:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220912132809438-09c04848fb5e232fbe7a629e61ccc1f0.png"},53955:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220912133744003-d1844db68ceb9b345770ae48bd275f93.png"},92623:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220918105146695-1831bb3c98d0649732e6a30e40be34fb.png"},85050:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image-20220918111050768-28391c05f86aeefc06f782873df963ac.png"},70362:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image1-f452887a4da336535c4e7ef31bf9a1c2.png"},51941:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image2-977dc35fc036e7ef1265095f485dbd76.png"}}]);