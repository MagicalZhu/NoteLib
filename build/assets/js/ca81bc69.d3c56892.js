"use strict";(self.webpackChunkhuakucha=self.webpackChunkhuakucha||[]).push([[4748],{5709:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>k,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var a=n(87462),l=(n(67294),n(3905));n(61839);const r={id:"Lock\u9501",title:"Lock\u9501"},i=void 0,o={unversionedId:"\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/Lock\u9501",id:"\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/Lock\u9501",title:"Lock\u9501",description:"\u9501\u5206\u7c7b",source:"@site/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/3.3\u5e76\u53d1\u5de5\u5177\u7c7b-Lock\u9501.md",sourceDirName:"\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236",slug:"/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/Lock\u9501",permalink:"/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/Lock\u9501",draft:!1,editUrl:"https://github.com/MagicalZhu/NoteLib/tree/main/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/3.3\u5e76\u53d1\u5de5\u5177\u7c7b-Lock\u9501.md",tags:[],version:"current",lastUpdatedBy:"YuLiang Zhu",lastUpdatedAt:1670289592,formattedLastUpdatedAt:"2022\u5e7412\u67086\u65e5",frontMatter:{id:"Lock\u9501",title:"Lock\u9501"},sidebar:"basicSideBar",previous:{title:"ThreadLocal",permalink:"/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/ThreadLocal"},next:{title:"\u539f\u5b50\u53d8\u91cf\u7c7b&CAS",permalink:"/docs/\u5e76\u53d1\u7f16\u7a0b/\u5e76\u53d1\u63a7\u5236/Atomic&CAS"}},k={},c=[{value:"\u9501\u5206\u7c7b",id:"\u9501\u5206\u7c7b",level:2},{value:"Lock\u63a5\u53e3",id:"lock\u63a5\u53e3",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:3},{value:"\u53ef\u4e2d\u65ad\u9501\u4e0e\u4e0d\u53ef\u4e2d\u65ad\u9501",id:"\u53ef\u4e2d\u65ad\u9501\u4e0e\u4e0d\u53ef\u4e2d\u65ad\u9501",level:3},{value:"synchronized\u65e0\u6cd5\u54cd\u5e94\u4e2d\u65ad",id:"synchronized\u65e0\u6cd5\u54cd\u5e94\u4e2d\u65ad",level:4},{value:"Lock\u54cd\u5e94\u4e2d\u65ad",id:"lock\u54cd\u5e94\u4e2d\u65ad",level:4},{value:"Lock\u4e3b\u8981\u65b9\u6cd5\u4ecb\u7ecd",id:"lock\u4e3b\u8981\u65b9\u6cd5\u4ecb\u7ecd",level:3},{value:"\u65b9\u6cd5\u6982\u8ff0",id:"\u65b9\u6cd5\u6982\u8ff0",level:4},{value:"tryLock \u907f\u514d\u6b7b\u9501",id:"trylock-\u907f\u514d\u6b7b\u9501",level:4},{value:"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501",id:"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-1",level:3},{value:"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501\u7684\u6f14\u793a",id:"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501\u7684\u6f14\u793a",level:3},{value:"\u53ef\u91cd\u5165\u9501\u4e0e\u975e\u53ef\u91cd\u5165\u9501",id:"\u53ef\u91cd\u5165\u9501\u4e0e\u975e\u53ef\u91cd\u5165\u9501",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-2",level:3},{value:"ReentrantLock\u5e38\u89c1\u65b9\u6cd5",id:"reentrantlock\u5e38\u89c1\u65b9\u6cd5",level:3},{value:"ReentrantLock\u5173\u7cfb\u56fe",id:"reentrantlock\u5173\u7cfb\u56fe",level:3},{value:"ReentrantLock\u53ef\u91cd\u5165\u9501\u6f14\u793a",id:"reentrantlock\u53ef\u91cd\u5165\u9501\u6f14\u793a",level:3},{value:"\u53ef\u91cd\u5165\u7684\u57fa\u672c\u539f\u7406",id:"\u53ef\u91cd\u5165\u7684\u57fa\u672c\u539f\u7406",level:3},{value:"\u4e0d\u53ef\u91cd\u5165\u7684\u57fa\u672c\u539f\u7406",id:"\u4e0d\u53ef\u91cd\u5165\u7684\u57fa\u672c\u539f\u7406",level:3},{value:"\u516c\u5e73\u9501\u4e0e\u975e\u516c\u5e73\u9501",id:"\u516c\u5e73\u9501\u4e0e\u975e\u516c\u5e73\u9501",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-3",level:3},{value:"\u516c\u5e73\u9501\u7684\u6f14\u793a",id:"\u516c\u5e73\u9501\u7684\u6f14\u793a",level:3},{value:"\u975e\u516c\u5e73\u9501\u7684\u6f14\u793a",id:"\u975e\u516c\u5e73\u9501\u7684\u6f14\u793a",level:3},{value:"\u7279\u4f8b",id:"\u7279\u4f8b",level:3},{value:"\u516c\u5e73\u9501\u6e90\u7801",id:"\u516c\u5e73\u9501\u6e90\u7801",level:3},{value:"\u975e\u516c\u5e73\u9501\u6e90\u7801",id:"\u975e\u516c\u5e73\u9501\u6e90\u7801",level:3},{value:"\u5171\u4eab\u9501\u4e0e\u6392\u4ed6\u9501",id:"\u5171\u4eab\u9501\u4e0e\u6392\u4ed6\u9501",level:2},{value:"\u57fa\u672c\u6982\u8ff0",id:"\u57fa\u672c\u6982\u8ff0",level:3},{value:"<strong>\u5171\u4eab\u9501\u4e0e\u6392\u4ed6\u9501\u6982\u8ff0</strong>?",id:"\u5171\u4eab\u9501\u4e0e\u6392\u4ed6\u9501\u6982\u8ff0",level:4},{value:"<strong>\u8bfb\u5199\u9501ReadWriteLock\u6982\u8ff0</strong>",id:"\u8bfb\u5199\u9501readwritelock\u6982\u8ff0",level:4},{value:"ReentrantReadWriteLock",id:"reentrantreadwritelock",level:3},{value:"\u57fa\u672c\u6982\u8ff0",id:"\u57fa\u672c\u6982\u8ff0-1",level:4},{value:"\u8bfb\u5199\u9501\u7b80\u5355\u7f13\u5b58\u7684\u793a\u4f8b",id:"\u8bfb\u5199\u9501\u7b80\u5355\u7f13\u5b58\u7684\u793a\u4f8b",level:4},{value:"\u8bfb\u9501\u63d2\u961f\u4e0e\u4e0d\u63d2\u961f\u7684\u793a\u4f8b",id:"\u8bfb\u9501\u63d2\u961f\u4e0e\u4e0d\u63d2\u961f\u7684\u793a\u4f8b",level:4},{value:"\u8bfb\u5199\u9501\u5347\u964d\u7ea7",id:"\u8bfb\u5199\u9501\u5347\u964d\u7ea7",level:3},{value:"\u5199\u9501\u964d\u7ea7\u793a\u4f8b",id:"\u5199\u9501\u964d\u7ea7\u793a\u4f8b",level:4},{value:"\u8bfb\u9501\u5347\u7ea7\u6d4b\u8bd5",id:"\u8bfb\u9501\u5347\u7ea7\u6d4b\u8bd5",level:4},{value:"ReentrantReadWriteLock \u5206\u6790",id:"reentrantreadwritelock-\u5206\u6790",level:3},{value:"ReentrantReadWriteLock\u7ed3\u6784",id:"reentrantreadwritelock\u7ed3\u6784",level:4},{value:"\u540c\u6b65\u72b6\u6001\u7684\u8bfb\u5199\u5212\u5206",id:"\u540c\u6b65\u72b6\u6001\u7684\u8bfb\u5199\u5212\u5206",level:4},{value:"\u5199\u9501\u7684\u83b7\u53d6",id:"\u5199\u9501\u7684\u83b7\u53d6",level:4},{value:"\u8bfb\u9501\u7684\u83b7\u53d6",id:"\u8bfb\u9501\u7684\u83b7\u53d6",level:4},{value:"\u8bfb\u5199\u9501\u7684\u516c\u5e73\u6027",id:"\u8bfb\u5199\u9501\u7684\u516c\u5e73\u6027",level:4},{value:"\u8bfb\u5199\u9501\u7684\u975e\u516c\u5e73\u6027",id:"\u8bfb\u5199\u9501\u7684\u975e\u516c\u5e73\u6027",level:4},{value:"\u81ea\u65cb\u9501\u548c\u963b\u585e\u9501",id:"\u81ea\u65cb\u9501\u548c\u963b\u585e\u9501",level:2},{value:"\u6982\u5ff5",id:"\u6982\u5ff5",level:3},{value:"\u7b80\u5355\u7684\u81ea\u65cb\u9501",id:"\u7b80\u5355\u7684\u81ea\u65cb\u9501",level:3},{value:"\u9501\u4f18\u5316",id:"\u9501\u4f18\u5316",level:2},{value:"jvm\u5bf9\u9501\u7684\u4f18\u5316",id:"jvm\u5bf9\u9501\u7684\u4f18\u5316",level:3},{value:"\u4e2a\u4eba\u5199\u4ee3\u7801",id:"\u4e2a\u4eba\u5199\u4ee3\u7801",level:3}],u={toc:c};function p(e){let{components:t,...r}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u9501\u5206\u7c7b"},"\u9501\u5206\u7c7b"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(83761).Z,width:"1269",height:"684"})),(0,l.kt)("h2",{id:"lock\u63a5\u53e3"},"Lock\u63a5\u53e3"),(0,l.kt)("h3",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,l.kt)("blockquote",null,(0,l.kt)("ol",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ol"},"\u9501\u662f\u7528\u6765\u63a7\u5236\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u65b9\u5f0f\u3002",(0,l.kt)("font",{color:"red"},"\u4e00\u822c\u6765\u8bf4,\u4e00\u4e2a\u9501\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90,\u4f46\u662f\u6709\u4e9b\u9501\u5141\u8bb8\u591a\u4e2a\u7ebf\u7a0b\u5e76\u53d1\u7684\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\uff08\u6bd4\u5982\u8bfb\u5199\u9501\uff09")),(0,l.kt)("li",{parentName:"ol"},"jdk1.5 \u540e\u63d0\u4f9b\u4e86Lock\u63a5\u53e3\u4ee5\u53ca\u76f8\u5173\u5b9e\u73b0\u7c7b\uff0cLock\u548csynchronized \u662f\u4e24\u79cd\u6700\u5e38\u89c1\u7684\u9501\uff0c\u90fd\u53ef\u4ee5\u8fbe\u5230\u7ebf\u7a0b\u5b89\u5168\u7684\u76ee\u7684\uff0c\u53ea\u662fLock\u9501\u9700\u8981\u663e\u5f0f\u7684\u83b7\u53d6\u548c\u91ca\u653e\u9501"),(0,l.kt)("li",{parentName:"ol"},"Lock \u4e0d\u662f\u7528\u4e8e\u4ee3\u66ffsynchronized\uff0c\u4f46\u662f\u76f8\u5bf9\u4e8esynchronized\u62e5\u6709\u66f4\u591a\u9ad8\u7ea7\u7684\u529f\u80fd\uff0c\u6bd4\u5982:\u53ef\u4e2d\u65ad\u7684\u83b7\u53d6\u9501\u3001\u8d85\u65f6\u83b7\u53d6\u9501\u7b49synchronized\u4e0d\u5177\u5907\u7684\u529f\u80fd"))),(0,l.kt)("p",null,"Lock\u7684\u4f7f\u7528\u57fa\u672c\u8303\u5f0f\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"Lock lock = new ReentrantLock();\nlock.lock();    //\u663e\u5f0f\u83b7\u53d6\u9501\ntry{\n    // do something...\n} finally {\n  lock.unlock();  //\u6700\u540e\u4e00\u5b9a\u8981\u663e\u5f0f\u7684\u91ca\u653e\u9501\n}\n")),(0,l.kt)("br",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Lock\u6700\u5e38\u89c1\u7684\u5b9e\u73b0\u7c7b\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"ReentrantLock"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Lock\u63a5\u53e3\u63d0\u4f9b\u7684synchronized\u4e0d\u5177\u5907\u7684\u529f\u80fd"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u5c1d\u8bd5\u975e\u963b\u585e\u7684\u83b7\u53d6\u9501"),": \u5f53\u524d\u7ebf\u7a0b\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u5982\u679c\u8fd9\u4e00\u65f6\u523b\u9501\u6ca1\u6709\u88ab\u5176\u4ed6\u7ebf\u7a0b\u83b7\u53d6\u5230\uff0c\u5219\u4f1a\u6210\u529f\u7684\u6301\u6709\u9501"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u80fd\u591f\u88ab\u4e2d\u65ad\u7684\u83b7\u53d6\u9501"),": \u4e0esynchronized\u4e0d\u4e00\u6837\u7684\u662f\uff0c\u83b7\u53d6\u5230\u9501\u7684\u7ebf\u7a0b\u53ef\u4ee5\u54cd\u5e94\u4e2d\u65ad\uff0c\u5f53\u83b7\u53d6\u5230\u9501\u7684\u7ebf\u7a0b\u88ab\u4e2d\u65ad\u65f6\uff0c\u4f1a\u629b\u51fa\u4e2d\u65ad\u5f02\u5e38\uff0c\u5e76\u4e14\u91ca\u653e\u9501"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u8d85\u65f6\u7684\u83b7\u53d6\u9501"),": \u5728\u6307\u5b9a\u7684\u622a\u6b62\u65f6\u95f4\u4e4b\u524d\u83b7\u53d6\u9501\uff0c\u5982\u679c\u5230\u4e86\u622a\u6b62\u65f6\u95f4\u8fd8\u65e0\u6cd5\u83b7\u53d6\u9501\uff0c\u5219\u8fd4\u56de"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4e3a\u4ec0\u4e48synchronized\u4e0d\u591f\u7528?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u6548\u7387\u4f4e"),": \u9501\u7684\u91ca\u653e\u60c5\u51b5\u5c11,\u5c1d\u8bd5\u83b7\u53d6\u9501\u7684\u65f6\u5019\u4e0d\u80fd\u8bbe\u7f6e\u8d85\u65f6\u3001\u65e0\u6cd5\u4e2d\u65ad\u4e00\u4e2a\u5c1d\u8bd5\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u4e0d\u7075\u6d3b"),": \u52a0\u9501\u3001\u91ca\u653e\u7684\u65f6\u673a\u5355\u4e00\uff0c\u5e76\u4e14\u6bcf\u4e2a\u9501\u53ea\u6709\u4e00\u4e2a\u6761\u4ef6\u5bf9\u8c61\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u65e0\u6cd5\u77e5\u9053\u662f\u5426\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u53ef\u89c1\u6027\u4fdd\u8bc1"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u62e5\u6709\u548c synchronized\u4e00\u6837\u7684\u5185\u5b58\u8bed\u4e49,\u4e0b\u4e00\u4e2a\u7ebf\u7a0b\u52a0\u9501\u540e\u53ef\u4ee5\u770b\u5230\u524d\u4e00\u4e2a\u7ebf\u7a0b\u89e3\u9501\u524d\u7684\u64cd\u4f5c")))),(0,l.kt)("br",null),(0,l.kt)("h3",{id:"\u53ef\u4e2d\u65ad\u9501\u4e0e\u4e0d\u53ef\u4e2d\u65ad\u9501"},"\u53ef\u4e2d\u65ad\u9501\u4e0e\u4e0d\u53ef\u4e2d\u65ad\u9501"),(0,l.kt)("blockquote",null,(0,l.kt)("font",{color:"red"},"Lock\u662f\u53ef\u4e2d\u65ad\u9501\uff0c\u800csynchronized \u4e0d\u662f\u53ef\u4e2d\u65ad\u9501")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u7ebf\u7a0bA\u548cB\u90fd\u8981\u83b7\u53d6\u5bf9\u8c61Lock\u7684\u9501\uff0c\u5047\u8bbeA\u83b7\u53d6\u4e86\u5bf9\u8c61Lock\u9501\uff0cB\u5c06\u7b49\u5f85A\u91ca\u653eLock\u7684\u9501",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u5982\u679c\u4f7f\u7528 synchronized, \u5982\u679c\u7ebf\u7a0bA\u4e0d\u91ca\u653e\uff0c\u7ebf\u7a0bB\u5c06\u4e00\u76f4\u7b49\u4e0b\u53bb\uff0c\u4e14\u7ebf\u7a0bB\u65e0\u6cd5\u88ab\u4e2d\u65ad")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u5982\u679c\u4f7f\u7528 ReentrantLock\uff0c\u5982\u679c\u7ebf\u7a0bA\u4e0d\u91ca\u653e\uff0c\u53ef\u4ee5\u4f7f\u7ebf\u7a0bB\u5c1d\u8bd5\u83b7\u53d6\u9501(\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4)\uff0c\u5931\u8d25\u540e\u518d\u4e2d\u65ad\u7ebf\u7a0bB"))))),(0,l.kt)("h4",{id:"synchronized\u65e0\u6cd5\u54cd\u5e94\u4e2d\u65ad"},"synchronized\u65e0\u6cd5\u54cd\u5e94\u4e2d\u65ad"),(0,l.kt)("p",null,"\u4e24\u4e2a\u7ebf\u7a0b\u51fa\u73b0\u4e86\u6b7b\u9501\uff0c\u4f7f\u7528synchronized\u7684\u8bdd\u65e0\u6cd5\u4e2d\u65ad\u4e24\u4e2a\u7ebf\u7a0b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class unInterruptLock {\n    private static final Object o1 = new Object();\n    public static void main(String[] args) throws InterruptedException {\n        Thread thread1 = new Thread(() -> {\n            System.out.println(new Date().toLocaleString()+":thread1 \u8fdb\u5165\u4e86...");\n            synchronized (o1) {\n                try {\n                    System.out.println(new Date().toLocaleString()+":thread1 \u83b7\u53d6\u5230\u9501...");\n                    Thread.sleep(20000);\n                    System.out.println(new Date().toLocaleString()+":thread1 \u91ca\u653e\u4e86\u9501...");\n                } catch (InterruptedException e) {\n                    System.out.println(new Date().toLocaleString()+":thread1 \u88ab\u4e2d\u65ad\u4e86...");\n                    e.printStackTrace();\n                }\n            }\n        });\n\n        Thread thread2 = new Thread(() -> {\n            System.out.println(new Date().toLocaleString()+":thread2 \u8fdb\u5165\u4e86...");\n            synchronized (o1) {\n                try {\n                    System.out.println(new Date().toLocaleString()+":thread2 \u83b7\u53d6\u5230\u9501...");\n                    Thread.sleep(1000);\n                    System.out.println(new Date().toLocaleString()+":thread2 \u91ca\u653e\u4e86\u9501...");\n                } catch (InterruptedException e) {\n                    System.out.println(new Date().toLocaleString()+":thread2 \u88ab\u4e2d\u65ad\u4e86...");\n                    e.printStackTrace();\n                }\n            }\n        });\n\n        thread1.start();\n        thread2.start();\n        // \u4e3b\u7ebf\u7a0b\u4f11\u7720\u4e00\u4e0b\uff0c\u8ba9t1,t2\u7ebf\u7a0b\u767e\u5206\u767e\u5df2\u7ecf\u542f\u52a8\uff0c\u907f\u514d\u7ebf\u7a0b\u4ea4\u66ff\u5bfc\u81f4\u6d4b\u8bd5\u7ed3\u679c\u6df7\u6dc6\n        Thread.sleep(1000);\n        // \u4e2d\u65adt2\u7ebf\u7a0b\u7684\u6267\u884c\n        thread2.interrupt();\n        System.out.println(new Date().toLocaleString()+":thread2 \u5c1d\u8bd5\u4e2d\u65ad...");\n\n    }\n}\n\n')),(0,l.kt)("br",null),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(43118).Z,width:"987",height:"380"})),(0,l.kt)("br",null),(0,l.kt)("h4",{id:"lock\u54cd\u5e94\u4e2d\u65ad"},"Lock\u54cd\u5e94\u4e2d\u65ad"),(0,l.kt)("p",null,"\u5982\u679c\u8fd9\u4e2a\u7ebf\u7a0b\u5728\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u91ca\u653e\u9501\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u88ab\u7acb\u5373\u4e2d\u65ad"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class interruptLock {\n    private static final ReentrantLock lock = new ReentrantLock();\n    public static void main(String[] args) throws InterruptedException {\n        Thread thread1 = new Thread(() -> {\n            System.out.println(new Date().toLocaleString()+":thread1 \u8fdb\u5165\u4e86...");\n            try {\n                lock.lockInterruptibly();\n                System.out.println(new Date().toLocaleString()+":thread1 \u83b7\u53d6\u5230\u9501...");\n                Thread.sleep(20000);\n                System.out.println(new Date().toLocaleString()+":thread1 \u91ca\u653e\u4e86\u9501...");\n            } catch (InterruptedException e) {\n                System.out.println(new Date().toLocaleString()+":thread1 \u88ab\u4e2d\u65ad\u4e86...");\n                e.printStackTrace();\n            } finally {\n                lock.unlock();\n            }\n        });\n\n        Thread thread2 = new Thread(() -> {\n            System.out.println(new Date().toLocaleString()+":thread2 \u8fdb\u5165\u4e86...");\n            try {\n                lock.lockInterruptibly();\n                System.out.println(new Date().toLocaleString()+":thread2 \u83b7\u53d6\u5230\u9501...");\n                Thread.sleep(1000);\n                System.out.println(new Date().toLocaleString()+":thread2 \u91ca\u653e\u4e86\u9501...");\n            } catch (InterruptedException e) {\n                System.out.println(new Date().toLocaleString()+":thread2 \u88ab\u4e2d\u65ad\u4e86...");\n                e.printStackTrace();\n            } finally {\n                lock.unlock();\n            }\n        });\n\n        thread1.start();\n        thread2.start();\n        // \u4e3b\u7ebf\u7a0b\u4f11\u7720\u4e00\u4e0b\uff0c\u8ba9t1,t2\u7ebf\u7a0b\u767e\u5206\u767e\u5df2\u7ecf\u542f\u52a8\uff0c\u907f\u514d\u7ebf\u7a0b\u4ea4\u66ff\u5bfc\u81f4\u6d4b\u8bd5\u7ed3\u679c\u6df7\u6dc6\n        Thread.sleep(1000);\n        // \u4e2d\u65adt2\u7ebf\u7a0b\u7684\u6267\u884c\n        thread2.interrupt();\n        System.out.println(new Date().toLocaleString()+":thread2 \u5c1d\u8bd5\u4e2d\u65ad...");\n\n    }\n}\n\n')),(0,l.kt)("br",null),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(89359).Z,width:"943",height:"308"})),(0,l.kt)("h3",{id:"lock\u4e3b\u8981\u65b9\u6cd5\u4ecb\u7ecd"},"Lock\u4e3b\u8981\u65b9\u6cd5\u4ecb\u7ecd"),(0,l.kt)("h4",{id:"\u65b9\u6cd5\u6982\u8ff0"},"\u65b9\u6cd5\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"lock()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7528\u6765\u83b7\u53d6\u9501\u5bf9\u8c61\uff0c\u8c03\u7528\u8be5\u65b9\u6cd5\u7684\u7ebf\u7a0b\u5c06\u4f1a\u83b7\u53d6\u9501\uff0c\u5f53\u83b7\u53d6\u5230\u9501\u540e\uff0c\u4ece\u8be5\u65b9\u6cd5\u8fd4\u56de",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u9501\u88ab\u522b\u7684\u7ebf\u7a0b\u6301\u6709\uff0c\u90a3\u5f53\u524d\u7ebf\u7a0b\u4f1a\u4e00\u76f4\u5904\u4e8e\u7b49\u5f85(waiting)\u72b6\u6001\uff0c\u76f4\u5230\u83b7\u53d6\u9501"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"lock\u65b9\u6cd5\u4e0d\u80fd\u88ab\u4e2d\u65ad")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"lockInterruptibly()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u53ef\u4e2d\u65ad\u7684\u83b7\u53d6\u9501")),(0,l.kt)("li",{parentName:"ul"},"\u4e0elock()\u65b9\u6cd5\u4e0d\u4e00\u6837\u7684\u662f\uff0c\u8be5\u65b9\u6cd5\u4f1a\u54cd\u5e94\u4e2d\u65ad\uff0c\u5373\u5728\u9501\u7684\u83b7\u53d6\u8fc7\u7a0b\u4e2d\u4e2d\u65ad\u5f53\u524d\u7ebf\u7a0b"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"tryLock([long timeout, TimeUnit unit])"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5c1d\u8bd5\u83b7\u53d6\u9501(\u53c2\u6570\u65f6\u7528\u4e8e\u914d\u7f6e\u8d85\u65f6\u53c2\u6570\u7684)\uff0c\u5f53\u524d\u7ebf\u7a0b\u5728\u4e0b\u9762\u4e09\u79cd\u60c5\u51b5\u4f1a\u8fd4\u56de:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"\u5728\u8d85\u65f6\u65f6\u95f4\u5185\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u8fd4\u56detrue")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"\u5728\u8d85\u65f6\u65f6\u95f4\u5185\u88ab\u4e2d\u65ad ->\u4f1a\u629b\u51fa ",(0,l.kt)("inlineCode",{parentName:"em"},"InterruptedException"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"\u8d85\u65f6\u65f6\u95f4\u7ed3\u675f\u8fd4\u56defalse")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"unlock()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u91ca\u653e\u9501"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"newCondition()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u83b7\u53d6\u4e0e\u9501\u5bf9\u8c61\u5173\u8054\u7684\u6761\u4ef6\u5bf9\u8c61\u8fd4\u56de ",(0,l.kt)("inlineCode",{parentName:"li"},"Conition")," \u6761\u4ef6\u5bf9\u8c61"),(0,l.kt)("li",{parentName:"ul"},"\u6ce8\u610f\uff1aLock\u9501",(0,l.kt)("inlineCode",{parentName:"li"},"\u53ef\u4ee5\u6709\u591a\u4e2a"),"\u4e0e\u4e4b\u5173\u8054\u7684\u6761\u4ef6\u5bf9\u8c61")))),(0,l.kt)("h4",{id:"trylock-\u907f\u514d\u6b7b\u9501"},"tryLock \u907f\u514d\u6b7b\u9501"),(0,l.kt)("p",null,"tryLock\u7684\u65b9\u5f0f\u907f\u514d\u4e86A\u7ebf\u7a0b\u83b7\u53d6\u9501\u540e\uff0cB\u7ebf\u7a0b\u88ab\u963b\u585e\u4f4f\u7684\u60c5\u51b5\u3002\u800c\u662f\u7531\u4ee3\u7801\u51b3\u5b9a\u65e0\u6cd5\u83b7\u53d6\u9501\u7684\u540e\u7eed\u5904\u7406\u3002\u800csynchronized\u53ea\u80fd\u88ab\u963b\u585e\u3002"),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u6bd4\u5982\u5728\u83b7\u53d6\u4e86\u95011\u540e\uff0c\u5c1d\u8bd5\u83b7\u53d6\u53e6\u4e00\u628a\u95012\u3002\u5982\u679c\u7b49\u5f85\u4e86\u4e00\u6bb5\u65f6\u95f4\u540e\u8fd8\u662f\u6ca1\u6709\u80fd\u83b7\u53d6\u5230\u95012\uff0c\u4fbf\u653e\u5f03\u83b7\u53d6\u95012\uff0c\u4fdd\u8bc1\u4e0d\u963b\u65ad\u63a5\u4e0b\u6765\u7684\u6d41\u7a0b\uff0c\u4ece\u800c\u907f\u514d\u6b7b\u9501")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class tryLockDemo {\n    public static final Lock lock1 = new ReentrantLock();\n    public static final Lock lock2 = new ReentrantLock();\n    public static void main(String[] args) {\n        Thread thread1 = new Thread(() -> {\n            for (int i = 0; i < 100; i++) {\n                try {\n                    // \u5c1d\u8bd5\u83b7\u53d6 lock1\n                    if (lock1.tryLock(3000, TimeUnit.MILLISECONDS)) {\n                        try {\n                            System.out.println("thread1 \u83b7\u53d6\u5230\u4e86lock1...");\n                            Thread.sleep(new Random().nextInt(1000));\n                                // \u5c1d\u8bd5\u83b7\u53d6 lock2\n                            if (lock2.tryLock(3000, TimeUnit.MILLISECONDS)) {\n                                try {\n                                    System.out.println("thread1 \u83b7\u53d6\u5230\u4e86lock2...");\n                                    System.out.println("thread1 \u83b7\u53d6\u5230\u4e86\u4e24\u628a\u9501...");\n                                    break;\n                                } finally {\n                                    lock2.unlock(); // \u83b7\u53d6\u5230lock2,\u624b\u52a8\u91ca\u653e\n                                }\n                            } else {\n                                System.out.println("thread1 \u6ca1\u6709\u83b7\u53d6\u5230lock2,\u5c1d\u8bd5\u91cd\u65b0\u83b7\u53d6...");\n                            }\n                        } finally {\n                            // \u83b7\u53d6\u5230lock1\u9700\u8981\u624b\u52a8\u91ca\u653e\n                            lock1.unlock();\n                        }\n                    } else {\n                        System.out.println("thread1 \u6ca1\u6709\u83b7\u53d6\u5230lock1,\u5c1d\u8bd5\u91cd\u65b0\u83b7\u53d6...");\n                    }\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        });\n        Thread thread2 = new Thread(() -> {\n            for (int i = 0; i < 100; i++) {\n                try {\n                    if (lock2.tryLock(1000, TimeUnit.MILLISECONDS)) {\n                        try {\n                            System.out.println("thread2 \u83b7\u53d6\u5230\u4e86lock2...");\n                            Thread.sleep(new Random().nextInt(1000));\n                            if (lock1.tryLock(1000, TimeUnit.MILLISECONDS)) {\n                                try {\n                                    System.out.println("thread2 \u83b7\u53d6\u5230\u4e86lock1...");\n                                    System.out.println("thread2 \u83b7\u53d6\u5230\u4e86\u4e24\u628a\u9501...");\n                                    break;\n                                } finally {\n                                    lock1.unlock(); // \u83b7\u53d6\u5230lock1,\u5c31\u91ca\u653e\n                                }\n                            }else {\n                                System.out.println("thread2 \u6ca1\u6709\u83b7\u53d6\u5230lock1,\u5c1d\u8bd5\u91cd\u65b0\u83b7\u53d6...");\n                            }\n                        } finally {\n                            lock2.unlock();\n                        }\n                    } else {\n                        System.out.println("thread2 \u6ca1\u6709\u83b7\u53d6\u5230lock2,\u5c1d\u8bd5\u91cd\u65b0\u83b7\u53d6...");\n                    }\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        });\n        thread1.start();\n        thread2.start();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(52209).Z,width:"516",height:"329"})),(0,l.kt)("h2",{id:"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501"},"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501"),(0,l.kt)("h3",{id:"\u6982\u8ff0-1"},"\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4e24\u8005\u7684\u533a\u522b"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u60b2\u89c2\u9501 [\u4e92\u65a5\u540c\u6b65\u9501]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4f1a\u9501\u4f4f\u540c\u6b65\u8d44\u6e90\u3002\u60b2\u89c2\u9501\u8ba4\u4e3a\u5982\u679c\u4e0d\u9501\u4f4f\u540c\u6b65\u8d44\u6e90,\u5176\u4ed6\u7684\u7ebf\u7a0b\u5c31\u4f1a\u6765\u4e89\u62a2\uff0c\u9020\u6210\u6570\u636e\u7684\u9519\u8bef")),(0,l.kt)("li",{parentName:"ul"},"\u60b2\u89c2\u9501\u4e3a\u4e86\u4fdd\u8bc1\u7ed3\u679c\u7684\u6b63\u786e\u6027\uff0c\u4f1a\u5728\u6bcf\u6b21\u83b7\u53d6\u5e76\u4e14\u4fee\u6539\u6570\u636e\u7684\u65f6\u5019\uff0c\u628a\u6570\u636e\u9501\u4f4f\uff0c\u4e0d\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u8bbf\u95ee\u8be5\u6570\u636e(\u65e0\u8bba\u8bfb\u53d6\u8fd8\u662f\u5199\u5165)\uff0c\u4ee5\u6b64\u4fdd\u8bc1\u6570\u636e\u5185\u5bb9\u7684\u6b63\u786e"),(0,l.kt)("li",{parentName:"ul"},"\u5178\u578b\u7684\u60b2\u89c2\u9501: ",(0,l.kt)("inlineCode",{parentName:"li"},"synchronized\u4e0eLock\u76f8\u5173\u7684\u7c7b")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u4e50\u89c2\u9501 [\u975e\u4e92\u65a5\u540c\u6b65\u9501]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4e0d\u4f1a\u9501\u4f4f\u540c\u6b65\u8d44\u6e90\u3002\u4e50\u89c2\u9501\u8ba4\u4e3a\u81ea\u5df1\u5728\u5904\u7406\u662f\uff0c\u4e0d\u4f1a\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b\u6765\u5e72\u6270\uff0c\u6240\u4ee5\u4e0d\u4f1a\u9501\u4f4f\u88ab\u64cd\u4f5c\u7684\u5bf9\u8c61")),(0,l.kt)("li",{parentName:"ul"},"\u5728\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u53bb\u5bf9\u6bd4\u4fee\u6539\u671f\u95f4\u6570\u636e\u662f\u5426\u88ab\u5176\u4ed6\u4eba\u6539\u53d8\u8fc7",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5982\u679c\u6ca1\u6709\u6539\u53d8\u8fc7\uff0c\u8bf4\u660e\u53ea\u6709\u5f53\u524d\u7ebf\u7a0b\u8fdb\u884c\u64cd\u4f5c\uff0c\u90a3\u4e48\u6b63\u5e38\u4fee\u6539\u6570\u636e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5982\u679c\u6539\u53d8\u8fc7\uff0c\u8bf4\u660e\u5176\u4ed6\u7ebf\u7a0b\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u4fee\u6539\u8fc7\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u4e0d\u7ee7\u7eed\u66f4\u65b0\uff0c\u800c\u662f\u9009\u62e9\u653e\u5f03\u3001\u62a5\u9519\u3001\u91cd\u8bd5\u7b49\u7b56\u7565")))),(0,l.kt)("li",{parentName:"ul"},"\u4e50\u89c2\u9501\u7684\u5b9e\u73b0\u4e00\u822c\u90fd\u662f\u901a\u8fc7",(0,l.kt)("font",{color:"red"},(0,l.kt)("strong",{parentName:"li"},"CAS\u7b97\u6cd5")),"\u5b9e\u73b0\u7684 "),(0,l.kt)("li",{parentName:"ul"},"\u5178\u578b\u7684\u4e50\u89c2\u9501: ",(0,l.kt)("inlineCode",{parentName:"li"},"\u539f\u5b50\u7c7b\u3001\u5e76\u53d1\u5bb9\u5668\u7b49")),(0,l.kt)("li",{parentName:"ul"},"\u5176\u4ed6\u4e50\u89c2\u9501\u7684\u6848\u4f8b",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"Git"),": \u6bd4\u8f83\u7248\u672c\u53f7\uff0c\u5982\u679c\u7248\u672c\u4e0e\u672c\u5730\u4e0d\u4e00\u81f4\uff0c\u90a3\u4e48\u4e45\u63d0\u4ea4\u5931\u8d25\u3002\u53ea\u6709\u8fdc\u7aef\u4ed3\u5e93\u4e0e\u672c\u5730\u7248\u672c\u53f7\u4e00\u76f4\uff0c\u624d\u53ef\u4ee5\u63d0\u4ea4"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"\u6570\u636e\u5e93"),":\u6dfb\u52a0\u7248\u672c\u53f7\u5b57\u6bb5\uff0c\u5728\u66f4\u65b0\u7684\u65f6\u5019\u6bd4\u8f83\u7248\u672c\u53f7"))))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u4e92\u65a5\u540c\u6b65\u9501(\u60b2\u89c2\u9501)\u7684\u52a3\u52bf"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u963b\u585e\u548c\u5524\u9192\u5e26\u6765\u7684\u5f00\u9500\u8f83\u5927\uff0c\u6709\u6027\u80fd\u52a3\u52bf")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u6c38\u4e45\u963b\u585e"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u88ab\u6c38\u4e45\u7684\u963b\u585e\uff0c\u6bd4\u5982\u9047\u5230\u4e86\u65e0\u7ebf\u5faa\u73af\u3001\u6b7b\u9501\u7b49\uff0c\u90a3\u4e48\u5176\u4ed6\u7b49\u5f85\u83b7\u53d6\u9501\u7684\u51e0\u4e2a\u7ebf\u7a0b\u6c38\u8fdc\u65e0\u6cd5\u6267\u884c"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4f18\u5148\u7ea7\u53cd\u8f6c"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7b49\u5f85\u9501\u7684\u7ebf\u7a0b\u4f18\u5148\u7ea7\u9ad8\uff0c\u6301\u6709\u9501\u7684\u4f18\u5148\u7ea7\u4f4e\uff0c\u4f18\u5148\u7ea7\u4f4e\u7684\u7ebf\u7a0b\u957f\u65f6\u95f4\u4e0d\u91ca\u653e\u9501\u7684\u8bdd\uff0c\u540e\u9762\u7684\u7ebf\u7a0b\u65e0\u8bba\u4f18\u5148\u7ea7\u591a\u9ad8\u90fd\u6ca1\u6709\u7528"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u4e24\u79cd\u9501\u7684\u5f00\u9500\u6bd4\u5bf9"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u60b2\u89c2\u9501\u7684\u539f\u59cb\u5f00\u9500\u9ad8\u4e8e\u4e50\u89c2\u9501\uff0c\u4f46\u662f\u7279\u70b9\u662f",(0,l.kt)("strong",{parentName:"li"},"\u4e00\u52b3\u6c38\u9038"),"\uff0c\u4e34\u754c\u533a\u65a5\u9501\u65f6\u95f4\u5c31\u7b97\u8d8a\u6765\u8d8a\u5e38\uff0c\u4e5f\u4e0d\u4f1a\u5bf9\u4e92\u65a5\u9501\u7684\u5f00\u9500\u9020\u6210\u5f71\u54cd"),(0,l.kt)("li",{parentName:"ul"},"\u4e50\u89c2\u9501\u4e00\u5f00\u59cb\u7684\u5f00\u9500\u6bd4\u60b2\u89c2\u9501\u5c0f\uff0c\u4f46\u662f",(0,l.kt)("strong",{parentName:"li"},"\u5982\u679c\u81ea\u65cb\u7684\u65f6\u95f4\u5f88\u957f\u6216\u8005\u4e0d\u505c\u7684\u91cd\u8bd5\uff0c\u90a3\u4e48\u6d88\u8017\u7684CPU\u8d44\u6e90\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u591a")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u4e24\u79cd\u9501\u7684\u4f7f\u7528\u573a\u666f"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u60b2\u89c2\u9501"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u9002\u5408\u5e76\u53d1\u5199\u5165\u591a\u7684\u60c5\u51b5\uff0c\u9002\u7528\u4e8e\u4e34\u754c\u533a\u6301\u9501\u65f6\u95f4\u8f83\u957f\u7684\u60c5\u51b5\u3002\u60b2\u89c2\u9501\u53ef\u4ee5\u907f\u514d\u5927\u91cf\u7684\u65e0\u7528\u81ea\u65cb\u7b49\u6d88\u8017")),(0,l.kt)("li",{parentName:"ul"},"\u5178\u578b\u60c5\u51b5",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e34\u754c\u533a\u6709IO\u64cd\u4f5c"),(0,l.kt)("li",{parentName:"ul"},"\u4e34\u754c\u533a\u7684\u4ee3\u7801\u590d\u6742\u6216\u8005\u5faa\u73af\u91cf\u5927"),(0,l.kt)("li",{parentName:"ul"},"\u4e34\u754c\u533a\u7ade\u4e89\u975e\u5e38\u6fc0\u70c8 -> \u5982\u679c\u7528\u4e50\u89c2\u9501\uff0c\u7531\u4e8e\u4f1a\u591a\u4e2a\u7ebf\u7a0b\u4fee\u6539\uff0c\u6240\u4ee5CAS\u6bd4\u8f83\u540e\u5927\u90e8\u5206\u90fd\u662f\u65e0\u6cd5\u66f4\u65b0\uff0c\u9700\u8981\u91cd\u8bd5"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4e50\u89c2\u9501"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u9002\u5408\u5e76\u53d1\u5199\u5165\u5c11\u7684\u60c5\u51b5\uff0c\u5927\u90e8\u5206\u662f\u8bfb\u53d6\u64cd\u4f5c\u3002\u4e0d\u52a0\u9501\u53ef\u4ee5\u8ba9\u8bfb\u53d6\u6027\u80fd\u5927\u5e45\u5ea6\u63d0\u9ad8"))))))),(0,l.kt)("h3",{id:"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501\u7684\u6f14\u793a"},"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501\u7684\u6f14\u793a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>++\u64cd\u4f5c\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501\u7684\u6f14\u793a</b>\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class LockDemo1 {\n    public static Object obj = new Object();\n    public static Lock lock = new ReentrantLock();\n    public static AtomicInteger atomicA = new AtomicInteger(0);\n    public static int a;\n\n    /* \u60b2\u89c2\u9501synchronized\u6f14\u793a\u7684\u793a\u4f8b */\n    public void add(){\n        synchronized (obj) {\n            a++;\n        }\n    }\n    /* \u60b2\u89c2\u9501lock\u7684\u6f14\u793a */\n    public void add2() {\n        lock.lock();\n        try {\n           a++;\n        }finally {\n            lock.unlock();\n        }\n    }\n    /* \u4e50\u89c2\u9501 AtomicInteger,\u5e95\u5c42\u91c7\u7528CAS\u7b97\u6cd5 */\n    public void add3() {\n        atomicA.incrementAndGet();  //\u7b49\u4ef7\u4e8e++a\n    }\n}\n')),(0,l.kt)("h2",{id:"\u53ef\u91cd\u5165\u9501\u4e0e\u975e\u53ef\u91cd\u5165\u9501"},"\u53ef\u91cd\u5165\u9501\u4e0e\u975e\u53ef\u91cd\u5165\u9501"),(0,l.kt)("h3",{id:"\u6982\u8ff0-2"},"\u6982\u8ff0"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u53ef\u91cd\u5165\u7684\u610f\u601d\u662f: \u4efb\u610f\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u4e4b\u540e\u53ef\u4ee5\u518d\u6b21\u83b7\u53d6\u9501\u800c\u4e0d\u4f1a\u88ab\u963b\u585e"),(0,l.kt)("p",{parentName:"blockquote"},"\u8be5\u7279\u6027\u9700\u8981\u89e3\u51b3\u4e24\u4e2a\u95ee\u9898:"),(0,l.kt)("ol",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ol"},"\u9501\u7684\u518d\u6b21\u83b7\u53d6: \u5224\u65ad\u8bf7\u6c42\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u662f\u5426\u662f\u5f53\u524d\u5360\u6709\u9501\u7684\u7ebf\u7a0b\uff0c\u5982\u679c\u662f\u7684\u8bdd\u53ef\u4ee5\u518d\u6b21\u83b7\u53d6\u6210\u529f"),(0,l.kt)("li",{parentName:"ol"},"\u9501\u7684\u6700\u7ec8\u91ca\u653e: \u7ebf\u7a0b\u91cd\u590dn\u6b21\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u90a3\u4e48\u5c31\u5728\u968f\u540e\u7684n\u6b21\u91ca\u653e\u9501\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u83b7\u53d6\u5230\u9501")),(0,l.kt)("ul",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ul"},"\u9501\u7684\u6700\u7ec8\u91ca\u653e\u8981\u6c42\u9501\u5728\u83b7\u53d6\u7684\u65f6\u5019\u8fdb\u884c\u8ba1\u6570\u7684\u81ea\u589e\uff0c\u8ba1\u6570\u8868\u793a\u5f53\u524d\u9501\u88ab\u7ebf\u7a0b\u91cd\u590d\u6301\u6709\u7684\u6b21\u6570\uff0c\u800c\u9501\u88ab\u91ca\u653e\u7684\u65f6\u5019\uff0c\u8ba1\u6570\u81ea\u51cf\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u5f53\u8ba1\u6570\u7b49\u4e8e0\u7684\u65f6\u5019\uff0c\u8868\u793a\u9501\u88ab\u6210\u529f\u7684\u91ca\u653e\u4e86\u3002"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u53ef\u91cd\u5165\u9501 [\u9012\u5f52\u9501]")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5141\u8bb8\u540c\u4e00\u4e2a\u7ebf\u7a0b\u591a\u6b21\u83b7\u53d6\u540c\u4e00\u628a\u9501\uff0c\u800c\u4e0d\u9700\u8981\u91ca\u653e\u8fd9\u628a\u9501\u91cd\u65b0\u83b7\u53d6\u3002Lock \u548c synchronized \u90fd\u662f\u53ef\u91cd\u5165\u9501")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u91cd\u5165\u9501\u8bf4\u660e \u9501\u7684\u64cd\u4f5c\u7c92\u5ea6\u662f\u201d\u7ebf\u7a0b\u201c\uff0c\u800c\u4e0d\u662f\u201c\u8c03\u7528\u201d")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u4e0d\u53ef\u91cd\u5165\u9501")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5178\u578b\u7684\u662f: ",(0,l.kt)("font",{color:"red"},"ThreadPoolExecutor#Worker")," "))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u53ef\u91cd\u5165\u9501\u7684\u597d\u5904")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u907f\u514d\u6b7b\u9501"),(0,l.kt)("li",{parentName:"ul"},"\u63d0\u9ad8\u5c01\u88c5\u6027 -> ",(0,l.kt)("font",{color:"red"},"\u5229\u7528\u53ef\u91cd\u5165\u7684\u6027\u8d28,\u53ef\u4ee5\u9012\u5f52\u8c03\u7528\u65b9\u6cd5\u800c\u4e0d\u7528\u62c5\u5fc3\u91cd\u65b0\u91ca\u653e\u9501-\u52a0\u9501\u6d88\u8017\u8d44\u6e90"))))),(0,l.kt)("h3",{id:"reentrantlock\u5e38\u89c1\u65b9\u6cd5"},"ReentrantLock\u5e38\u89c1\u65b9\u6cd5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"reentrantLock.getHoldCount()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u9501\u7684\u6301\u6709\u8ba1\u6570"),(0,l.kt)("li",{parentName:"ul"},"\u6bcf\u6b21\u8c03\u7528lock()\u65b9\u6cd5\u540e\uff0c\u8fd9\u4e2a\u8ba1\u6570\u5668\u4f1a\u52a01\uff0cunlock()\u65b9\u6cd5\u4f1a\u51cf1\uff0c\u53d8\u4e3a0\u5c31\u8bf4\u660e\u91ca\u653e\u4e86\u9501"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"reentrantLock.isHeldByCurrentThread()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u9501\u662f\u5426\u88ab\u5f53\u524d\u7ebf\u7a0b\u6301\u6709"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"reentrantLock.getQueueLength()"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u5f53\u524d\u6b63\u5728\u7b49\u5f85\u8fd9\u628a\u9501\u7684\u961f\u5217\u6709\u591a\u957f")))),(0,l.kt)("h3",{id:"reentrantlock\u5173\u7cfb\u56fe"},"ReentrantLock\u5173\u7cfb\u56fe"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"ReentrantLock\u4e2d\u6709\u4e00\u4e2aSync\u7684\u5185\u90e8\u7c7b\uff0c\u8fd9\u4e2a\u5185\u90e8\u7c7b\u5b9e\u73b0\u4e86AQS"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("font",{color:"red"},"\u91cd\u5165\u9501\u7684\u72b6\u6001\u4fdd\u5b58\u5728Sync\u5185\u90e8\u7c7b\u7684\u7684state\u5b57\u6bb5\u4e2d\u7684(\u7ee7\u627f\u81ea\u7236\u7c7bAQS)\uff0c\u4fee\u6539\u548c\u8bfb\u53d6\u8fd9\u4e2a\u72b6\u6001\u90fd\u662f\u901a\u8fc7AQS\u5b9e\u73b0\u7684")),(0,l.kt)("li",{parentName:"ol"},"\u516c\u5e73\u4e0e\u975e\u516c\u5e73\u9501\u7684\u5b9e\u73b0\u662f\u7531 ReentrantLock \u7684\u5185\u90e8\u7c7b FairSync \u548c NonfairSync\u5b9e\u73b0\u7684")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(60192).Z,width:"1174",height:"1138"})),(0,l.kt)("h3",{id:"reentrantlock\u53ef\u91cd\u5165\u9501\u6f14\u793a"},"ReentrantLock\u53ef\u91cd\u5165\u9501\u6f14\u793a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>\u6f14\u793aLock\u7684\u53ef\u91cd\u5165\u9501</b>\n *\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class ReentrantLockDemo {\n    private static final ReentrantLock lock = new ReentrantLock();\n    private static Logger log = LoggerFactory.getLogger(ReentrantLockDemo.class);\n\n    public static void main(String[] args) {\n        new Thread(() -> {\n            lock.lock();\n            try {\n                log.info("\u8fdb\u5165\u7b2c\u4e00\u5c42\u9501,\u5f53\u524d\u9501\u6301\u6709\u6b21\u6570\u4e3a:{}",lock.getHoldCount());\n                lock.lock();\n                try {\n                    log.info("\u8fdb\u5165\u7b2c\u4e8c\u5c42\u9501,\u5f53\u524d\u9501\u6301\u6709\u6b21\u6570\u4e3a:{}",lock.getHoldCount());\n                }finally {\n                    lock.unlock();\n                    log.info("\u91ca\u653e\u7b2c\u4e8c\u5c42\u9501,\u5f53\u524d\u9501\u6301\u6709\u6b21\u6570\u4e3a:{}",lock.getHoldCount());\n                }\n            }finally {\n                lock.unlock();\n                log.info("\u91ca\u653e\u7b2c\u4e00\u5c42\u9501,\u5f53\u524d\u9501\u6301\u6709\u6b21\u6570\u4e3a:{}",lock.getHoldCount());\n            }\n        }).start();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(59029).Z,width:"887",height:"154"})),(0,l.kt)("h3",{id:"\u53ef\u91cd\u5165\u7684\u57fa\u672c\u539f\u7406"},"\u53ef\u91cd\u5165\u7684\u57fa\u672c\u539f\u7406"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"java.util.concurrent.locks.ReentrantLock.Sync#nonfairTryAcquire"),(0,l.kt)("li",{parentName:"ol"},"java.util.concurrent.locks.ReentrantLock.Sync#tryRelease"),(0,l.kt)("li",{parentName:"ol"},"java.util.concurrent.locks.ReentrantLock.Sync#getHoldCount")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(94864).Z,width:"1085",height:"993"})),(0,l.kt)("h3",{id:"\u4e0d\u53ef\u91cd\u5165\u7684\u57fa\u672c\u539f\u7406"},"\u4e0d\u53ef\u91cd\u5165\u7684\u57fa\u672c\u539f\u7406"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"java.util.concurrent.ThreadPoolExecutor.Worker#tryAcquire"),(0,l.kt)("li",{parentName:"ol"},"java.util.concurrent.ThreadPoolExecutor.Worker#tryRelease")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(38686).Z,width:"796",height:"346"})),(0,l.kt)("h2",{id:"\u516c\u5e73\u9501\u4e0e\u975e\u516c\u5e73\u9501"},"\u516c\u5e73\u9501\u4e0e\u975e\u516c\u5e73\u9501"),(0,l.kt)("h3",{id:"\u6982\u8ff0-3"},"\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u533a\u522b?")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u516c\u5e73\u9501"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u4e00\u4e2a\u6765"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u6309\u7167\u7ebf\u7a0b\u8bf7\u6c42\u7684\u987a\u5e8f\u6765\u5206\u914d\u9501"),",\u7ebf\u7a0b\u4f1a\u76f4\u63a5\u8fdb\u5165\u7b49\u5f85\u961f\u5217\u53bb\u6392\u961f\uff0c\u53ea\u6709\u7b49\u5f85\u961f\u5217\u91cc\u7684\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u83b7\u53d6\u5230\u9501"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u975e\u516c\u5e73\u9501 [\u9ed8\u8ba4]"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8c01\u62a2\u5230\u5c31\u662f\u8c01\u7684"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4e0d\u5b8c\u5168\u6309\u7167\u7ebf\u7a0b\u8bf7\u6c42\u7684\u987a\u5e8f\u6765\u5206\u914d\u9501\uff0c\u5728",(0,l.kt)("strong",null,"\u4e00\u5b9a\u7684\u60c5\u51b5"),"\u4e0b\u53ef\u4ee5\u63d2\u961f"),"(\u662f\u5728\u5408\u9002\u7684\u65f6\u673a\u624d\u4f1a\u63d2\u961f)")))),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},"// \u516c\u5e73\u9501\u4e0e\u975e\u516c\u5e73\u9501\u7684\u521b\u5efa\npublic ReentrantLock(boolean fair) {\n  sync = fair ? new FairSync() : new NonfairSync();\n}\n")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4e24\u79cd\u9501\u7684\u4f18\u7f3a\u70b9"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u975e\u516c\u5e73\u9501",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f18\u70b9\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6267\u884c\u6548\u7387\u9ad8,\u53ef\u4ee5\u51cf\u5c11CPU\u5524\u9192\u7ebf\u7a0b\u7684\u5f00\u9500\uff0c\u6574\u4f53\u7684\u541e\u5410\u6548\u7387\u4f1a\u9ad8\u70b9\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u907f\u514d\u5524\u9192\u5e26\u6765\u7684\u7a7a\u6863\u671f"),"\uff0cCPU\u4e0d\u5fc5\u53d6\u5524\u9192\u6240\u6709\u7ebf\u7a0b\uff0c\u4f1a\u51cf\u5c11\u5524\u8d77\u7ebf\u7a0b\u7684\u6570\u91cf"))),(0,l.kt)("li",{parentName:"ul"},"\u7f3a\u70b9: \u53ef\u80fd\u5bfc\u81f4\u961f\u5217\u4e2d\u95f4\u7684\u7ebf\u7a0b\u4e00\u76f4\u83b7\u53d6\u4e0d\u5230\u9501\u6216\u8005\u957f\u65f6\u95f4\u83b7\u53d6\u4e0d\u5230\u9501\uff0c\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u997f\u6b7b"))),(0,l.kt)("li",{parentName:"ul"},"\u516c\u5e73\u9501",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f18\u70b9: \u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u80fd\u5f97\u5230\u8d44\u6e90,\u90fd\u6709\u6267\u884c\u7684\u673a\u4f1a\uff0c\u4e0d\u4f1a\u997f\u6b7b\u5728\u961f\u5217\u4e2d"),(0,l.kt)("li",{parentName:"ul"},"\u7f3a\u70b9: \u541e\u5410\u91cf\u4f1a\u4e0b\u964d\u5f88\u591a\uff0c\u961f\u5217\u91cc\u9762\u9664\u4e86\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u5176\u4ed6\u7684\u7ebf\u7a0b\u90fd\u4f1a\u963b\u585e\uff0ccpu\u5524\u9192\u963b\u585e\u7ebf\u7a0b\u7684\u5f00\u9500\u4f1a\u5f88\u5927")))))),(0,l.kt)("h3",{id:"\u516c\u5e73\u9501\u7684\u6f14\u793a"},"\u516c\u5e73\u9501\u7684\u6f14\u793a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6240\u6709\u7ebf\u7a0b\u90fd\u5f97\u5230\u6267\u884c\uff0c\u5e76\u4e14\u662f\u6309\u7167\u6392\u961f\u987a\u5e8f\u6267\u884c"),(0,l.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b1\u5360\u6709\u9501\u65f6\uff0c\u7ebf\u7a0b2\u8bf7\u6c42\u83b7\u53d6\u9501\u3002\u5f53\u7ebf\u7a0b1\u6267\u884c\u5b8c\u91ca\u653e\u9501\u540e\uff0c\u5373\u4f7f\u7ebf\u7a0b1\u80fd\u5f88\u5feb\u7684\u6267\u884c\u5b8c\u4efb\u52a1\u3002\u4f46\u662f\u516c\u5e73\u9501\u7684\u6301\u6709\u6309\u7167\u8bf7\u6c42\u987a\u5e8f\u5206\u914d\u9501\uff0c\u6240\u4ee5\u7ebf\u7a0b2\u83b7\u53d6\u5230\u4e86\u6267\u884c\u6743\uff0c\u7ebf\u7a0b3\u4e5f\u4e00\u6837\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class FairLockDemo {\n    // \u521b\u5efa\u4e00\u4e2a\u516c\u5e73\u9501\n    private static final ReentrantLock fairLock = new ReentrantLock(true);\n    private static int ticketNum = 10;\n\n    public static void sellTicket() {\n        fairLock.lock();\n        try {\n            if (ticketNum > 0) {\n                System.out.printf("\u7ebf\u7a0b%s\u83b7\u53d6\u5230\u4e86\u9501,\u5f53\u524d\u9501\u7684\u52a0\u9501\u6b21\u6570\u4e3a:%d,\u7b49\u5f85\u961f\u5217\u6709:%d\u4e2a,\u5356\u51fa:%d\u53f7,\u5269\u4f59:%d\\r\\n",\n                        ThreadUtil.getThreadInfo3(),fairLock.getHoldCount(),fairLock.getQueueLength(),ticketNum,--ticketNum);\n            }\n        } finally {\n            fairLock.unlock();\n        }\n    }\n\n    public static void main(String[] args) {\n        new Thread(() -> {\n            for (int j = 0; j < 100; j++) {\n                sellTicket();\n            }\n        },"Thread1").start();\n        new Thread(() -> {\n            for (int j = 0; j < 100; j++) {\n                sellTicket();\n            }\n        },"Thread2").start();\n        new Thread(() -> {\n            for (int j = 0; j < 100; j++) {\n                sellTicket();\n            }\n        },"Thread3").start();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(37923).Z,width:"927",height:"277"})),(0,l.kt)("h3",{id:"\u975e\u516c\u5e73\u9501\u7684\u6f14\u793a"},"\u975e\u516c\u5e73\u9501\u7684\u6f14\u793a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u7ebf\u7a0b1\u62a2\u5230\u9501\u540e\uff0c\u7ebf\u7a0b2\u4f1a\u88ab\u963b\u585e\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002\u5f53\u7ebf\u7a0b1\u91ca\u653e\u5b8c\u9501\uff0c\u7ebf\u7a0bB\u4ece\u7b49\u5f85\u72b6\u6001\u5230\u8fd0\u884c\u72b6\u6001\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u3002\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u7ebf\u7a0b1\u62a2\u5230\u4e86\u9501\u5e76\u7ee7\u7eed\u6267\u884c\u3002"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class UnFairLockDemo {\n    // \u521b\u5efa\u4e00\u4e2a\u975e\u516c\u5e73\u9501\n    private static final ReentrantLock unfairLock = new ReentrantLock(false);\n    private static int ticketNum = 10;\n\n    public static void sellTicket() {\n        unfairLock.lock();\n        try {\n            if (ticketNum > 0) {\n                System.out.printf("\u7ebf\u7a0b%s\u83b7\u53d6\u5230\u4e86\u9501,\u5f53\u524d\u9501\u7684\u52a0\u9501\u6b21\u6570\u4e3a:%d,\u7b49\u5f85\u961f\u5217\u6709:%d\u4e2a,\u5356\u51fa:%d\u53f7,\u5269\u4f59:%d\\r\\n",\n                        ThreadUtil.getThreadInfo3(),unfairLock.getHoldCount(),unfairLock.getQueueLength(),ticketNum,--ticketNum);\n            }\n        } finally {\n            unfairLock.unlock();\n        }\n    }\n\n    public static void main(String[] args) {\n        new Thread(() -> {\n            for (int j = 0; j < 100; j++) {\n                sellTicket();\n            }\n        },"Thread1").start();\n        new Thread(() -> {\n            for (int j = 0; j < 100; j++) {\n                sellTicket();\n            }\n        },"Thread2").start();\n        new Thread(() -> {\n            for (int j = 0; j < 100; j++) {\n                sellTicket();\n            }\n        },"Thread3").start();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(42460).Z,width:"898",height:"266"})),(0,l.kt)("h3",{id:"\u7279\u4f8b"},"\u7279\u4f8b"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"tryLock()\u65b9\u6cd5\u4e0d\u9075\u5b88\u8bbe\u5b9a\u7684\u516c\u5e73\u539f\u5219")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5f53\u7ebf\u7a0b\u6267\u884ctryLock()\u65b9\u6cd5\u65f6\uff0c\u4e00\u65e6\u6709\u7ebf\u7a0b\u91ca\u653e\u9501\uff0c\u90a3\u4e48\u8fd9\u4e2atryLock\u7684\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u9501\uff0c\u5373\u4f7f\u7b49\u5f85\u961f\u5217\u4e2d\u5df2\u7ecf\u6709\u7b49\u5f85\u7684\u7ebf\u7a0b\u4e86\uff01")),(0,l.kt)("li",{parentName:"ul"},"\u6ce8\u610f: ",(0,l.kt)("strong",{parentName:"li"},"\u5b9e\u9645\u4e0atryLock() \u548c\u975e\u516c\u5e73\u9501\u6ca1\u6709\u5c1d\u8bd5\u83b7\u53d6\u9501\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u5f53\u524d\u7ebf\u7a0b\u6709\u673a\u4f1a\u83b7\u53d6\u9501\u5c31\u83b7\u53d6\u9501"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'// \u5c1d\u8bd5\u83b7\u53d6\u9501\u7684\u65b9\u6cd5\nfinal boolean nonfairTryAcquire(int acquires) {\n  final Thread current = Thread.currentThread();\n  int c = getState();\n  // \u5f53\u524d\u9501\u7684\u6301\u6709\u8ba1\u6570\u662f0 -> \u6ca1\u6709\u7ebf\u7a0b\u6301\u6709\u9501\n  if (c == 0) {\n    // \u8bbe\u7f6e\u9501\u7684\u6301\u6709\u8ba1\u6570=1 \u5e76\u4e14\u8ba9\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\u9501\uff0c\u7136\u540e\u8fd4\u56detrue\n    if (compareAndSetState(0, acquires)) {\n      setExclusiveOwnerThread(current);\n      return true;\n    }\n  }\n  // \u91cd\u5165\u9501\u7684\u7279\u6027\n  else if (current == getExclusiveOwnerThread()) {\n    int nextc = c + acquires;\n    if (nextc < 0)\n      throw new Error("Maximum lock count exceeded");\n    setState(nextc);\n    return true;\n  }\n  return false;\n}\n')),(0,l.kt)("h3",{id:"\u516c\u5e73\u9501\u6e90\u7801"},"\u516c\u5e73\u9501\u6e90\u7801"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'static final class FairSync extends Sync {\n  private static final long serialVersionUID = -3000897897090466540L;\n    \n  // \u5c1d\u8bd5\u83b7\u53d6\u9501\n  final void lock() {\n    acquire(1);\n  }\n  \n  protected final boolean tryAcquire(int acquires) {\n    final Thread current = Thread.currentThread();\n    // \u83b7\u53d6\u9501\u7684\u6301\u6709\u8ba1\u6570\n    int c = getState();\n    // \u9501\u7684\u6301\u6709\u8ba1\u6570\u662f0\uff0c\u5373\u5f53\u524d\u9501\u6ca1\u6709\u88ab\u4efb\u4f55\u7ebf\u7a0b\u6301\u6709\n    if (c == 0) {\n      // \u5224\u65ad\u5f53\u524d\u7ebf\u7a0b\u5728\u961f\u5217\u4e2d\u662f\u4e0d\u662f\u7b2c\u4e00\u4e2a(\u5224\u65ad\u7b49\u5f85\u961f\u5217\u524d\u9762\u662f\u5426\u8fd8\u6709\u5176\u4ed6\u7684\u7ebf\u7a0b)\n      if (!hasQueuedPredecessors() &&\n          compareAndSetState(0, acquires)) {\n         // \u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u7684\u9501\u4e3a\u6392\u4ed6\u9501\n        setExclusiveOwnerThread(current);\n        return true;\n      }\n    }\n    // \u5982\u679c\u9501\u7684\u6301\u6709\u8ba1\u6570\u4e3a\u4e0d\u662f0\uff0c\u4e14\u5360\u7528\u6392\u4ed6\u9501\u662f\u6b63\u662f\u5f53\u524d\u7ebf\u7a0b\n    else if (current == getExclusiveOwnerThread()) {\n      int nextc = c + acquires;\n      if (nextc < 0)\n        throw new Error("Maximum lock count exceeded");\n      // \u589e\u52a0\u9501\u7684\u6301\u6709\u8ba1\u6570\n      setState(nextc);\n      return true;\n    }\n    return false;\n  }\n}\n\n// \u5224\u65ad\u662f\u4e0d\u662f\u961f\u5217\u7684\u7b2c\u4e00\u4e2a\npublic final boolean hasQueuedPredecessors() {\n  Node t = tail; \n  Node h = head;\n  Node s;\n  // \u6ca1\u6709\u5934\u90e8\u8282\u70b9\n  return h != t &&\n    ((s = h.next) == null || s.thread != Thread.currentThread());\n}\n')),(0,l.kt)("h3",{id:"\u975e\u516c\u5e73\u9501\u6e90\u7801"},"\u975e\u516c\u5e73\u9501\u6e90\u7801"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"static final class NonfairSync extends Sync {\n  private static final long serialVersionUID = 7316153563782823691L;\n    // \u76f4\u63a5\u5c1d\u8bd5\u52a0\u9501\n  final void lock() {\n    // \u5982\u679c\u9501\u7684\u6301\u6709\u8ba1\u6570\u4e3a0\u7684\u8bdd\uff0c\u91c7\u7528CAS\u7b97\u6cd5\u7684\u65b9\u5f0f\u53bb\u5c1d\u8bd5\u5c06\u9501\u7684\u6301\u6709\u8ba1\u6570\u4ece0\u66f4\u65b0\u4e3a1\n    if (compareAndSetState(0, 1))\n       // \u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u7684\u9501\u4e3a\u6392\u4ed6\u9501\n      setExclusiveOwnerThread(Thread.currentThread());\n    else\n      acquire(1);\n  }\n  protected final boolean tryAcquire(int acquires) {\n    return nonfairTryAcquire(acquires);\n  }\n}\n")),(0,l.kt)("h2",{id:"\u5171\u4eab\u9501\u4e0e\u6392\u4ed6\u9501"},"\u5171\u4eab\u9501\u4e0e\u6392\u4ed6\u9501"),(0,l.kt)("h3",{id:"\u57fa\u672c\u6982\u8ff0"},"\u57fa\u672c\u6982\u8ff0"),(0,l.kt)("h4",{id:"\u5171\u4eab\u9501\u4e0e\u6392\u4ed6\u9501\u6982\u8ff0"},(0,l.kt)("strong",{parentName:"h4"},"\u5171\u4eab\u9501\u4e0e\u6392\u4ed6\u9501\u6982\u8ff0"),"?"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u6392\u4ed6\u9501")," ","[",(0,l.kt)("em",{parentName:"li"},"\u72ec\u5360\u9501\u3001\u72ec\u4eab\u9501"),"]",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u8be5\u9501\u5728\u540c\u4e00\u65f6\u523b\u53ea\u5141\u8bb8\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709,\u5e76\u4e14\u6301\u6709\u6392\u4ed6\u9501\u7684\u7ebf\u7a0b\xa0",(0,l.kt)("strong",null,"\u5373\u80fd\u8bfb\u6570\u636e\u53c8\u80fd\u4fee\u6539\u6570\u636e"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u7279\u70b9"),":",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u67d0\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u60f3\u8981\u83b7\u53d6\u9501,\u5fc5\u987b\u7b49\u5f85\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u91ca\u653e\u5b8c\u9501\u540e\u624d\u53ef\u4ee5"))),(0,l.kt)("li",{parentName:"ul"},"\u5e38\u89c1\u7684\u6392\u4ed6\u9501",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"synchronized")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ReentrantLock")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u5171\u4eab\u9501")," ","[ ",(0,l.kt)("em",{parentName:"li"},"\u8bfb\u9501")," ]",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u8be5\u9501\u5728\u540c\u4e00\u65f6\u523b\u53ef\u4ee5\u88ab\u591a\u4e2a\u7ebf\u7a0b\u6301\u6709,\u4f46\u662f\u6301\u6709\u5171\u4eab\u9501\u7684\u7ebf\u7a0b ",(0,l.kt)("strong",null,"\u53ea\u80fd\u8bfb\u6570\u636e,\u4e0d\u80fd\u4fee\u6539\u6570\u636e"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u7279\u70b9")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u7ebf\u7a0bA\u5bf9\u6570\u636eS\u52a0\u4e0a\u5171\u4eab\u9501\u540e\uff0c\u5219\u5176\u4ed6\u7ebf\u7a0b\u53ea\u80fd\u5bf9S\u518d\u52a0\u5171\u4eab\u9501\uff0c\u4e0d\u80fd\u52a0\u6392\u5b83\u9501"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u5e38\u89c1\u7684\u5171\u4eab\u9501"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ReentrantReadWriteLock"))))))),(0,l.kt)("h4",{id:"\u8bfb\u5199\u9501readwritelock\u6982\u8ff0"},(0,l.kt)("strong",{parentName:"h4"},"\u8bfb\u5199\u9501","[ReadWriteLock]","\u6982\u8ff0")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,(0,l.kt)("strong",null,"ReadWriteLock"),"\u8bfb\u5199\u9501\u7684\u63a5\u53e3"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"readLock()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8fd4\u56de\u4e00\u4e2a\u8bfb\u9501\uff0c\u7528\u4e8e\u8bfb\u64cd\u4f5c")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u8bfb\u9501\u662f\u5171\u4eab\u7684\u3002\u53ea\u8981\u6ca1\u6709\u5199\u7ebf\u7a0b\uff0c\u8bfb\u9501\u53ef\u4ee5\u88ab\u591a\u4e2a\u8bfb\u7ebf\u7a0b\u540c\u65f6\u6301\u6709")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u83b7\u53d6\u8bfb\u9501\u7684\u6761\u4ef6"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u7684\u5199\u9501"),(0,l.kt)("li",{parentName:"ul"},"\u6ca1\u6709\u5199\u8bf7\u6c42,\u6216\u8005\u6709\u5199\u8bf7\u6c42\uff0c\u4f46\u8c03\u7528\u7ebf\u7a0b\u548c\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u662f\u540c\u4e00\u4e2a(\u9501\u964d\u7ea7 + \u53ef\u91cd\u5165)"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"writeLock()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8fd4\u56de\u4e00\u4e2a\u5199\u9501,",(0,l.kt)("font",{color:"red"},"\u5199\u9501\u662f\u6392\u4ed6\u7684\u3002")," ")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u83b7\u53d6\u5199\u9501\u7684\u6761\u4ef6"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u7684\u8bfb\u9501"),(0,l.kt)("li",{parentName:"ul"},"\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u7684\u5199\u9501")))))),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface ReadWriteLock {\n    Lock readLock();\n    Lock writeLock();\n}\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u6240\u6709\u7684ReadWriteLock\u5b9e\u73b0\u5fc5\u987b\u4fdd\u8bc1 ",(0,l.kt)("strong",{parentName:"p"},"writeLock\u64cd\u4f5c\u7684\u5185\u5b58\u540c\u6b65\u6548\u679c\u4e5f\u4e0e\u76f8\u5173\u7684readLock\u4fdd\u6301\u4e00\u81f4,\u6210\u529f\u83b7\u5f97\u8bfb\u9501\u7684\u7ebf\u7a0b\u5c06\u770b\u5230\u5728\u524d\u4e00\u6b21\u91ca\u653e\u5199\u9501\u4e4b\u540e\u6240\u505a\u7684\u6240\u6709\u66f4\u65b0")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u8fd9\u8bf4\u660e\u5728\u5199\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u4e4b\u540e\uff0c\u6240\u6709\u7684\u8bfb\u7ebf\u7a0b\u548c\u5176\u4ed6\u5199\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u963b\u585e")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u8bfb\u9501\u4e0e\u5199\u9501\u7684\u4ea4\u4e92\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u53ef\u9009\u7684\u5b9e\u73b0\u5305\u62ec"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u91ca\u653e\u4f18\u5148")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5f53\u4e00\u4e2a\u5199\u5165\u64cd\u4f5c\u91ca\u653e\u5199\u9501\u65f6\uff0c\u5e76\u4e14\u7b49\u5f85\u961f\u5217\u4e2d\u4e2d\u540c\u65f6\u5b58\u5728\u5199\u7ebf\u7a0b\u548c\u8bfb\u7ebf\u7a0b\uff0c\u90a3\u4e48\u5e94\u8be5\u4f18\u5148\u9009\u62e9\u8bfb\u7ebf\u7a0b\uff0c\u8fd8\u662f\u5199\u7ebf\u7a0b\uff0c\u8fd8\u662f\u6700\u5148\u53d1\u8d77\u83b7\u53d6\u9501\u8bf7\u6c42\u7684\u7ebf\u7a0b"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u8bfb\u7ebf\u7a0b\u63d2\u961f")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u9501\u662f\u7531\u8bfb\u7ebf\u7a0b\u6301\u6709\uff0c\u4f46\u662f\u5199\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\uff0c\u90a3\u4e48\u65b0\u5230\u8fbe\u7684\u8bfb\u7ebf\u7a0b\u662f\u5426\u80fd\u7acb\u5373\u83b7\u53d6\u8bbf\u95ee\u6743\uff0c\u8fd8\u662f\u5e94\u8be5\u5728\u5199\u7ebf\u7a0b\u540e\u9762\u7b49\u5f85?"),(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u5141\u8bb8\u8bfb\u7ebf\u7a0b\u63d2\u961f\u5230\u5199\u7ebf\u7a0b\u4e4b\u524d\uff0c\u90a3\u4e48\u53ef\u4ee5\u63d0\u9ad8\u5e76\u53d1\u6027\uff0c\u4f46\u662f\u53ef\u80fd\u4f1a\u9020\u6210\u5199\u7ebf\u7a0b\u7684\u9965\u997f"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u53ef\u91cd\u5165")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8bfb\u9501\u548c\u5199\u9501\u662f\u5426\u662f\u53ef\u91cd\u5165\u7684?"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u964d\u7ea7")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709\u5199\u5165\u9501\uff0c\u90a3\u4e48\u80fd\u5426\u5728\u4e0d\u91ca\u653e\u5199\u9501\u7684\u60c5\u51b5\u4e0b\u83b7\u53d6\u8bfb\u9501\u3002\u8fd9\u4e2a\u4f1a\u5bfc\u81f4\u5199\u9501\u964d\u7ea7\u6210\u4e3a\u8bfb\u9501\uff0c\u5e76\u4e14\u4e0d\u5141\u8bb8\u5176\u4ed6\u5199\u7ebf\u7a0b\u4fee\u6539\u88ab\u4fdd\u62a4\u7684\u8d44\u6e90"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u5347\u7ea7")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8bfb\u9501\u80fd\u5426\u4f18\u5148\u4e8e\u5176\u4ed6\u6b63\u5728\u7b49\u5f85\u7684\u8bfb\u7ebf\u7a0b\u548c\u5199\u7ebf\u7a0b\u5347\u7ea7\u4e3a\u4e00\u4e2a\u5199\u9501?\u5927\u591a\u6570\u7684\u60c5\u51b5\u662f\u4e0d\u5141\u8bb8\u7684\uff0c\u56e0\u4e3a\u6ca1\u6709\u663e\u5f0f\u7684\u5347\u7ea7\u64cd\u4f5c\uff0c\u4f1a\u5f88\u5bb9\u6613\u9020\u6210\u6b7b\u9501",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u4e24\u4e2a\u8bfb\u7ebf\u7a0b\u5c1d\u8bd5\u540c\u65f6\u5347\u7ea7\u4e3a\u5199\u9501\uff0c\u90a3\u4e48\u4e24\u4e2a\u90fd\u4e0d\u4f1a\u91ca\u653e\u8bfb\u53d6\u9501\u3002"))))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"ReadWriteLock\u5e38\u89c1\u7684\u5b9e\u73b0\u7c7b\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"ReentrantReadWriteLock")," "))),(0,l.kt)("admonition",{title:"\u8bfb\u5199\u9501\u4f7f\u7528\u7684\u6ce8\u610f\u70b9",type:"danger"},(0,l.kt)("ol",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u5728\u8bbf\u95ee\u5171\u4eab\u6570\u636e\u65f6\uff0c\u8bfb\u5199\u9501\u6bd4\u4e92\u65a5\u9501\u5141\u8bb8\u7684\u5e76\u53d1\u7ea7\u522b\u66f4\u9ad8"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u56e0\u4e3a: ",(0,l.kt)("font",{color:"red"},"\u5c3d\u7ba1\u4e00\u6b21\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b(\u5199\u7ebf\u7a0b)\u53ef\u4ee5\u4fee\u6539\u5171\u4eab\u6570\u636e\uff0c\u4f46\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u4efb\u610f\u6570\u91cf\u7684\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u5e76\u53d1\u5730\u8bfb\u53d6\u6570\u636e(\u56e0\u6b64\u79f0\u4e3a\u8bfb\u7ebf\u7a0b)\u3002\u4ece\u7406\u8bba\u4e0a\u8bb2\uff0c\u4f7f\u7528\u8bfb\u5199\u9501\u6240\u5141\u8bb8\u7684\u5e76\u53d1\u6027\u7684\u589e\u52a0\u5c06\u5bfc\u81f4\u6027\u80fd\u7684\u63d0\u9ad8\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u4e92\u65a5\u9501")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u4f7f\u7528\u8bfb\u5199\u9501\u80fd\u5426\u63d0\u9ad8\u6027\u80fd\u7684\u53d6\u51b3\u4e8e\u8bfb\u53d6\u6570\u636e\u88ab\u4fee\u6539\u76f8\u6bd4,\u8bfb\u548c\u5199\u64cd\u4f5c\u7684\u6301\u7eed\u65f6\u95f4"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6bd4\u5982\u4e00\u4e2a\u96c6\u5408\u6700\u521d\u662f\u7528\u6570\u636e\u586b\u5145\u7684\uff0c\u4e4b\u540e\u5f88\u5c11\u88ab\u4fee\u6539\uff0c\u4f46\u7ecf\u5e38\u88ab\u641c\u7d22(\u6bd4\u5982\u67d0\u79cd\u76ee\u5f55)\uff0c\u8fd9\u662f\u4f7f\u7528\u8bfb\u5199\u9501\u7684\u7406\u60f3\u5019\u9009\u96c6\u5408"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4f46\u5982\u679c\u66f4\u65b0\u53d8\u5f97\u9891\u7e41\uff0c\u90a3\u4e48\u6570\u636e\u7684\u5927\u90e8\u5206\u65f6\u95f4\u90fd\u88ab\u6392\u4ed6\u9501\u5b9a\uff0c\u5e76\u53d1\u6027\u51e0\u4e4e\u6ca1\u6709\u589e\u52a0\u3002\u6b64\u5916\u5982\u679c\u8bfb\u64cd\u4f5c\u592a\u77ed\uff0c\u8bfb\u5199\u9501\u5b9e\u73b0(\u5176\u672c\u8d28\u4e0a\u6bd4\u4e92\u65a5\u9501\u66f4\u590d\u6742)\u7684\u5f00\u9500\u53ef\u80fd\u4f1a\u63a7\u5236\u6267\u884c\u6210\u672c")))))),(0,l.kt)("h3",{id:"reentrantreadwritelock"},"ReentrantReadWriteLock"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"ReentrantReadWriteLock \u662f\u8bfb\u5199\u9501\u63a5\u53e3 ReadWriteLock\u7684\u4e00\u4e2a\u5b9e\u73b0")),(0,l.kt)("h4",{id:"\u57fa\u672c\u6982\u8ff0-1"},"\u57fa\u672c\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"ReentrantReadWriteLock \u5bf9ReadWriteLock\u4ea4\u4e92\u65b9\u5f0f\u5b9e\u73b0"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u516c\u5e73\u9009\u62e9\u6027"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u652f\u6301\u975e\u516c\u5e73(\u9ed8\u8ba4)\u548c\u516c\u5e73\u7684\u9501\u83b7\u53d6\u65b9\u5f0f\uff0c\u541e\u5410\u91cf\u8fd8\u662f\u975e\u516c\u5e73\u4f18\u4e8e\u516c\u5e73",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u975e\u516c\u5e73\u9501",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5199\u9501\u53ef\u4ee5\u968f\u65f6\u63d2\u5165\uff0c\u8bfb\u9501\u53ea\u80fd\u5728\u7b49\u5f85\u961f\u5217\u5934\u8282\u70b9\u4e0d\u662f\u60f3\u83b7\u53d6\u5199\u9501\u7684\u7ebf\u7a0b\u7684\u65f6\u5019\u53ef\u4ee5\u63d2\u961f")))),(0,l.kt)("li",{parentName:"ul"},"\u516c\u5e73\u9501",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u6765\u4e86\u4e4b\u540e\u4e0d\u7ba1\u8bfb\u5199\u90fd\u53bb\u7b49\u5f85\u961f\u5217\u4e2d\u7b49\u5f85\uff0c\u4e0d\u5141\u8bb8\u63d2\u961f"))))),(0,l.kt)("li",{parentName:"ul"},"\u8bfb\u5199\u9501\u5b9e\u73b0\u4e86AQS\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"tryAcquire \u548c tryReleaseShared"),"\u65b9\u6cd5\u5206\u522b\u53bb\u83b7\u53d6\u516c\u5e73\u4e0e\u975e\u516c\u5e73\u9501"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u53ef\u91cd\u5165"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8bfb\u9501\u548c\u5199\u9501\u90fd\u652f\u6301\u7ebf\u7a0b\u91cd\u8fdb\u5165,\u8bfb\u5199\u9501\u53ef\u4ee5\u6309\u7167ReentrantLock\u7684\u65b9\u5f0f\u91cd\u65b0\u83b7\u53d6\u8bfb\u53d6\u9501\u3001\u5199\u5165\u9501\u3002",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u7ebf\u7a0b\u83b7\u53d6\u4e86\u8bfb\u9501\u540e\uff0c\u8fd8\u53ef\u4ee5\u518d\u6b21\u83b7\u53d6\u8bfb\u9501")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u7ebf\u7a0b\u83b7\u53d6\u4e86\u5199\u9501\u540e\uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u518d\u6b21\u83b7\u53d6\u5199\u9501\u548c\u8bfb\u9501")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u9501\u964d\u7ea7"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u9075\u5faa ",(0,l.kt)("font",{color:"red"},"\u83b7\u53d6\u5199\u9501 -> \u83b7\u53d6\u8bfb\u9501 -> \u91ca\u653e\u5199\u9501\u7684\u6b21\u5e8f"),"\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u5199\u9501\u80fd\u591f\u4ee5\u91cd\u5165\u7684\u65b9\u5f0f\u964d\u7ea7\u6210\u4e3a\u8bfb\u9501\u3002\u5176\u5b9e\u73b0\u65b9\u5f0f\u662f\uff1a",(0,l.kt)("font",{color:"red"},"\u5148\u83b7\u53d6\u5199\u5165\u9501\uff0c\u7136\u540e\u83b7\u53d6\u8bfb\u53d6\u9501\uff0c\u6700\u540e\u91ca\u653e\u5199\u5165\u9501\u3002\u4f46\u662f\uff0c\u4ece\u8bfb\u53d6\u9501\u5347\u7ea7\u5230\u5199\u5165\u9501\u662f",(0,l.kt)("strong",{parentName:"li"},"\u4e0d\u53ef\u80fd\u7684"))))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"ReentrantReadWriteLock \u5e38\u89c1\u7684\u65b9\u6cd5"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"int getReadLockCount()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u5f53\u524d\u8bfb\u9501\u88ab\u83b7\u53d6\u7684\u6b21\u6570"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"int getReadHoldCount()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\u8bfb\u9501\u7684\u6b21\u6570"),(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7ThreadLocal\u4fdd\u5b58\u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u8bfb\u9501\u7684\u6b21\u6570"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"int getWriteHoldCount()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\u5199\u9501\u7684\u6b21\u6570"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"boolean isWriteLocked()")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5224\u65ad\u5199\u9501\u662f\u5426\u88ab\u83b7\u53d6")))))),(0,l.kt)("h4",{id:"\u8bfb\u5199\u9501\u7b80\u5355\u7f13\u5b58\u7684\u793a\u4f8b"},"\u8bfb\u5199\u9501\u7b80\u5355\u7f13\u5b58\u7684\u793a\u4f8b"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u7b80\u5355\u7684\u7f13\u5b58Demo: Cache\u91c7\u7528\u7ebf\u7a0b\u4e0d\u5b89\u5168\u7684HashMap\u4f5c\u4e3a\u7f13\u5b58\u7684\u5b9e\u73b0\uff0c\u540c\u65f6\u7528\u8bfb\u5199\u9501\u4fdd\u8bc1cache \u7684\u8bfb\u5199\u64cd\u4f5c\u662f\u5b89\u5168\u7684\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>\u8bfb\u5199\u9501\u7684\u7f13\u5b58Demo</b>\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\npublic class ReadWriteLockDemo {\n    public static final Map<String,Object> cache = new HashMap<String,Object>();\n    private static final ReentrantReadWriteLock READ_WRITE_LOCK = new ReentrantReadWriteLock();\n    // \u8bfb\u9501\n    private static final Lock read = READ_WRITE_LOCK.readLock();\n    // \u5199\u9501\n    private static final Lock write = READ_WRITE_LOCK.writeLock();\n        // \u7f13\u5b58\u503c\u7684\u83b7\u53d6\n    public static final Object get(String key) {\n        read.lock();\n        try {\n            System.out.println(Thread.currentThread().getName()+":\u83b7\u53d6key="+key+"\u7684\u7f13\u5b58\u503c");\n         return cache.get(key);\n        }finally {\n            read.unlock();\n        }\n    }\n    // \u7f13\u5b58\u7684\u5199\u5165\n    public static final void put(String key, Object value) {\n        write.lock();\n        try {\n            System.out.println(Thread.currentThread().getName()+":\u5b58\u50a8[key="+key+",value="+value+"]\u7684\u7f13\u5b58\u503c");\n            cache.put(key, value);\n        }finally {\n            write.unlock();\n        }\n    }\n    public static void main(String[] args) throws InterruptedException {\n        ReadWriteLockDemo cache = new ReadWriteLockDemo();\n        new Thread(() -> {\n            for (int i = 1; i <= 5; i++) {\n                cache.put(String.valueOf(i), new Date());\n            }\n        },"thread1").start();\n        // \u4fdd\u8bc1\u7f13\u5b58\u5df2\u7ecf\u5199\u5165\n        TimeUnit.SECONDS.sleep(2);\n        for (int i = 1; i <= 5; i++) {\n            int finalNum = i;\n            new Thread(() -> {\n                Object value = cache.get(String.valueOf(finalNum));\n                System.out.println(finalNum+"\u5bf9\u5e94\u7684\u7f13\u5b58\u503c\u4e3a=>"+value);\n            },"Thread-" + i).start();\n        }\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(27607).Z,width:"769",height:"379"})),(0,l.kt)("h4",{id:"\u8bfb\u9501\u63d2\u961f\u4e0e\u4e0d\u63d2\u961f\u7684\u793a\u4f8b"},"\u8bfb\u9501\u63d2\u961f\u4e0e\u4e0d\u63d2\u961f\u7684\u793a\u4f8b"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5728ReentrantReadWriteLock\u7684\u975e\u516c\u5e73\u9501\u7684\u60c5\u51b5\u4e0b,\u6f14\u793a\u8bfb\u9501\u63d2\u961f\u4e0e\u4e0d\u63d2\u961f\u7684\u60c5\u51b5"),(0,l.kt)("p",{parentName:"blockquote"},"\u6839\u636e\u8fd0\u884c\u7ed3\u679c\u53ef\u4ee5\u770b\u5230:\u83b7\u53d6\u5199\u9501\u540e\uff0c\u540e\u7eed\u83b7\u53d6\u8bfb\u5199\u9501\u7684\u8bf7\u6c42\u90fd\u4f1a\u88ab\u653e\u5728\u963b\u585e\u961f\u5217\u4e2d\u3002\u5f53\u91ca\u653e\u4e86\u5199\u9501\u4f46\u662f\u5934\u8282\u70b9\u662f\u83b7\u53d6\u4e86\u8bfb\u9501\u7684\u7ebf\u7a0b\uff0c\u90a3\u4e48\u540e\u9762\u65b0\u6765\u7684\u5c1d\u8bd5\u83b7\u53d6\u8bfb\u9501\u7684\u7ebf\u7a0b\u53ef\u4ee5\u4e0d\u6392\u961f\u76f4\u63a5\u62ff\u5230\u8bfb\u9501(\u63d2\u961f)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * <b>\u8bfb\u9501\u80fd\u591f\u63d2\u961f\u4e0e\u4e0d\u80fd\u63d2\u961f\u7684\u6f14\u793a</b>\n *\n * @author <a href="mailto:zhuyuliangm@gmail.com">zyl</a>\n */\n\npublic class NonfairBargeDemo {\n    // \u5b9a\u4e49\u4e3a\u975e\u516c\u5e73\u9501\u6f14\u793a\u63d2\u961f\n    private static final  ReentrantReadWriteLockExt READ_WRITE_LOCK = new ReentrantReadWriteLockExt(false);\n    // \u8bfb\u9501\n    private static final ReentrantReadWriteLock.ReadLock read =READ_WRITE_LOCK.readLock();\n    // \u5199\u9501\n    private static final ReentrantReadWriteLock.WriteLock write =READ_WRITE_LOCK.writeLock();\n    private static final Logger log = LoggerFactory.getLogger(NonfairBargeDemo.class);\n\n    public static final String getCurrentThread() {\n        return Thread.currentThread().getName();\n    }\n\n    public static final void read() {\n        log.info("\u7ebf\u7a0b{}\u5c1d\u8bd5\u83b7\u53d6\u8bfb\u9501",getCurrentThread());\n        read.lock();\n        try {\n            log.warn("\u7ebf\u7a0b{}\u6210\u529f\u83b7\u53d6\u8bfb\u9501,\u5e76\u5f00\u59cb\u8bfb\u53d6...",getCurrentThread());\n            TimeUnit.MILLISECONDS.sleep(20);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            log.info("\u7ebf\u7a0b{}\u91ca\u653e\u4e86\u8bfb\u9501",getCurrentThread());\n            read.unlock();\n        }\n    }\n    public static final void write() {\n        log.info("\u7ebf\u7a0b{}\u5c1d\u8bd5\u83b7\u53d6\u5199\u9501",getCurrentThread());\n        write.lock();\n        try {\n            log.warn("\u7ebf\u7a0b{}\u6210\u529f\u83b7\u53d6\u5199\u9501,\u5e76\u5f00\u59cb\u5199\u5165...",getCurrentThread());\n            TimeUnit.MILLISECONDS.sleep(40);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            log.error("\u7ebf\u7a0b{}\u91ca\u653e\u4e86\u5199\u9501,\u7b49\u5f85\u961f\u5217\u4e2d\u6709{}\u4e2a\u7b49\u5f85\u7ebf\u7a0b",getCurrentThread(),READ_WRITE_LOCK.getQueuedThreads().size());\n            write.unlock();\n        }\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        new Thread(() -> { NonfairBargeDemo.write();},"thread1").start(); //\u5199\u9501\u540e\u9762\u7684\u8bfb\u9501\u90fd\u4f1a\u88ab\u963b\u585e\n        TimeUnit.MILLISECONDS.sleep(20);\n        new Thread(() -> { NonfairBargeDemo.read();},"thread2").start();\n        new Thread(() -> { NonfairBargeDemo.read();},"thread3").start();\n        new Thread(() -> { NonfairBargeDemo.write();},"thread4").start();\n        new Thread(() -> { NonfairBargeDemo.read();},"thread5").start();\n        new Thread(() -> {\n            for (int i = 1; i <= 1000; i++) {\n                new Thread(() -> {\n                    NonfairBargeDemo.read();\n                },"\u5b50\u7ebf\u7a0b\u521b\u5efa\u7ebf\u7a0b:"+i).start();\n            }\n        }).start();\n    }\n}\n\n/**\n * \u62d3\u5c55ReentrantReadWriteLock,\u83b7\u53d6\u961f\u5217\u4e2d\u7b49\u5f85\u7684\u7ebf\u7a0b\n */\nclass ReentrantReadWriteLockExt extends ReentrantReadWriteLock{\n    public ReentrantReadWriteLockExt(boolean fair) {\n        super(fair);\n    }\n    public Collection<Thread> getQueuedThreads() {\n        return getQueuedReaderThreads();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(72367).Z,width:"1255",height:"1127"})),(0,l.kt)("h3",{id:"\u8bfb\u5199\u9501\u5347\u964d\u7ea7"},"\u8bfb\u5199\u9501\u5347\u964d\u7ea7"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u9501\u964d\u7ea7"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u6301\u6709\u4f4f\u5f53\u524d\u62e5\u6709\u7684\u5199\u9501\uff0c\u518d\u83b7\u53d6\u5230\u8bfb\u9501\uff0c\u968f\u540e\u91ca\u653e\u4e4b\u524d\u6301\u6709\u7684\u5199\u9501")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},(0,l.kt)("strong",null,"\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u89c1\u6027"),",ReentrantReadWriteLock \u652f\u6301\u5199\u9501\u964d\u7ea7\u4e3a\u8bfb\u9501\uff0c\u4f46\u662f\u4e0d\u652f\u6301\u8bfb\u9501\u5347\u7ea7\u4e3a\u5199\u9501"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e86\u8bfb\u9501\uff0c\u5176\u4e2d\u4efb\u610f\u4e00\u4e2a\u5347\u7ea7\u4e3a\u5199\u9501\u7684\u7ebf\u7a0b\u66f4\u65b0\u4e86\u6570\u636e\uff0c\u90a3\u4e48\u8fd9\u4e2a\u66f4\u65b0\u5bf9\u4e8e\u5176\u4ed6\u6301\u6709\u8bfb\u9501\u7684\u7ebf\u7a0b\u662f\u4e0d\u53ef\u89c1\u7684"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u964d\u7ea7\u6b65\u9aa4"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u83b7\u53d6\u5199\u9501 -> \u5199\u6570\u636e -> \u83b7\u53d6\u8bfb\u9501[\u91cd\u5165\u7684\u65b9\u5f0f] -> \u8bfb\u53d6\u6570\u636e -> \u91ca\u653e\u5199\u9501 -> \u91ca\u653e\u8bfb\u9501"))))),(0,l.kt)("h4",{id:"\u5199\u9501\u964d\u7ea7\u793a\u4f8b"},"\u5199\u9501\u964d\u7ea7\u793a\u4f8b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class ReentrantReadWriteLockDemo2 {\n    private static String cache = "";\n    private static final ReentrantReadWriteLock READ_WRITE_LOCK = new ReentrantReadWriteLock();\n    private static final ReentrantReadWriteLock.ReadLock READ_LOCK = READ_WRITE_LOCK.readLock();\n    private static final ReentrantReadWriteLock.WriteLock WRITE_LOCK = READ_WRITE_LOCK.writeLock();\n    public static void main(String[] args) {\n        new Thread(() -> {\n            try {\n                // \u83b7\u53d6\u5199\u9501\n                WRITE_LOCK.lock();\n                TimeUnit.SECONDS.sleep(5);\n                cache = "\u5199\u5165\u6570\u636e";\n                System.out.println(Thread.currentThread().getName() + "\\t[\u5199\u9501]\u5199\u5165\u5b8c\u6210");\n                // \u5199\u5165\u7ebf\u7a0b\u518d\u6b21\u5c1d\u8bd5\u83b7\u53d6\u8bfb\u9501\n                READ_LOCK.lock();\n                System.out.println(Thread.currentThread().getName() + "\\t[\u8bfb\u9501]\u83b7\u53d6\u6570\u636e:" + cache);\n                // \u91ca\u653e\u5199\u9501\n                WRITE_LOCK.unlock();\n                READ_LOCK.unlock();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        },"[\u5199\u5165\u7ebf\u7a0b]").start();\n    }\n}\n\n/*\n    // \u963b\u585e 5s\n    [\u5199\u5165\u7ebf\u7a0b]  [\u5199\u9501]\u5199\u5165\u5b8c\u6210\n    [\u5199\u5165\u7ebf\u7a0b]  [\u8bfb\u9501]\u83b7\u53d6\u6570\u636e:\u5199\u5165\u6570\u636e\n*/\n')),(0,l.kt)("h4",{id:"\u8bfb\u9501\u5347\u7ea7\u6d4b\u8bd5"},"\u8bfb\u9501\u5347\u7ea7\u6d4b\u8bd5"),(0,l.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u83b7\u53d6\u4e86\u8bfb\u9501\u4e4b\u540e\uff0c\u662f\u65e0\u6cd5\u4ee5\u91cd\u5165\u7684\u65b9\u5f0f\u83b7\u53d6\u5230\u5199\u9501\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u9664\u975e\u5728\u83b7\u53d6\u5199\u9501\u4e4b\u524d\u91ca\u653e\u6389\u8bfb\u9501")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class ReentrantReadWriteLockDemo3 {\n    private static String cache = "\u521d\u59cb\u503c1";\n    private static final ReentrantReadWriteLock READ_WRITE_LOCK = new ReentrantReadWriteLock();\n    private static final ReentrantReadWriteLock.ReadLock READ_LOCK = READ_WRITE_LOCK.readLock();\n    private static final ReentrantReadWriteLock.WriteLock WRITE_LOCK = READ_WRITE_LOCK.writeLock();\n    public static void main(String[] args) {\n        new Thread(() -> {\n            try {\n                // \u83b7\u53d6\u8bfb\u9501\n                READ_LOCK.lock();\n                System.out.println(Thread.currentThread().getName() + "\\t[\u8bfb\u9501]\u83b7\u53d6\u6570\u636e:" + cache);\n                // \u83b7\u53d6\u5199\u9501\n                System.out.println(Thread.currentThread().getName() + "\u5c1d\u8bd5\u83b7\u53d6\u5199\u9501...");\n                WRITE_LOCK.lock();\n                System.out.println(Thread.currentThread().getName() + "\u5199\u9501\u83b7\u53d6\u6210\u529f...");\n                TimeUnit.SECONDS.sleep(5);\n                cache = "\u521d\u59cb\u503c2";\n                System.out.println(Thread.currentThread().getName() + "\\t[\u5199\u9501]\u5199\u5165\u5b8c\u6210");\n                    // \u91ca\u653e\u8bfb\u9501\n                READ_LOCK.unlock();\n                // \u91ca\u653e\u5199\u9501\n                WRITE_LOCK.unlock();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        },"[\u8bfb\u53d6\u7ebf\u7a0b]").start();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(24490).Z,width:"620",height:"227"})),(0,l.kt)("h3",{id:"reentrantreadwritelock-\u5206\u6790"},"ReentrantReadWriteLock \u5206\u6790"),(0,l.kt)("h4",{id:"reentrantreadwritelock\u7ed3\u6784"},"ReentrantReadWriteLock\u7ed3\u6784"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"ReentrantReadWriteLock \u5b9e\u73b0\u4e86 ReadWriteLock\u63a5\u53e3,\u5206\u522b\u63d0\u4f9b\u83b7\u53d6\u8bfb\u5199\u9501\u7684\u65b9\u6cd5"),(0,l.kt)("li",{parentName:"ol"},"ReentrantReadWriteLock \u7684\u5185\u90e8\u7c7b Sync\u7ee7\u627f\u4e86AQS\uff0c\u4f46\u662f\u7531\u4e8e\u5b58\u5728\u4e24\u628a\u9501\uff0c\u6240\u4ee5\u5c06AQS\u7684\u540c\u6b65\u72b6\u6001\u6309\u4f4d\u5206\u9694\u6210\u9ad8\u4f4e\u4f4d\uff0c\u7528\u6765\u5b58\u50a8\u8bfb\u5199\u9501\u7684\u6301\u6709\u8ba1\u6570",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u63d0\u4f9b\u4e86\u53ef\u91cd\u5165\u7684\u7279\u6027"))),(0,l.kt)("li",{parentName:"ol"},"ReentrantReadWriteLock \u7684\u5185\u90e8\u7c7b Sync\u6709\u4e24\u4e2a\u5b50\u7c7b:FairSync\u3001NonfairSync\uff0c\u7528\u4e8e\u63d0\u4f9b\u516c\u5e73\u548c\u975e\u516c\u5e73\u6027"),(0,l.kt)("li",{parentName:"ol"},"\u8bfb\u9501\u7684\u83b7\u53d6\u4e0e\u5199\u9501\u7684\u83b7\u53d6\u662f\u5206\u79bb\u7684")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(55793).Z,width:"1210",height:"1198"})),(0,l.kt)("h4",{id:"\u540c\u6b65\u72b6\u6001\u7684\u8bfb\u5199\u5212\u5206"},"\u540c\u6b65\u72b6\u6001\u7684\u8bfb\u5199\u5212\u5206"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8bfb\u5199\u9501\u4e5f\u4f9d\u8d56\u4e8eAQS\u5b9e\u73b0\u540c\u6b65\u7684\u529f\u80fd\uff0c\u5e76\u4e14\u8bfb\u5199\u72b6\u6001\u5c31\u662fAQS\u540c\u6b65\u5668\u7684\u540c\u6b65\u72b6\u6001(state)\uff0c\u800c\u4e14\u540c\u6b65\u72b6\u6001\u8868\u793a\u9501\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u91cd\u590d\u6301\u6709\u7684\u8ba1\u6570"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7531\u4e8e\u8bfb\u5199\u9501\u5305\u542b\u4e86\u4e24\u628a\u9501\uff0c\u6240\u4ee5 ",(0,l.kt)("font",{color:"red"},"\u9700\u8981\u5728\u540c\u6b65\u72b6\u6001(\u4e00\u4e2aint\u53d8\u91cf)\u4e0a\u7ef4\u62a4\u8bfb\u9501\u7684\u6301\u6709\u8ba1\u6570\u4ee5\u53ca\u5199\u9501\u7684\u6301\u6709\u8ba1\u6570")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5982\u679c\u9700\u8981\u5728\u4e00\u4e2a\u6574\u578b\u53d8\u91cf\u4e0a\u7ef4\u62a4\u591a\u79cd\u72b6\u6001\uff0c\u5c31\u4e00\u5b9a\u9700\u8981\u4f7f\u7528 ",(0,l.kt)("strong",null,"\u6309\u4f4d\u5206\u9694")," \u7684\u6280\u672f")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u8bfb\u5199\u9501\u5c06\u540c\u6b65\u72b6\u6001\u7684\u53d8\u91cf\u5206\u6210\u4e86\u4e24\u90e8\u5206"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u9ad816\u4f4d\u8868\u793a\u8bfb\u9501\u7684\u6301\u6709\u8ba1\u6570")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u4f4e16\u4f4d\u8868\u793a\u5199\u9501\u7684\u6301\u6709\u8ba1\u6570"))))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"// @see java.util.concurrent.locks.ReentrantReadWriteLock.Sync \nabstract static class Sync extends AbstractQueuedSynchronizer {\n  private static final long serialVersionUID = 6317671515068378041L;\n\n  /*\n  * Read vs write count extraction constants and functions.\n  * Lock state is logically divided into two unsigned shorts:\n  * The lower one representing the exclusive (writer) lock hold count,\n  * and the upper the shared (reader) hold count.\n  */\n\n  static final int SHARED_SHIFT   = 16;\n  static final int SHARED_UNIT    = (1 << SHARED_SHIFT);\n  static final int MAX_COUNT      = (1 << SHARED_SHIFT) - 1;\n  static final int EXCLUSIVE_MASK = (1 << SHARED_SHIFT) - 1;\n\n  /** \u83b7\u53d6\u8bfb\u9501\u7684\u6301\u6709\u8ba1\u6570  */\n  static int sharedCount(int c)    { return c >>> SHARED_SHIFT; }\n  /** \u83b7\u53d6\u5199\u9501\u7684\u6301\u6709\u8ba1\u6570  */\n  static int exclusiveCount(int c) { return c & EXCLUSIVE_MASK; }\n    \n  // .......\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4e0b\u56fe\u8868\u793a\u7684\u4e00\u4e2a\u7ebf\u7a0b\u5df2\u7ecf\u83b7\u53d6\u4e86\u5199\u9501\uff0c\u5e76\u4e14\u91cd\u5165\u4e86\u4e24\u6b21\uff0c\u540c\u65f6\u4e5f\u8fde\u7eed\u83b7\u53d6\u4e86\u4e24\u6b21\u8bfb\u9501\u3002\u901a\u8fc7",(0,l.kt)("em",{parentName:"p"},"\u4f4d\u8fd0\u7b97\u53ef\u4ee5\u786e\u5b9a\u8bfb\u5199\u9501\u7684\u540c\u6b65\u72b6\u6001")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5047\u8bbe\u5f53\u524d\u540c\u6b65\u72b6\u6001\u503c\u4e3aS\uff0cget\u548cset\u7684\u64cd\u4f5c\u5982\u4e0b"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u83b7\u53d6\u5199\u72b6\u6001"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"S & 0x0000FFFF:\u5c06\u9ad816\u4f4d\u5168\u90e8\u62b9\u53bb")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u83b7\u53d6\u8bfb\u72b6\u6001"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"S>>>16:\u65e0\u7b26\u53f7\u88650: \u53f3\u79fb16\u4f4d"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u5199\u72b6\u6001\u52a01"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"S+1"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"\u8bfb\u72b6\u6001\u52a01"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"S+\uff081<<16\uff09: S + 0x00010000"))))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\x13S!=0\u65f6\uff0c\u5f53\u5199\u72b6\u6001=0\uff0c\u5219\u8bfb\u72b6\u6001>0,\u5373\u8bfb\u9501\u5df2\u7ecf\u88ab\u83b7\u53d6"))))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt",src:n(82876).Z,width:"694",height:"317"})),(0,l.kt)("h4",{id:"\u5199\u9501\u7684\u83b7\u53d6"},"\u5199\u9501\u7684\u83b7\u53d6"),(0,l.kt)("blockquote",null,(0,l.kt)("ol",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"setState(c + acquires); => \u63d0\u4f9b\u4e86\u53ef\u91cd\u5165")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"if (w == 0 || current != getExclusiveOwnerThread()) => \u83b7\u53d6\u5199\u9501\u65f6\u4e0d\u5141\u8bb8\u6709\u8bfb\u9501\u88ab\u6301\u6709\u4e0e\u5176\u4ed6\u5199\u9501\u88ab\u6301\u6709 -> \u72ec\u5360\u6027")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'protected final boolean tryAcquire(int acquires) {\n  Thread current = Thread.currentThread();\n  // \u83b7\u53d6\u8bfb\u5199\u9501\u7684\u540c\u6b65\u72b6\u6001\n  int c = getState();\n  // \u83b7\u53d6\u8bfb\u5199\u9501\u4e2d\u5199\u9501\u7684\u540c\u6b65\u72b6\u6001(\u9501\u7684\u6301\u6709\u8ba1\u6570)\n  int w = exclusiveCount(c);\n  // \u9501\u7684\u6301\u6709\u8ba1\u6570>0 -> \u5b58\u5728\u8bfb\u9501\u6216\u8005\u5199\u9501\n  if (c != 0) {\n    // \u5b58\u5728\u8bfb\u9501\u6216\u8005\u5176\u4ed6\u5199\u9501\u72ec\u5360\u4e86\u8be5\u9501 -> \u83b7\u53d6\u9501\u5931\u8d25\n    if (w == 0 || current != getExclusiveOwnerThread())\n      return false;\n    if (w + exclusiveCount(acquires) > MAX_COUNT)\n      throw new Error("Maximum lock count exceeded");\n    // \u53ef\u91cd\u5165\u7684\u5904\u7406: \u6b64\u65f6\u6301\u6709\u5199\u9501\u7684\u662f\u5f53\u524d\u5199\u7ebf\u7a0b\uff0c\u6240\u4ee5\u5c06\u8bfb\u9501\u7684\u6301\u6709\u8ba1\u6570\u52a01\n    setState(c + acquires);\n    return true;\n  }\n  // \u5230\u8fd9\u91cc\u8bf4\u660e\u6b64\u65f6c=0,\u8bfb\u9501\u548c\u5199\u9501\u90fd\u6ca1\u6709\u88ab\u83b7\u53d6\n  // \u5982\u679c\u83b7\u53d6\u5199\u9501\u88ab\u963b\u585e\u6216\u8005\u8bbe\u7f6e\u540c\u6b65\u72b6\u6001\u5931\u8d25 -> \u83b7\u53d6\u9501\u5931\u8d25\n  if (writerShouldBlock() || !compareAndSetState(c, c + acquires))\n    return false;\n  // \u8bfb\u5199\u7ebf\u7a0b\u90fd\u6ca1\u6709\u6301\u6709\u9501\uff0c\u90a3\u4e48\u5f53\u524d\u5199\u7ebf\u7a0b\u72ec\u5360\u5199\u9501 -> \u6210\u529f\u83b7\u53d6\u5199\u9501\n  setExclusiveOwnerThread(current);\n  return true;\n}\n')),(0,l.kt)("h4",{id:"\u8bfb\u9501\u7684\u83b7\u53d6"},"\u8bfb\u9501\u7684\u83b7\u53d6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'// \u91cd\u5165+\u8bfb\u9501\u83b7\u53d6\u7684\u6761\u4ef6\nprotected final int tryAcquireShared(int unused) {\n  Thread current = Thread.currentThread();\n // \u83b7\u53d6\u8bfb\u5199\u9501\u7684\u540c\u6b65\u72b6\u6001\n  int c = getState();\n  // \u5982\u679c\u6709\u5199\u7ebf\u7a0b\u6301\u6709\u9501\uff0c\u5e76\u4e14\u4e0d\u662f\u5f53\u524d\u7ebf\u7a0b\n  if (exclusiveCount(c) != 0 && getExclusiveOwnerThread() != current)\n    return -1;\n  // \u83b7\u53d6\u8bfb\u9501\u7684\u6301\u6709\u8ba1\u6570\n  int r = sharedCount(c);\n  // \u5982\u679c\u83b7\u53d6\u8bfb\u9501\u4e0d\u4f1a\u88ab\u963b\u585e\n  if (!readerShouldBlock() && r < MAX_COUNT && compareAndSetState(c, c + SHARED_UNIT)) {\n    // \u5982\u679c\u8bfb\u9501\u7684\u6301\u6709\u8ba1\u6570=0\uff0c\u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u662f\u7b2c\u4e00\u4e2a\u8bfb\u7684\n    if (r == 0) {\n      firstReader = current;\n      firstReaderHoldCount = 1;\n    } else if (firstReader == current) {\n      firstReaderHoldCount++;\n    } else {\n      // \u901a\u8fc7ThreadLocal\u5b58\u50a8\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\u9501\u7684\u8ba1\u6570\n      HoldCounter rh = cachedHoldCounter;\n      if (rh == null || rh.tid != getThreadId(current))\n        cachedHoldCounter = rh = readHolds.get();\n      else if (rh.count == 0)\n        readHolds.set(rh);\n      rh.count++;\n    }\n    return 1;\n  }\n  return fullTryAcquireShared(current);\n}\n\n// \u8bfb\u9501\u83b7\u53d6\u7684\u6761\u4ef6\nfinal int fullTryAcquireShared(Thread current) {\n  HoldCounter rh = null;\n  // \u81ea\u65cb\u7684\u83b7\u53d6\u8bfb\u9501\n  for (;;) {\n    // \u83b7\u53d6\u8bfb\u5199\u9501\u7684\u540c\u6b65\u72b6\u6001\n    int c = getState();\n    if (exclusiveCount(c) != 0) {\n      if (getExclusiveOwnerThread() != current)\n        return -1;\n      // else we hold the exclusive lock; blocking here\n      // would cause deadlock.\n    } else if (readerShouldBlock()) {\n      // Make sure we\'re not acquiring read lock reentrantly\n      if (firstReader == current) {\n        // assert firstReaderHoldCount > 0;\n      } else {\n        if (rh == null) {\n          rh = cachedHoldCounter;\n          if (rh == null || rh.tid != getThreadId(current)) {\n            rh = readHolds.get();\n            if (rh.count == 0)\n              readHolds.remove();\n          }\n        }\n        if (rh.count == 0)\n          return -1;\n      }\n    }\n    if (sharedCount(c) == MAX_COUNT)\n      throw new Error("Maximum lock count exceeded");\n    if (compareAndSetState(c, c + SHARED_UNIT)) {\n      if (sharedCount(c) == 0) {\n        firstReader = current;\n        firstReaderHoldCount = 1;\n      } else if (firstReader == current) {\n        firstReaderHoldCount++;\n      } else {\n        if (rh == null)\n          rh = cachedHoldCounter;\n        if (rh == null || rh.tid != getThreadId(current))\n          rh = readHolds.get();\n        else if (rh.count == 0)\n          readHolds.set(rh);\n        rh.count++;\n        cachedHoldCounter = rh; // cache for release\n      }\n      return 1;\n    }\n  }\n}\n')),(0,l.kt)("h4",{id:"\u8bfb\u5199\u9501\u7684\u516c\u5e73\u6027"},"\u8bfb\u5199\u9501\u7684\u516c\u5e73\u6027"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"static final class FairSync extends Sync {\n  private static final long serialVersionUID = -2274990926593161451L;\n  final boolean writerShouldBlock() {\n    return hasQueuedPredecessors();\n  }\n  final boolean readerShouldBlock() {\n    return hasQueuedPredecessors();\n  }\n}\n")),(0,l.kt)("h4",{id:"\u8bfb\u5199\u9501\u7684\u975e\u516c\u5e73\u6027"},"\u8bfb\u5199\u9501\u7684\u975e\u516c\u5e73\u6027"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5199\u9501\u53ef\u4ee5\u968f\u65f6\u63d2\u5165\uff0c\u8bfb\u9501\u53ea\u80fd\u5728\u7b49\u5f85\u961f\u5217\u5934\u8282\u70b9\u4e0d\u662f\u60f3\u83b7\u53d6\u5199\u9501\u7684\u7ebf\u7a0b\u7684\u65f6\u5019\u53ef\u4ee5\u63d2\u961f")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"static final class NonfairSync extends Sync {\n  private static final long serialVersionUID = -8159625535654395037L;\n  final boolean writerShouldBlock() {\n    // \u5199\u7ebf\u7a0b\u4e0d\u4f1a\u88ab\u963b\u585e -> \u5199\u9501\u968f\u65f6\u63d2\u5165\n    return false; // writers can always barge\n  }\n  final boolean readerShouldBlock() {\n    /* As a heuristic to avoid indefinite writer starvation,\n    * block if the thread that momentarily appears to be head\n    * of queue, if one exists, is a waiting writer.  This is\n    * only a probabilistic effect since a new reader will not\n    * block if there is a waiting writer behind other enabled\n    * readers that have not yet drained from the queue.\n    */\n    // \u5934\u8282\u70b9\u662f\u4e00\u4e2a\u72ec\u5360\u7684\u9501(\u5199\u9501\u7684\u65f6\u5019),\u8bfb\u7ebf\u7a0b\u88ab\u963b\u585e\n    return apparentlyFirstQueuedIsExclusive();\n  }\n}\n\n// \u5224\u65ad\u5934\u8282\u70b9\u662f\u4e0d\u662f\u72ec\u5360\u9501(!s.isShared()\u8868\u793a\u662f\u4e00\u4e2a\u72ec\u5360\u7684)\nfinal boolean apparentlyFirstQueuedIsExclusive() {\n  Node h, s;\n  return (h = head) != null &&\n    (s = h.next)  != null &&\n    !s.isShared()         &&\n    s.thread != null;\n}\n\n")),(0,l.kt)("h2",{id:"\u81ea\u65cb\u9501\u548c\u963b\u585e\u9501"},"\u81ea\u65cb\u9501\u548c\u963b\u585e\u9501"),(0,l.kt)("h3",{id:"\u6982\u5ff5"},"\u6982\u5ff5"),(0,l.kt)("admonition",{title:"\u81ea\u65cb\u9501\u6982\u8ff0",type:"caution"},(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7531\u4e8e\u963b\u585e\u6216\u8005\u5524\u9192\u4e00\u4e2ajava \u7ebf\u7a0b\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u7684\u5207\u6362\uff0c\u8fd9\u79cd\u5207\u6362\u9700\u8981\u8017\u8d39CPU\u65f6\u95f4\u3002\u5982\u679c\u540c\u6b65\u4ee3\u7801\u5757\u5230\u4ee3\u7801\u8fc7\u4e8e\u7b80\u5355\uff0c\u72b6\u6001\u8f6c\u6362\u5230\u65f6\u95f4\u6709\u53ef\u80fd\u6bd4\u7528\u6237\u6267\u884c\u4ee3\u7801\u5230\u65f6\u95f4\u8fd8\u957f\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5728\u8bb8\u591a\u573a\u666f\u4e0b\uff0c\u540c\u6b65\u8d44\u6e90\u5230\u9501\u5b9a\u65f6\u95f4\u77ed\uff0c\u4e3a\u4e86\u8fd9\u5c0f\u6bb5\u65f6\u95f4\u5207\u6362\u7ebf\u7a0b,\u7ebf\u7a0b\u7684\u6302\u8d77\u548c\u6062\u590d\u53ef\u80fd\u4f1a\u8ba9\u7cfb\u7edf\u5f97\u4e0d\u507f\u5931")))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4e3a\u4e86\u5f53\u524d\u7ebf\u7a0b ",(0,l.kt)("em",{parentName:"p"},"\u7a0d\u7b49\u4e00\u4e0b"),", \u9700\u8981\u8ba9\u5f53\u524d\u7ebf\u7a0b\u8fdb\u884c",(0,l.kt)("strong",{parentName:"p"},"\u81ea\u65cb")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u81ea\u65cb\u9501")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5982\u679c\u7ebf\u7a0b\u81ea\u65cb\u5b8c\u6210\u540e\u524d\u9762\u9501\u5b9a\u540c\u6b65\u8d44\u6e90\u7684\u7ebf\u7a0b\u91ca\u653e\u4e86\u9501\uff0c\u90a3\u4e48\u5f53\u524d\u7ebf\u7a0b\u5c31\u6ca1\u5fc5\u8981\u963b\u585e\uff0c\u800c\u662f\u76f4\u63a5\u83b7\u53d6\u540c\u6b65\u8d44\u6e90\uff0c\u4ece\u800c\u907f\u514d\u5207\u6362\u7ebf\u7a0b\u7684\u5f00\u9500"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u81ea\u65cb\u9501\u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8eCAS")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"juc.atomic\u5305\u4e0b\u9762\u7684\u7c7b\u57fa\u672c\u90fd\u662f\u81ea\u65cb\u9501\u7684\u5b9e\u73b0")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u7f3a\u70b9"),": \u5982\u679c\u9501\u88ab\u5360\u7528\u7684\u65f6\u95f4\u5f88\u957f\uff0c\u7531\u4e8e\u81ea\u65cb\u9501\u4e0d\u4f1a\u653e\u5f03CPU\u6267\u884c\uff0c\u90a3\u4e48\u81ea\u65cb\u7684\u7ebf\u7a0b\u53ea\u4f1a\u6d6a\u8d39CPU\u8d44\u6e90")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u9002\u7528\u573a\u666f")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u591a\u7528\u4e8e\u591a\u6838\u670d\u52a1\u5668\uff0c\u5728\u5e76\u53d1\u7a0b\u5ea6\u4e0d\u662f\u5f88\u9ad8\u7684\u60c5\u51b5\u4e0b\uff0c\u6bd4\u963b\u585e\u9501\u6548\u7387\u9ad8"),(0,l.kt)("li",{parentName:"ul"},"\u9002\u7528\u4e8e\u4e34\u754c\u533a\u8f83\u5c0f\u7684\u60c5\u51b5\uff0c\u5982\u679c\u4e34\u754c\u533a\u8f83\u5927(\u7ebf\u7a0b\u6301\u6709\u9501\u9700\u8981\u5f88\u4e45\u624d\u80fd\u91ca\u653e)\uff0c\u4f1a\u4e00\u76f4\u5360\u7528CPU\u8d44\u6e90\u81ea\u65cb"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"\u963b\u585e\u9501")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"}," \u963b\u585e\u9501\u5982\u679c\u6ca1\u6709\u62ff\u5230\u9501,\u4f1a\u76f4\u63a5\u628a\u7ebf\u7a0b\u963b\u585e\u4f4f,\u76f4\u5230\u88ab\u5524\u9192"))))))),(0,l.kt)("h3",{id:"\u7b80\u5355\u7684\u81ea\u65cb\u9501"},"\u7b80\u5355\u7684\u81ea\u65cb\u9501"),(0,l.kt)("p",null,"\u5229\u7528\u4e86atomic\u5305\u4e0b\u9762\u7c7b\u7684CAS\u64cd\u4f5c\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u81ea\u65cb\u9501"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class SpinLockDemo {\n    private static final AtomicReference<Thread> lock = new AtomicReference<>();\n    public static void lock() {\n        Thread thread = Thread.currentThread();\n        // \u53ea\u6709\u5f53lock=null\u7684\u65f6\u5019\u624d\u80fd\u66f4\u65b0 => \u53ea\u6709\u5f53lock\u88ab\u91ca\u653e\u65f6,\u624d\u80fd\u52a0"\u9501"\n        while(!lock.compareAndSet(null, thread)) {\n            System.out.println("\u81ea\u65cb\u9501\u83b7\u53d6\u5931\u8d25,\u91cd\u8bd5...");\n        }\n    }\n    public static void unlock() {\n        Thread thread = Thread.currentThread();\n        // \u53ea\u6709\u5f53lock=null\u7684\u65f6\u5019\u624d\u80fd\u66f4\u65b0 => \u53ea\u6709\u5f53lock\u88ab\u91ca\u653e\u65f6,\u624d\u80fd\u52a0"\u9501"\n        lock.compareAndSet(thread, null);\n    }\n\n    public static void main(String[] args) {\n        Runnable runnable = new Runnable() {\n            @Override\n            public void run() {\n                System.out.println(Thread.currentThread().getName()+"\u5c1d\u8bd5\u83b7\u53d6\u81ea\u65cb\u9501");\n                SpinLockDemo.lock();\n                System.out.println(Thread.currentThread().getName()+"\u6210\u529f\u83b7\u53d6\u81ea\u65cb\u9501");\n                try {\n                    TimeUnit.SECONDS.sleep(1);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                } finally {\n                    System.out.println(Thread.currentThread().getName()+"\u91ca\u653e\u4e86\u81ea\u65cb\u9501");\n                    SpinLockDemo.unlock();\n                }\n            }\n        };\n        new Thread(runnable).start();\n        new Thread(runnable).start();\n    }\n}\n')),(0,l.kt)("h2",{id:"\u9501\u4f18\u5316"},"\u9501\u4f18\u5316"),(0,l.kt)("h3",{id:"jvm\u5bf9\u9501\u7684\u4f18\u5316"},"jvm\u5bf9\u9501\u7684\u4f18\u5316"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("mark",null,"\u81ea\u65cb\u9501\u548c\u81ea\u9002\u5e94"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u81ea\u9002\u5e94\u9501\u5c31\u662f\u9501\u81ea\u65cb\u4e86\u4e00\u6bb5\u65f6\u95f4\u540e\u8fd8\u662f\u65e0\u6cd5\u83b7\u53d6\u5230\u9501\uff0c\u4e8e\u662f\u8f6c\u800c\u53d8\u6210\u963b\u585e\u9501"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("mark",null,"\u9501\u6d88\u9664")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("mark",null,"\u9501\u7c97\u5316"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5b9e\u8d28\u662f\u9009\u62e9\u5408\u9002\u7684\u9501\u7c92\u5ea6")))),(0,l.kt)("h3",{id:"\u4e2a\u4eba\u5199\u4ee3\u7801"},"\u4e2a\u4eba\u5199\u4ee3\u7801"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u7f29\u5c0f\u540c\u6b65\u4ee3\u7801\u5757,\u5c3d\u91cf\u4e0d\u9501\u4f4f\u65b9\u6cd5")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u51cf\u5c11\u8bf7\u6c42\u9501\u7684\u6b21\u6570"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6bd4\u5982\u8bf4\u591a\u4e2a\u4e1a\u52a1\u5904\u7406\u9700\u8981\u52a0\u9501\uff0c\u53ef\u4ee5\u901a\u8fc7\u5408\u5e76\u4e1a\u52a1\u5904\u7406\u7684\u65b9\u5f0f\uff0c\u51cf\u5c11\u9501\u8bf7\u6c42\u6765"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u907f\u514d\u4eba\u4e3a\u5236\u9020\u201c\u70ed\u70b9\u201d")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u9501\u4e2d\u5c3d\u91cf\u4e0d\u8981\u5d4c\u5957\u9501")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u9009\u62e9\u5408\u9002\u7684\u9501\u7c7b\u578b\u548c\u5de5\u5177\u7c7b"))))}p.isMDXComponent=!0},24490:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20210803094323730-0ba6b4e55d2845ac97a2f576d15423c0.png"},89359:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211006223253771-a6ea0051abec61b69031973564ef0b9b.png"},83761:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211007140748499-9c2f800eb78e7b29ef97d491d98f82dd.png"},59029:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211008195716353-836319548a0deff8ef94166582fb1d87.png"},94864:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211008202224476-bbf75a67df7854d10a0f58857f36ab6f.png"},38686:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211008202549077-d79c51fe12040af77de645fff41dee68.png"},42460:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211010204853543-6e5ab0afec5a33720d0ad3d87ba21e4c.png"},37923:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211010205229182-eb2cb43371e2d9961d8b713b03dd4165.png"},43118:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211014204114055-ae1e0bef4afeadcedaa7ddc8d7ff1d48.png"},52209:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211014205025015-2b91e4252958cdf77dceaf5b31f738a2.png"},27607:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211016155902172-ff02c8bba6e4e509fc4002d3c884e555.png"},60192:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211016223823076-0c6b5b9fcedb7067aaf4380e344b85a8.png"},82876:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211016231232528-5c905b50a6fd83347ab378e32f5d575d.png"},55793:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211017084106049-cc7958cdad0c00ba602540d3a919f833.png"},72367:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20211017141604832-f956e9716b5d5415c744fe8908c5d084.png"}}]);