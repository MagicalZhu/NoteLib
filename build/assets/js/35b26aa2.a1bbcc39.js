"use strict";(self.webpackChunkhuakucha=self.webpackChunkhuakucha||[]).push([[8097],{70086:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var n=t(87462),l=(t(67294),t(3905));t(61839);const r={id:"Nacos",title:"\u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e\u4e2d\u5fc3-Nacos"},i=void 0,o={unversionedId:"SpringCloud/Alibaba/Nacos",id:"SpringCloud/Alibaba/Nacos",title:"\u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e\u4e2d\u5fc3-Nacos",description:"1. Nacos",source:"@site/docs/SpringCloud/Alibaba/\u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e\u4e2d\u5fc3-Nacos.md",sourceDirName:"SpringCloud/Alibaba",slug:"/SpringCloud/Alibaba/Nacos",permalink:"/docs/SpringCloud/Alibaba/Nacos",draft:!1,editUrl:"https://github.com/MagicalZhu/NoteLib/tree/main/docs/SpringCloud/Alibaba/\u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e\u4e2d\u5fc3-Nacos.md",tags:[],version:"current",lastUpdatedBy:"YuLiang Zhu",lastUpdatedAt:1670289592,formattedLastUpdatedAt:"2022\u5e7412\u67086\u65e5",frontMatter:{id:"Nacos",title:"\u670d\u52a1\u6ce8\u518c\u4e0e\u914d\u7f6e\u4e2d\u5fc3-Nacos"},sidebar:"springCloudSideBar",previous:{title:"SpringCloud-Alibaba",permalink:"/docs/category/springcloud-alibaba"},next:{title:"\u670d\u52a1\u5bb9\u9519-Sentinel",permalink:"/docs/SpringCloud/Alibaba/Sentinel"}},p={},s=[{value:"1. Nacos",id:"1-nacos",level:2},{value:"1.1 Nacos \u6982\u8ff0",id:"11-nacos-\u6982\u8ff0",level:3},{value:"1.2 Nacos \u73af\u5883\u642d\u5efa\uff08\u5355\u673a\u7248\uff09",id:"12-nacos-\u73af\u5883\u642d\u5efa\u5355\u673a\u7248",level:3},{value:"2. Nacos \u7684\u57fa\u672c\u4f7f\u7528\u3010 \u6ce8\u518c\u4e2d\u5fc3 \u3011",id:"2-nacos-\u7684\u57fa\u672c\u4f7f\u7528-\u6ce8\u518c\u4e2d\u5fc3-",level:2},{value:"2.1 Nacos \u670d\u52a1\u6ce8\u518c",id:"21-nacos-\u670d\u52a1\u6ce8\u518c",level:3},{value:"2.2 \u6d88\u8d39\u670d\u52a1\u6ce8\u518c\u4e0e\u670d\u52a1\u8d1f\u8f7d",id:"22-\u6d88\u8d39\u670d\u52a1\u6ce8\u518c\u4e0e\u670d\u52a1\u8d1f\u8f7d",level:3},{value:"3. Nacos \u7684\u670d\u52a1\u914d\u7f6e\u4e2d\u5fc3",id:"3-nacos-\u7684\u670d\u52a1\u914d\u7f6e\u4e2d\u5fc3",level:2},{value:"3.1 Nacos\u914d\u7f6e\u4e2d\u5fc3\u7684\u914d\u7f6e\u89c4\u5219\uff08\u57fa\u4e8eDataId /NameSpace\uff09",id:"31-nacos\u914d\u7f6e\u4e2d\u5fc3\u7684\u914d\u7f6e\u89c4\u5219\u57fa\u4e8edataid-namespace",level:3},{value:"3.1.1 Nacos\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3-\u57fa\u7840\u914d\u7f6e \u3010 \u57fa\u4e8eDataId + namespace \u3011",id:"311-nacos\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3-\u57fa\u7840\u914d\u7f6e--\u57fa\u4e8edataid--namespace-",level:4},{value:"3.1.2 Nacos\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3-\u5206\u7c7b\u914d\u7f6e",id:"312-nacos\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3-\u5206\u7c7b\u914d\u7f6e",level:4},{value:"4. Nacos \u670d\u52a1\u53d1\u73b0\u7684\u9886\u57df\u6a21\u578b",id:"4-nacos-\u670d\u52a1\u53d1\u73b0\u7684\u9886\u57df\u6a21\u578b",level:2},{value:"4.1 \u9886\u57df\u6a21\u578b\u6982\u8ff0",id:"41-\u9886\u57df\u6a21\u578b\u6982\u8ff0",level:3},{value:"4.1.1 \u6570\u636e\u9886\u57df\u6a21\u578b",id:"411-\u6570\u636e\u9886\u57df\u6a21\u578b",level:4},{value:"4.1.2 \u670d\u52a1\u9886\u57df\u6a21\u578b",id:"412-\u670d\u52a1\u9886\u57df\u6a21\u578b",level:4},{value:"4.1.3 \u914d\u7f6e\u9886\u57df\u6a21\u578b",id:"413-\u914d\u7f6e\u9886\u57df\u6a21\u578b",level:4},{value:"4.2 \u521b\u5efa\u5f00\u53d1\u4f7f\u7528\u7684NameSpace",id:"42-\u521b\u5efa\u5f00\u53d1\u4f7f\u7528\u7684namespace",level:3},{value:"5. Nacos \u5143\u6570\u636e\uff08Meta-Data\uff09",id:"5-nacos-\u5143\u6570\u636emeta-data",level:2},{value:"6. Nacos \u96c6\u7fa4 \u4e0e\u6301\u4e45\u5316",id:"6-nacos-\u96c6\u7fa4-\u4e0e\u6301\u4e45\u5316",level:2},{value:"6.1 Nacos \u6301\u4e45\u5316",id:"61-nacos-\u6301\u4e45\u5316",level:3},{value:"6.2 Nacos \u7684\u96c6\u7fa4\u67b6\u6784\u6a21\u5f0f",id:"62-nacos-\u7684\u96c6\u7fa4\u67b6\u6784\u6a21\u5f0f",level:3},{value:"6.2.1 Nginx+Nacos+Mysql \u6784\u5efa\u6301\u4e45\u5316\u7684Nacos\u96c6\u7fa4",id:"621-nginxnacosmysql-\u6784\u5efa\u6301\u4e45\u5316\u7684nacos\u96c6\u7fa4",level:4}],c={toc:s};function m(e){let{components:a,...r}=e;return(0,l.kt)("wrapper",(0,n.Z)({},c,r,{components:a,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"1-nacos"},"1. Nacos"),(0,l.kt)("h3",{id:"11-nacos-\u6982\u8ff0"},"1.1 Nacos \u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4ec0\u4e48\u662fNacos?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7528\u4e8e ",(0,l.kt)("inlineCode",{parentName:"li"},"\u53d1\u73b0\u3001\u914d\u7f6e\u548c\u7ba1\u7406\u5fae\u670d\u52a1"),"  , \u53ef\u4ee5",(0,l.kt)("inlineCode",{parentName:"li"},"\u5feb\u901f\u5b9e\u73b0\u52a8\u6001\u670d\u52a1\u53d1\u73b0\u3001\u670d\u52a1\u914d\u7f6e\u3001\u670d\u52a1\u5143\u6570\u636e\u53ca\u6d41\u91cf\u7ba1\u7406")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"Nacos = Eureka + Config + Bus"))))),(0,l.kt)("h3",{id:"12-nacos-\u73af\u5883\u642d\u5efa\u5355\u673a\u7248"},"1.2 Nacos \u73af\u5883\u642d\u5efa\uff08\u5355\u673a\u7248\uff09"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"Nacos\u7684\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"config/application.properties"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://nacos.io/zh-cn/docs/system-configurations.html"},"\u66f4\u591a\u7cfb\u7edf\u914d\u7f6e\u6307\u5357\u67e5\u770b\u5b98\u7f51\u914d\u7f6e")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u64cd\u4f5c\u6b65\u9aa4"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://github.com/alibaba/nacos/releases"},"Github \u4e0b\u8f7d jar\u5305"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("font",{color:"red"},"\u542f\u52a8Nacos\u670d\u52a1"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"  startup.sh -m standalone\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u8fdb\u5165Nacos \u7ba1\u63a7\u53f0\u754c\u9762"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"http://ip:8848/nacos/index.html"),(0,l.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u7528\u6237\u540d\u5bc6\u7801\u90fd\u662f: ",(0,l.kt)("em",{parentName:"li"},"Nacos"))))))),(0,l.kt)("h2",{id:"2-nacos-\u7684\u57fa\u672c\u4f7f\u7528-\u6ce8\u518c\u4e2d\u5fc3-"},"2. Nacos \u7684\u57fa\u672c\u4f7f\u7528\u3010 \u6ce8\u518c\u4e2d\u5fc3 \u3011"),(0,l.kt)("h3",{id:"21-nacos-\u670d\u52a1\u6ce8\u518c"},"2.1 Nacos \u670d\u52a1\u6ce8\u518c"),(0,l.kt)("blockquote",null,(0,l.kt)("font",{color:"red"},"Nacos \u6ce8\u518c\u670d\u52a1\u4e2d\u5fc3\u5bf9\u6bd4"),", ",(0,l.kt)("strong",null,"Nacos\u652f\u6301AP\u548cCP\u6a21\u5f0f\u7684\u5207\u6362")),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(65252).Z,width:"818",height:"354"})),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u64cd\u4f5c\u6b65\u9aa4 ?"))),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5f15\u5165 Nacos \u7684GAV \u5750\u6807 ",(0,l.kt)("inlineCode",{parentName:"li"},"spring-cloud-starter-alibaba-nacos-discovery")),(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u542f\u52a8\u670d\u52a1\u53d1\u73b0\u7684\u6ce8\u89e3 ",(0,l.kt)("inlineCode",{parentName:"li"},"@EnableDiscoveryClient")),(0,l.kt)("li",{parentName:"ol"},"application.yml \u4e2d\u5bf9nacos \u8fdb\u884c\u914d\u7f6e",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.application.name"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u5fae\u670d\u52a1\u540d\u79f0"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.discovery.server-addr"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u914d\u7f6e Nacos \u6ce8\u518c\u4e2d\u5fc3\u7684\u5730\u5740 ( ip+\u7aef\u53e3 )"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.discovery.namespace"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u670d\u52a1\u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u7684\u662fpublic")))))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460\u3001\u5f15\u5165Nacos\u670d\u52a1\u53d1\u73b0\u7684\u4f9d\u8d56")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>com.alibaba.cloud</groupId>\n  <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n</dependency>\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461\u3001\u4fee\u6539\u914d\u7f6e\u6587\u4ef6application.yml,\u5bf9nacos.discovery \u53c2\u6570\u8fdb\u884c\u914d\u7f6e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"server:\n  port: 8005\nspring:\n  application:\n    name: cloud-provider-payment-nacos-8005\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n        service: cloud-provider-payment-nacos\n        namespace: public\n        ip: localhost\n\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2462\u3001\u901a\u8fc7DiscoveryClient \u67e5\u770b\u6ce8\u518c\u5230\u6ce8\u518c\u4e2d\u5fc3\u6240\u6709\u7684\u670d\u52a1\u4fe1\u606f")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\npublic class DiscoveryClientController {\n    private static final Logger log = LoggerFactory.getLogger(DiscoveryClientController.class);\n\n    @Autowired\n    private DiscoveryClient discoveryClient;\n\n\n    @GetMapping("/getServices")\n    public List<ServiceInstance> getServices(){\n        List<String> services = discoveryClient.getServices();\n        List<ServiceInstance> instances = new ArrayList<>();\n        for (String serviceName : services) {\n            instances.addAll(discoveryClient.getInstances(serviceName));\n        }\n        return instances;\n    }\n}\n\n/*\n  [\n      {\n          "host": "localhost",\n          "instanceId": null,\n          "metadata": {\n              "nacos.cluster": "DEFAULT",\n              "nacos.healthy": "true",\n              "nacos.instanceId": "localhost#8005#DEFAULT#DEFAULT_GROUP@@cloud-provider-payment-nacos-8005",\n              "nacos.weight": "1.0",\n              "preserved.register.source": "SPRING_CLOUD"\n          },\n          "port": 8005,\n          "scheme": null,\n          "secure": false,\n          "serviceId": "cloud-provider-payment-nacos-8005",\n          "uri": "http://localhost:8005"\n      }\n  ]\n*/\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2463. \u8fdb\u5165Nacos \u63d0\u4f9b\u7684\u7ba1\u7406\u9762\u677f,\u67e5\u770b\u6ce8\u518c\u4e2d\u5fc3\u5df2\u6ce8\u518c\u7684\u670d\u52a1")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20201213192559390",src:t(62059).Z,width:"1228",height:"542"})),(0,l.kt)("h3",{id:"22-\u6d88\u8d39\u670d\u52a1\u6ce8\u518c\u4e0e\u670d\u52a1\u8d1f\u8f7d"},"2.2 \u6d88\u8d39\u670d\u52a1\u6ce8\u518c\u4e0e\u670d\u52a1\u8d1f\u8f7d"),(0,l.kt)("blockquote",null,(0,l.kt)("font",{color:"red"},"Nacos\u96c6\u6210\u4e86Ribbon,\u9ed8\u8ba4\u4f7f\u7528\u8f6e\u8be2\u7684\u8d1f\u8f7d\u6a21\u5f0f")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460\u3001 \u6ce8\u518c\u6d88\u670d\u52a1\u540e\uff0c\u914d\u7f6eRestTemplate,\u6807\u6ce8@LoadBalanced \u6ce8\u89e3")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class RibbonConfig {\n\n    @Bean\n    @LoadBalanced\n    public RestTemplate restTemplate(){\n        RestTemplate restTemplate = new RestTemplate();\n        List<HttpMessageConverter<?>> list = restTemplate.getMessageConverters();\n        // \u66ff\u6362 StringHttpMessageConverter \u7684\u9ed8\u8ba4\u5b57\u7b26\u96c6\n        for (HttpMessageConverter<?> httpMessageConverter : list) {\n            if(httpMessageConverter instanceof StringHttpMessageConverter) {\n                ((StringHttpMessageConverter) httpMessageConverter).setDefaultCharset(StandardCharsets.UTF_8);\n                break;\n            }\n        }\n        return restTemplate;\n    }\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461\u3001 controller\u6d4b\u8bd5\u8d1f\u8f7d")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\npublic class TestBalanced {\n    @Resource\n    private RestTemplate restTemplate;\n\n    private static final String PAYMENT_SERVICE="cloud-provider-payment-nacos";\n\n    @GetMapping("/order/getInfo")\n    public String getInfo(){\n        return restTemplate.getForObject(String.format("http://%s/getInfo", PAYMENT_SERVICE), String.class);\n    }\n}\n')),(0,l.kt)("h2",{id:"3-nacos-\u7684\u670d\u52a1\u914d\u7f6e\u4e2d\u5fc3"},"3. Nacos \u7684\u670d\u52a1\u914d\u7f6e\u4e2d\u5fc3"),(0,l.kt)("h3",{id:"31-nacos\u914d\u7f6e\u4e2d\u5fc3\u7684\u914d\u7f6e\u89c4\u5219\u57fa\u4e8edataid-namespace"},"3.1 Nacos\u914d\u7f6e\u4e2d\u5fc3\u7684\u914d\u7f6e\u89c4\u5219\uff08\u57fa\u4e8eDataId /NameSpace\uff09"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"Nacos\u5982\u4f55\u5bfb\u627e\u5230\u914d\u7f6e\u6587\u4ef6? \u3010 DataId \u5b8c\u6574\u914d\u7f6e \u3011"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"${spring.cloud.nacos.config.prefix}-${spring.profiles.active}.${file-extension}"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.config.prefix"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u6587\u4ef6\u524d\u7f00,\u9ed8\u8ba4\u4e3a ",(0,l.kt)("em",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"em"},"spring.application.name"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.profiles.active"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6307\u5b9aprofile "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"${spring.profiles.active}")," \u5f53\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u6307\u5b9a\u65f6\u5fc5\u987b\u653e\u5728 bootstrap.yml \u6587\u4ef6\u4e2d",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4e00\u822c\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"-Dspring.profiles.active=<profile>"),"\u7684\u65b9\u5f0f\u6307\u5b9a\u914d\u7f6e"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"file-extension"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u6587\u4ef6\u62d3\u5c55\u540d\uff0c\u76ee\u524d\u53ea\u652f\u6301 ",(0,l.kt)("inlineCode",{parentName:"li"},"properties")," \u548c ",(0,l.kt)("inlineCode",{parentName:"li"},"yaml")," \u7c7b\u578b"))))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Nacos\u914d\u7f6e\u4e2d\u5fc3\u4e5f\u652f\u6301 namespace \u7684\u914d\u7f6e\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e0b\uff0c\u53ef\u4ee5\u5b58\u5728\u76f8\u540c\u7684 Group \u6216 Data ID \u7684\u914d\u7f6e"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u4f7f\u7528 ",(0,l.kt)("strong",{parentName:"li"},(0,l.kt)("em",{parentName:"strong"},"public"))," \u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"${spring.cloud.nacos.config.namespace}")," \u6307\u5b9a\u547d\u540d\u7a7a\u95f4\uff0c",(0,l.kt)("font",{color:"red"},"\u4e00\u5b9a\u8981\u653e\u5728 bootstrap.yml\u4e2d!!"))))),(0,l.kt)("h4",{id:"311-nacos\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3-\u57fa\u7840\u914d\u7f6e--\u57fa\u4e8edataid--namespace-"},"3.1.1 Nacos\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3-\u57fa\u7840\u914d\u7f6e \u3010 \u57fa\u4e8eDataId + namespace \u3011"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u64cd\u4f5c\u6b65\u9aa4"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"\u5728\u670d\u52a1\u4e2d\u5f15\u5165 Nacos\u914d\u7f6e\u4e2d\u5fc3\u548c\u670d\u52a1\u6ce8\u518c\u7684\u4f9d\u8d56 ",(0,l.kt)("inlineCode",{parentName:"li"},"nacos-config"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"li"},"nacos-discovery")),(0,l.kt)("li",{parentName:"ol"},"\u4e3a\u670d\u52a1\u6dfb\u52a0 application.yml \u4e0e bootstrap.yml"),(0,l.kt)("li",{parentName:"ol"},"\u4fee\u6539 ",(0,l.kt)("inlineCode",{parentName:"li"},"bootstrap.yml"),"\u7684\u914d\u7f6e\u4fe1\u606f",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.config.namespace"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u547d\u540d\u7a7a\u95f4"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.config.prefix"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u6587\u4ef6\u524d\u7f00"),(0,l.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u662f ",(0,l.kt)("strong",{parentName:"li"},"${Spring.application.name}")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.profiles.active"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u54ea\u4e2a\u73af\u5883"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.config.file-extension"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u6587\u4ef6\u7684\u540e\u7f00"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.config.server-addr"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u4e2d\u5fc3\u7684\u5730\u5740"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.discovery.server-addr"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6ce8\u518c\u4e2d\u5fc3\u5730\u5740"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.discovery.namespace"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u547d\u540d\u7a7a\u95f4"))))),(0,l.kt)("li",{parentName:"ol"},"\u5728\u9700\u8981\u5237\u65b0\u914d\u7f6e\u4fe1\u606f\u7684\u7c7b\u4e0a\u6807\u6ce8 ",(0,l.kt)("inlineCode",{parentName:"li"},"@RefreshScope"),",Nacos\u53ef\u4ee5\u5b9e\u73b0\u52a8\u6001\u5237\u65b0\u670d\u52a1\u914d\u7f6e\u4fe1\u606f",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5728\u63d0\u4ea4\u66f4\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u540e,\u4f1a\u8c03\u7528\u5237\u65b0\u7684api")))))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460\u3001\u5f15\u5165\u4f9d\u8d56")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>com.alibaba.cloud</groupId>\n  <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n</dependency>\n<dependency>\n  <groupId>com.alibaba.cloud</groupId>\n  <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>\n</dependency>\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2462\u3001\u5728Nacos\u754c\u9762\u7684\u914d\u7f6e\u7ba1\u7406\u754c\u9762\uff0c\u65b0\u52a0\u914d\u7f6e")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20201214100238226",src:t(20868).Z,width:"1290",height:"421"})),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2463\u3001 \u4fee\u6539\u670d\u52a1\u7684bootstrap.yml")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"spring:\n  application:\n    name: cloud-nacos-client\n  cloud:\n    nacos:\n      config:\n        namespace: ad9448c4-6809-4511-9cb5-7724ec0bce3d\n        prefix: cloud-nacos-client-3357\n        file-extension: yaml\n        server-addr: 127.0.0.1:8848\n      discovery:\n        server-addr: 127.0.0.1:8848\n        namespace: ad9448c4-6809-4511-9cb5-7724ec0bce3d\n  profiles:\n    active: dev\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: '*'\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2464\u3001 \u5728\u4e1a\u52a1\u670d\u52a1\u4e0a\u6807\u6ce8\u81ea\u52a8\u5237\u65b0\u7684\u6ce8\u89e3")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@RefreshScope\npublic class TestController {\n\n    @Value("${config.version}")\n    private Integer version;\n\n    @Value("${config.msg}")\n    private String msg;\n\n    @RequestMapping("/get")\n    public String get() {\n        return String.format("msg:%s,version:%s",msg,version);\n    }\n}\n')),(0,l.kt)("h4",{id:"312-nacos\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3-\u5206\u7c7b\u914d\u7f6e"},"3.1.2 Nacos\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3-\u5206\u7c7b\u914d\u7f6e"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u95ee\u9898\uff1a\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u901a\u5e38\u4f1a\u6709\u591a\u4e2a\u73af\u5883 (\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u751f\u4ea7)\uff0c\u5982\u4f55\u4fdd\u8bc1\u4e0d\u540c\u7684\u73af\u5883\u542f\u52a8\u670d\u52a1\u65f6\u53ef\u4ee5\u6b63\u786e\u7684\u8bfb\u53d6\u5230Nacos\u4e0a\u7684\u914d\u7f6e\u6587\u4ef6\u5462\uff1f")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u89e3\u51b3\u65b9\u6848\uff1f"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("mark",null,"DataID\u65b9\u6848"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6307\u5b9a${spring.profile.active} \u3001\u914d\u7f6e\u6587\u4ef6\u7684DataId\u6765\u4f7f\u4e0d\u540c\u73af\u5883\u4e0b\u8bfb\u53d6\u4e0d\u540c\u7684\u914d\u7f6e"),(0,l.kt)("li",{parentName:"ul"},"\u6bd4\u5982: \u9ed8\u8ba4\u7a7a\u95f4+\u9ed8\u8ba4\u5206\u7ec4+\u65b0\u5efadev\u548ctest\u4e24\u4e2aDataID"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("mark",null,"Group\u65b9\u6848"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7Group\u5b9e\u73b0\u73af\u5883\u533a\u5206"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("mark",null,"Namespace\u65b9\u6848"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7Namespace\u5b9e\u73b0\u73af\u5883\u533a\u5206")))))),(0,l.kt)("h2",{id:"4-nacos-\u670d\u52a1\u53d1\u73b0\u7684\u9886\u57df\u6a21\u578b"},"4. Nacos \u670d\u52a1\u53d1\u73b0\u7684\u9886\u57df\u6a21\u578b"),(0,l.kt)("h3",{id:"41-\u9886\u57df\u6a21\u578b\u6982\u8ff0"},"4.1 \u9886\u57df\u6a21\u578b\u6982\u8ff0"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u9886\u57df\u6a21\u578b\u5206\u4e3a: ",(0,l.kt)("strong",{parentName:"p"},"\u6570\u636e\u6a21\u578b\u3001\u670d\u52a1\u9886\u57df\u6a21\u578b\u3001\u914d\u7f6e\u9886\u57df\u6a21\u578b"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u9886\u57df\u6a21\u578b\u6982\u8ff0"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u901a\u8fc7 namespace \u6784\u5efa\u591a\u4e2a\u73af\u5883 -> \u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u751f\u4ea7\u7b49\u7b49"),(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7Group \u53ef\u4ee5\u5c06\u591a\u4e2a\u670d\u52a1Service\u5212\u5206\u4e3a\u540c\u4e00\u4e2a\u7ec4"),(0,l.kt)("li",{parentName:"ul"},"Service \u5c31\u662f\u5fae\u670d\u52a1\uff0c\u4e00\u4e2aService \u53ef\u4ee5 \u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2aCluster\u96c6\u7fa4\uff08\u591a\u4e2aInstance\u670d\u52a1\u5b9e\u4f8b\uff09"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u9886\u57df\u6a21\u578b\u7684\u51e0\u4e2a\u6982\u5ff5?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"NameSpace"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u7528\u4e8e\u8fdb\u884c\u79df\u6237\u7c92\u5ea6\u7684\u914d\u7f6e\u5b9e\u73b0\u9694\u79bb,\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e0b\uff0c\u53ef\u4ee5\u5b58\u5728\u76f8\u540c\u7684Group \u6216 DataID \u7684\u914d\u7f6e"),(0,l.kt)("li",{parentName:"ul"},"Namespace \u7684\u5e38\u7528\u573a\u666f\u4e4b\u4e00\u662f\u4e0d\u540c\u73af\u5883\u7684\u914d\u7f6e\u7684\u533a\u5206\u9694\u79bb\uff0c\u4f8b\u5982\u5f00\u53d1\u6d4b\u8bd5\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\u7684\u8d44\u6e90\uff08\u5982\u914d\u7f6e\u3001\u670d\u52a1\uff09\u9694\u79bb\u7b49\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4 ",(0,l.kt)("font",{color:"red"},"public")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Group"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u540c\u670d\u52a1\u53ef\u4ee5\u5206\u5230\u540c\u4e00\u4e2a\u7ec4"),(0,l.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4 ",(0,l.kt)("font",{color:"red"},"DEFAULT_GROUP")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Service"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u6ce8\u518c\u5230Nacos\u4e2d\u7684\u670d\u52a1"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Instance"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u5b9e\u4f8b"),(0,l.kt)("li",{parentName:"ul"},"\u63d0\u4f9b\u4e00\u4e2a\u6216\u591a\u4e2a\u670d\u52a1\u7684\u5177\u6709\u53ef\u8bbf\u95ee\u7f51\u7edc\u5730\u5740\uff08IP:Port\uff09\u7684\u8fdb\u7a0b"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"Cluster"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u540c\u4e00\u4e2a\u670d\u52a1\u4e0b\u7684\u6240\u6709\u5b9e\u4f8b\u7ec4\u6210\u4e00\u4e2a\u9ed8\u8ba4\u96c6\u7fa4"),(0,l.kt)("li",{parentName:"ul"},"\u5bf9\u6307\u5b9a\u7684\u5fae\u670d\u52a1\u7684\u4e00\u4e2a\u865a\u62df\u5212\u5206,\u9ed8\u8ba4 ",(0,l.kt)("font",{color:"red"},"DEFAULT"))))))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20201214202929160",src:t(51079).Z,width:"522",height:"334"})),(0,l.kt)("h4",{id:"411-\u6570\u636e\u9886\u57df\u6a21\u578b"},"4.1.1 \u6570\u636e\u9886\u57df\u6a21\u578b"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Nacos \u6570\u636e\u6a21\u578bKey \u7531\u4e09\u5143\u7ec4\u552f\u4e00\u786e\u5b9a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Namespace\u9ed8\u8ba4\u662f\u7a7a\u4e32\uff0c\u516c\u5171\u547d\u540d\u7a7a\u95f4\uff08public\uff09"),(0,l.kt)("li",{parentName:"ul"},"Group \u5206\u7ec4\u9ed8\u8ba4\u662f DEFAULT_GROUP"),(0,l.kt)("li",{parentName:"ul"},"Cluster \u7b49\u540c\u4e8e\u591a\u4e2aService")))),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(81625).Z,width:"600",height:"450"})),(0,l.kt)("h4",{id:"412-\u670d\u52a1\u9886\u57df\u6a21\u578b"},"4.1.2 \u670d\u52a1\u9886\u57df\u6a21\u578b"),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(73948).Z,width:"805",height:"483"})),(0,l.kt)("h4",{id:"413-\u914d\u7f6e\u9886\u57df\u6a21\u578b"},"4.1.3 \u914d\u7f6e\u9886\u57df\u6a21\u578b"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20201214200305144",src:t(82705).Z,width:"564",height:"534"})),(0,l.kt)("h3",{id:"42-\u521b\u5efa\u5f00\u53d1\u4f7f\u7528\u7684namespace"},"4.2 \u521b\u5efa\u5f00\u53d1\u4f7f\u7528\u7684NameSpace"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u64cd\u4f5c\u6b65\u9aa4"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5728 Nacos \u7684\u7ba1\u7406\u9762\u677f\u4e0a\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4  , \u4f1a\u5f97\u5230\u4e00\u4e2a",(0,l.kt)("font",{color:"red"},"\u547d\u540d\u7a7a\u95f4ID (UUID)")),(0,l.kt)("li",{parentName:"ul"},"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u7684 ",(0,l.kt)("font",{color:"red"},"spring.cloud.nacos.discovery.namespace"))))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460. Nacos \u7ba1\u7406\u9762\u677f\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4")),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(11335).Z,width:"1062",height:"486"})),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461. \u5728\u670d\u52a1\u7684 application.yml \u4e2d\u914d\u7f6enamespace")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"server:\n  port: 8005\nspring:\n  application:\n    name: cloud-provider-payment-nacos-8005\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n        service: cloud-provider-payment-nacos\n        namespace: ad9448c4-6809-4511-9cb5-7724ec0bce3d\n        ip: localhost\n\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2462. \u8fdb\u5165Nacos \u63d0\u4f9b\u7684\u7ba1\u7406\u9762\u677f,dev\u547d\u540d\u7a7a\u95f4\u4e2d\u6ce8\u518c\u7684\u670d\u52a1")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20201213200122669",src:t(70766).Z,width:"1344",height:"249"})),(0,l.kt)("h2",{id:"5-nacos-\u5143\u6570\u636emeta-data"},"5. Nacos \u5143\u6570\u636e\uff08Meta-Data\uff09"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u4ec0\u4e48\u662f \u5143\u6570\u636e ?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Nacos\u6570\u636e\uff08\u5982\u914d\u7f6e\u548c\u670d\u52a1\uff09\u63cf\u8ff0\u4fe1\u606f",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5982\u670d\u52a1\u7248\u672c\u3001\u6743\u91cd\u3001\u5bb9\u707e\u7b56\u7565\u3001\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u3001\u9274\u6743\u914d\u7f6e\u3001\u5404\u79cd\u81ea\u5b9a\u4e49\u6807\u7b7e (label)"))),(0,l.kt)("li",{parentName:"ul"},"\u4ece\u4f5c\u7528\u8303\u56f4\u6765\u770b\uff0c\u5206\u4e3a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u670d\u52a1\u7ea7\u522b\u7684\u5143\u6570\u636e")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u96c6\u7fa4\u7684\u5143\u6570\u636e ")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u5b9e\u4f8b\u7684\u5143\u6570\u636e ")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5143\u6570\u636e\u7684\u4f5c\u7528"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u63d0\u4f9b\u5fae\u670d\u52a1\u7684\u63cf\u8ff0\u4fe1\u606f"),(0,l.kt)("li",{parentName:"ul"},'\u5b9e\u73b0 "\u7248\u672c\u63a7\u5236"',(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u5141\u8bb8\u591a\u4e2a\u7248\u672c\u7684\u5fae\u670d\u52a1\u4e4b\u95f4\u8fdb\u884c\u76f8\u4e92\u8c03\u7528 , \u4f46\u662f V1 \u7248\u672c \u7684\u5fae\u670d\u52a1A \u53ea\u80fd\u8c03\u7528 V1 \u7248\u672c\u7684 \u5fae\u670d\u52a1B ( \u5b9e\u73b0",(0,l.kt)("font",{color:"blue"},"\u7070\u5ea6\u53d1\u5e03")," )"))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5982\u4f55\u8bbe\u7f6e\u5fae\u670d\u52a1\u7684\u5143\u6570\u636e ?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u63a7\u5236\u53f0\u8bbe\u7f6e"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.cloud.nacos.discovery.metadata"),"  : \u662f\u4e00\u4e2aMap<String,String>")))))),(0,l.kt)("h2",{id:"6-nacos-\u96c6\u7fa4-\u4e0e\u6301\u4e45\u5316"},"6. Nacos \u96c6\u7fa4 \u4e0e\u6301\u4e45\u5316"),(0,l.kt)("h3",{id:"61-nacos-\u6301\u4e45\u5316"},"6.1 Nacos \u6301\u4e45\u5316"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("mark",null,"Nacos\u9ed8\u8ba4\u4f7f\u7528derby \u5d4c\u5165\u5f0f\u6570\u636e\u5e93")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u5982\u4f55\u5c06\u6570\u636e\u5e93\u5207\u6362\u5230Mysql\uff1f"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"\u6267\u884c Nacos conf\u76ee\u5f55\u4e0b\u7684 nacos-mysql.sql"),(0,l.kt)("li",{parentName:"ol"},"\u4fee\u6539 Nacos conf\u76ee\u5f55\u4e0b\u9762\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"application.properties"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"spring.datasource.platform=mysql")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"db.num=xxx")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"db.url.0=jdbcurl")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"db.user=xxx")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"db.password")))),(0,l.kt)("li",{parentName:"ol"},"\u542f\u52a8nacos")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"spring.datasource.platform=mysql\ndb.num=1\ndb.url.0=jdbc:mysql://172.24.70.217:3306/cloud001?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true\ndb.user=root\ndb.password=123\n")),(0,l.kt)("h3",{id:"62-nacos-\u7684\u96c6\u7fa4\u67b6\u6784\u6a21\u5f0f"},"6.2 Nacos \u7684\u96c6\u7fa4\u67b6\u6784\u6a21\u5f0f"),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(22732).Z,width:"1232",height:"926"})),(0,l.kt)("h4",{id:"621-nginxnacosmysql-\u6784\u5efa\u6301\u4e45\u5316\u7684nacos\u96c6\u7fa4"},"6.2.1 Nginx+Nacos+Mysql \u6784\u5efa\u6301\u4e45\u5316\u7684Nacos\u96c6\u7fa4"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u64cd\u4f5c\u6b65\u9aa4\uff1f"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5b89\u88c5Mysql/MariaDB"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"green"},"\u5bfc\u5165\u521d\u59cb\u5316\u811a\u672c"),": \u5c06Nacos conf\u76ee\u5f55\u4e0b\u9762\u7684 ",(0,l.kt)("code",null,"nacos-mysql.sql")," \u6587\u4ef6\u5bfc\u5165\u5230Mysql"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u914d\u7f6eNacos"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"green"},"\u4fee\u6539 application.properties")," : \u914d\u7f6eNacos conf\u76ee\u5f55\u4e0b\u9762\u7684 ",(0,l.kt)("code",null,"application.properties")," \u6587\u4ef6\uff0c\u914d\u7f6e\u6570\u636e\u5e93\u8fde\u63a5"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"\u6dfb\u52a0 cluster.conf"),": \u5728 Nacos conf\u76ee\u5f55\u4e0b\u65b0\u52a0 ",(0,l.kt)("code",null,"cluster.conf"),"\uff0c\u914d\u7f6e\u683c\u5f0f\u5982\u4e0b",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-conf"},"Nacos\u8282\u70b91\u7684ip:Nacos\u670d\u52a1\u7aef\u53e3\nNacos\u8282\u70b92\u7684ip:Nacos\u670d\u52a1\u7aef\u53e3\nNacos\u8282\u70b93\u7684ip:Nacos\u670d\u52a1\u7aef\u53e3\n....\nNacos\u8282\u70b9N\u7684ip:Nacos\u670d\u52a1\u7aef\u53e3\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4fee\u6539Nginx\u914d\u7f6e\u6587\u4ef6\u7684\u8d1f\u8f7d\u5747\u8861"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-conf"},"upstrream xxx{\n    server Nacos\u8282\u70b91\u7684ip:Nacos\u670d\u52a1\u7aef\u53e3\n    server Nacos\u8282\u70b92\u7684ip:Nacos\u670d\u52a1\u7aef\u53e3\n    server Nacos\u8282\u70b93\u7684ip:Nacos\u670d\u52a1\u7aef\u53e3\n    ....\n    server Nacos\u8282\u70b9N\u7684ip:Nacos\u670d\u52a1\u7aef\u53e3\n}\nserver {\n  listen 80;\n  server_name  localhost;\n  location / {\n    proxy_pass http://xxxx;\n  }\n}\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Spring Cloud Alibaba\u8fde\u63a5Nacos\u96c6\u7fa4"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"`spring.cloud.nacos.discovery.server-addr=\xa0nginx\u7ed1\u5b9a\u57df\u540d:\u7aef\u53e3`"))))))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460\u3001 \u914d\u7f6eNacos \u7684application.properties ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"server.servlet.contextPath=/nacos\nserver.port=8848\nspring.datasource.platform=mysql\ndb.num=1\ndb.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC\ndb.user=root\ndb.password=123\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461\u3001 \u914d\u7f6eNacos \u7684cluster.conf ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-conf"},"172.24.159.32:8848\n172.24.82.63:8848\n172.24.95.56:8848\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2462\u3001 \u914d\u7f6eNginx \u7684\u591a\u670d\u52a1\u5668\u8d1f\u8f7d ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-conf"},"server {\n        listen       8088;\n        server_name  localhost;\n        location / {\n            proxy_pass http://nacos;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n\nupstream nacos {\n    server 172.24.159.32:8848;\n    server 172.24.82.63:8848;\n    server 172.24.95.56:8848;\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2463\u3001 \u901a\u8fc7Nginx\u4ee3\u7406\u8bbf\u95eeNacos\u670d\u52a1 ")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20201216134235260",src:t(23765).Z,width:"1090",height:"429"})),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2464\u3001 \u67e5\u770b\u96c6\u7fa4\u72b6\u6001 ")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("font",{color:"red"},"Nacos \u901a\u8fc7 Raft\u534f\u8bae\u9009\u4e3e\u51faNacos\u96c6\u7fa4\u7684LEADER\u3001FOLLOWER"))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20201219154713163",src:t(73942).Z,width:"1672",height:"1185"})),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2465\u3001 Nacos\u5ba2\u6237\u7aef\u8bbf\u95ee\u96c6\u7fa4 ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"spring:\n  application:\n    name: cloud-provider-payment-sentinel-8007\n  profiles:\n    active: dev\n  cloud:\n    nacos:\n      discovery:\n        ip: 172.24.230.126\n        service: cloud-provider-payment-sentinel\n        # \u4f7f\u7528nginx \u642d\u5efanacos \u96c6\u7fa4\n        server-addr: 172.24.95.56:8088\n        # \u4f7f\u7528\u81ea\u5b9a\u4e49\u7684namespace id\n        namespace: dev-coustom-20201219\n      config:\n        namespace: dev-coustom-20201219\n        server-addr: 172.24.95.56:8088\n        prefix: cloud-provider-payment-sentinel-8007\n        file-extension: yaml\n")))}m.isMDXComponent=!0},62059:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201213192559390-14fe1a664fafc240e9e7f21de2d69e5f.png"},11335:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201213194620607-39aab2ddfc93174ce7f19390ea64c220.png"},70766:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201213200122669-959d55bc8007acd6622fa3522e0573bb.png"},65252:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201213210130705-18cb576d0ed28366fb177aa4201a65ca.png"},20868:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201214100238226-4e6311312dc151cb3be37d574c826fc4.png"},73948:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201214200230990-486c293acfbf9bc603a2d71c159ade3c.png"},82705:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201214200305144-0e1ef58601746fc600881fb52c3bf13d.png"},51079:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201214202929160-10d2f138faaa70313a115ff0f8f257be.png"},81625:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201214203344952-08f920cfe35ad199038a80ecfa7f6262.png"},22732:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201215154214394-4e3476fe3b11739c06ffd391f02e399f.png"},23765:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201216134235260-ca37cb8227bc1bd424fc6ad2507a8783.png"},73942:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/image-20201219154713163-b578f40d08dd63a2a8f93b6183771b66.png"}}]);